import{Z as qe}from"./index.esm-nwFtzgNC.js";import{A as Be}from"./AppLayout-B-F94kRC.js";import{r as m,k as R,B as je,y as Oe,i as f,o as w,c as M,w as a,J as Ye,b as e,u as Je,f as i,t as _,e as q,a as u,d as $,g as ye,F as Q,K as Ke,L as Ze}from"./app-Cqyzzk-o.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Ge=u("h2",{class:"text-h6"},"WhatsApp Business",-1),He={class:"d-flex justify-center align-center mt-2"},Qe=u("div",{class:"text-subtitle-2"},"Sent",-1),Xe={class:"text-h6"},ea=u("div",{class:"text-subtitle-2"},"Delivered",-1),aa={class:"text-h6"},ta=u("div",{class:"text-subtitle-2"},"Read",-1),la={class:"text-h6"},sa=u("div",{class:"text-subtitle-2"},"Pending",-1),na={class:"text-h6"},oa=u("div",{class:"text-subtitle-2"},"Failed",-1),ia={class:"text-h6"},ra=u("div",{class:"text-h6"},"Recent Messages",-1),ua={key:1,class:"text-center pa-4"},da=u("p",{class:"text-body-1 mt-2"},"No messages found. Try sending one!",-1),ca=u("thead",null,[u("tr",null,[u("th",{class:"text-left"},"Content"),u("th",{class:"text-left"},"Recipient"),u("th",{class:"text-left"},"Status"),u("th",{class:"text-left"},"Sent Date"),u("th",{class:"text-center"},"Actions")])],-1),va={class:"text-center"},pa={key:3,class:"d-flex justify-center mt-4"},ma=u("span",null,"WhatsApp Contacts",-1),fa={class:"mt-4 text-caption"},_a=u("h3",null,"CSV File Requirements",-1),ga=u("p",{class:"mb-2"},"Your CSV file should include the following columns:",-1),ya=u("ul",null,[u("li",null,"Name (required)"),u("li",null,"Phone Number (required, in international format)"),u("li",null,"WhatsApp Number (optional, in international format)"),u("li",null,"Alternative Phone (optional)"),u("li",null,"Email (optional)"),u("li",null,"Company (optional)"),u("li",null,"Status (optional)")],-1),ha=u("strong",null,"Important:",-1),ba={class:"mt-4"},wa={key:0,class:"text-center pa-4"},Aa=u("p",{class:"text-body-1 mt-2"},"No templates available",-1),xa={key:0},Ca={class:"d-flex flex-wrap justify-space-between align-center"},Va={class:"text-caption text-grey"},ka=u("br",null,null,-1),Ta={class:"d-flex mt-2 mt-sm-0"},$a={key:1,class:"text-center pa-4"},Sa=u("p",{class:"text-body-1 mt-2"},"Select a template to edit or create a new one",-1),Ia={__name:"WhatsApp",setup(Ma){const B=m("all"),j=m("all"),he=m(10),be=[{title:"All Types",value:"all"},{title:"Customer",value:"customer"},{title:"Vendor",value:"vendor"},{title:"Partner",value:"partner"},{title:"Employee",value:"employee"}],we=[{title:"All Statuses",value:"all"},{title:"Active",value:1},{title:"Inactive",value:0}],ue=R(()=>{if(!Array.isArray(A.value))return[];let s=[...A.value];return B.value!=="all"&&(s=s.filter(l=>l.type===B.value)),j.value!=="all"&&(s=s.filter(l=>l.status===j.value)),s}),Ae=s=>!!(s.whatsapp||s.alt_phone||s.phone),xe=s=>{alert(`Contact: ${s.name}
Phone: ${s.phone||"N/A"}
WhatsApp: ${s.whatsapp||"N/A"}
Type: ${s.type||"N/A"}
Company: ${s.company_name||"N/A"}
Country: ${s.country_name||"N/A"}`)},de=(s=!1,l=null)=>{F.value="",V.value="",s?h.value=pe.value:l?h.value=[l]:h.value=[],(!Array.isArray(p.value)||p.value.length===0)&&!r.value.templates&&le(),W.value=!0},Ce=()=>{S.value="",B.value="all",j.value="all"},X=R(()=>{var s;return(s=Ye().props.value.user)==null?void 0:s.id}),S=m(""),y=m([]),r=m({messages:!1,contacts:!1,templates:!1,sending:!1,importing:!1,savingTemplate:!1,deletingTemplate:!1}),A=m([]),h=m([]),V=m(""),p=m([]),O=m(!1),W=m(!1),K=m(!1),F=m(""),Z=m(""),z=m(null),Y=m(1),ce=m(20),ve=m(0),Ve=m({name:"",content:"",channel:"WhatsApp",module:"Message"}),d=m(null),P=m(!1),k=m("Connected"),T=m({sent:0,delivered:0,read:0,failed:0,pending:0}),pe=m([]),ee=R(()=>Math.ceil(ve.value/ce.value));R(()=>{const s=[],o=Math.floor(2.5);let n=Math.max(1,Y.value-o),c=Math.min(ee.value,n+5-1);c-n+1<5&&(n=Math.max(1,c-5+1));for(let v=n;v<=c;v++)s.push(v);return s});const ae=R(()=>{if(!S.value||!Array.isArray(y.value))return y.value;const s=S.value.toLowerCase();return y.value.filter(l=>{var o,n,c,v;return((o=l.content)==null?void 0:o.toLowerCase().includes(s))||((n=l.status)==null?void 0:n.toLowerCase().includes(s))||((c=l.recipient_name)==null?void 0:c.toLowerCase().includes(s))||((v=l.recipient_phone)==null?void 0:v.toLowerCase().includes(s))})}),me=R(()=>Array.isArray(A.value)?A.value.filter(s=>s.whatsapp||s.alt_phone):[]),G=async(s=1)=>{var l,o,n,c;try{r.value.messages=!0,Y.value=s;const v=await axios.get("/api/v1/whatsapp-messages",{params:{page:s,per_page:ce.value}});(o=(l=v.data)==null?void 0:l.data)!=null&&o.data&&Array.isArray(v.data.data.data)?(y.value=v.data.data.data,ve.value=v.data.data.total||y.value.length,fe()):(console.error("Unexpected API response format:",v.data),Array.isArray(y.value)||(y.value=[]),b("Invalid data format received from server"))}catch(v){console.error("Error loading messages:",v),b(`Failed to load messages: ${((c=(n=v.response)==null?void 0:n.data)==null?void 0:c.message)||v.message}`),Array.isArray(y.value)||(y.value=[])}finally{r.value.messages=!1}};je(S,s=>{s===""&&G(Y.value)});const fe=()=>{if(!Array.isArray(y.value)){console.error("messages.value is not an array:",y.value);return}try{const s=y.value.reduce((l,o)=>{const n=o&&o.status&&typeof o.status=="string"?o.status.toLowerCase():"unknown";return l[n]=(l[n]||0)+1,l},{});T.value={sent:s.sent||0,delivered:s.delivered||0,read:s.read||0,failed:s.failed||0,pending:s.pending||0},y.value.forEach(l=>{if(l.message_status&&l.message_status!==l.status){const o=l.message_status.toLowerCase();T.value[o]=(T.value[o]||0)+1}})}catch(s){console.error("Error calculating stats:",s),T.value={sent:0,delivered:0,read:0,failed:0,pending:0}}},te=async()=>{var s,l,o,n;try{r.value.contacts=!0;const c=await axios.get("/api/v1/contacts");(l=(s=c.data)==null?void 0:s.data)!=null&&l.data&&Array.isArray(c.data.data.data)?(A.value=c.data.data.data,ue=A,console.log("Contacts loaded:",A.value.length)):(console.error("Unexpected API response format:",c.data),(!Array.isArray(A.value)||A.value.length===0)&&(A.value=[]),b("Invalid contact data format received from server"))}catch(c){console.error("Error loading contacts:",c),b(`Failed to load contacts: ${((n=(o=c.response)==null?void 0:o.data)==null?void 0:n.message)||c.message}`),(!Array.isArray(A.value)||A.value.length===0)&&(A.value=[])}finally{r.value.contacts=!1}},le=async()=>{var s,l,o;try{r.value.templates=!0;const n=await axios.get("/api/v1/templates");(s=n.data)!=null&&s.data&&Array.isArray(n.data.data)?(p.value=n.data.data,console.log("Templates loaded:",p.value.length)):(console.error("Unexpected API response format:",n.data),(!Array.isArray(p.value)||p.value.length===0)&&(p.value=[]),b("Invalid template data format received from server"))}catch(n){console.error("Error loading templates:",n),b(`Failed to load templates: ${((o=(l=n.response)==null?void 0:l.data)==null?void 0:o.message)||n.message}`),(!Array.isArray(p.value)||p.value.length===0)&&(p.value=[])}finally{r.value.templates=!1}},ke=s=>{if(!s||!Array.isArray(p.value))return;const l=p.value.find(o=>o.id===s);l&&(V.value=l.content,d.value=l,console.log("Selected template:",l))},Te=async()=>{F.value="",V.value="",h.value=[],d.value=null,(!Array.isArray(A.value)||A.value.length===0)&&!r.value.contacts&&await te(),(!Array.isArray(p.value)||p.value.length===0)&&!r.value.templates&&await le(),W.value=!0},b=s=>{F.value=s,setTimeout(()=>{F.value=""},5e3)},U=s=>{Z.value=s,setTimeout(()=>{Z.value=""},5e3)},$e=async()=>{var s,l,o,n,c;if(!V.value.trim())return b("Please enter a message");if(!Array.isArray(h.value)||h.value.length===0)return b("Please select at least one recipient");try{r.value.sending=!0;const v=await axios.post("/api/v1/whatsapp-send",{user_id:X.value,contacts:h.value.map(x=>({id:x.id,name:x.name,chatId:x.whatsapp||x.alt_phone||x.phone})),message:V.value,template_id:((s=d.value)==null?void 0:s.id)||null}),g=new Date;Array.isArray(y.value)||(y.value=[]),y.value.unshift({id:((l=v.data)==null?void 0:l.id)||Date.now(),content:V.value,recipients:h.value.length,status:"sent",message_status:"sent",sent_at:g.toISOString().split("T")[0],created_at:g.toISOString(),recipient_name:h.value.map(x=>x.name).join(", "),recipient_phone:h.value.map(x=>x.whatsapp||x.alt_phone||x.phone).join(", "),results:((o=v.data)==null?void 0:o.results)||[]}),T.value.sent+=h.value.length,U(`Message successfully sent to ${h.value.length} recipients`),V.value="",h.value=[],d.value=null,W.value=!1,setTimeout(()=>{G(1)},1e3)}catch(v){console.error("Error sending message:",v),b(`Failed to send message: ${((c=(n=v.response)==null?void 0:n.data)==null?void 0:c.message)||v.message}`)}finally{r.value.sending=!1}},Se=s=>{console.log("Viewing message details:",s),alert(`Message ID: ${s.id}
Content: ${s.content}
Status: ${s.status||s.message_status||"Unknown"}
Sent At: ${s.sent_at||(s.created_at?s.created_at.split("T")[0]:"N/A")}
Recipient: ${s.recipient_name||"Unknown"} (${s.recipient_phone||"Unknown"})`)},Me=async s=>{var l,o;if(!s)return b("Invalid message ID");if(confirm("Are you sure you want to delete this message?"))try{await axios.delete(`/api/v1/whatsapp-messages/${s}`),Array.isArray(y.value)&&(y.value=y.value.filter(n=>n.id!==s),fe()),U("Message deleted successfully")}catch(n){console.error("Error deleting message:",n),b(`Failed to delete message: ${((o=(l=n.response)==null?void 0:l.data)==null?void 0:o.message)||n.message}`)}},Pe=async()=>{var s,l,o;if(!z.value)return b("Please select a CSV file to import");try{r.value.importing=!0;const n=new FormData;n.append("file",z.value),n.append("user_id",X.value);const c=await axios.post("/api/v1/contacts/import",n,{headers:{"Content-Type":"multipart/form-data"}});c.data&&c.data.success?(U(`Successfully imported ${c.data.imported||"multiple"} contacts`),await te(),O.value=!1,z.value=null):b(((s=c.data)==null?void 0:s.message)||"Import failed")}catch(n){console.error("Error importing contacts:",n),b(`Failed to import contacts: ${((o=(l=n.response)==null?void 0:l.data)==null?void 0:o.message)||n.message}`)}finally{r.value.importing=!1}},Ne=()=>{P.value=!0,d.value={...Ve.value}},Ue=async()=>{var s,l;if(!d.value||!d.value.name||!d.value.content)return b("Template name and content are required");try{r.value.savingTemplate=!0;let o;const n={name:d.value.name,content:d.value.content,channel:d.value.channel||"WhatsApp",module:d.value.module||"Message",user_id:X.value};if(P.value||!d.value.id)o=await axios.post("/api/v1/templates",n),o.data&&o.data.data&&(Array.isArray(p.value)||(p.value=[]),p.value.push(o.data.data),U("Template created successfully"));else if(o=await axios.put(`/api/v1/templates/${d.value.id}`,n),o.data&&o.data.data){const c=p.value.findIndex(v=>v.id===d.value.id);c!==-1&&(p.value[c]=o.data.data),U("Template updated successfully")}P.value=!1}catch(o){console.error("Error saving template:",o),b(`Failed to save template: ${((l=(s=o.response)==null?void 0:s.data)==null?void 0:l.message)||o.message}`)}finally{r.value.savingTemplate=!1}},De=async()=>{var s,l;if(!d.value||!d.value.id)return b("No template selected");if(confirm(`Are you sure you want to delete template "${d.value.name}"?`))try{r.value.deletingTemplate=!0,await axios.delete(`/api/v1/templates/${d.value.id}`),p.value=p.value.filter(o=>o.id!==d.value.id),d.value=null,U("Template deleted successfully")}catch(o){console.error("Error deleting template:",o),b(`Failed to delete template: ${((l=(s=o.response)==null?void 0:s.data)==null?void 0:l.message)||o.message}`)}finally{r.value.deletingTemplate=!1}},Ie=async()=>{var s,l,o;try{k.value="Connecting...";const n=await axios.post("/api/v1/whatsapp-reconnect");n.data&&n.data.success?(k.value="Connected",U("WhatsApp connection successful")):(k.value="Disconnected",b(((s=n.data)==null?void 0:s.message)||"Failed to connect to WhatsApp"))}catch(n){console.error("Error reconnecting WhatsApp:",n),k.value="Disconnected",b(`Failed to connect to WhatsApp: ${((o=(l=n.response)==null?void 0:l.data)==null?void 0:o.message)||n.message}`)}},We=s=>s?s.replace(/@c\.us$/,""):"Unknown";return Oe(()=>(y.value=[],A.value=[],p.value=[],G(1),te(),le(),()=>{clearInterval(statusInterval)})),(s,l)=>{const o=f("v-alert"),n=f("v-icon"),c=f("v-avatar"),v=f("v-chip"),g=f("v-btn"),x=f("v-divider"),C=f("v-col"),J=f("v-row"),D=f("v-card-text"),N=f("v-card"),se=f("v-text-field"),I=f("v-card-title"),ne=f("v-progress-linear"),Fe=f("v-table"),ze=f("v-pagination"),_e=f("v-container"),E=f("v-select"),Ee=f("v-data-table"),oe=f("v-list-item"),ge=f("v-textarea"),ie=f("v-spacer"),H=f("v-card-actions"),re=f("v-dialog"),Le=f("v-file-input"),Re=f("v-list");return w(),M(Be,null,{default:a(()=>[e(Je(qe),{title:"WhatsApp Business"}),e(_e,null,{default:a(()=>[F.value?(w(),M(o,{key:0,type:"error",closable:"",class:"mb-4"},{default:a(()=>[i(_(F.value),1)]),_:1})):q("",!0),Z.value?(w(),M(o,{key:1,type:"success",closable:"",class:"mb-4"},{default:a(()=>[i(_(Z.value),1)]),_:1})):q("",!0),e(J,null,{default:a(()=>[e(C,{cols:"12",md:"3"},{default:a(()=>[e(N,null,{default:a(()=>[e(D,{class:"text-center"},{default:a(()=>[e(c,{size:"80",color:k.value==="Connected"?"green":"grey",class:"mb-3"},{default:a(()=>[e(n,{size:"48",color:"white"},{default:a(()=>[i("mdi-whatsapp")]),_:1})]),_:1},8,["color"]),Ge,u("div",He,[e(v,{color:k.value==="Connected"?"success":k.value==="Connecting..."?"warning":"error",class:"mr-2"},{default:a(()=>[i(_(k.value),1)]),_:1},8,["color"]),k.value!=="Connected"&&k.value!=="Connecting..."?(w(),M(g,{key:0,size:"small",color:"primary",icon:"",onClick:Ie},{default:a(()=>[e(n,null,{default:a(()=>[i("mdi-refresh")]),_:1})]),_:1})):q("",!0)]),e(x,{class:"my-4"}),e(J,null,{default:a(()=>[e(C,{cols:"6",class:"py-1"},{default:a(()=>[Qe,u("div",Xe,_(T.value.sent),1)]),_:1}),e(C,{cols:"6",class:"py-1"},{default:a(()=>[ea,u("div",aa,_(T.value.delivered),1)]),_:1}),e(C,{cols:"6",class:"py-1"},{default:a(()=>[ta,u("div",la,_(T.value.read),1)]),_:1}),e(C,{cols:"6",class:"py-1"},{default:a(()=>[sa,u("div",na,_(T.value.pending),1)]),_:1}),e(C,{cols:"12",class:"py-1"},{default:a(()=>[oa,u("div",ia,_(T.value.failed),1)]),_:1})]),_:1}),e(x,{class:"my-4"}),e(g,{color:"primary",block:"",class:"mb-2",onClick:Te},{default:a(()=>[e(n,{class:"mr-2"},{default:a(()=>[i("mdi-message-text")]),_:1}),i(" New Message ")]),_:1}),e(g,{color:"info",block:"",class:"mb-2",onClick:l[0]||(l[0]=t=>O.value=!0)},{default:a(()=>[e(n,{class:"mr-2"},{default:a(()=>[i("mdi-file-import")]),_:1}),i(" Import Contacts ")]),_:1}),e(g,{color:"secondary",block:"",onClick:l[1]||(l[1]=t=>K.value=!0)},{default:a(()=>[e(n,{class:"mr-2"},{default:a(()=>[i("mdi-file-document-edit")]),_:1}),i(" Manage Templates ")]),_:1})]),_:1})]),_:1})]),_:1}),e(C,{cols:"12",md:"9"},{default:a(()=>[e(N,null,{default:a(()=>[e(I,{class:"d-flex flex-wrap justify-space-between align-center"},{default:a(()=>[ra,e(se,{modelValue:S.value,"onUpdate:modelValue":l[2]||(l[2]=t=>S.value=t),"append-icon":"mdi-magnify",label:"Search messages","single-line":"","hide-details":"",density:"compact",class:"max-w-xs mt-2 mt-sm-0"},null,8,["modelValue"])]),_:1}),e(D,null,{default:a(()=>[r.value.messages?(w(),M(ne,{key:0,indeterminate:"",color:"primary"})):!Array.isArray(ae.value)||ae.value.length===0?(w(),$("div",ua,[e(n,{size:"large",color:"grey"},{default:a(()=>[i("mdi-message-text-outline")]),_:1}),da])):(w(),M(Fe,{key:2},{default:a(()=>[ca,u("tbody",null,[(w(!0),$(Q,null,ye(ae.value,t=>(w(),$("tr",{key:t.id},[u("td",null,_(t.content),1),u("td",null,_(We(t.recipient_phone)),1),u("td",null,[e(v,{color:t.status==="delivered"||t.message_status==="delivered"?"success":t.status==="read"||t.message_status==="read"?"info":t.status==="failed"||t.message_status==="failed"?"error":t.status==="sent"||t.message_status==="sent"?"primary":"warning",size:"small"},{default:a(()=>[i(_(t.message_status||t.status||"Unknown"),1)]),_:2},1032,["color"])]),u("td",null,_(s.formatDate(t.sent_at||t.created_at)),1),u("td",va,[e(g,{icon:"",size:"small",color:"info",variant:"text",onClick:L=>Se(t)},{default:a(()=>[e(n,null,{default:a(()=>[i("mdi-eye")]),_:1})]),_:2},1032,["onClick"]),e(g,{icon:"",size:"small",color:"error",variant:"text",onClick:L=>Me(t.id)},{default:a(()=>[e(n,null,{default:a(()=>[i("mdi-delete")]),_:1})]),_:2},1032,["onClick"])])]))),128))])]),_:1})),ee.value>1?(w(),$("div",pa,[e(ze,{modelValue:Y.value,"onUpdate:modelValue":[l[3]||(l[3]=t=>Y.value=t),G],length:ee.value,"total-visible":5},null,8,["modelValue","length"])])):q("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(_e,null,{default:a(()=>[e(J,null,{default:a(()=>[e(C,{cols:"12"},{default:a(()=>[e(N,null,{default:a(()=>[e(I,{class:"d-flex align-center justify-space-between"},{default:a(()=>[ma,u("div",null,[e(g,{color:"success",onClick:l[4]||(l[4]=t=>de(!0)),disabled:!pe.value.length},{default:a(()=>[e(n,{start:""},{default:a(()=>[i("mdi-send")]),_:1}),i(" Bulk Message ")]),_:1},8,["disabled"])])]),_:1}),e(D,null,{default:a(()=>[e(J,null,{default:a(()=>[e(C,{cols:"12",sm:"6",md:"4"},{default:a(()=>[e(se,{modelValue:S.value,"onUpdate:modelValue":l[5]||(l[5]=t=>S.value=t),label:"Search Contacts","prepend-inner-icon":"mdi-magnify",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),e(C,{cols:"12",sm:"6",md:"3"},{default:a(()=>[e(E,{modelValue:B.value,"onUpdate:modelValue":l[6]||(l[6]=t=>B.value=t),items:be,label:"Contact Type",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),e(C,{cols:"12",sm:"6",md:"3"},{default:a(()=>[e(E,{modelValue:j.value,"onUpdate:modelValue":l[7]||(l[7]=t=>j.value=t),items:we,label:"Contact Status",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),e(C,{cols:"12",sm:"6",md:"2"},{default:a(()=>[e(g,{color:"info",variant:"text",onClick:Ce},{default:a(()=>[e(n,{start:""},{default:a(()=>[i("mdi-filter-off")]),_:1}),i(" Reset ")]),_:1})]),_:1})]),_:1}),e(Ee,{modelValue:h.value,"onUpdate:modelValue":l[8]||(l[8]=t=>h.value=t),headers:[{title:"ID",key:"id",width:"5%"},{title:"Name",key:"name",width:"20%"},{title:"WhatsApp",key:"whatsapp",width:"15%"},{title:"Type",key:"type",width:"10%"},{title:"Company",key:"company_name",width:"15%"},{title:"Status",key:"status",width:"10%"},{title:"Country",key:"country_name",width:"15%"},{title:"Actions",key:"actions",sortable:!1,width:"10%"}],items:ue.value,search:S.value,"items-per-page":he.value,"item-value":"id","show-select":"",class:"mt-4"},{"item.whatsapp":a(({item:t})=>[i(_(t.whatsapp||t.alt_phone||t.phone||"N/A"),1)]),"item.type":a(({item:t})=>[e(v,{color:t.type==="customer"?"primary":t.type==="vendor"?"success":t.type==="partner"?"warning":t.type==="employee"?"info":"grey",size:"small"},{default:a(()=>[i(_(t.type),1)]),_:2},1032,["color"])]),"item.status":a(({item:t})=>[e(v,{color:t.status===1?"success":"grey",size:"small"},{default:a(()=>[i(_(t.status===1?"Active":"Inactive"),1)]),_:2},1032,["color"])]),"item.actions":a(({item:t})=>[e(g,{icon:"",size:"small",color:"primary",onClick:L=>xe(t)},{default:a(()=>[e(n,null,{default:a(()=>[i("mdi-eye")]),_:1})]),_:2},1032,["onClick"]),e(g,{icon:"",size:"small",color:"success",onClick:L=>de(!1,t),disabled:!Ae(t)},{default:a(()=>[e(n,null,{default:a(()=>[i("mdi-send")]),_:1})]),_:2},1032,["onClick","disabled"])]),_:1},8,["modelValue","items","search","items-per-page"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(re,{modelValue:W.value,"onUpdate:modelValue":l[12]||(l[12]=t=>W.value=t),"max-width":"700px"},{default:a(()=>[e(N,null,{default:a(()=>[e(I,null,{default:a(()=>[e(n,{color:"primary",class:"mr-2"},{default:a(()=>[i("mdi-message-text")]),_:1}),i(" Send WhatsApp Message ")]),_:1}),e(D,null,{default:a(()=>[r.value.contacts||r.value.templates?(w(),M(ne,{key:0,indeterminate:"",color:"primary",class:"mb-4"})):q("",!0),e(E,{modelValue:h.value,"onUpdate:modelValue":l[9]||(l[9]=t=>h.value=t),items:me.value,"item-title":"name","item-value":"id",label:"Select Recipients",multiple:"",chips:"","return-object":"",hint:`${me.value.length} contacts with WhatsApp numbers available`,"persistent-hint":"",loading:r.value.contacts,disabled:r.value.contacts,rules:[t=>Array.isArray(t)&&t.length>0||"At least one recipient is required"]},{"prepend-item":a(()=>[e(oe,{title:"WhatsApp Recipients",disabled:""}),e(x)]),selection:a(({item:t})=>[e(v,null,{default:a(()=>[i(_(t.raw.name)+" ("+_(t.raw.whatsapp||t.raw.alt_phone||t.raw.phone)+") ",1)]),_:2},1024)]),item:a(({item:t,props:L})=>[e(oe,Ke(Ze(L)),{prepend:a(()=>[e(c,{color:"grey-lighten-3",size:"36"},{default:a(()=>[e(n,{color:"grey-darken-2"},{default:a(()=>[i("mdi-account")]),_:1})]),_:1})]),title:a(()=>[i(_(t.raw.name),1)]),subtitle:a(()=>[i(_(t.raw.whatsapp||t.raw.alt_phone||t.raw.phone),1)]),_:2},1040)]),_:1},8,["modelValue","items","hint","loading","disabled","rules"]),e(E,{label:"Select Template",items:p.value,"item-title":"name","item-value":"id","onUpdate:modelValue":ke,class:"mt-4",hint:d.value?`Channel: ${d.value.channel||"WhatsApp"} | Type: ${d.value.module||"Message"}`:"","persistent-hint":"",loading:r.value.templates,disabled:r.value.templates,clearable:""},null,8,["items","hint","loading","disabled"]),e(ge,{modelValue:V.value,"onUpdate:modelValue":l[10]||(l[10]=t=>V.value=t),label:"Message",rows:"5",class:"mt-4",hint:"Variables format: {{variable_name}}","persistent-hint":"",rules:[t=>!!t||"Message is required"],disabled:r.value.sending},null,8,["modelValue","rules","disabled"]),u("div",fa,[e(n,{size:"small",color:"info",class:"mr-1"},{default:a(()=>[i("mdi-information-outline")]),_:1}),i(" Your message will be sent to "+_(h.value.length)+" recipient(s). ",1)])]),_:1}),e(H,null,{default:a(()=>[e(ie),e(g,{color:"error",variant:"outlined",onClick:l[11]||(l[11]=t=>W.value=!1),disabled:r.value.sending},{default:a(()=>[i(" Cancel ")]),_:1},8,["disabled"]),e(g,{color:"primary",onClick:$e,loading:r.value.sending,disabled:!V.value||!Array.isArray(h.value)||h.value.length===0||r.value.sending},{default:a(()=>[i(" Send Message ")]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(re,{modelValue:O.value,"onUpdate:modelValue":l[15]||(l[15]=t=>O.value=t),"max-width":"500px"},{default:a(()=>[e(N,null,{default:a(()=>[e(I,null,{default:a(()=>[e(n,{color:"primary",class:"mr-2"},{default:a(()=>[i("mdi-file-import")]),_:1}),i(" Import Contacts ")]),_:1}),e(D,null,{default:a(()=>[e(Le,{modelValue:z.value,"onUpdate:modelValue":l[13]||(l[13]=t=>z.value=t),label:"Upload CSV File",accept:".csv","prepend-icon":"mdi-file-upload","show-size":"","truncate-length":"25",loading:r.value.importing,disabled:r.value.importing,rules:[t=>!!t||"CSV file is required"]},null,8,["modelValue","loading","disabled","rules"]),e(o,{type:"info",class:"mt-4",variant:"tonal"},{default:a(()=>[_a,ga,ya]),_:1}),e(o,{type:"warning",class:"mt-2",variant:"tonal"},{default:a(()=>[ha,i(" Phone numbers should be in international format (e.g., +1234567890) ")]),_:1}),u("div",ba,[e(g,{color:"secondary",variant:"outlined","prepend-icon":"mdi-download",block:""},{default:a(()=>[i(" Download Sample CSV ")]),_:1})])]),_:1}),e(H,null,{default:a(()=>[e(ie),e(g,{color:"error",variant:"outlined",onClick:l[14]||(l[14]=t=>O.value=!1),disabled:r.value.importing},{default:a(()=>[i(" Cancel ")]),_:1},8,["disabled"]),e(g,{color:"primary",onClick:Pe,loading:r.value.importing,disabled:!z.value||r.value.importing},{default:a(()=>[i(" Import Contacts ")]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(re,{modelValue:K.value,"onUpdate:modelValue":l[21]||(l[21]=t=>K.value=t),"max-width":"700px"},{default:a(()=>[e(N,null,{default:a(()=>[e(I,null,{default:a(()=>[e(n,{color:"primary",class:"mr-2"},{default:a(()=>[i("mdi-file-document-edit")]),_:1}),i(" Manage Templates ")]),_:1}),e(D,null,{default:a(()=>[r.value.templates?(w(),M(ne,{key:0,indeterminate:"",color:"primary",class:"mb-4"})):q("",!0),e(J,null,{default:a(()=>[e(C,{cols:"12",md:"4"},{default:a(()=>[e(N,{variant:"outlined"},{default:a(()=>[e(I,{class:"text-subtitle-1"},{default:a(()=>[i("Available Templates")]),_:1}),e(Re,null,{default:a(()=>[!Array.isArray(p.value)||p.value.length===0?(w(),$("div",wa,[e(n,{size:"large",color:"grey"},{default:a(()=>[i("mdi-file-document-outline")]),_:1}),Aa])):(w(!0),$(Q,{key:1},ye(p.value,t=>(w(),M(oe,{key:t.id,title:t.name,subtitle:t.channel||"WhatsApp",onClick:L=>{d.value={...t},P.value=!1},active:d.value&&d.value.id===t.id},{prepend:a(()=>[e(n,{color:"primary"},{default:a(()=>[i("mdi-file-document-outline")]),_:1})]),_:2},1032,["title","subtitle","onClick","active"]))),128))]),_:1}),e(H,null,{default:a(()=>[e(g,{color:"success",block:"",onClick:Ne,"prepend-icon":"mdi-plus"},{default:a(()=>[i(" New Template ")]),_:1})]),_:1})]),_:1})]),_:1}),e(C,{cols:"12",md:"8"},{default:a(()=>[e(N,{variant:"outlined",class:"h-100"},{default:a(()=>[e(I,{class:"text-subtitle-1"},{default:a(()=>[i(_(P.value?"Create New Template":d.value?"Edit Template":"Template Details"),1)]),_:1}),e(D,null,{default:a(()=>[d.value?(w(),$("div",xa,[e(se,{modelValue:d.value.name,"onUpdate:modelValue":l[16]||(l[16]=t=>d.value.name=t),label:"Template Name",rules:[t=>!!t||"Template name is required"],disabled:r.value.savingTemplate||r.value.deletingTemplate},null,8,["modelValue","rules","disabled"]),e(E,{modelValue:d.value.channel,"onUpdate:modelValue":l[17]||(l[17]=t=>d.value.channel=t),label:"Channel",items:["WhatsApp","SMS","Email"],disabled:r.value.savingTemplate||r.value.deletingTemplate,class:"mt-4"},null,8,["modelValue","disabled"]),e(E,{modelValue:d.value.module,"onUpdate:modelValue":l[18]||(l[18]=t=>d.value.module=t),label:"Template Type",items:["Message","Notification","Marketing","Reminder"],disabled:r.value.savingTemplate||r.value.deletingTemplate,class:"mt-4"},null,8,["modelValue","disabled"]),e(ge,{modelValue:d.value.content,"onUpdate:modelValue":l[19]||(l[19]=t=>d.value.content=t),label:"Template Content",rows:"8",hint:"Variables format: {{variable_name}}","persistent-hint":"",rules:[t=>!!t||"Template content is required"],disabled:r.value.savingTemplate||r.value.deletingTemplate,class:"mt-4"},null,8,["modelValue","rules","disabled"]),e(x,{class:"my-4"}),u("div",Ca,[u("div",Va,[d.value.id&&!P.value?(w(),$(Q,{key:0},[i(" Template ID: "+_(d.value.id)+" ",1),ka,i(" Last Updated: "+_(d.value.updated_at?new Date(d.value.updated_at).toLocaleString():"N/A"),1)],64)):(w(),$(Q,{key:1},[i(" Creating new template ")],64))]),u("div",Ta,[e(g,{color:"error",class:"mr-2",disabled:P.value||r.value.savingTemplate||r.value.deletingTemplate||!d.value.id,loading:r.value.deletingTemplate,onClick:De},{default:a(()=>[i(" Delete ")]),_:1},8,["disabled","loading"]),e(g,{color:"primary",loading:r.value.savingTemplate,disabled:r.value.savingTemplate||r.value.deletingTemplate||!d.value.name||!d.value.content,onClick:Ue},{default:a(()=>[i(_(P.value?"Create":"Save Changes"),1)]),_:1},8,["loading","disabled"])])])])):(w(),$("div",$a,[e(n,{size:"large",color:"grey"},{default:a(()=>[i("mdi-file-document-outline")]),_:1}),Sa]))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(H,null,{default:a(()=>[e(ie),e(g,{color:"primary",onClick:l[20]||(l[20]=t=>K.value=!1)},{default:a(()=>[i("Close")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}};export{Ia as default};

import{A as S}from"./AppLayout-CjSb-v4r.js";import{s as m,i as a,o as Q,c as K,w as t,b as e,x as B,f as n,D as _,a as F,t as O,E as f}from"./app-Cqk36qee.js";import T from"./Permissions-D4ByWzOf.js";import{_ as q}from"./_plugin-vue_export-helper-DlAUqK2U.js";const j={components:{AppLayout:S,Permissions:T},data(){return{roles:[],dialog:!1,loading:!1,dialogDelete:!1,headers:[{title:"Agent Name",align:"start",sortable:!1,key:"name"},{title:"Email",key:"email"},{title:"Phone",key:"phone"},{title:"Actions",key:"actions",sortable:!1}],users:[],searchQuery:"",editedIndex:-1,editedItem:{id:null,name:"",email:"",phone:"",selectedRole:null},defaultItem:{id:null,name:"",email:"",phone:"",selectedRole:null}}},computed:{formTitle(){return this.editedIndex===-1?"New Admin":"Edit Admin"}},watch:{dialog(l){l?this.fetchRoles():this.close()},dialogDelete(l){!l&&this.closeDelete()}},created(){this.initialize()},methods:{fetchRoles(){m.get("api/v1/roles").then(o=>{this.roles=o.data}).catch(o=>{console.error("API Error:",o)})},initialize(){m.get("v1/users").then(o=>{this.users=o.data}).catch(o=>console.error("API Error:",o))},editItem(l){this.editedIndex=this.users.indexOf(l),this.editedItem={...l,selectedRole:l.roles.length?l.roles[0]:null},this.dialog=!0},deleteItem(l){this.editedIndex=this.users.indexOf(l),this.editedItem={...l},this.dialogDelete=!0},deleteItemConfirm(){m.delete(`v1/user/${this.editedItem.id}`).then(()=>{this.users.splice(this.editedIndex,1),this.$toastr.success("User deleted successfully"),this.closeDelete()}).catch(l=>console.error("Deletion error:",l))},close(){this.dialog=!1,this.resetForm()},closeDelete(){this.dialogDelete=!1,this.resetForm()},resetForm(){this.editedItem={...this.defaultItem},this.editedIndex=-1},managePermissions(l){this.$refs.PermissionsComponent.showDialog(l.id)},save(){let l;const o={...this.editedItem,role:this.editedItem.selectedRole?this.editedItem.selectedRole.id:null};this.editedIndex>-1?l=m.put(`v1/user/${this.editedItem.id}`,o):l=m.post("v1/user",o),l.then(()=>{this.initialize(),this.close(),this.$toastr.success("User saved successfully")}).catch(y=>console.error("Save error:",y))},performSearch(){this.searchQuery.trim()===""?this.initialize():m.get("v1/users/search",{params:{query:this.searchQuery}}).then(l=>{this.users=l.data}).catch(l=>console.error("Search error:",l))},activateAccount(l){m.post(`v1/user/activate/${l.id}`).then(()=>{this.initialize(),this.$toastr.success("Account activated successfully")}).catch(o=>console.error("Activation error:",o))},resetPassword(l){m.post(`v1/user/reset-password/${l.id}`).then(()=>{this.$toastr.success("Password reset successfully")}).catch(o=>console.error("Password reset error:",o))}}},H={class:"text-h5"};function M(l,o,y,G,i,r){const p=a("v-text-field"),b=a("v-container"),I=a("v-card"),P=a("v-toolbar-title"),w=a("v-divider"),g=a("v-spacer"),u=a("v-btn"),C=a("v-card-title"),x=a("v-col"),R=a("v-select"),D=a("v-row"),U=a("v-card-text"),V=a("v-card-actions"),A=a("v-dialog"),z=a("v-toolbar"),h=a("v-icon"),v=a("v-tooltip"),E=a("v-data-table"),L=a("Permissions"),N=a("AppLayout");return Q(),K(N,null,{default:t(()=>[e(I,{class:"my-card"},{default:t(()=>[e(b,null,{default:t(()=>[e(p,{modelValue:i.searchQuery,"onUpdate:modelValue":o[0]||(o[0]=s=>i.searchQuery=s),label:"Search",onKeyup:B(r.performSearch,["enter"]),variant:"outlined"},null,8,["modelValue","onKeyup"])]),_:1})]),_:1}),e(I,{class:"my-card",outlined:""},{default:t(()=>[e(E,{headers:i.headers,loading:i.loading,items:i.users,"sort-by":[{key:"name",order:"asc"}]},{top:t(()=>[e(z,{flat:""},{default:t(()=>[e(P,null,{default:t(()=>[n("Admin")]),_:1}),e(w,{class:"mx-4",inset:"",vertical:""}),e(g),e(A,{modelValue:i.dialog,"onUpdate:modelValue":o[5]||(o[5]=s=>i.dialog=s),"max-width":"500px"},{activator:t(({props:s})=>[e(u,_({color:"primary",dark:"",class:"mb-2"},s),{default:t(()=>[n(" New Admin ")]),_:2},1040)]),default:t(()=>[e(I,null,{default:t(()=>[e(C,null,{default:t(()=>[F("span",H,O(r.formTitle),1)]),_:1}),e(U,null,{default:t(()=>[e(b,null,{default:t(()=>[e(D,null,{default:t(()=>[e(x,{cols:"12"},{default:t(()=>[e(p,{modelValue:i.editedItem.name,"onUpdate:modelValue":o[1]||(o[1]=s=>i.editedItem.name=s),label:"Name"},null,8,["modelValue"])]),_:1}),e(x,{cols:"12"},{default:t(()=>[e(p,{modelValue:i.editedItem.email,"onUpdate:modelValue":o[2]||(o[2]=s=>i.editedItem.email=s),label:"Email"},null,8,["modelValue"])]),_:1}),e(x,{cols:"12"},{default:t(()=>[e(p,{modelValue:i.editedItem.phone,"onUpdate:modelValue":o[3]||(o[3]=s=>i.editedItem.phone=s),label:"Phone"},null,8,["modelValue"])]),_:1}),e(x,{cols:"12"},{default:t(()=>[e(R,{modelValue:i.editedItem.selectedRole,"onUpdate:modelValue":o[4]||(o[4]=s=>i.editedItem.selectedRole=s),items:i.roles,"item-title":"name","item-value":"id",label:"Role","return-object":""},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1})]),_:1}),e(V,null,{default:t(()=>[e(g),e(u,{color:"blue-darken-1",variant:"text",onClick:r.close},{default:t(()=>[n(" Cancel ")]),_:1},8,["onClick"]),e(u,{color:"blue-darken-1",variant:"text",onClick:r.save},{default:t(()=>[n(" Save ")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(A,{modelValue:i.dialogDelete,"onUpdate:modelValue":o[6]||(o[6]=s=>i.dialogDelete=s),"max-width":"500px"},{default:t(()=>[e(I,null,{default:t(()=>[e(C,{class:"text-h5"},{default:t(()=>[n(" Are you sure you want to delete this item? ")]),_:1}),e(V,null,{default:t(()=>[e(g),e(u,{color:"blue-darken-1",variant:"text",onClick:r.closeDelete},{default:t(()=>[n(" Cancel ")]),_:1},8,["onClick"]),e(u,{color:"blue-darken-1",variant:"text",onClick:r.deleteItemConfirm},{default:t(()=>[n(" OK ")]),_:1},8,["onClick"]),e(g)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),"item.actions":t(({item:s})=>[e(v,{bottom:"",text:"Edit"},{activator:t(({on:d,attrs:c})=>[e(h,_(c,f(d),{size:"large",color:"info",class:"me-2",onClick:k=>r.editItem(s)}),{default:t(()=>[n(" mdi-pencil ")]),_:2},1040,["onClick"])]),_:2},1024),e(v,{bottom:"",text:"Delete"},{activator:t(({on:d,attrs:c})=>[e(h,_(c,f(d),{size:"large",color:"error",class:"me-2",onClick:k=>r.deleteItem(s)}),{default:t(()=>[n(" mdi-delete ")]),_:2},1040,["onClick"])]),_:2},1024),e(v,{bottom:"",text:"Activate Account"},{activator:t(({on:d,attrs:c})=>[e(h,_(c,f(d),{size:"large",color:"success",class:"me-2",onClick:k=>r.activateAccount(s)}),{default:t(()=>[n(" mdi-account-check ")]),_:2},1040,["onClick"])]),_:2},1024),e(v,{bottom:"",text:"Reset Password"},{activator:t(({on:d,attrs:c})=>[e(h,_(c,f(d),{size:"large",color:"warning",class:"me-2",onClick:k=>r.resetPassword(s)}),{default:t(()=>[n(" mdi-lock-reset ")]),_:2},1040,["onClick"])]),_:2},1024),e(v,{bottom:"",text:"Manage Permissions"},{activator:t(({on:d,attrs:c})=>[e(h,_(c,f(d),{size:"large",color:"primary",class:"me-2",onClick:k=>r.managePermissions(s)}),{default:t(()=>[n(" mdi-account-key ")]),_:2},1040,["onClick"])]),_:2},1024)]),"no-data":t(()=>[e(u,{color:"primary",onClick:r.initialize},{default:t(()=>[n(" Reset ")]),_:1},8,["onClick"])]),_:1},8,["headers","loading","items"]),e(L,{ref:"PermissionsComponent"},null,512)]),_:1})]),_:1})}const Z=q(j,[["render",M],["__scopeId","data-v-f5627b6a"]]);export{Z as default};

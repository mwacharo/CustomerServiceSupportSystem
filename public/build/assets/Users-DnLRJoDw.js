import{A as O}from"./AppLayout-kXqulQEF.js";import{s as _,i as n,o as x,c as S,w as t,b as e,x as T,f as i,y as h,a as q,t as C,d as H,W as I}from"./app-DTo2cNfO.js";import M from"./Permissions-CaX4xMdD.js";import{_ as W}from"./_plugin-vue_export-helper-DlAUqK2U.js";const j={components:{AppLayout:O,Permissions:M},data(){return{roles:[],dialog:!1,loading:!1,dialogDelete:!1,headers:[{title:"Agent Name",align:"start",sortable:!1,key:"name"},{title:"Email",key:"email"},{title:"Phone",key:"phone"},{title:"Agent SIP",key:"phone_number"},{title:"Role",key:"roles"},{title:"Status",key:"status"},{title:"Actions",key:"actions",sortable:!1}],users:[],searchQuery:"",editedIndex:-1,editedItem:{id:null,name:"",email:"",phone:"",selectedRole:null,phone_number:"",branch_id:null,country_id:null,status:["available","engaged"]},defaultItem:{id:null,name:"",email:"",phone:"",selectedRole:null,phone_number:"",branch_id:null,country_id:null,status:["available","engaged"]}}},computed:{formTitle(){return this.editedIndex===-1?"New Admin":"Edit Admin"}},watch:{dialog(s){s?this.fetchRoles():this.close()},dialogDelete(s){!s&&this.closeDelete()}},created(){this.initialize()},methods:{getStatusColor(s){if(!s)return"grey";switch(s.toLowerCase()){case"available":return"green";case"engaged":return"orange";default:return"grey"}},fetchRoles(){_.get("api/v1/roles").then(l=>{this.roles=l.data}).catch(l=>{console.error("API Error:",l)})},initialize(){_.get("v1/users").then(l=>{this.users=l.data.map(u=>({...u,roles:u.roles&&u.roles.length?u.roles:[]}))}).catch(l=>console.error("API Error:",l))},editItem(s){this.editedIndex=this.users.indexOf(s),this.editedItem={...s,selectedRole:s.roles.length?s.roles[0]:null},this.dialog=!0},deleteItem(s){this.editedIndex=this.users.indexOf(s),this.editedItem={...s},this.dialogDelete=!0},deleteItemConfirm(){_.delete(`v1/user/${this.editedItem.id}`).then(()=>{this.users.splice(this.editedIndex,1),this.$toastr.success("User deleted successfully"),this.closeDelete()}).catch(s=>console.error("Deletion error:",s))},close(){this.dialog=!1,this.resetForm()},closeDelete(){this.dialogDelete=!1,this.resetForm()},resetForm(){this.editedItem={...this.defaultItem},this.editedIndex=-1},managePermissions(s){this.$refs.PermissionsComponent.showDialog(s.id)},save(){var u;let s;const l={...this.editedItem,role:((u=this.editedItem.selectedRole)==null?void 0:u.name)||""};this.editedIndex>-1?s=_.put(`v1/user/${this.editedItem.id}`,l):s=_.post("v1/user",l),s.then(()=>{this.initialize(),this.close(),this.$toastr.success("User saved successfully")}).catch(A=>console.error("Save error:",A))},performSearch(){this.searchQuery.trim()===""?this.initialize():_.get("v1/users/search",{params:{query:this.searchQuery}}).then(s=>{this.users=s.data}).catch(s=>console.error("Search error:",s))},activateAccount(s){_.post(`v1/user/activate/${s.id}`).then(()=>{this.initialize(),this.$toastr.success("Account activated successfully")}).catch(l=>console.error("Activation error:",l))},resetPassword(s){_.post(`v1/user/reset-password/${s.id}`).then(()=>{this.$toastr.success("Password reset successfully")}).catch(l=>console.error("Password reset error:",l))}}},G={class:"text-h5"},J={key:1};function X(s,l,u,A,a,r){const v=n("v-text-field"),P=n("v-container"),z=n("v-toolbar-title"),N=n("v-divider"),b=n("v-spacer"),f=n("v-icon"),p=n("v-btn"),w=n("v-card-title"),c=n("v-col"),y=n("v-select"),L=n("v-row"),E=n("v-card-text"),U=n("v-card-actions"),V=n("v-card"),R=n("v-dialog"),B=n("v-toolbar"),D=n("v-chip"),g=n("v-tooltip"),Q=n("v-data-table"),K=n("Permissions"),F=n("AppLayout");return x(),S(F,null,{default:t(()=>[e(V,{class:"my-card"},{default:t(()=>[e(P,null,{default:t(()=>[e(v,{modelValue:a.searchQuery,"onUpdate:modelValue":l[0]||(l[0]=o=>a.searchQuery=o),label:"Search",onKeyup:T(r.performSearch,["enter"]),variant:"outlined"},null,8,["modelValue","onKeyup"])]),_:1}),e(Q,{headers:a.headers,loading:a.loading,items:a.users,"sort-by":[{key:"name",order:"asc"}]},{top:t(()=>[e(B,{flat:""},{default:t(()=>[e(z,null,{default:t(()=>[i("Admin")]),_:1}),e(N,{class:"mx-4",inset:"",vertical:""}),e(b),e(R,{modelValue:a.dialog,"onUpdate:modelValue":l[11]||(l[11]=o=>a.dialog=o),"max-width":"800px"},{activator:t(({props:o})=>[e(p,h({color:"black",dark:"",class:"mb-2"},o,{elevation:"2",rounded:"",onClick:l[1]||(l[1]=d=>a.dialog=!0)}),{default:t(()=>[e(f,{left:""},{default:t(()=>[i("mdi-plus")]),_:1}),i(" New Admin ")]),_:2},1040)]),default:t(()=>[e(V,null,{default:t(()=>[e(w,null,{default:t(()=>[q("span",G,C(r.formTitle),1)]),_:1}),e(E,null,{default:t(()=>[e(P,null,{default:t(()=>[e(L,null,{default:t(()=>[e(c,{cols:"12",sm:"6"},{default:t(()=>[e(v,{modelValue:a.editedItem.name,"onUpdate:modelValue":l[2]||(l[2]=o=>a.editedItem.name=o),label:"Name"},null,8,["modelValue"])]),_:1}),e(c,{cols:"12",sm:"6"},{default:t(()=>[e(v,{modelValue:a.editedItem.email,"onUpdate:modelValue":l[3]||(l[3]=o=>a.editedItem.email=o),label:"Email"},null,8,["modelValue"])]),_:1}),e(c,{cols:"12",sm:"6"},{default:t(()=>[e(v,{modelValue:a.editedItem.address,"onUpdate:modelValue":l[4]||(l[4]=o=>a.editedItem.address=o),label:"Address"},null,8,["modelValue"])]),_:1}),e(c,{cols:"12",sm:"6"},{default:t(()=>[e(v,{modelValue:a.editedItem.phone,"onUpdate:modelValue":l[5]||(l[5]=o=>a.editedItem.phone=o),label:"Phone"},null,8,["modelValue"])]),_:1}),e(c,{cols:"12",sm:"6"},{default:t(()=>[e(y,{modelValue:a.editedItem.selectedRole,"onUpdate:modelValue":l[6]||(l[6]=o=>a.editedItem.selectedRole=o),items:a.roles,"item-title":"name","item-value":"name",label:"Role"},null,8,["modelValue","items"])]),_:1}),e(c,{cols:"12",sm:"6"},{default:t(()=>[e(v,{modelValue:a.editedItem.phone_number,"onUpdate:modelValue":l[7]||(l[7]=o=>a.editedItem.phone_number=o),label:"Agent SIP"},null,8,["modelValue"])]),_:1}),e(c,{cols:"12",sm:"6"},{default:t(()=>[e(y,{modelValue:a.editedItem.branch_id,"onUpdate:modelValue":l[8]||(l[8]=o=>a.editedItem.branch_id=o),items:s.branches,"item-title":"name","item-value":"id",label:"Branch"},null,8,["modelValue","items"])]),_:1}),e(c,{cols:"12",sm:"6"},{default:t(()=>[e(y,{modelValue:a.editedItem.country_id,"onUpdate:modelValue":l[9]||(l[9]=o=>a.editedItem.country_id=o),items:s.countries,"item-title":"name","item-value":"id",label:"Country"},null,8,["modelValue","items"])]),_:1}),e(c,{cols:"12",sm:"6"},{default:t(()=>[e(y,{modelValue:a.editedItem.status,"onUpdate:modelValue":l[10]||(l[10]=o=>a.editedItem.status=o),items:["available","engaged","offline"],label:"Status",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(U,null,{default:t(()=>[e(b),e(p,{color:"blue-darken-1",variant:"text",onClick:r.close},{default:t(()=>[i(" Cancel ")]),_:1},8,["onClick"]),e(p,{color:"blue-darken-1",variant:"text",onClick:r.save},{default:t(()=>[i(" Save ")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(R,{modelValue:a.dialogDelete,"onUpdate:modelValue":l[12]||(l[12]=o=>a.dialogDelete=o),"max-width":"500px"},{default:t(()=>[e(V,null,{default:t(()=>[e(w,{class:"text-h5"},{default:t(()=>[i(" Are you sure you want to delete this item? ")]),_:1}),e(U,null,{default:t(()=>[e(b),e(p,{color:"blue-darken-1",variant:"text",onClick:r.closeDelete},{default:t(()=>[i(" Cancel ")]),_:1},8,["onClick"]),e(p,{color:"blue-darken-1",variant:"text",onClick:r.deleteItemConfirm},{default:t(()=>[i(" OK ")]),_:1},8,["onClick"]),e(b)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),"item.roles":t(({item:o})=>[o.roles&&o.roles.length?(x(),S(D,{key:0,color:"primary"},{default:t(()=>[i(C(o.roles[0].name),1)]),_:2},1024)):(x(),H("span",J,"No role assigned"))]),"item.status":t(({item:o})=>[e(D,{color:r.getStatusColor(o.status)},{default:t(()=>[i(C(o.status||"N/A"),1)]),_:2},1032,["color"])]),"item.actions":t(({item:o})=>[e(g,{bottom:"",text:"Edit"},{activator:t(({on:d,attrs:m})=>[e(f,h(m,I(d),{size:"large",color:"info",class:"me-2",onClick:k=>r.editItem(o)}),{default:t(()=>[i(" mdi-pencil ")]),_:2},1040,["onClick"])]),_:2},1024),e(g,{bottom:"",text:"Delete"},{activator:t(({on:d,attrs:m})=>[e(f,h(m,I(d),{size:"large",color:"error",class:"me-2",onClick:k=>r.deleteItem(o)}),{default:t(()=>[i(" mdi-delete ")]),_:2},1040,["onClick"])]),_:2},1024),e(g,{bottom:"",text:"Activate Account"},{activator:t(({on:d,attrs:m})=>[e(f,h(m,I(d),{size:"large",color:"success",class:"me-2",onClick:k=>r.activateAccount(o)}),{default:t(()=>[i(" mdi-account-check ")]),_:2},1040,["onClick"])]),_:2},1024),e(g,{bottom:"",text:"Reset Password"},{activator:t(({on:d,attrs:m})=>[e(f,h(m,I(d),{size:"large",color:"warning",class:"me-2",onClick:k=>r.resetPassword(o)}),{default:t(()=>[i(" mdi-lock-reset ")]),_:2},1040,["onClick"])]),_:2},1024),e(g,{bottom:"",text:"Manage Permissions"},{activator:t(({on:d,attrs:m})=>[e(f,h(m,I(d),{size:"large",color:"primary",class:"me-2",onClick:k=>r.managePermissions(o)}),{default:t(()=>[i(" mdi-account-key ")]),_:2},1040,["onClick"])]),_:2},1024)]),"no-data":t(()=>[e(p,{color:"primary",onClick:r.initialize},{default:t(()=>[i(" Reset ")]),_:1},8,["onClick"])]),_:1},8,["headers","loading","items"]),e(K,{ref:"PermissionsComponent"},null,512)]),_:1})]),_:1})}const te=W(j,[["render",X],["__scopeId","data-v-9532d596"]]);export{te as default};

import{Z as O}from"./index.esm-4cCL6dQM.js";import{A as Z}from"./AppLayout-DVnjgFjK.js";import{k as G,r as c,y as H,i as s,o as V,c as K,w as t,J as Q,b as e,u as X,f as o,t as u,a,d as R,g as Y,F as ee}from"./app-Ckac36Rh.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const te=a("h2",{class:"text-h6"},"WhatsApp Business",-1),le=a("div",{class:"text-subtitle-2"},"Sent",-1),ae={class:"text-h6"},ne=a("div",{class:"text-subtitle-2"},"Delivered",-1),se={class:"text-h6"},oe=a("div",{class:"text-subtitle-2"},"Read",-1),ie={class:"text-h6"},ce=a("div",{class:"text-subtitle-2"},"Failed",-1),ue={class:"text-h6"},de=a("div",null,"Recent Messages",-1),re=a("thead",null,[a("tr",null,[a("th",null,"Content"),a("th",null,"Recipients"),a("th",null,"Status"),a("th",null,"Sent Date"),a("th",null,"Actions")])],-1),he={__name:"WhatsApp",setup(_e){const S=G(()=>{var i;return(i=Q().props.value.user)==null?void 0:i.id}),C=c(""),f=c([]),k=c([]),_=c([]),m=c(""),A=c([]),h=c(!1),v=c(!1);c(!1),c({name:"",content:""});const M=c("Connected"),x=c({sent:156,delivered:145,read:98,failed:11}),B=()=>{k.value=[{id:1,name:"John Mwacharo",phone:"254799806098@c.us",status:"Active"},{id:2,name:"Jane Smith",phone:"+254723456789",status:"Active"},{id:3,name:"Robert Brown",phone:"+254734567890",status:"Inactive"},{id:4,name:"Sarah Wilson",phone:"+254745678901",status:"Active"}]},$=async()=>{try{const i=await axios.get("/api/v1/templates");A.value=i.data}catch(i){console.error("Error loading templates:",i)}},W=async()=>{try{const i=await axios.post("/api/v1/whatsapp-send",{user_id:S.value,contacts:_.value.map(r=>({id:r.id,name:r.name,chatId:r.phone})),message:m.value}),n=new Date;f.value.unshift({id:f.value.length+1,content:m.value,recipients:_.value.length,status:"Sent",sent_at:n.toISOString().slice(0,10),results:i.data.results}),m.value="",_.value=[],v.value=!1}catch(i){alert("Message failed to send. Check console."),console.error(i)}};return H(()=>{f.value=[{id:1,content:"Payment reminder for April invoice",recipients:25,status:"Delivered",sent_at:"2025-04-19"},{id:2,content:"System maintenance notification",recipients:120,status:"Sent",sent_at:"2025-04-18"},{id:3,content:"New feature announcement",recipients:50,status:"Delivered",sent_at:"2025-04-17"},{id:4,content:"Urgent: Account verification required",recipients:5,status:"Read",sent_at:"2025-04-16"}],B(),$(),console.log("user_id",S.value)}),(i,n)=>{const r=s("v-icon"),F=s("v-avatar"),b=s("v-chip"),D=s("v-divider"),p=s("v-col"),U=s("v-row"),d=s("v-btn"),g=s("v-card-text"),w=s("v-card"),J=s("v-text-field"),y=s("v-card-title"),P=s("v-table"),j=s("v-container"),I=s("v-select"),E=s("v-textarea"),N=s("v-spacer"),T=s("v-card-actions"),z=s("v-dialog"),L=s("v-file-input"),q=s("v-alert");return V(),K(Z,null,{default:t(()=>[e(X(O),{title:"WhatsApp"}),e(j,null,{default:t(()=>[e(U,null,{default:t(()=>[e(p,{cols:"12",md:"3"},{default:t(()=>[e(w,null,{default:t(()=>[e(g,{class:"text-center"},{default:t(()=>[e(F,{size:"80",color:"green",class:"mb-3"},{default:t(()=>[e(r,{size:"48",color:"white"},{default:t(()=>[o("mdi-whatsapp")]),_:1})]),_:1}),te,e(b,{color:M.value==="Connected"?"success":"error",class:"mt-2"},{default:t(()=>[o(u(M.value),1)]),_:1},8,["color"]),e(D,{class:"my-4"}),e(U,null,{default:t(()=>[e(p,{cols:"6",class:"py-1"},{default:t(()=>[le,a("div",ae,u(x.value.sent),1)]),_:1}),e(p,{cols:"6",class:"py-1"},{default:t(()=>[ne,a("div",se,u(x.value.delivered),1)]),_:1}),e(p,{cols:"6",class:"py-1"},{default:t(()=>[oe,a("div",ie,u(x.value.read),1)]),_:1}),e(p,{cols:"6",class:"py-1"},{default:t(()=>[ce,a("div",ue,u(x.value.failed),1)]),_:1})]),_:1}),e(D,{class:"my-4"}),e(d,{color:"primary",block:"",onClick:n[0]||(n[0]=l=>v.value=!0)},{default:t(()=>[o(" New Message ")]),_:1}),e(d,{color:"info",block:"",class:"mt-2",onClick:n[1]||(n[1]=l=>h.value=!0)},{default:t(()=>[o(" Import Contacts ")]),_:1})]),_:1})]),_:1})]),_:1}),e(p,{cols:"12",md:"9"},{default:t(()=>[e(w,null,{default:t(()=>[e(y,{class:"d-flex justify-space-between align-center"},{default:t(()=>[de,e(J,{modelValue:C.value,"onUpdate:modelValue":n[2]||(n[2]=l=>C.value=l),"append-icon":"mdi-magnify",label:"Search messages","single-line":"","hide-details":"",density:"compact",class:"max-w-xs"},null,8,["modelValue"])]),_:1}),e(g,null,{default:t(()=>[e(P,null,{default:t(()=>[re,a("tbody",null,[(V(!0),R(ee,null,Y(f.value,l=>(V(),R("tr",{key:l.id},[a("td",null,u(l.content),1),a("td",null,u(l.recipients),1),a("td",null,[e(b,{color:l.status==="Delivered"?"success":l.status==="Read"?"info":"warning",size:"small"},{default:t(()=>[o(u(l.status),1)]),_:2},1032,["color"])]),a("td",null,u(l.sent_at),1),a("td",null,[e(d,{icon:"",size:"small",color:"primary",variant:"text"},{default:t(()=>[e(r,null,{default:t(()=>[o("mdi-refresh")]),_:1})]),_:1}),e(d,{icon:"",size:"small",color:"info",variant:"text"},{default:t(()=>[e(r,null,{default:t(()=>[o("mdi-eye")]),_:1})]),_:1}),e(d,{icon:"",size:"small",color:"error",variant:"text"},{default:t(()=>[e(r,null,{default:t(()=>[o("mdi-delete")]),_:1})]),_:1})])]))),128))])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(z,{modelValue:v.value,"onUpdate:modelValue":n[6]||(n[6]=l=>v.value=l),"max-width":"700px"},{default:t(()=>[e(w,null,{default:t(()=>[e(y,null,{default:t(()=>[o("Send WhatsApp Message")]),_:1}),e(g,null,{default:t(()=>[e(I,{modelValue:_.value,"onUpdate:modelValue":n[3]||(n[3]=l=>_.value=l),items:k.value,"item-title":"name","item-value":"id",label:"Select Recipients",multiple:"",chips:"","return-object":""},{selection:t(({item:l})=>[e(b,null,{default:t(()=>[o(u(l.raw.name)+" ("+u(l.raw.phone)+")",1)]),_:2},1024)]),_:1},8,["modelValue","items"]),e(I,{label:"Select Template",items:A.value,"item-title":"name","item-value":"id","onUpdate:modelValue":i.onTemplateSelect,class:"mt-4",hint:i.selectedTemplate?`Channel: ${i.selectedTemplate.channel} | Module: ${i.selectedTemplate.module}`:"","persistent-hint":""},null,8,["items","onUpdate:modelValue","hint"]),e(E,{modelValue:m.value,"onUpdate:modelValue":n[4]||(n[4]=l=>m.value=l),label:"Message",rows:"5",class:"mt-4",hint:"Variables format: {{variable_name}}","persistent-hint":""},null,8,["modelValue"])]),_:1}),e(T,null,{default:t(()=>[e(N),e(d,{color:"error",onClick:n[5]||(n[5]=l=>v.value=!1)},{default:t(()=>[o("Cancel")]),_:1}),e(d,{color:"primary",onClick:W,disabled:!m.value||_.value.length===0},{default:t(()=>[o(" Send Message ")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(z,{modelValue:h.value,"onUpdate:modelValue":n[8]||(n[8]=l=>h.value=l),"max-width":"500px"},{default:t(()=>[e(w,null,{default:t(()=>[e(y,null,{default:t(()=>[o("Import Contacts")]),_:1}),e(g,null,{default:t(()=>[e(L,{label:"Upload CSV File",accept:".csv","prepend-icon":"mdi-file-upload","show-size":"","truncate-length":"25"}),e(q,{type:"info",class:"mt-4"},{default:t(()=>[o(" CSV file should have columns: Name, Phone Number, Status ")]),_:1})]),_:1}),e(T,null,{default:t(()=>[e(N),e(d,{color:"error",onClick:n[7]||(n[7]=l=>h.value=!1)},{default:t(()=>[o("Cancel")]),_:1}),e(d,{color:"primary"},{default:t(()=>[o("Import")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}};export{he as default};

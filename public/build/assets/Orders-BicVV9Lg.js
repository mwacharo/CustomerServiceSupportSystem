import{A as Xe}from"./AppLayout-BhSyaM2q.js";import{N as Ze,k as Ve,r as Je,i as Z,o as se,c as ge,w as m,J as ze,a as N,b as v,f as M,t as W,e as ke,d as De,g as xe,F as Ae,z as et,n as Fe}from"./app-Deeaacfw.js";import{_ as tt}from"./_plugin-vue_export-helper-DlAUqK2U.js";var He={exports:{}};(function(g,E){(function(G,Q){g.exports=Q()})(window,function(){return function(G){var Q={};function x(d){if(Q[d])return Q[d].exports;var r=Q[d]={i:d,l:!1,exports:{}};return G[d].call(r.exports,r,r.exports,x),r.l=!0,r.exports}return x.m=G,x.c=Q,x.d=function(d,r,o){x.o(d,r)||Object.defineProperty(d,r,{enumerable:!0,get:o})},x.r=function(d){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(d,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(d,"__esModule",{value:!0})},x.t=function(d,r){if(1&r&&(d=x(d)),8&r||4&r&&typeof d=="object"&&d&&d.__esModule)return d;var o=Object.create(null);if(x.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:d}),2&r&&typeof d!="string")for(var e in d)x.d(o,e,(function(c){return d[c]}).bind(null,e));return o},x.n=function(d){var r=d&&d.__esModule?function(){return d.default}:function(){return d};return x.d(r,"a",r),r},x.o=function(d,r){return Object.prototype.hasOwnProperty.call(d,r)},x.p="",x(x.s=3)}([function(G,Q,x){(function(d){var r=x(6);G.exports=r({window:d.window})}).call(this,x(5))},function(G,Q,x){var d=!0,r=!0;function o(e,c,l){var n=e.match(c);return n&&n.length>=l&&parseInt(n[l],10)}G.exports={extractVersion:o,wrapPeerConnectionEvent:function(e,c,l){if(e.RTCPeerConnection){var n=e.RTCPeerConnection.prototype,h=n.addEventListener;n.addEventListener=function(y,s){if(y!==c)return h.apply(this,arguments);var f=function(t){var a=l(t);a&&s(a)};return this._eventMap=this._eventMap||{},this._eventMap[s]=f,h.apply(this,[y,f])};var S=n.removeEventListener;n.removeEventListener=function(y,s){if(y!==c||!this._eventMap||!this._eventMap[s])return S.apply(this,arguments);var f=this._eventMap[s];return delete this._eventMap[s],S.apply(this,[y,f])},Object.defineProperty(n,"on"+c,{get:function(){return this["_on"+c]},set:function(y){this["_on"+c]&&(this.removeEventListener(c,this["_on"+c]),delete this["_on"+c]),y&&this.addEventListener(c,this["_on"+c]=y)},enumerable:!0,configurable:!0})}},disableLog:function(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(d=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},disableWarnings:function(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(r=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))},log:function(){if(typeof window=="object"){if(d)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}},deprecated:function(e,c){r&&console.warn(e+" is deprecated, please use "+c+" instead.")},detectBrowser:function(e){var c=e&&e.navigator,l={browser:null,version:null};if(e===void 0||!e.navigator)return l.browser="Not a browser.",l;if(c.mozGetUserMedia)l.browser="firefox",l.version=o(c.userAgent,/Firefox\/(\d+)\./,1);else if(c.webkitGetUserMedia)l.browser="chrome",l.version=o(c.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(c.mediaDevices&&c.userAgent.match(/Edge\/(\d+).(\d+)$/))l.browser="edge",l.version=o(c.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!c.userAgent.match(/AppleWebKit\/(\d+)\./))return l.browser="Not a supported browser.",l;l.browser="safari",l.version=o(c.userAgent,/AppleWebKit\/(\d+)\./,1)}return l}}},function(G,Q,x){var d={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};d.localCName=d.generateIdentifier(),d.splitLines=function(r){return r.trim().split(`
`).map(function(o){return o.trim()})},d.splitSections=function(r){return r.split(`
m=`).map(function(o,e){return(e>0?"m="+o:o).trim()+`\r
`})},d.getDescription=function(r){var o=d.splitSections(r);return o&&o[0]},d.getMediaSections=function(r){var o=d.splitSections(r);return o.shift(),o},d.matchPrefix=function(r,o){return d.splitLines(r).filter(function(e){return e.indexOf(o)===0})},d.parseCandidate=function(r){for(var o,e={foundation:(o=r.indexOf("a=candidate:")===0?r.substring(12).split(" "):r.substring(10).split(" "))[0],component:parseInt(o[1],10),protocol:o[2].toLowerCase(),priority:parseInt(o[3],10),ip:o[4],address:o[4],port:parseInt(o[5],10),type:o[7]},c=8;c<o.length;c+=2)switch(o[c]){case"raddr":e.relatedAddress=o[c+1];break;case"rport":e.relatedPort=parseInt(o[c+1],10);break;case"tcptype":e.tcpType=o[c+1];break;case"ufrag":e.ufrag=o[c+1],e.usernameFragment=o[c+1];break;default:e[o[c]]=o[c+1]}return e},d.writeCandidate=function(r){var o=[];o.push(r.foundation),o.push(r.component),o.push(r.protocol.toUpperCase()),o.push(r.priority),o.push(r.address||r.ip),o.push(r.port);var e=r.type;return o.push("typ"),o.push(e),e!=="host"&&r.relatedAddress&&r.relatedPort&&(o.push("raddr"),o.push(r.relatedAddress),o.push("rport"),o.push(r.relatedPort)),r.tcpType&&r.protocol.toLowerCase()==="tcp"&&(o.push("tcptype"),o.push(r.tcpType)),(r.usernameFragment||r.ufrag)&&(o.push("ufrag"),o.push(r.usernameFragment||r.ufrag)),"candidate:"+o.join(" ")},d.parseIceOptions=function(r){return r.substr(14).split(" ")},d.parseRtpMap=function(r){var o=r.substr(9).split(" "),e={payloadType:parseInt(o.shift(),10)};return o=o[0].split("/"),e.name=o[0],e.clockRate=parseInt(o[1],10),e.channels=o.length===3?parseInt(o[2],10):1,e.numChannels=e.channels,e},d.writeRtpMap=function(r){var o=r.payloadType;r.preferredPayloadType!==void 0&&(o=r.preferredPayloadType);var e=r.channels||r.numChannels||1;return"a=rtpmap:"+o+" "+r.name+"/"+r.clockRate+(e!==1?"/"+e:"")+`\r
`},d.parseExtmap=function(r){var o=r.substr(9).split(" ");return{id:parseInt(o[0],10),direction:o[0].indexOf("/")>0?o[0].split("/")[1]:"sendrecv",uri:o[1]}},d.writeExtmap=function(r){return"a=extmap:"+(r.id||r.preferredId)+(r.direction&&r.direction!=="sendrecv"?"/"+r.direction:"")+" "+r.uri+`\r
`},d.parseFmtp=function(r){for(var o,e={},c=r.substr(r.indexOf(" ")+1).split(";"),l=0;l<c.length;l++)e[(o=c[l].trim().split("="))[0].trim()]=o[1];return e},d.writeFmtp=function(r){var o="",e=r.payloadType;if(r.preferredPayloadType!==void 0&&(e=r.preferredPayloadType),r.parameters&&Object.keys(r.parameters).length){var c=[];Object.keys(r.parameters).forEach(function(l){r.parameters[l]?c.push(l+"="+r.parameters[l]):c.push(l)}),o+="a=fmtp:"+e+" "+c.join(";")+`\r
`}return o},d.parseRtcpFb=function(r){var o=r.substr(r.indexOf(" ")+1).split(" ");return{type:o.shift(),parameter:o.join(" ")}},d.writeRtcpFb=function(r){var o="",e=r.payloadType;return r.preferredPayloadType!==void 0&&(e=r.preferredPayloadType),r.rtcpFeedback&&r.rtcpFeedback.length&&r.rtcpFeedback.forEach(function(c){o+="a=rtcp-fb:"+e+" "+c.type+(c.parameter&&c.parameter.length?" "+c.parameter:"")+`\r
`}),o},d.parseSsrcMedia=function(r){var o=r.indexOf(" "),e={ssrc:parseInt(r.substr(7,o-7),10)},c=r.indexOf(":",o);return c>-1?(e.attribute=r.substr(o+1,c-o-1),e.value=r.substr(c+1)):e.attribute=r.substr(o+1),e},d.parseSsrcGroup=function(r){var o=r.substr(13).split(" ");return{semantics:o.shift(),ssrcs:o.map(function(e){return parseInt(e,10)})}},d.getMid=function(r){var o=d.matchPrefix(r,"a=mid:")[0];if(o)return o.substr(6)},d.parseFingerprint=function(r){var o=r.substr(14).split(" ");return{algorithm:o[0].toLowerCase(),value:o[1]}},d.getDtlsParameters=function(r,o){return{role:"auto",fingerprints:d.matchPrefix(r+o,"a=fingerprint:").map(d.parseFingerprint)}},d.writeDtlsParameters=function(r,o){var e="a=setup:"+o+`\r
`;return r.fingerprints.forEach(function(c){e+="a=fingerprint:"+c.algorithm+" "+c.value+`\r
`}),e},d.getIceParameters=function(r,o){var e=d.splitLines(r);return{usernameFragment:(e=e.concat(d.splitLines(o))).filter(function(c){return c.indexOf("a=ice-ufrag:")===0})[0].substr(12),password:e.filter(function(c){return c.indexOf("a=ice-pwd:")===0})[0].substr(10)}},d.writeIceParameters=function(r){return"a=ice-ufrag:"+r.usernameFragment+`\r
a=ice-pwd:`+r.password+`\r
`},d.parseRtpParameters=function(r){for(var o={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},e=d.splitLines(r)[0].split(" "),c=3;c<e.length;c++){var l=e[c],n=d.matchPrefix(r,"a=rtpmap:"+l+" ")[0];if(n){var h=d.parseRtpMap(n),S=d.matchPrefix(r,"a=fmtp:"+l+" ");switch(h.parameters=S.length?d.parseFmtp(S[0]):{},h.rtcpFeedback=d.matchPrefix(r,"a=rtcp-fb:"+l+" ").map(d.parseRtcpFb),o.codecs.push(h),h.name.toUpperCase()){case"RED":case"ULPFEC":o.fecMechanisms.push(h.name.toUpperCase())}}}return d.matchPrefix(r,"a=extmap:").forEach(function(y){o.headerExtensions.push(d.parseExtmap(y))}),o},d.writeRtpDescription=function(r,o){var e="";e+="m="+r+" ",e+=o.codecs.length>0?"9":"0",e+=" UDP/TLS/RTP/SAVPF ",e+=o.codecs.map(function(l){return l.preferredPayloadType!==void 0?l.preferredPayloadType:l.payloadType}).join(" ")+`\r
`,e+=`c=IN IP4 0.0.0.0\r
`,e+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,o.codecs.forEach(function(l){e+=d.writeRtpMap(l),e+=d.writeFmtp(l),e+=d.writeRtcpFb(l)});var c=0;return o.codecs.forEach(function(l){l.maxptime>c&&(c=l.maxptime)}),c>0&&(e+="a=maxptime:"+c+`\r
`),e+=`a=rtcp-mux\r
`,o.headerExtensions&&o.headerExtensions.forEach(function(l){e+=d.writeExtmap(l)}),e},d.parseRtpEncodingParameters=function(r){var o,e=[],c=d.parseRtpParameters(r),l=c.fecMechanisms.indexOf("RED")!==-1,n=c.fecMechanisms.indexOf("ULPFEC")!==-1,h=d.matchPrefix(r,"a=ssrc:").map(function(f){return d.parseSsrcMedia(f)}).filter(function(f){return f.attribute==="cname"}),S=h.length>0&&h[0].ssrc,y=d.matchPrefix(r,"a=ssrc-group:FID").map(function(f){return f.substr(17).split(" ").map(function(t){return parseInt(t,10)})});y.length>0&&y[0].length>1&&y[0][0]===S&&(o=y[0][1]),c.codecs.forEach(function(f){if(f.name.toUpperCase()==="RTX"&&f.parameters.apt){var t={ssrc:S,codecPayloadType:parseInt(f.parameters.apt,10)};S&&o&&(t.rtx={ssrc:o}),e.push(t),l&&((t=JSON.parse(JSON.stringify(t))).fec={ssrc:S,mechanism:n?"red+ulpfec":"red"},e.push(t))}}),e.length===0&&S&&e.push({ssrc:S});var s=d.matchPrefix(r,"b=");return s.length&&(s=s[0].indexOf("b=TIAS:")===0?parseInt(s[0].substr(7),10):s[0].indexOf("b=AS:")===0?1e3*parseInt(s[0].substr(5),10)*.95-16e3:void 0,e.forEach(function(f){f.maxBitrate=s})),e},d.parseRtcpParameters=function(r){var o={},e=d.matchPrefix(r,"a=ssrc:").map(function(n){return d.parseSsrcMedia(n)}).filter(function(n){return n.attribute==="cname"})[0];e&&(o.cname=e.value,o.ssrc=e.ssrc);var c=d.matchPrefix(r,"a=rtcp-rsize");o.reducedSize=c.length>0,o.compound=c.length===0;var l=d.matchPrefix(r,"a=rtcp-mux");return o.mux=l.length>0,o},d.parseMsid=function(r){var o,e=d.matchPrefix(r,"a=msid:");if(e.length===1)return{stream:(o=e[0].substr(7).split(" "))[0],track:o[1]};var c=d.matchPrefix(r,"a=ssrc:").map(function(l){return d.parseSsrcMedia(l)}).filter(function(l){return l.attribute==="msid"});return c.length>0?{stream:(o=c[0].value.split(" "))[0],track:o[1]}:void 0},d.generateSessionId=function(){return Math.random().toString().substr(2,21)},d.writeSessionBoilerplate=function(r,o,e){var c=o!==void 0?o:2;return`v=0\r
o=`+(e||"thisisadapterortc")+" "+(r||d.generateSessionId())+" "+c+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},d.writeMediaSection=function(r,o,e,c){var l=d.writeRtpDescription(r.kind,o);if(l+=d.writeIceParameters(r.iceGatherer.getLocalParameters()),l+=d.writeDtlsParameters(r.dtlsTransport.getLocalParameters(),e==="offer"?"actpass":"active"),l+="a=mid:"+r.mid+`\r
`,r.direction?l+="a="+r.direction+`\r
`:r.rtpSender&&r.rtpReceiver?l+=`a=sendrecv\r
`:r.rtpSender?l+=`a=sendonly\r
`:r.rtpReceiver?l+=`a=recvonly\r
`:l+=`a=inactive\r
`,r.rtpSender){var n="msid:"+c.id+" "+r.rtpSender.track.id+`\r
`;l+="a="+n,l+="a=ssrc:"+r.sendEncodingParameters[0].ssrc+" "+n,r.sendEncodingParameters[0].rtx&&(l+="a=ssrc:"+r.sendEncodingParameters[0].rtx.ssrc+" "+n,l+="a=ssrc-group:FID "+r.sendEncodingParameters[0].ssrc+" "+r.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return l+="a=ssrc:"+r.sendEncodingParameters[0].ssrc+" cname:"+d.localCName+`\r
`,r.rtpSender&&r.sendEncodingParameters[0].rtx&&(l+="a=ssrc:"+r.sendEncodingParameters[0].rtx.ssrc+" cname:"+d.localCName+`\r
`),l},d.getDirection=function(r,o){for(var e=d.splitLines(r),c=0;c<e.length;c++)switch(e[c]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return e[c].substr(2)}return o?d.getDirection(o):"sendrecv"},d.getKind=function(r){return d.splitLines(r)[0].split(" ")[0].substr(2)},d.isRejected=function(r){return r.split(" ",2)[1]==="0"},d.parseMLine=function(r){var o=d.splitLines(r)[0].substr(2).split(" ");return{kind:o[0],port:parseInt(o[1],10),protocol:o[2],fmt:o.slice(3).join(" ")}},d.parseOLine=function(r){var o=d.matchPrefix(r,"o=")[0].substr(2).split(" ");return{username:o[0],sessionId:o[1],sessionVersion:parseInt(o[2],10),netType:o[3],addressType:o[4],address:o[5]}},d.isValidSDP=function(r){if(typeof r!="string"||r.length===0)return!1;for(var o=d.splitLines(r),e=0;e<o.length;e++)if(o[e].length<2||o[e].charAt(1)!=="=")return!1;return!0},G.exports=d},function(G,Q,x){x(4),G.exports=x(17)},function(G,Q,x){var d=function(r){var o=Object.prototype,e=o.hasOwnProperty,c=typeof Symbol=="function"?Symbol:{},l=c.iterator||"@@iterator",n=c.asyncIterator||"@@asyncIterator",h=c.toStringTag||"@@toStringTag";function S(R,P,U,H){var I=P&&P.prototype instanceof f?P:f,ee=Object.create(I.prototype),pe=new ce(H||[]);return ee._invoke=function(O,J,F){var K="suspendedStart";return function(oe,te){if(K==="executing")throw new Error("Generator is already running");if(K==="completed"){if(oe==="throw")throw te;return X()}for(F.method=oe,F.arg=te;;){var Ce=F.delegate;if(Ce){var Se=V(Ce,F);if(Se){if(Se===s)continue;return Se}}if(F.method==="next")F.sent=F._sent=F.arg;else if(F.method==="throw"){if(K==="suspendedStart")throw K="completed",F.arg;F.dispatchException(F.arg)}else F.method==="return"&&F.abrupt("return",F.arg);K="executing";var fe=y(O,J,F);if(fe.type==="normal"){if(K=F.done?"completed":"suspendedYield",fe.arg===s)continue;return{value:fe.arg,done:F.done}}fe.type==="throw"&&(K="completed",F.method="throw",F.arg=fe.arg)}}}(R,U,pe),ee}function y(R,P,U){try{return{type:"normal",arg:R.call(P,U)}}catch(H){return{type:"throw",arg:H}}}r.wrap=S;var s={};function f(){}function t(){}function a(){}var i={};i[l]=function(){return this};var p=Object.getPrototypeOf,b=p&&p(p(re([])));b&&b!==o&&e.call(b,l)&&(i=b);var D=a.prototype=f.prototype=Object.create(i);function T(R){["next","throw","return"].forEach(function(P){R[P]=function(U){return this._invoke(P,U)}})}function L(R,P){var U;this._invoke=function(H,I){function ee(){return new P(function(pe,O){(function J(F,K,oe,te){var Ce=y(R[F],R,K);if(Ce.type!=="throw"){var Se=Ce.arg,fe=Se.value;return fe&&typeof fe=="object"&&e.call(fe,"__await")?P.resolve(fe.__await).then(function(he){J("next",he,oe,te)},function(he){J("throw",he,oe,te)}):P.resolve(fe).then(function(he){Se.value=he,oe(Se)},function(he){return J("throw",he,oe,te)})}te(Ce.arg)})(H,I,pe,O)})}return U=U?U.then(ee,ee):ee()}}function V(R,P){var U=R.iterator[P.method];if(U===void 0){if(P.delegate=null,P.method==="throw"){if(R.iterator.return&&(P.method="return",P.arg=void 0,V(R,P),P.method==="throw"))return s;P.method="throw",P.arg=new TypeError("The iterator does not provide a 'throw' method")}return s}var H=y(U,R.iterator,P.arg);if(H.type==="throw")return P.method="throw",P.arg=H.arg,P.delegate=null,s;var I=H.arg;return I?I.done?(P[R.resultName]=I.value,P.next=R.nextLoc,P.method!=="return"&&(P.method="next",P.arg=void 0),P.delegate=null,s):I:(P.method="throw",P.arg=new TypeError("iterator result is not an object"),P.delegate=null,s)}function A(R){var P={tryLoc:R[0]};1 in R&&(P.catchLoc=R[1]),2 in R&&(P.finallyLoc=R[2],P.afterLoc=R[3]),this.tryEntries.push(P)}function j(R){var P=R.completion||{};P.type="normal",delete P.arg,R.completion=P}function ce(R){this.tryEntries=[{tryLoc:"root"}],R.forEach(A,this),this.reset(!0)}function re(R){if(R){var P=R[l];if(P)return P.call(R);if(typeof R.next=="function")return R;if(!isNaN(R.length)){var U=-1,H=function I(){for(;++U<R.length;)if(e.call(R,U))return I.value=R[U],I.done=!1,I;return I.value=void 0,I.done=!0,I};return H.next=H}}return{next:X}}function X(){return{value:void 0,done:!0}}return t.prototype=D.constructor=a,a.constructor=t,a[h]=t.displayName="GeneratorFunction",r.isGeneratorFunction=function(R){var P=typeof R=="function"&&R.constructor;return!!P&&(P===t||(P.displayName||P.name)==="GeneratorFunction")},r.mark=function(R){return Object.setPrototypeOf?Object.setPrototypeOf(R,a):(R.__proto__=a,h in R||(R[h]="GeneratorFunction")),R.prototype=Object.create(D),R},r.awrap=function(R){return{__await:R}},T(L.prototype),L.prototype[n]=function(){return this},r.AsyncIterator=L,r.async=function(R,P,U,H,I){I===void 0&&(I=Promise);var ee=new L(S(R,P,U,H),I);return r.isGeneratorFunction(P)?ee:ee.next().then(function(pe){return pe.done?pe.value:ee.next()})},T(D),D[h]="Generator",D[l]=function(){return this},D.toString=function(){return"[object Generator]"},r.keys=function(R){var P=[];for(var U in R)P.push(U);return P.reverse(),function H(){for(;P.length;){var I=P.pop();if(I in R)return H.value=I,H.done=!1,H}return H.done=!0,H}},r.values=re,ce.prototype={constructor:ce,reset:function(R){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(j),!R)for(var P in this)P.charAt(0)==="t"&&e.call(this,P)&&!isNaN(+P.slice(1))&&(this[P]=void 0)},stop:function(){this.done=!0;var R=this.tryEntries[0].completion;if(R.type==="throw")throw R.arg;return this.rval},dispatchException:function(R){if(this.done)throw R;var P=this;function U(J,F){return ee.type="throw",ee.arg=R,P.next=J,F&&(P.method="next",P.arg=void 0),!!F}for(var H=this.tryEntries.length-1;H>=0;--H){var I=this.tryEntries[H],ee=I.completion;if(I.tryLoc==="root")return U("end");if(I.tryLoc<=this.prev){var pe=e.call(I,"catchLoc"),O=e.call(I,"finallyLoc");if(pe&&O){if(this.prev<I.catchLoc)return U(I.catchLoc,!0);if(this.prev<I.finallyLoc)return U(I.finallyLoc)}else if(pe){if(this.prev<I.catchLoc)return U(I.catchLoc,!0)}else{if(!O)throw new Error("try statement without catch or finally");if(this.prev<I.finallyLoc)return U(I.finallyLoc)}}}},abrupt:function(R,P){for(var U=this.tryEntries.length-1;U>=0;--U){var H=this.tryEntries[U];if(H.tryLoc<=this.prev&&e.call(H,"finallyLoc")&&this.prev<H.finallyLoc){var I=H;break}}I&&(R==="break"||R==="continue")&&I.tryLoc<=P&&P<=I.finallyLoc&&(I=null);var ee=I?I.completion:{};return ee.type=R,ee.arg=P,I?(this.method="next",this.next=I.finallyLoc,s):this.complete(ee)},complete:function(R,P){if(R.type==="throw")throw R.arg;return R.type==="break"||R.type==="continue"?this.next=R.arg:R.type==="return"?(this.rval=this.arg=R.arg,this.method="return",this.next="end"):R.type==="normal"&&P&&(this.next=P),s},finish:function(R){for(var P=this.tryEntries.length-1;P>=0;--P){var U=this.tryEntries[P];if(U.finallyLoc===R)return this.complete(U.completion,U.afterLoc),j(U),s}},catch:function(R){for(var P=this.tryEntries.length-1;P>=0;--P){var U=this.tryEntries[P];if(U.tryLoc===R){var H=U.completion;if(H.type==="throw"){var I=H.arg;j(U)}return I}}throw new Error("illegal catch attempt")},delegateYield:function(R,P,U){return this.delegate={iterator:re(R),resultName:P,nextLoc:U},this.method==="next"&&(this.arg=void 0),s}},r}(G.exports);try{regeneratorRuntime=d}catch{Function("r","regeneratorRuntime = r")(d)}},function(G,Q){var x;x=function(){return this}();try{x=x||new Function("return this")()}catch{typeof window=="object"&&(x=window)}G.exports=x},function(G,Q,x){var d=x(1);G.exports=function(r,o){var e=r&&r.window,c={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0};for(var l in o)hasOwnProperty.call(o,l)&&(c[l]=o[l]);var n=d.log,h=d.detectBrowser(e),S=x(7)||null,y=x(9)||null,s=x(13)||null,f=x(15)||null,t=x(16)||null,a={browserDetails:h,commonShim:t,extractVersion:d.extractVersion,disableLog:d.disableLog,disableWarnings:d.disableWarnings};switch(h.browser){case"chrome":if(!S||!S.shimPeerConnection||!c.shimChrome)return n("Chrome shim is not included in this adapter release."),a;n("adapter.js shimming chrome."),a.browserShim=S,t.shimCreateObjectURL(e),S.shimGetUserMedia(e),S.shimMediaStream(e),S.shimSourceObject(e),S.shimPeerConnection(e),S.shimOnTrack(e),S.shimAddTrackRemoveTrack(e),S.shimGetSendersWithDtmf(e),S.shimSenderReceiverGetStats(e),S.fixNegotiationNeeded(e),t.shimRTCIceCandidate(e),t.shimMaxMessageSize(e),t.shimSendThrowTypeError(e);break;case"firefox":if(!s||!s.shimPeerConnection||!c.shimFirefox)return n("Firefox shim is not included in this adapter release."),a;n("adapter.js shimming firefox."),a.browserShim=s,t.shimCreateObjectURL(e),s.shimGetUserMedia(e),s.shimSourceObject(e),s.shimPeerConnection(e),s.shimOnTrack(e),s.shimRemoveStream(e),s.shimSenderGetStats(e),s.shimReceiverGetStats(e),s.shimRTCDataChannel(e),t.shimRTCIceCandidate(e),t.shimMaxMessageSize(e),t.shimSendThrowTypeError(e);break;case"edge":if(!y||!y.shimPeerConnection||!c.shimEdge)return n("MS edge shim is not included in this adapter release."),a;n("adapter.js shimming edge."),a.browserShim=y,t.shimCreateObjectURL(e),y.shimGetUserMedia(e),y.shimPeerConnection(e),y.shimReplaceTrack(e),y.shimGetDisplayMedia(e),t.shimMaxMessageSize(e),t.shimSendThrowTypeError(e);break;case"safari":if(!f||!c.shimSafari)return n("Safari shim is not included in this adapter release."),a;n("adapter.js shimming safari."),a.browserShim=f,t.shimCreateObjectURL(e),f.shimRTCIceServerUrls(e),f.shimCreateOfferLegacy(e),f.shimCallbacksAPI(e),f.shimLocalStreamsAPI(e),f.shimRemoteStreamsAPI(e),f.shimTrackEventTransceiver(e),f.shimGetUserMedia(e),t.shimRTCIceCandidate(e),t.shimMaxMessageSize(e),t.shimSendThrowTypeError(e);break;default:n("Unsupported browser!")}return a}},function(G,Q,x){var d=x(1),r=d.log;function o(e,c,l){var n=l?"outbound-rtp":"inbound-rtp",h=new Map;if(c===null)return h;var S=[];return e.forEach(function(y){y.type==="track"&&y.trackIdentifier===c.id&&S.push(y)}),S.forEach(function(y){e.forEach(function(s){s.type===n&&s.trackId===y.id&&function f(t,a,i){a&&!i.has(a.id)&&(i.set(a.id,a),Object.keys(a).forEach(function(p){p.endsWith("Id")?f(t,t.get(a[p]),i):p.endsWith("Ids")&&a[p].forEach(function(b){f(t,t.get(b),i)})}))}(e,s,h)})}),h}G.exports={shimGetUserMedia:x(8),shimMediaStream:function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},shimOnTrack:function(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(l){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=l)},enumerable:!0,configurable:!0});var c=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var l=this;return l._ontrackpoly||(l._ontrackpoly=function(n){n.stream.addEventListener("addtrack",function(h){var S;S=e.RTCPeerConnection.prototype.getReceivers?l.getReceivers().find(function(s){return s.track&&s.track.id===h.track.id}):{track:h.track};var y=new Event("track");y.track=h.track,y.receiver=S,y.transceiver={receiver:S},y.streams=[n.stream],l.dispatchEvent(y)}),n.stream.getTracks().forEach(function(h){var S;S=e.RTCPeerConnection.prototype.getReceivers?l.getReceivers().find(function(s){return s.track&&s.track.id===h.id}):{track:h};var y=new Event("track");y.track=h,y.receiver=S,y.transceiver={receiver:S},y.streams=[n.stream],l.dispatchEvent(y)})},l.addEventListener("addstream",l._ontrackpoly)),c.apply(l,arguments)}}else d.wrapPeerConnectionEvent(e,"track",function(l){return l.transceiver||Object.defineProperty(l,"transceiver",{value:{receiver:l.receiver}}),l})},shimGetSendersWithDtmf:function(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var c=function(s,f){return{track:f,get dtmf(){return this._dtmf===void 0&&(f.kind==="audio"?this._dtmf=s.createDTMFSender(f):this._dtmf=null),this._dtmf},_pc:s}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var l=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(s,f){var t=this,a=l.apply(t,arguments);return a||(a=c(t,s),t._senders.push(a)),a};var n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(s){var f=this;n.apply(f,arguments);var t=f._senders.indexOf(s);t!==-1&&f._senders.splice(t,1)}}var h=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(s){var f=this;f._senders=f._senders||[],h.apply(f,[s]),s.getTracks().forEach(function(t){f._senders.push(c(f,t))})};var S=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(s){var f=this;f._senders=f._senders||[],S.apply(f,[s]),s.getTracks().forEach(function(t){var a=f._senders.find(function(i){return i.track===t});a&&f._senders.splice(f._senders.indexOf(a),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var y=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var s=this,f=y.apply(s,[]);return f.forEach(function(t){t._pc=s}),f},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},shimSenderReceiverGetStats:function(e){if(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var c=e.RTCPeerConnection.prototype.getSenders;c&&(e.RTCPeerConnection.prototype.getSenders=function(){var S=this,y=c.apply(S,[]);return y.forEach(function(s){s._pc=S}),y});var l=e.RTCPeerConnection.prototype.addTrack;l&&(e.RTCPeerConnection.prototype.addTrack=function(){var S=l.apply(this,arguments);return S._pc=this,S}),e.RTCRtpSender.prototype.getStats=function(){var S=this;return this._pc.getStats().then(function(y){return o(y,S.track,!0)})}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){var S=this,y=n.apply(S,[]);return y.forEach(function(s){s._pc=S}),y}),d.wrapPeerConnectionEvent(e,"track",function(S){return S.receiver._pc=S.srcElement,S}),e.RTCRtpReceiver.prototype.getStats=function(){var S=this;return this._pc.getStats().then(function(y){return o(y,S.track,!1)})}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var h=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var S=this;if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var y,s,f,t=arguments[0];return S.getSenders().forEach(function(a){a.track===t&&(y?f=!0:y=a)}),S.getReceivers().forEach(function(a){return a.track===t&&(s?f=!0:s=a),a.track===t}),f||y&&s?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):y?y.getStats():s?s.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return h.apply(S,arguments)}}}},shimSourceObject:function(e){var c=e&&e.URL;typeof e=="object"&&e.HTMLMediaElement&&!("srcObject"in e.HTMLMediaElement.prototype)&&Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(l){var n=this;this._srcObject=l,this.src&&c.revokeObjectURL(this.src),l?(this.src=c.createObjectURL(l),l.addEventListener("addtrack",function(){n.src&&c.revokeObjectURL(n.src),n.src=c.createObjectURL(l)}),l.addEventListener("removetrack",function(){n.src&&c.revokeObjectURL(n.src),n.src=c.createObjectURL(l)})):this.src=""}})},shimAddTrackRemoveTrackWithNative:function(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var S=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(y){return S._shimmedLocalStreams[y][0]})};var c=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(S,y){if(!y)return c.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var s=c.apply(this,arguments);return this._shimmedLocalStreams[y.id]?this._shimmedLocalStreams[y.id].indexOf(s)===-1&&this._shimmedLocalStreams[y.id].push(s):this._shimmedLocalStreams[y.id]=[y,s],s};var l=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(S){var y=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},S.getTracks().forEach(function(t){if(y.getSenders().find(function(a){return a.track===t}))throw new DOMException("Track already exists.","InvalidAccessError")});var s=y.getSenders();l.apply(this,arguments);var f=y.getSenders().filter(function(t){return s.indexOf(t)===-1});this._shimmedLocalStreams[S.id]=[S].concat(f)};var n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(S){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[S.id],n.apply(this,arguments)};var h=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(S){var y=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},S&&Object.keys(this._shimmedLocalStreams).forEach(function(s){var f=y._shimmedLocalStreams[s].indexOf(S);f!==-1&&y._shimmedLocalStreams[s].splice(f,1),y._shimmedLocalStreams[s].length===1&&delete y._shimmedLocalStreams[s]}),h.apply(this,arguments)}},shimAddTrackRemoveTrack:function(e){if(e.RTCPeerConnection){var c=d.detectBrowser(e);if(e.RTCPeerConnection.prototype.addTrack&&c.version>=65)return this.shimAddTrackRemoveTrackWithNative(e);var l=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var t=this,a=l.apply(this);return t._reverseStreams=t._reverseStreams||{},a.map(function(i){return t._reverseStreams[i.id]})};var n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var a=this;if(a._streams=a._streams||{},a._reverseStreams=a._reverseStreams||{},t.getTracks().forEach(function(p){if(a.getSenders().find(function(b){return b.track===p}))throw new DOMException("Track already exists.","InvalidAccessError")}),!a._reverseStreams[t.id]){var i=new e.MediaStream(t.getTracks());a._streams[t.id]=i,a._reverseStreams[i.id]=t,t=i}n.apply(a,[t])};var h=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(t){var a=this;a._streams=a._streams||{},a._reverseStreams=a._reverseStreams||{},h.apply(a,[a._streams[t.id]||t]),delete a._reverseStreams[a._streams[t.id]?a._streams[t.id].id:t.id],delete a._streams[t.id]},e.RTCPeerConnection.prototype.addTrack=function(t,a){var i=this;if(i.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var p=[].slice.call(arguments,1);if(p.length!==1||!p[0].getTracks().find(function(L){return L===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");var b=i.getSenders().find(function(L){return L.track===t});if(b)throw new DOMException("Track already exists.","InvalidAccessError");i._streams=i._streams||{},i._reverseStreams=i._reverseStreams||{};var D=i._streams[a.id];if(D)D.addTrack(t),Promise.resolve().then(function(){i.dispatchEvent(new Event("negotiationneeded"))});else{var T=new e.MediaStream([t]);i._streams[a.id]=T,i._reverseStreams[T.id]=a,i.addStream(T)}return i.getSenders().find(function(L){return L.track===t})},["createOffer","createAnswer"].forEach(function(t){var a=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var i=this,p=arguments,b=arguments.length&&typeof arguments[0]=="function";return b?a.apply(i,[function(D){var T=s(i,D);p[0].apply(null,[T])},function(D){p[1]&&p[1].apply(null,D)},arguments[2]]):a.apply(i,arguments).then(function(D){return s(i,D)})}});var S=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){var t=this;return arguments.length&&arguments[0].type&&(arguments[0]=f(t,arguments[0])),S.apply(t,arguments)};var y=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var t=y.get.apply(this);return t.type===""?t:s(this,t)}}),e.RTCPeerConnection.prototype.removeTrack=function(t){var a,i=this;if(i.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!t._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(t._pc!==i)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");i._streams=i._streams||{},Object.keys(i._streams).forEach(function(p){i._streams[p].getTracks().find(function(b){return t.track===b})&&(a=i._streams[p])}),a&&(a.getTracks().length===1?i.removeStream(i._reverseStreams[a.id]):a.removeTrack(t.track),i.dispatchEvent(new Event("negotiationneeded")))}}function s(t,a){var i=a.sdp;return Object.keys(t._reverseStreams||[]).forEach(function(p){var b=t._reverseStreams[p],D=t._streams[b.id];i=i.replace(new RegExp(D.id,"g"),b.id)}),new RTCSessionDescription({type:a.type,sdp:i})}function f(t,a){var i=a.sdp;return Object.keys(t._reverseStreams||[]).forEach(function(p){var b=t._reverseStreams[p],D=t._streams[b.id];i=i.replace(new RegExp(b.id,"g"),D.id)}),new RTCSessionDescription({type:a.type,sdp:i})}},shimPeerConnection:function(e){var c=d.detectBrowser(e);if(!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=function(h,S){return r("PeerConnection"),h&&h.iceTransportPolicy&&(h.iceTransports=h.iceTransportPolicy),new e.webkitRTCPeerConnection(h,S)},e.RTCPeerConnection.prototype=e.webkitRTCPeerConnection.prototype,e.webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.webkitRTCPeerConnection.generateCertificate}})),e.RTCPeerConnection){var l=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(h,S,y){var s=this,f=arguments;if(arguments.length>0&&typeof h=="function")return l.apply(this,arguments);if(l.length===0&&(arguments.length===0||typeof arguments[0]!="function"))return l.apply(this,[]);var t=function(p){var b={};return p.result().forEach(function(D){var T={id:D.id,timestamp:D.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[D.type]||D.type};D.names().forEach(function(L){T[L]=D.stat(L)}),b[T.id]=T}),b},a=function(p){return new Map(Object.keys(p).map(function(b){return[b,p[b]]}))};if(arguments.length>=2){var i=function(p){f[1](a(t(p)))};return l.apply(this,[i,arguments[0]])}return new Promise(function(p,b){l.apply(s,[function(D){p(a(t(D)))},b])}).then(S,y)},c.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(h){var S=e.RTCPeerConnection.prototype[h];e.RTCPeerConnection.prototype[h]=function(){var y=arguments,s=this,f=new Promise(function(t,a){S.apply(s,[y[0],t,a])});return y.length<2?f:f.then(function(){y[1].apply(null,[])},function(t){y.length>=3&&y[2].apply(null,[t])})}}),c.version<52&&["createOffer","createAnswer"].forEach(function(h){var S=e.RTCPeerConnection.prototype[h];e.RTCPeerConnection.prototype[h]=function(){var y=this;if(arguments.length<1||arguments.length===1&&typeof arguments[0]=="object"){var s=arguments.length===1?arguments[0]:void 0;return new Promise(function(f,t){S.apply(y,[f,t,s])})}return S.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(h){var S=e.RTCPeerConnection.prototype[h];e.RTCPeerConnection.prototype[h]=function(){return arguments[0]=new(h==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),S.apply(this,arguments)}});var n=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}},fixNegotiationNeeded:function(e){d.wrapPeerConnectionEvent(e,"negotiationneeded",function(c){if(c.target.signalingState==="stable")return c})},shimGetDisplayMedia:function(e,c){e.navigator&&e.navigator.mediaDevices&&!("getDisplayMedia"in e.navigator.mediaDevices)&&(typeof c=="function"?(e.navigator.mediaDevices.getDisplayMedia=function(l){return c(l).then(function(n){var h=l.video&&l.video.width,S=l.video&&l.video.height,y=l.video&&l.video.frameRate;return l.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:n,maxFrameRate:y||3}},h&&(l.video.mandatory.maxWidth=h),S&&(l.video.mandatory.maxHeight=S),e.navigator.mediaDevices.getUserMedia(l)})},e.navigator.getDisplayMedia=function(l){return d.deprecated("navigator.getDisplayMedia","navigator.mediaDevices.getDisplayMedia"),e.navigator.mediaDevices.getDisplayMedia(l)}):console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}}},function(G,Q,x){var d=x(1),r=d.log;G.exports=function(o){var e=d.detectBrowser(o),c=o&&o.navigator,l=function(s){if(typeof s!="object"||s.mandatory||s.optional)return s;var f={};return Object.keys(s).forEach(function(t){if(t!=="require"&&t!=="advanced"&&t!=="mediaSource"){var a=typeof s[t]=="object"?s[t]:{ideal:s[t]};a.exact!==void 0&&typeof a.exact=="number"&&(a.min=a.max=a.exact);var i=function(b,D){return b?b+D.charAt(0).toUpperCase()+D.slice(1):D==="deviceId"?"sourceId":D};if(a.ideal!==void 0){f.optional=f.optional||[];var p={};typeof a.ideal=="number"?(p[i("min",t)]=a.ideal,f.optional.push(p),(p={})[i("max",t)]=a.ideal,f.optional.push(p)):(p[i("",t)]=a.ideal,f.optional.push(p))}a.exact!==void 0&&typeof a.exact!="number"?(f.mandatory=f.mandatory||{},f.mandatory[i("",t)]=a.exact):["min","max"].forEach(function(b){a[b]!==void 0&&(f.mandatory=f.mandatory||{},f.mandatory[i(b,t)]=a[b])})}}),s.advanced&&(f.optional=(f.optional||[]).concat(s.advanced)),f},n=function(s,f){if(e.version>=61)return f(s);if((s=JSON.parse(JSON.stringify(s)))&&typeof s.audio=="object"){var t=function(b,D,T){D in b&&!(T in b)&&(b[T]=b[D],delete b[D])};t((s=JSON.parse(JSON.stringify(s))).audio,"autoGainControl","googAutoGainControl"),t(s.audio,"noiseSuppression","googNoiseSuppression"),s.audio=l(s.audio)}if(s&&typeof s.video=="object"){var a=s.video.facingMode;a=a&&(typeof a=="object"?a:{ideal:a});var i,p=e.version<66;if(a&&(a.exact==="user"||a.exact==="environment"||a.ideal==="user"||a.ideal==="environment")&&(!c.mediaDevices.getSupportedConstraints||!c.mediaDevices.getSupportedConstraints().facingMode||p)&&(delete s.video.facingMode,a.exact==="environment"||a.ideal==="environment"?i=["back","rear"]:a.exact!=="user"&&a.ideal!=="user"||(i=["front"]),i))return c.mediaDevices.enumerateDevices().then(function(b){var D=(b=b.filter(function(T){return T.kind==="videoinput"})).find(function(T){return i.some(function(L){return T.label.toLowerCase().indexOf(L)!==-1})});return!D&&b.length&&i.indexOf("back")!==-1&&(D=b[b.length-1]),D&&(s.video.deviceId=a.exact?{exact:D.deviceId}:{ideal:D.deviceId}),s.video=l(s.video),r("chrome: "+JSON.stringify(s)),f(s)});s.video=l(s.video)}return r("chrome: "+JSON.stringify(s)),f(s)},h=function(s){return e.version>=64?s:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[s.name]||s.name,message:s.message,constraint:s.constraint||s.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};c.getUserMedia=function(s,f,t){n(s,function(a){c.webkitGetUserMedia(a,f,function(i){t&&t(h(i))})})};var S=function(s){return new Promise(function(f,t){c.getUserMedia(s,f,t)})};if(c.mediaDevices||(c.mediaDevices={getUserMedia:S,enumerateDevices:function(){return new Promise(function(s){var f={audio:"audioinput",video:"videoinput"};return o.MediaStreamTrack.getSources(function(t){s(t.map(function(a){return{label:a.label,kind:f[a.kind],deviceId:a.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),c.mediaDevices.getUserMedia){var y=c.mediaDevices.getUserMedia.bind(c.mediaDevices);c.mediaDevices.getUserMedia=function(s){return n(s,function(f){return y(f).then(function(t){if(f.audio&&!t.getAudioTracks().length||f.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(a){a.stop()}),new DOMException("","NotFoundError");return t},function(t){return Promise.reject(h(t))})})}}else c.mediaDevices.getUserMedia=function(s){return S(s)};c.mediaDevices.addEventListener===void 0&&(c.mediaDevices.addEventListener=function(){r("Dummy mediaDevices.addEventListener called.")}),c.mediaDevices.removeEventListener===void 0&&(c.mediaDevices.removeEventListener=function(){r("Dummy mediaDevices.removeEventListener called.")})}},function(G,Q,x){var d=x(1),r=x(10),o=x(11);G.exports={shimGetUserMedia:x(12),shimPeerConnection:function(e){var c=d.detectBrowser(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(h){return h}),e.RTCSessionDescription||(e.RTCSessionDescription=function(h){return h}),c.version<15025)){var l=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(h){l.set.call(this,h);var S=new Event("enabled");S.enabled=h,this.dispatchEvent(S)}})}e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)&&Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=new e.RTCDtmfSender(this):this.track.kind==="video"&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);var n=o(e,c.version);e.RTCPeerConnection=function(h){return h&&h.iceServers&&(h.iceServers=r(h.iceServers)),new n(h)},e.RTCPeerConnection.prototype=n.prototype},shimReplaceTrack:function(e){e.RTCRtpSender&&!("replaceTrack"in e.RTCRtpSender.prototype)&&(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)},shimGetDisplayMedia:function(e,c){if("getDisplayMedia"in e.navigator&&e.navigator.mediaDevices&&!("getDisplayMedia"in e.navigator.mediaDevices)){var l=e.navigator.getDisplayMedia;e.navigator.mediaDevices.getDisplayMedia=function(n){return l.call(e.navigator,n)},e.navigator.getDisplayMedia=function(n){return d.deprecated("navigator.getDisplayMedia","navigator.mediaDevices.getDisplayMedia"),l.call(e.navigator,n)}}}}},function(G,Q,x){var d=x(1);G.exports=function(r,o){var e=!1;return(r=JSON.parse(JSON.stringify(r))).filter(function(c){if(c&&(c.urls||c.url)){var l=c.urls||c.url;c.url&&!c.urls&&d.deprecated("RTCIceServer.url","RTCIceServer.urls");var n=typeof l=="string";return n&&(l=[l]),l=l.filter(function(h){return h.indexOf("turn:")===0&&h.indexOf("transport=udp")!==-1&&h.indexOf("turn:[")===-1&&!e?(e=!0,!0):h.indexOf("stun:")===0&&o>=14393&&h.indexOf("?transport=udp")===-1}),delete c.url,c.urls=n?l[0]:l,!!l.length}})}},function(G,Q,x){var d=x(2);function r(n,h,S,y,s){var f=d.writeRtpDescription(n.kind,h);if(f+=d.writeIceParameters(n.iceGatherer.getLocalParameters()),f+=d.writeDtlsParameters(n.dtlsTransport.getLocalParameters(),S==="offer"?"actpass":s||"active"),f+="a=mid:"+n.mid+`\r
`,n.rtpSender&&n.rtpReceiver?f+=`a=sendrecv\r
`:n.rtpSender?f+=`a=sendonly\r
`:n.rtpReceiver?f+=`a=recvonly\r
`:f+=`a=inactive\r
`,n.rtpSender){var t=n.rtpSender._initialTrackId||n.rtpSender.track.id;n.rtpSender._initialTrackId=t;var a="msid:"+(y?y.id:"-")+" "+t+`\r
`;f+="a="+a,f+="a=ssrc:"+n.sendEncodingParameters[0].ssrc+" "+a,n.sendEncodingParameters[0].rtx&&(f+="a=ssrc:"+n.sendEncodingParameters[0].rtx.ssrc+" "+a,f+="a=ssrc-group:FID "+n.sendEncodingParameters[0].ssrc+" "+n.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return f+="a=ssrc:"+n.sendEncodingParameters[0].ssrc+" cname:"+d.localCName+`\r
`,n.rtpSender&&n.sendEncodingParameters[0].rtx&&(f+="a=ssrc:"+n.sendEncodingParameters[0].rtx.ssrc+" cname:"+d.localCName+`\r
`),f}function o(n,h){var S={codecs:[],headerExtensions:[],fecMechanisms:[]},y=function(f,t){f=parseInt(f,10);for(var a=0;a<t.length;a++)if(t[a].payloadType===f||t[a].preferredPayloadType===f)return t[a]},s=function(f,t,a,i){var p=y(f.parameters.apt,a),b=y(t.parameters.apt,i);return p&&b&&p.name.toLowerCase()===b.name.toLowerCase()};return n.codecs.forEach(function(f){for(var t=0;t<h.codecs.length;t++){var a=h.codecs[t];if(f.name.toLowerCase()===a.name.toLowerCase()&&f.clockRate===a.clockRate){if(f.name.toLowerCase()==="rtx"&&f.parameters&&a.parameters.apt&&!s(f,a,n.codecs,h.codecs))continue;(a=JSON.parse(JSON.stringify(a))).numChannels=Math.min(f.numChannels,a.numChannels),S.codecs.push(a),a.rtcpFeedback=a.rtcpFeedback.filter(function(i){for(var p=0;p<f.rtcpFeedback.length;p++)if(f.rtcpFeedback[p].type===i.type&&f.rtcpFeedback[p].parameter===i.parameter)return!0;return!1});break}}}),n.headerExtensions.forEach(function(f){for(var t=0;t<h.headerExtensions.length;t++){var a=h.headerExtensions[t];if(f.uri===a.uri){S.headerExtensions.push(a);break}}}),S}function e(n,h,S){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[h][n].indexOf(S)!==-1}function c(n,h){var S=n.getRemoteCandidates().find(function(y){return h.foundation===y.foundation&&h.ip===y.ip&&h.port===y.port&&h.priority===y.priority&&h.protocol===y.protocol&&h.type===y.type});return S||n.addRemoteCandidate(h),!S}function l(n,h){var S=new Error(h);return S.name=n,S.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[n],S}G.exports=function(n,h){function S(t,a){a.addTrack(t),a.dispatchEvent(new n.MediaStreamTrackEvent("addtrack",{track:t}))}function y(t,a,i,p){var b=new Event("track");b.track=a,b.receiver=i,b.transceiver={receiver:i},b.streams=p,n.setTimeout(function(){t._dispatchEvent("track",b)})}var s=function(t){var a=this,i=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(b){a[b]=i[b].bind(i)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",t=JSON.parse(JSON.stringify(t||{})),this.usingBundle=t.bundlePolicy==="max-bundle",t.rtcpMuxPolicy==="negotiate")throw l("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(t.rtcpMuxPolicy||(t.rtcpMuxPolicy="require"),t.iceTransportPolicy){case"all":case"relay":break;default:t.iceTransportPolicy="all"}switch(t.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:t.bundlePolicy="balanced"}if(t.iceServers=function(b,D){var T=!1;return(b=JSON.parse(JSON.stringify(b))).filter(function(L){if(L&&(L.urls||L.url)){var V=L.urls||L.url;L.url&&!L.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var A=typeof V=="string";return A&&(V=[V]),V=V.filter(function(j){return j.indexOf("turn:")===0&&j.indexOf("transport=udp")!==-1&&j.indexOf("turn:[")===-1&&!T?(T=!0,!0):j.indexOf("stun:")===0&&D>=14393&&j.indexOf("?transport=udp")===-1}),delete L.url,L.urls=A?V[0]:V,!!V.length}})}(t.iceServers||[],h),this._iceGatherers=[],t.iceCandidatePoolSize)for(var p=t.iceCandidatePoolSize;p>0;p--)this._iceGatherers.push(new n.RTCIceGatherer({iceServers:t.iceServers,gatherPolicy:t.iceTransportPolicy}));else t.iceCandidatePoolSize=0;this._config=t,this.transceivers=[],this._sdpSessionId=d.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(s.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(s.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),s.prototype.onicecandidate=null,s.prototype.onaddstream=null,s.prototype.ontrack=null,s.prototype.onremovestream=null,s.prototype.onsignalingstatechange=null,s.prototype.oniceconnectionstatechange=null,s.prototype.onconnectionstatechange=null,s.prototype.onicegatheringstatechange=null,s.prototype.onnegotiationneeded=null,s.prototype.ondatachannel=null,s.prototype._dispatchEvent=function(t,a){this._isClosed||(this.dispatchEvent(a),typeof this["on"+t]=="function"&&this["on"+t](a))},s.prototype._emitGatheringStateChange=function(){var t=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",t)},s.prototype.getConfiguration=function(){return this._config},s.prototype.getLocalStreams=function(){return this.localStreams},s.prototype.getRemoteStreams=function(){return this.remoteStreams},s.prototype._createTransceiver=function(t,a){var i=this.transceivers.length>0,p={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:t,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&i)p.iceTransport=this.transceivers[0].iceTransport,p.dtlsTransport=this.transceivers[0].dtlsTransport;else{var b=this._createIceAndDtlsTransports();p.iceTransport=b.iceTransport,p.dtlsTransport=b.dtlsTransport}return a||this.transceivers.push(p),p},s.prototype.addTrack=function(t,a){if(this._isClosed)throw l("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var i;if(this.transceivers.find(function(b){return b.track===t}))throw l("InvalidAccessError","Track already exists.");for(var p=0;p<this.transceivers.length;p++)this.transceivers[p].track||this.transceivers[p].kind!==t.kind||(i=this.transceivers[p]);return i||(i=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),this.localStreams.indexOf(a)===-1&&this.localStreams.push(a),i.track=t,i.stream=a,i.rtpSender=new n.RTCRtpSender(t,i.dtlsTransport),i.rtpSender},s.prototype.addStream=function(t){var a=this;if(h>=15025)t.getTracks().forEach(function(p){a.addTrack(p,t)});else{var i=t.clone();t.getTracks().forEach(function(p,b){var D=i.getTracks()[b];p.addEventListener("enabled",function(T){D.enabled=T.enabled})}),i.getTracks().forEach(function(p){a.addTrack(p,i)})}},s.prototype.removeTrack=function(t){if(this._isClosed)throw l("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof n.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var a=this.transceivers.find(function(p){return p.rtpSender===t});if(!a)throw l("InvalidAccessError","Sender was not created by this connection.");var i=a.stream;a.rtpSender.stop(),a.rtpSender=null,a.track=null,a.stream=null,this.transceivers.map(function(p){return p.stream}).indexOf(i)===-1&&this.localStreams.indexOf(i)>-1&&this.localStreams.splice(this.localStreams.indexOf(i),1),this._maybeFireNegotiationNeeded()},s.prototype.removeStream=function(t){var a=this;t.getTracks().forEach(function(i){var p=a.getSenders().find(function(b){return b.track===i});p&&a.removeTrack(p)})},s.prototype.getSenders=function(){return this.transceivers.filter(function(t){return!!t.rtpSender}).map(function(t){return t.rtpSender})},s.prototype.getReceivers=function(){return this.transceivers.filter(function(t){return!!t.rtpReceiver}).map(function(t){return t.rtpReceiver})},s.prototype._createIceGatherer=function(t,a){var i=this;if(a&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var p=new n.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(p,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(b){var D=!b.candidate||Object.keys(b.candidate).length===0;p.state=D?"completed":"gathering",i.transceivers[t].bufferedCandidateEvents!==null&&i.transceivers[t].bufferedCandidateEvents.push(b)},p.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),p},s.prototype._gather=function(t,a){var i=this,p=this.transceivers[a].iceGatherer;if(!p.onlocalcandidate){var b=this.transceivers[a].bufferedCandidateEvents;this.transceivers[a].bufferedCandidateEvents=null,p.removeEventListener("localcandidate",this.transceivers[a].bufferCandidates),p.onlocalcandidate=function(D){if(!(i.usingBundle&&a>0)){var T=new Event("icecandidate");T.candidate={sdpMid:t,sdpMLineIndex:a};var L=D.candidate,V=!L||Object.keys(L).length===0;if(V)p.state!=="new"&&p.state!=="gathering"||(p.state="completed");else{p.state==="new"&&(p.state="gathering"),L.component=1,L.ufrag=p.getLocalParameters().usernameFragment;var A=d.writeCandidate(L);T.candidate=Object.assign(T.candidate,d.parseCandidate(A)),T.candidate.candidate=A,T.candidate.toJSON=function(){return{candidate:T.candidate.candidate,sdpMid:T.candidate.sdpMid,sdpMLineIndex:T.candidate.sdpMLineIndex,usernameFragment:T.candidate.usernameFragment}}}var j=d.getMediaSections(i._localDescription.sdp);j[T.candidate.sdpMLineIndex]+=V?`a=end-of-candidates\r
`:"a="+T.candidate.candidate+`\r
`,i._localDescription.sdp=d.getDescription(i._localDescription.sdp)+j.join("");var ce=i.transceivers.every(function(re){return re.iceGatherer&&re.iceGatherer.state==="completed"});i.iceGatheringState!=="gathering"&&(i.iceGatheringState="gathering",i._emitGatheringStateChange()),V||i._dispatchEvent("icecandidate",T),ce&&(i._dispatchEvent("icecandidate",new Event("icecandidate")),i.iceGatheringState="complete",i._emitGatheringStateChange())}},n.setTimeout(function(){b.forEach(function(D){p.onlocalcandidate(D)})},0)}},s.prototype._createIceAndDtlsTransports=function(){var t=this,a=new n.RTCIceTransport(null);a.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var i=new n.RTCDtlsTransport(a);return i.ondtlsstatechange=function(){t._updateConnectionState()},i.onerror=function(){Object.defineProperty(i,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:a,dtlsTransport:i}},s.prototype._disposeIceAndDtlsTransports=function(t){var a=this.transceivers[t].iceGatherer;a&&(delete a.onlocalcandidate,delete this.transceivers[t].iceGatherer);var i=this.transceivers[t].iceTransport;i&&(delete i.onicestatechange,delete this.transceivers[t].iceTransport);var p=this.transceivers[t].dtlsTransport;p&&(delete p.ondtlsstatechange,delete p.onerror,delete this.transceivers[t].dtlsTransport)},s.prototype._transceive=function(t,a,i){var p=o(t.localCapabilities,t.remoteCapabilities);a&&t.rtpSender&&(p.encodings=t.sendEncodingParameters,p.rtcp={cname:d.localCName,compound:t.rtcpParameters.compound},t.recvEncodingParameters.length&&(p.rtcp.ssrc=t.recvEncodingParameters[0].ssrc),t.rtpSender.send(p)),i&&t.rtpReceiver&&p.codecs.length>0&&(t.kind==="video"&&t.recvEncodingParameters&&h<15019&&t.recvEncodingParameters.forEach(function(b){delete b.rtx}),t.recvEncodingParameters.length?p.encodings=t.recvEncodingParameters:p.encodings=[{}],p.rtcp={compound:t.rtcpParameters.compound},t.rtcpParameters.cname&&(p.rtcp.cname=t.rtcpParameters.cname),t.sendEncodingParameters.length&&(p.rtcp.ssrc=t.sendEncodingParameters[0].ssrc),t.rtpReceiver.receive(p))},s.prototype.setLocalDescription=function(t){var a,i,p=this;if(["offer","answer"].indexOf(t.type)===-1)return Promise.reject(l("TypeError",'Unsupported type "'+t.type+'"'));if(!e("setLocalDescription",t.type,p.signalingState)||p._isClosed)return Promise.reject(l("InvalidStateError","Can not set local "+t.type+" in state "+p.signalingState));if(t.type==="offer")a=d.splitSections(t.sdp),i=a.shift(),a.forEach(function(D,T){var L=d.parseRtpParameters(D);p.transceivers[T].localCapabilities=L}),p.transceivers.forEach(function(D,T){p._gather(D.mid,T)});else if(t.type==="answer"){a=d.splitSections(p._remoteDescription.sdp),i=a.shift();var b=d.matchPrefix(i,"a=ice-lite").length>0;a.forEach(function(D,T){var L=p.transceivers[T],V=L.iceGatherer,A=L.iceTransport,j=L.dtlsTransport,ce=L.localCapabilities,re=L.remoteCapabilities;if(!(d.isRejected(D)&&d.matchPrefix(D,"a=bundle-only").length===0)&&!L.rejected){var X=d.getIceParameters(D,i),R=d.getDtlsParameters(D,i);b&&(R.role="server"),p.usingBundle&&T!==0||(p._gather(L.mid,T),A.state==="new"&&A.start(V,X,b?"controlling":"controlled"),j.state==="new"&&j.start(R));var P=o(ce,re);p._transceive(L,P.codecs.length>0,!1)}})}return p._localDescription={type:t.type,sdp:t.sdp},t.type==="offer"?p._updateSignalingState("have-local-offer"):p._updateSignalingState("stable"),Promise.resolve()},s.prototype.setRemoteDescription=function(t){var a=this;if(["offer","answer"].indexOf(t.type)===-1)return Promise.reject(l("TypeError",'Unsupported type "'+t.type+'"'));if(!e("setRemoteDescription",t.type,a.signalingState)||a._isClosed)return Promise.reject(l("InvalidStateError","Can not set remote "+t.type+" in state "+a.signalingState));var i={};a.remoteStreams.forEach(function(A){i[A.id]=A});var p=[],b=d.splitSections(t.sdp),D=b.shift(),T=d.matchPrefix(D,"a=ice-lite").length>0,L=d.matchPrefix(D,"a=group:BUNDLE ").length>0;a.usingBundle=L;var V=d.matchPrefix(D,"a=ice-options:")[0];return a.canTrickleIceCandidates=!!V&&V.substr(14).split(" ").indexOf("trickle")>=0,b.forEach(function(A,j){var ce=d.splitLines(A),re=d.getKind(A),X=d.isRejected(A)&&d.matchPrefix(A,"a=bundle-only").length===0,R=ce[0].substr(2).split(" ")[2],P=d.getDirection(A,D),U=d.parseMsid(A),H=d.getMid(A)||d.generateIdentifier();if(X||re==="application"&&(R==="DTLS/SCTP"||R==="UDP/DTLS/SCTP"))a.transceivers[j]={mid:H,kind:re,protocol:R,rejected:!0};else{var I,ee,pe,O,J,F,K,oe,te;!X&&a.transceivers[j]&&a.transceivers[j].rejected&&(a.transceivers[j]=a._createTransceiver(re,!0));var Ce,Se,fe=d.parseRtpParameters(A);X||(Ce=d.getIceParameters(A,D),(Se=d.getDtlsParameters(A,D)).role="client"),K=d.parseRtpEncodingParameters(A);var he=d.parseRtcpParameters(A),Le=d.matchPrefix(A,"a=end-of-candidates",D).length>0,Pe=d.matchPrefix(A,"a=candidate:").map(function(le){return d.parseCandidate(le)}).filter(function(le){return le.component===1});if((t.type==="offer"||t.type==="answer")&&!X&&L&&j>0&&a.transceivers[j]&&(a._disposeIceAndDtlsTransports(j),a.transceivers[j].iceGatherer=a.transceivers[0].iceGatherer,a.transceivers[j].iceTransport=a.transceivers[0].iceTransport,a.transceivers[j].dtlsTransport=a.transceivers[0].dtlsTransport,a.transceivers[j].rtpSender&&a.transceivers[j].rtpSender.setTransport(a.transceivers[0].dtlsTransport),a.transceivers[j].rtpReceiver&&a.transceivers[j].rtpReceiver.setTransport(a.transceivers[0].dtlsTransport)),t.type!=="offer"||X)t.type==="answer"&&!X&&(ee=(I=a.transceivers[j]).iceGatherer,pe=I.iceTransport,O=I.dtlsTransport,J=I.rtpReceiver,F=I.sendEncodingParameters,oe=I.localCapabilities,a.transceivers[j].recvEncodingParameters=K,a.transceivers[j].remoteCapabilities=fe,a.transceivers[j].rtcpParameters=he,Pe.length&&pe.state==="new"&&(!T&&!Le||L&&j!==0?Pe.forEach(function(le){c(I.iceTransport,le)}):pe.setRemoteCandidates(Pe)),L&&j!==0||(pe.state==="new"&&pe.start(ee,Ce,"controlling"),O.state==="new"&&O.start(Se)),!o(I.localCapabilities,I.remoteCapabilities).codecs.filter(function(le){return le.name.toLowerCase()==="rtx"}).length&&I.sendEncodingParameters[0].rtx&&delete I.sendEncodingParameters[0].rtx,a._transceive(I,P==="sendrecv"||P==="recvonly",P==="sendrecv"||P==="sendonly"),!J||P!=="sendrecv"&&P!=="sendonly"?delete I.rtpReceiver:(te=J.track,U?(i[U.stream]||(i[U.stream]=new n.MediaStream),S(te,i[U.stream]),p.push([te,J,i[U.stream]])):(i.default||(i.default=new n.MediaStream),S(te,i.default),p.push([te,J,i.default]))));else{(I=a.transceivers[j]||a._createTransceiver(re)).mid=H,I.iceGatherer||(I.iceGatherer=a._createIceGatherer(j,L)),Pe.length&&I.iceTransport.state==="new"&&(!Le||L&&j!==0?Pe.forEach(function(le){c(I.iceTransport,le)}):I.iceTransport.setRemoteCandidates(Pe)),oe=n.RTCRtpReceiver.getCapabilities(re),h<15019&&(oe.codecs=oe.codecs.filter(function(le){return le.name!=="rtx"})),F=I.sendEncodingParameters||[{ssrc:1001*(2*j+2)}];var Ee,Y=!1;P==="sendrecv"||P==="sendonly"?(Y=!I.rtpReceiver,J=I.rtpReceiver||new n.RTCRtpReceiver(I.dtlsTransport,re),Y&&(te=J.track,U&&U.stream==="-"||(U?(i[U.stream]||(i[U.stream]=new n.MediaStream,Object.defineProperty(i[U.stream],"id",{get:function(){return U.stream}})),Object.defineProperty(te,"id",{get:function(){return U.track}}),Ee=i[U.stream]):(i.default||(i.default=new n.MediaStream),Ee=i.default)),Ee&&(S(te,Ee),I.associatedRemoteMediaStreams.push(Ee)),p.push([te,J,Ee]))):I.rtpReceiver&&I.rtpReceiver.track&&(I.associatedRemoteMediaStreams.forEach(function(le){var Me=le.getTracks().find(function(we){return we.id===I.rtpReceiver.track.id});Me&&function(we,be){be.removeTrack(we),be.dispatchEvent(new n.MediaStreamTrackEvent("removetrack",{track:we}))}(Me,le)}),I.associatedRemoteMediaStreams=[]),I.localCapabilities=oe,I.remoteCapabilities=fe,I.rtpReceiver=J,I.rtcpParameters=he,I.sendEncodingParameters=F,I.recvEncodingParameters=K,a._transceive(a.transceivers[j],!1,Y)}}}),a._dtlsRole===void 0&&(a._dtlsRole=t.type==="offer"?"active":"passive"),a._remoteDescription={type:t.type,sdp:t.sdp},t.type==="offer"?a._updateSignalingState("have-remote-offer"):a._updateSignalingState("stable"),Object.keys(i).forEach(function(A){var j=i[A];if(j.getTracks().length){if(a.remoteStreams.indexOf(j)===-1){a.remoteStreams.push(j);var ce=new Event("addstream");ce.stream=j,n.setTimeout(function(){a._dispatchEvent("addstream",ce)})}p.forEach(function(re){var X=re[0],R=re[1];j.id===re[2].id&&y(a,X,R,[j])})}}),p.forEach(function(A){A[2]||y(a,A[0],A[1],[])}),n.setTimeout(function(){a&&a.transceivers&&a.transceivers.forEach(function(A){A.iceTransport&&A.iceTransport.state==="new"&&A.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),A.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},s.prototype.close=function(){this.transceivers.forEach(function(t){t.iceTransport&&t.iceTransport.stop(),t.dtlsTransport&&t.dtlsTransport.stop(),t.rtpSender&&t.rtpSender.stop(),t.rtpReceiver&&t.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},s.prototype._updateSignalingState=function(t){this.signalingState=t;var a=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",a)},s.prototype._maybeFireNegotiationNeeded=function(){var t=this;this.signalingState==="stable"&&this.needNegotiation!==!0&&(this.needNegotiation=!0,n.setTimeout(function(){if(t.needNegotiation){t.needNegotiation=!1;var a=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",a)}},0))},s.prototype._updateIceConnectionState=function(){var t,a={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(p){p.iceTransport&&!p.rejected&&a[p.iceTransport.state]++}),t="new",a.failed>0?t="failed":a.checking>0?t="checking":a.disconnected>0?t="disconnected":a.new>0?t="new":a.connected>0?t="connected":a.completed>0&&(t="completed"),t!==this.iceConnectionState){this.iceConnectionState=t;var i=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",i)}},s.prototype._updateConnectionState=function(){var t,a={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(p){p.iceTransport&&p.dtlsTransport&&!p.rejected&&(a[p.iceTransport.state]++,a[p.dtlsTransport.state]++)}),a.connected+=a.completed,t="new",a.failed>0?t="failed":a.connecting>0?t="connecting":a.disconnected>0?t="disconnected":a.new>0?t="new":a.connected>0&&(t="connected"),t!==this.connectionState){this.connectionState=t;var i=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",i)}},s.prototype.createOffer=function(){var t=this;if(t._isClosed)return Promise.reject(l("InvalidStateError","Can not call createOffer after close"));var a=t.transceivers.filter(function(T){return T.kind==="audio"}).length,i=t.transceivers.filter(function(T){return T.kind==="video"}).length,p=arguments[0];if(p){if(p.mandatory||p.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");p.offerToReceiveAudio!==void 0&&(a=p.offerToReceiveAudio===!0?1:p.offerToReceiveAudio===!1?0:p.offerToReceiveAudio),p.offerToReceiveVideo!==void 0&&(i=p.offerToReceiveVideo===!0?1:p.offerToReceiveVideo===!1?0:p.offerToReceiveVideo)}for(t.transceivers.forEach(function(T){T.kind==="audio"?--a<0&&(T.wantReceive=!1):T.kind==="video"&&--i<0&&(T.wantReceive=!1)});a>0||i>0;)a>0&&(t._createTransceiver("audio"),a--),i>0&&(t._createTransceiver("video"),i--);var b=d.writeSessionBoilerplate(t._sdpSessionId,t._sdpSessionVersion++);t.transceivers.forEach(function(T,L){var V=T.track,A=T.kind,j=T.mid||d.generateIdentifier();T.mid=j,T.iceGatherer||(T.iceGatherer=t._createIceGatherer(L,t.usingBundle));var ce=n.RTCRtpSender.getCapabilities(A);h<15019&&(ce.codecs=ce.codecs.filter(function(X){return X.name!=="rtx"})),ce.codecs.forEach(function(X){X.name==="H264"&&X.parameters["level-asymmetry-allowed"]===void 0&&(X.parameters["level-asymmetry-allowed"]="1"),T.remoteCapabilities&&T.remoteCapabilities.codecs&&T.remoteCapabilities.codecs.forEach(function(R){X.name.toLowerCase()===R.name.toLowerCase()&&X.clockRate===R.clockRate&&(X.preferredPayloadType=R.payloadType)})}),ce.headerExtensions.forEach(function(X){(T.remoteCapabilities&&T.remoteCapabilities.headerExtensions||[]).forEach(function(R){X.uri===R.uri&&(X.id=R.id)})});var re=T.sendEncodingParameters||[{ssrc:1001*(2*L+1)}];V&&h>=15019&&A==="video"&&!re[0].rtx&&(re[0].rtx={ssrc:re[0].ssrc+1}),T.wantReceive&&(T.rtpReceiver=new n.RTCRtpReceiver(T.dtlsTransport,A)),T.localCapabilities=ce,T.sendEncodingParameters=re}),t._config.bundlePolicy!=="max-compat"&&(b+="a=group:BUNDLE "+t.transceivers.map(function(T){return T.mid}).join(" ")+`\r
`),b+=`a=ice-options:trickle\r
`,t.transceivers.forEach(function(T,L){b+=r(T,T.localCapabilities,"offer",T.stream,t._dtlsRole),b+=`a=rtcp-rsize\r
`,!T.iceGatherer||t.iceGatheringState==="new"||L!==0&&t.usingBundle||(T.iceGatherer.getLocalCandidates().forEach(function(V){V.component=1,b+="a="+d.writeCandidate(V)+`\r
`}),T.iceGatherer.state==="completed"&&(b+=`a=end-of-candidates\r
`))});var D=new n.RTCSessionDescription({type:"offer",sdp:b});return Promise.resolve(D)},s.prototype.createAnswer=function(){var t=this;if(t._isClosed)return Promise.reject(l("InvalidStateError","Can not call createAnswer after close"));if(t.signalingState!=="have-remote-offer"&&t.signalingState!=="have-local-pranswer")return Promise.reject(l("InvalidStateError","Can not call createAnswer in signalingState "+t.signalingState));var a=d.writeSessionBoilerplate(t._sdpSessionId,t._sdpSessionVersion++);t.usingBundle&&(a+="a=group:BUNDLE "+t.transceivers.map(function(b){return b.mid}).join(" ")+`\r
`),a+=`a=ice-options:trickle\r
`;var i=d.getMediaSections(t._remoteDescription.sdp).length;t.transceivers.forEach(function(b,D){if(!(D+1>i)){if(b.rejected)return b.kind==="application"?b.protocol==="DTLS/SCTP"?a+=`m=application 0 DTLS/SCTP 5000\r
`:a+="m=application 0 "+b.protocol+` webrtc-datachannel\r
`:b.kind==="audio"?a+=`m=audio 0 UDP/TLS/RTP/SAVPF 0\r
a=rtpmap:0 PCMU/8000\r
`:b.kind==="video"&&(a+=`m=video 0 UDP/TLS/RTP/SAVPF 120\r
a=rtpmap:120 VP8/90000\r
`),void(a+=`c=IN IP4 0.0.0.0\r
a=inactive\r
a=mid:`+b.mid+`\r
`);var T;b.stream&&(b.kind==="audio"?T=b.stream.getAudioTracks()[0]:b.kind==="video"&&(T=b.stream.getVideoTracks()[0]),T&&h>=15019&&b.kind==="video"&&!b.sendEncodingParameters[0].rtx&&(b.sendEncodingParameters[0].rtx={ssrc:b.sendEncodingParameters[0].ssrc+1}));var L=o(b.localCapabilities,b.remoteCapabilities);!L.codecs.filter(function(V){return V.name.toLowerCase()==="rtx"}).length&&b.sendEncodingParameters[0].rtx&&delete b.sendEncodingParameters[0].rtx,a+=r(b,L,"answer",b.stream,t._dtlsRole),b.rtcpParameters&&b.rtcpParameters.reducedSize&&(a+=`a=rtcp-rsize\r
`)}});var p=new n.RTCSessionDescription({type:"answer",sdp:a});return Promise.resolve(p)},s.prototype.addIceCandidate=function(t){var a,i=this;return t&&t.sdpMLineIndex===void 0&&!t.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(p,b){if(!i._remoteDescription)return b(l("InvalidStateError","Can not add ICE candidate without a remote description"));if(t&&t.candidate!==""){var D=t.sdpMLineIndex;if(t.sdpMid){for(var T=0;T<i.transceivers.length;T++)if(i.transceivers[T].mid===t.sdpMid){D=T;break}}var L=i.transceivers[D];if(!L)return b(l("OperationError","Can not add ICE candidate"));if(L.rejected)return p();var V=Object.keys(t.candidate).length>0?d.parseCandidate(t.candidate):{};if(V.protocol==="tcp"&&(V.port===0||V.port===9)||V.component&&V.component!==1)return p();if((D===0||D>0&&L.iceTransport!==i.transceivers[0].iceTransport)&&!c(L.iceTransport,V))return b(l("OperationError","Can not add ICE candidate"));var A=t.candidate.trim();A.indexOf("a=")===0&&(A=A.substr(2)),(a=d.getMediaSections(i._remoteDescription.sdp))[D]+="a="+(V.type?A:"end-of-candidates")+`\r
`,i._remoteDescription.sdp=d.getDescription(i._remoteDescription.sdp)+a.join("")}else for(var j=0;j<i.transceivers.length&&(i.transceivers[j].rejected||(i.transceivers[j].iceTransport.addRemoteCandidate({}),(a=d.getMediaSections(i._remoteDescription.sdp))[j]+=`a=end-of-candidates\r
`,i._remoteDescription.sdp=d.getDescription(i._remoteDescription.sdp)+a.join(""),!i.usingBundle));j++);p()})},s.prototype.getStats=function(t){if(t&&t instanceof n.MediaStreamTrack){var a=null;if(this.transceivers.forEach(function(p){p.rtpSender&&p.rtpSender.track===t?a=p.rtpSender:p.rtpReceiver&&p.rtpReceiver.track===t&&(a=p.rtpReceiver)}),!a)throw l("InvalidAccessError","Invalid selector.");return a.getStats()}var i=[];return this.transceivers.forEach(function(p){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(b){p[b]&&i.push(p[b].getStats())})}),Promise.all(i).then(function(p){var b=new Map;return p.forEach(function(D){D.forEach(function(T){b.set(T.id,T)})}),b})},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(t){var a=n[t];if(a&&a.prototype&&a.prototype.getStats){var i=a.prototype.getStats;a.prototype.getStats=function(){return i.apply(this).then(function(p){var b=new Map;return Object.keys(p).forEach(function(D){var T;p[D].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(T=p[D]).type]||T.type,b.set(D,p[D])}),b})}}});var f=["createOffer","createAnswer"];return f.forEach(function(t){var a=s.prototype[t];s.prototype[t]=function(){var i=arguments;return typeof i[0]=="function"||typeof i[1]=="function"?a.apply(this,[arguments[2]]).then(function(p){typeof i[0]=="function"&&i[0].apply(null,[p])},function(p){typeof i[1]=="function"&&i[1].apply(null,[p])}):a.apply(this,arguments)}}),(f=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(t){var a=s.prototype[t];s.prototype[t]=function(){var i=arguments;return typeof i[1]=="function"||typeof i[2]=="function"?a.apply(this,arguments).then(function(){typeof i[1]=="function"&&i[1].apply(null)},function(p){typeof i[2]=="function"&&i[2].apply(null,[p])}):a.apply(this,arguments)}}),["getStats"].forEach(function(t){var a=s.prototype[t];s.prototype[t]=function(){var i=arguments;return typeof i[1]=="function"?a.apply(this,arguments).then(function(){typeof i[1]=="function"&&i[1].apply(null)}):a.apply(this,arguments)}}),s}},function(G,Q,x){G.exports=function(d){var r=d&&d.navigator,o=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(e){return o(e).catch(function(c){return Promise.reject(function(l){return{name:{PermissionDeniedError:"NotAllowedError"}[l.name]||l.name,message:l.message,constraint:l.constraint,toString:function(){return this.name}}}(c))})}}},function(G,Q,x){var d=x(1);G.exports={shimGetUserMedia:x(14),shimOnTrack:function(r){typeof r=="object"&&r.RTCPeerConnection&&!("ontrack"in r.RTCPeerConnection.prototype)&&Object.defineProperty(r.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(o){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=o),this.addEventListener("addstream",this._ontrackpoly=(function(e){e.stream.getTracks().forEach((function(c){var l=new Event("track");l.track=c,l.receiver={track:c},l.transceiver={receiver:l.receiver},l.streams=[e.stream],this.dispatchEvent(l)}).bind(this))}).bind(this))},enumerable:!0,configurable:!0}),typeof r=="object"&&r.RTCTrackEvent&&"receiver"in r.RTCTrackEvent.prototype&&!("transceiver"in r.RTCTrackEvent.prototype)&&Object.defineProperty(r.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimSourceObject:function(r){typeof r=="object"&&r.HTMLMediaElement&&!("srcObject"in r.HTMLMediaElement.prototype)&&Object.defineProperty(r.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(o){this.mozSrcObject=o}})},shimPeerConnection:function(r){var o=d.detectBrowser(r);if(typeof r=="object"&&(r.RTCPeerConnection||r.mozRTCPeerConnection)){r.RTCPeerConnection||(r.RTCPeerConnection=function(n,h){if(o.version<38&&n&&n.iceServers){for(var S=[],y=0;y<n.iceServers.length;y++){var s=n.iceServers[y];if(s.hasOwnProperty("urls"))for(var f=0;f<s.urls.length;f++){var t={url:s.urls[f]};s.urls[f].indexOf("turn")===0&&(t.username=s.username,t.credential=s.credential),S.push(t)}else S.push(n.iceServers[y])}n.iceServers=S}return new r.mozRTCPeerConnection(n,h)},r.RTCPeerConnection.prototype=r.mozRTCPeerConnection.prototype,r.mozRTCPeerConnection.generateCertificate&&Object.defineProperty(r.RTCPeerConnection,"generateCertificate",{get:function(){return r.mozRTCPeerConnection.generateCertificate}}),r.RTCSessionDescription=r.mozRTCSessionDescription,r.RTCIceCandidate=r.mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){var h=r.RTCPeerConnection.prototype[n];r.RTCPeerConnection.prototype[n]=function(){return arguments[0]=new(n==="addIceCandidate"?r.RTCIceCandidate:r.RTCSessionDescription)(arguments[0]),h.apply(this,arguments)}});var e=r.RTCPeerConnection.prototype.addIceCandidate;r.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?e.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var c={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},l=r.RTCPeerConnection.prototype.getStats;r.RTCPeerConnection.prototype.getStats=function(n,h,S){return l.apply(this,[n||null]).then(function(y){if(o.version<48&&(y=function(s){var f=new Map;return Object.keys(s).forEach(function(t){f.set(t,s[t]),f[t]=s[t]}),f}(y)),o.version<53&&!h)try{y.forEach(function(s){s.type=c[s.type]||s.type})}catch(s){if(s.name!=="TypeError")throw s;y.forEach(function(f,t){y.set(t,Object.assign({},f,{type:c[f.type]||f.type}))})}return y}).then(h,S)}}},shimSenderGetStats:function(r){if(typeof r=="object"&&r.RTCPeerConnection&&r.RTCRtpSender&&(!r.RTCRtpSender||!("getStats"in r.RTCRtpSender.prototype))){var o=r.RTCPeerConnection.prototype.getSenders;o&&(r.RTCPeerConnection.prototype.getSenders=function(){var c=this,l=o.apply(c,[]);return l.forEach(function(n){n._pc=c}),l});var e=r.RTCPeerConnection.prototype.addTrack;e&&(r.RTCPeerConnection.prototype.addTrack=function(){var c=e.apply(this,arguments);return c._pc=this,c}),r.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}},shimReceiverGetStats:function(r){if(typeof r=="object"&&r.RTCPeerConnection&&r.RTCRtpSender&&(!r.RTCRtpSender||!("getStats"in r.RTCRtpReceiver.prototype))){var o=r.RTCPeerConnection.prototype.getReceivers;o&&(r.RTCPeerConnection.prototype.getReceivers=function(){var e=this,c=o.apply(e,[]);return c.forEach(function(l){l._pc=e}),c}),d.wrapPeerConnectionEvent(r,"track",function(e){return e.receiver._pc=e.srcElement,e}),r.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}},shimRemoveStream:function(r){r.RTCPeerConnection&&!("removeStream"in r.RTCPeerConnection.prototype)&&(r.RTCPeerConnection.prototype.removeStream=function(o){var e=this;d.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(c){c.track&&o.getTracks().indexOf(c.track)!==-1&&e.removeTrack(c)})})},shimRTCDataChannel:function(r){r.DataChannel&&!r.RTCDataChannel&&(r.RTCDataChannel=r.DataChannel)},shimGetDisplayMedia:function(r,o){r.navigator&&r.navigator.mediaDevices&&!("getDisplayMedia"in r.navigator.mediaDevices)&&(r.navigator.mediaDevices.getDisplayMedia=function(e){if(!e||!e.video){var c=new DOMException("getDisplayMedia without video constraints is undefined");return c.name="NotFoundError",c.code=8,Promise.reject(c)}return e.video===!0?e.video={mediaSource:o}:e.video.mediaSource=o,r.navigator.mediaDevices.getUserMedia(e)},r.navigator.getDisplayMedia=function(e){return d.deprecated("navigator.getDisplayMedia","navigator.mediaDevices.getDisplayMedia"),r.navigator.mediaDevices.getDisplayMedia(e)})}}},function(G,Q,x){var d=x(1),r=d.log;G.exports=function(o){var e=d.detectBrowser(o),c=o&&o.navigator,l=o&&o.MediaStreamTrack,n=function(i){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[i.name]||i.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[i.message]||i.message,constraint:i.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},h=function(i,p,b){var D=function(T){if(typeof T!="object"||T.require)return T;var L=[];return Object.keys(T).forEach(function(V){if(V!=="require"&&V!=="advanced"&&V!=="mediaSource"){var A=T[V]=typeof T[V]=="object"?T[V]:{ideal:T[V]};if(A.min===void 0&&A.max===void 0&&A.exact===void 0||L.push(V),A.exact!==void 0&&(typeof A.exact=="number"?A.min=A.max=A.exact:T[V]=A.exact,delete A.exact),A.ideal!==void 0){T.advanced=T.advanced||[];var j={};typeof A.ideal=="number"?j[V]={min:A.ideal,max:A.ideal}:j[V]=A.ideal,T.advanced.push(j),delete A.ideal,Object.keys(A).length||delete T[V]}}}),L.length&&(T.require=L),T};return i=JSON.parse(JSON.stringify(i)),e.version<38&&(r("spec: "+JSON.stringify(i)),i.audio&&(i.audio=D(i.audio)),i.video&&(i.video=D(i.video)),r("ff37: "+JSON.stringify(i))),c.mozGetUserMedia(i,p,function(T){b(n(T))})};if(c.mediaDevices||(c.mediaDevices={getUserMedia:function(i){return new Promise(function(p,b){h(i,p,b)})},addEventListener:function(){},removeEventListener:function(){}}),c.mediaDevices.enumerateDevices=c.mediaDevices.enumerateDevices||function(){return new Promise(function(i){i([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},e.version<41){var S=c.mediaDevices.enumerateDevices.bind(c.mediaDevices);c.mediaDevices.enumerateDevices=function(){return S().then(void 0,function(i){if(i.name==="NotFoundError")return[];throw i})}}if(e.version<49){var y=c.mediaDevices.getUserMedia.bind(c.mediaDevices);c.mediaDevices.getUserMedia=function(i){return y(i).then(function(p){if(i.audio&&!p.getAudioTracks().length||i.video&&!p.getVideoTracks().length)throw p.getTracks().forEach(function(b){b.stop()}),new DOMException("The object can not be found here.","NotFoundError");return p},function(p){return Promise.reject(n(p))})}}if(!(e.version>55&&"autoGainControl"in c.mediaDevices.getSupportedConstraints())){var s=function(i,p,b){p in i&&!(b in i)&&(i[b]=i[p],delete i[p])},f=c.mediaDevices.getUserMedia.bind(c.mediaDevices);if(c.mediaDevices.getUserMedia=function(i){return typeof i=="object"&&typeof i.audio=="object"&&(i=JSON.parse(JSON.stringify(i)),s(i.audio,"autoGainControl","mozAutoGainControl"),s(i.audio,"noiseSuppression","mozNoiseSuppression")),f(i)},l&&l.prototype.getSettings){var t=l.prototype.getSettings;l.prototype.getSettings=function(){var i=t.apply(this,arguments);return s(i,"mozAutoGainControl","autoGainControl"),s(i,"mozNoiseSuppression","noiseSuppression"),i}}if(l&&l.prototype.applyConstraints){var a=l.prototype.applyConstraints;l.prototype.applyConstraints=function(i){return this.kind==="audio"&&typeof i=="object"&&(i=JSON.parse(JSON.stringify(i)),s(i,"autoGainControl","mozAutoGainControl"),s(i,"noiseSuppression","mozNoiseSuppression")),a.apply(this,[i])}}}c.getUserMedia=function(i,p,b){if(e.version<44)return h(i,p,b);d.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),c.mediaDevices.getUserMedia(i).then(p,b)}}},function(G,Q,x){var d=x(1);G.exports={shimLocalStreamsAPI:function(r){if(typeof r=="object"&&r.RTCPeerConnection){if("getLocalStreams"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),"getStreamById"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.getStreamById=function(e){var c=null;return this._localStreams&&this._localStreams.forEach(function(l){l.id===e&&(c=l)}),this._remoteStreams&&this._remoteStreams.forEach(function(l){l.id===e&&(c=l)}),c}),!("addStream"in r.RTCPeerConnection.prototype)){var o=r.RTCPeerConnection.prototype.addTrack;r.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.indexOf(e)===-1&&this._localStreams.push(e);var c=this;e.getTracks().forEach(function(l){o.call(c,l,e)})},r.RTCPeerConnection.prototype.addTrack=function(e,c){return c&&(this._localStreams?this._localStreams.indexOf(c)===-1&&this._localStreams.push(c):this._localStreams=[c]),o.call(this,e,c)}}"removeStream"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);var c=this._localStreams.indexOf(e);if(c!==-1){this._localStreams.splice(c,1);var l=this,n=e.getTracks();this.getSenders().forEach(function(h){n.indexOf(h.track)!==-1&&l.removeTrack(h)})}})}},shimRemoteStreamsAPI:function(r){if(typeof r=="object"&&r.RTCPeerConnection&&("getRemoteStreams"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in r.RTCPeerConnection.prototype))){Object.defineProperty(r.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){this._onaddstream&&this.removeEventListener("addstream",this._onaddstream),this.addEventListener("addstream",this._onaddstream=e)}});var o=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(c){c.streams.forEach(function(l){if(e._remoteStreams||(e._remoteStreams=[]),!(e._remoteStreams.indexOf(l)>=0)){e._remoteStreams.push(l);var n=new Event("addstream");n.stream=l,e.dispatchEvent(n)}})}),o.apply(e,arguments)}}},shimCallbacksAPI:function(r){if(typeof r=="object"&&r.RTCPeerConnection){var o=r.RTCPeerConnection.prototype,e=o.createOffer,c=o.createAnswer,l=o.setLocalDescription,n=o.setRemoteDescription,h=o.addIceCandidate;o.createOffer=function(y,s){var f=arguments.length>=2?arguments[2]:arguments[0],t=e.apply(this,[f]);return s?(t.then(y,s),Promise.resolve()):t},o.createAnswer=function(y,s){var f=arguments.length>=2?arguments[2]:arguments[0],t=c.apply(this,[f]);return s?(t.then(y,s),Promise.resolve()):t};var S=function(y,s,f){var t=l.apply(this,[y]);return f?(t.then(s,f),Promise.resolve()):t};o.setLocalDescription=S,S=function(y,s,f){var t=n.apply(this,[y]);return f?(t.then(s,f),Promise.resolve()):t},o.setRemoteDescription=S,S=function(y,s,f){var t=h.apply(this,[y]);return f?(t.then(s,f),Promise.resolve()):t},o.addIceCandidate=S}},shimGetUserMedia:function(r){var o=r&&r.navigator;o.getUserMedia||(o.webkitGetUserMedia?o.getUserMedia=o.webkitGetUserMedia.bind(o):o.mediaDevices&&o.mediaDevices.getUserMedia&&(o.getUserMedia=(function(e,c,l){o.mediaDevices.getUserMedia(e).then(c,l)}).bind(o)))},shimRTCIceServerUrls:function(r){var o=r.RTCPeerConnection;r.RTCPeerConnection=function(e,c){if(e&&e.iceServers){for(var l=[],n=0;n<e.iceServers.length;n++){var h=e.iceServers[n];!h.hasOwnProperty("urls")&&h.hasOwnProperty("url")?(d.deprecated("RTCIceServer.url","RTCIceServer.urls"),(h=JSON.parse(JSON.stringify(h))).urls=h.url,delete h.url,l.push(h)):l.push(e.iceServers[n])}e.iceServers=l}return new o(e,c)},r.RTCPeerConnection.prototype=o.prototype,"generateCertificate"in r.RTCPeerConnection&&Object.defineProperty(r.RTCPeerConnection,"generateCertificate",{get:function(){return o.generateCertificate}})},shimTrackEventTransceiver:function(r){typeof r=="object"&&r.RTCPeerConnection&&"receiver"in r.RTCTrackEvent.prototype&&!r.RTCTransceiver&&Object.defineProperty(r.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimCreateOfferLegacy:function(r){var o=r.RTCPeerConnection.prototype.createOffer;r.RTCPeerConnection.prototype.createOffer=function(e){var c=this;if(e){e.offerToReceiveAudio!==void 0&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var l=c.getTransceivers().find(function(h){return h.sender.track&&h.sender.track.kind==="audio"});e.offerToReceiveAudio===!1&&l?l.direction==="sendrecv"?l.setDirection?l.setDirection("sendonly"):l.direction="sendonly":l.direction==="recvonly"&&(l.setDirection?l.setDirection("inactive"):l.direction="inactive"):e.offerToReceiveAudio!==!0||l||c.addTransceiver("audio"),e.offerToReceiveVideo!==void 0&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var n=c.getTransceivers().find(function(h){return h.sender.track&&h.sender.track.kind==="video"});e.offerToReceiveVideo===!1&&n?n.direction==="sendrecv"?n.setDirection("sendonly"):n.direction==="recvonly"&&n.setDirection("inactive"):e.offerToReceiveVideo!==!0||n||c.addTransceiver("video")}return o.apply(c,arguments)}}}},function(G,Q,x){var d=x(2),r=x(1);G.exports={shimRTCIceCandidate:function(o){if(!(!o.RTCIceCandidate||o.RTCIceCandidate&&"foundation"in o.RTCIceCandidate.prototype)){var e=o.RTCIceCandidate;o.RTCIceCandidate=function(c){if(typeof c=="object"&&c.candidate&&c.candidate.indexOf("a=")===0&&((c=JSON.parse(JSON.stringify(c))).candidate=c.candidate.substr(2)),c.candidate&&c.candidate.length){var l=new e(c),n=d.parseCandidate(c.candidate),h=Object.assign(l,n);return h.toJSON=function(){return{candidate:h.candidate,sdpMid:h.sdpMid,sdpMLineIndex:h.sdpMLineIndex,usernameFragment:h.usernameFragment}},h}return new e(c)},o.RTCIceCandidate.prototype=e.prototype,r.wrapPeerConnectionEvent(o,"icecandidate",function(c){return c.candidate&&Object.defineProperty(c,"candidate",{value:new o.RTCIceCandidate(c.candidate),writable:"false"}),c})}},shimCreateObjectURL:function(o){var e=o&&o.URL;if(typeof o=="object"&&o.HTMLMediaElement&&"srcObject"in o.HTMLMediaElement.prototype&&e.createObjectURL&&e.revokeObjectURL){var c=e.createObjectURL.bind(e),l=e.revokeObjectURL.bind(e),n=new Map,h=0;e.createObjectURL=function(s){if("getTracks"in s){var f="polyblob:"+ ++h;return n.set(f,s),r.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream"),f}return c(s)},e.revokeObjectURL=function(s){l(s),n.delete(s)};var S=Object.getOwnPropertyDescriptor(o.HTMLMediaElement.prototype,"src");Object.defineProperty(o.HTMLMediaElement.prototype,"src",{get:function(){return S.get.apply(this)},set:function(s){return this.srcObject=n.get(s)||null,S.set.apply(this,[s])}});var y=o.HTMLMediaElement.prototype.setAttribute;o.HTMLMediaElement.prototype.setAttribute=function(){return arguments.length===2&&(""+arguments[0]).toLowerCase()==="src"&&(this.srcObject=n.get(arguments[1])||null),y.apply(this,arguments)}}},shimMaxMessageSize:function(o){if(!o.RTCSctpTransport&&o.RTCPeerConnection){var e=r.detectBrowser(o);"sctp"in o.RTCPeerConnection.prototype||Object.defineProperty(o.RTCPeerConnection.prototype,"sctp",{get:function(){return this._sctp===void 0?null:this._sctp}});var c=function(y){var s=d.splitSections(y.sdp);return s.shift(),s.some(function(f){var t=d.parseMLine(f);return t&&t.kind==="application"&&t.protocol.indexOf("SCTP")!==-1})},l=function(y){var s=y.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(s===null||s.length<2)return-1;var f=parseInt(s[1],10);return f!=f?-1:f},n=function(y){var s=65536;return e.browser==="firefox"&&(s=e.version<57?y===-1?16384:2147483637:e.version<60?e.version===57?65535:65536:2147483637),s},h=function(y,s){var f=65536;e.browser==="firefox"&&e.version===57&&(f=65535);var t=d.matchPrefix(y.sdp,"a=max-message-size:");return t.length>0?f=parseInt(t[0].substr(19),10):e.browser==="firefox"&&s!==-1&&(f=2147483637),f},S=o.RTCPeerConnection.prototype.setRemoteDescription;o.RTCPeerConnection.prototype.setRemoteDescription=function(){var y=this;if(y._sctp=null,c(arguments[0])){var s,f=l(arguments[0]),t=n(f),a=h(arguments[0],f);s=t===0&&a===0?Number.POSITIVE_INFINITY:t===0||a===0?Math.max(t,a):Math.min(t,a);var i={};Object.defineProperty(i,"maxMessageSize",{get:function(){return s}}),y._sctp=i}return S.apply(y,arguments)}}},shimSendThrowTypeError:function(o){if(o.RTCPeerConnection&&"createDataChannel"in o.RTCPeerConnection.prototype){var e=o.RTCPeerConnection.prototype.createDataChannel;o.RTCPeerConnection.prototype.createDataChannel=function(){var l=this,n=e.apply(l,arguments);return c(n,l),n},r.wrapPeerConnectionEvent(o,"datachannel",function(l){return c(l.channel,l.target),l})}function c(l,n){var h=l.send;l.send=function(){var S=arguments[0],y=S.length||S.size||S.byteLength;if(l.readyState==="open"&&n.sctp&&y>n.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+n.sctp.maxMessageSize+" bytes)");return h.apply(l,arguments)}}}}},function(G,Q,x){x.r(Q),typeof console<"u"&&console.log!==void 0||(console={log:function(){}});var d=function(){},r=function(){},o=function(){},e=function(){},c=function(){},l=function(){};l=console.error.bind(console);var n={trace:d,debug:r,vdebug:o,log:e,warn:c,error:l},h=x(0),S=x.n(h);function y(u){return(y=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(k){return typeof k}:function(k){return k&&typeof Symbol=="function"&&k.constructor===Symbol&&k!==Symbol.prototype?"symbol":typeof k})(u)}var s=null,f=null,t=null,a=!1,i=null,p=null,b=null,D=function(u){switch(u.response){case"keepalive":n.vdebug("Got a keepalive");break;case"ack":n.debug("Got an ack"),n.debug(u);break;case"success":n.debug("Got a success"),n.debug(u),p(u);break;case"closed":n.debug("Got a closed connection"),n.debug(u),b();break;case"offline":n.debug("Connection is offline, token expired"),n.debug(u),f("offline");break;case"trickle":if(!F()&&!K())return void n.debug("This handle is not attached to this session");var k=u.candidate,C=i.webrtcConfig;n.debug("Got a trickled candidate"),n.debug(k),C.pc&&C.remoteSdp?(n.debug("Adding remote candidate:",k),k&&k.completed!==!0?C.pc.addIceCandidate(new RTCIceCandidate(k)):C.pc.addIceCandidate()):(n.debug("We didn't do setRemoteDescription (trickle got here before the offer?), caching candidate"),C.candidates||(C.candidates=[]),C.candidates.push(k),n.debug(C.candidates));break;case"webrtcup":if(!F())return void n.debug("This handle is not attached");i.webrtcState(!0);break;case"hangup":if(n.debug("Got a hangup event"),n.debug(u),!F())return void n.debug("This handle is not attached");i.webrtcState(!1,u.reason),i.hangup();break;case"media":if(n.debug("Got a media event"),n.debug(u),!F())return void n.debug("This handle is not attached");i.mediaState(u.type,u.receiving);break;case"slowlink":if(n.debug("Got a slowlink event"),n.debug(u),!F())return void n.debug("This handle is not attached");i.slowLink(u.uplink,u.nacks);break;case"error":n.error("AfricasTalking Client Error: "+u.error.code+" "+u.error.reason),n.debug(u);break;case"event":if(n.log("Got an event"),n.log(u),u.eventdata===void 0||u.eventdata===null)return void n.warn("Missing eventdata...");if(n.log(u.eventdata),!F())return void n.warn("This handle is not attachedddd");u.jsep!==void 0&&u.jsep!==null&&(n.log("Handling SDP as well..."),n.log(u.jsep)),i.onmessage!==null&&i.onmessage!==void 0?(n.log("Notifying application..."),i.onmessage(u.eventdata,u.jsep)):n.debug("No provided notification callback");break;default:n.warn("Unknown message/event  "+u),n.debug(u)}},T=function(u){if(!a)return n.warn("Is the gateway down? (connected=false)"),void u.error("Is the gateway down? (connected=false)");if(!F()&&!K())return n.warn("Invalid handle"),void u.error("Invalid handle");var k=u.message,C=u.jsep,w={command:"message",body:k};C!=null&&(w.jsep=C),n.debug("Sending message to web socket"),n.debug(w),n.debug("Sending a request to Africa's Talking"+w),s.send(JSON.stringify(w))},L=function(u){if(!F()&&!K())return n.warn("Invalid handle"),void u.error("Invalid handle");var k=i.webrtcConfig,C=u.text;if(C==null)return n.warn("Invalid text"),void u.error("Invalid text");n.log("Sending string on data channel: "+C),k.dataChannel.send(C),u.success()},V=function(u){var k=u.jsep;u.media=u.media||{audio:!0};var C=u.media;if(!F()&&!K())return n.warn("Invalid handle"),void u.error("Invalid handle");var w=i.webrtcConfig;if(w.pc===void 0||w.pc===null)n.log("Creating a new media session"),C.update=!1;else if(w.pc!==void 0&&w.pc!==null)if(n.log("Updating existing media session"),C.update=!0,u.stream!==null&&u.stream!==void 0)u.stream!==w.myStream&&n.log("Renegotiation involves a new external stream");else{if(C.addAudio){if(C.replaceAudio=!1,C.removeAudio=!1,C.audioSend=!0,w.myStream&&w.myStream.getAudioTracks()&&w.myStream.getAudioTracks().length)return n.error("AfricasTalking Client Error: Can't add audio stream, there already is one"),void u.error("AfricasTalking Client Error: Can't add audio stream, there already is one")}else C.removeAudio?(C.replaceAudio=!1,C.addAudio=!1,C.audioSend=!1):C.replaceAudio&&(C.addAudio=!1,C.removeAudio=!1,C.audioSend=!0);w.myStream===null||w.myStream===void 0?(C.replaceAudio&&(C.replaceAudio=!1,C.addAudio=!0,C.audioSend=!0),ee(C)&&(C.addAudio=!0)):w.myStream.getAudioTracks()!==null&&w.myStream.getAudioTracks()!==void 0&&w.myStream.getAudioTracks().length!==0||(C.replaceAudio&&(C.replaceAudio=!1,C.addAudio=!0,C.audioSend=!0),ee(C)&&(C.addAudio=!0))}if(C.update&&!w.streamExternal&&(C.removeAudio||C.replaceAudio)){if(w.myStream&&w.myStream.getAudioTracks()&&w.myStream.getAudioTracks().length){var _=w.myStream.getAudioTracks()[0];n.log("Removing audio track:",_),w.myStream.removeTrack(_);try{_.stop()}catch(B){n.log("Error removing audio track:",B)}}if(w.pc.getSenders()&&w.pc.getSenders().length&&!C.replaceAudio&&S.a.browserDetails.browser==="firefox")for(var z in w.pc.getSenders()){var $=w.pc.getSenders()[z];$&&$.track&&$.track.kind==="audio"&&(n.log("Removing audio sender:",$),w.pc.removeTrack($))}}if(u.stream!==null&&u.stream!==void 0){var ne=u.stream;if(n.log("MediaStream provided by the application"),n.debug(ne),C.update&&w.myStream&&w.myStream!==u.stream&&!w.streamExternal){try{var q=w.myStream.getTracks();for(var de in q){var ae=q[de];n.log(ae),ae!=null&&ae.stop()}}catch{}w.myStream=null}return w.streamExternal=!0,void X(k,C,u,ne)}if(n.log("Executing isAudioSendEnabled"),ee(C)){i.consentDialog(!0);var ie=ee(C);ie===!0&&C!=null&&C!=null&&y(C.audio)==="object"&&(ie=C.audio),C!=null&&C.video==="screen"||navigator.mediaDevices.enumerateDevices().then(function(B){var me=B.some(function(ye){return ye.kind==="audioinput"}),ue=ee(C),ve=pe(C);if((ue||ve)&&!(ue&&me)&&ve)return i.consentDialog(!1),u.error("Audio capture is required, but no capture device found"),!1;var _e={audio:!!me&&ie,video:!1};n.debug("getUserMedia constraints",_e),navigator.mediaDevices.getUserMedia(_e).then(function(ye){i.consentDialog(!1),X(k,C,u,ye)}).catch(function(ye){i.consentDialog(!1),u.error({code:ye.code,name:ye.name,message:ye.message})})}).catch(function(B){i.consentDialog(!1),u.error("enumerateDevices error",B)})}else X(k,C,u)},A=function(u){var k=u.jsep;if(!F()&&!K())return n.warn("Invalid handle"),void u.error("Invalid handle");var C=i.webrtcConfig;if(k!=null){if(C.pc===null)return n.warn("Wait, no PeerConnection?? if this is an answer, use createAnswer and not handleRemoteJsep"),void u.error("No PeerConnection: if this is an answer, use createAnswer and not handleRemoteJsep");C.pc.setRemoteDescription(new RTCSessionDescription(k),function(){if(n.log("Remote description accepted!"),C.remoteSdp=k.sdp,C.candidates&&C.candidates.length>0){for(var w in C.candidates){var _=C.candidates[w];n.debug("Adding remote candidate:",_),_&&_.completed!==!0?C.pc.addIceCandidate(new RTCIceCandidate(_)):C.pc.addIceCandidate()}C.candidates=[]}},u.error)}else u.error("Invalid JSEP")},j=function(){if(!F()&&!K())return n.warn("Invalid handle"),"Invalid handle";var u=i.webrtcConfig;return u.pc===null||u.pc===void 0?"Invalid PeerConnection":u.pc.getStats?u.bitrate.timer===null||u.bitrate.timer===void 0?(n.log("Starting bitrate timer (via getStats)"),u.bitrate.timer=setInterval(function(){u.pc.getStats().then(function(k){k.forEach(function(C){if(C){var w=!1;if((C.mediaType==="video"||C.id.toLowerCase().indexOf("video")>-1)&&C.type==="inbound-rtp"&&C.id.indexOf("rtcp")<0?w=!0:C.type!="ssrc"||!C.bytesReceived||C.googCodecName!=="VP8"&&C.googCodecName!==""||(w=!0),w)if(u.bitrate.bsnow=C.bytesReceived,u.bitrate.tsnow=C.timestamp,u.bitrate.bsbefore===null||u.bitrate.tsbefore===null)u.bitrate.bsbefore=u.bitrate.bsnow,u.bitrate.tsbefore=u.bitrate.tsnow;else{var _=u.bitrate.tsnow-u.bitrate.tsbefore;S.a.browserDetails.browser=="safari"&&(_/=1e3);var z=Math.round(8*(u.bitrate.bsnow-u.bitrate.bsbefore)/_);u.bitrate.value=z+" kbits/sec",u.bitrate.bsbefore=u.bitrate.bsnow,u.bitrate.tsbefore=u.bitrate.tsnow}}})})},1e3),"0 kbits/sec"):u.bitrate.value:(n.warn("Getting the video bitrate unsupported by browser"),"Feature unsupported by browser")},ce=function(u){if(!F()&&!K())return n.warn("Invalid handle"),void u.error("Invalid handle");var k=i.webrtcConfig;if(k.dtmfSender===null||k.dtmfSender===void 0){if(k.pc!==void 0&&k.pc!==null){var C=k.pc.getSenders().find(function(ne){return ne.track&&ne.track.kind==="audio"});if(!C)return n.warn("Invalid DTMF configuration (no audio track)"),void u.error("Invalid DTMF configuration (no audio track)");k.dtmfSender=C.dtmf,k.dtmfSender&&(n.log("Created DTMF Sender"),k.dtmfSender.ontonechange=function(ne){n.debug("Sent DTMF tone: "+ne.tone)}),n.log({"config.dtmfSender":k.dtmfSender})}if(k.dtmfSender===null||k.dtmfSender===void 0)return n.warn("Invalid DTMF configuration"),void u.error("Invalid DTMF configuration")}var w=u.dtmf;if(w==null)return n.warn("Invalid DTMF parameters"),void u.error("Invalid DTMF parameters");var _=w.tones;if(_==null)return n.warn("Invalid DTMF string"),void u.error("Invalid DTMF string");var z=w.duration;z==null&&(z=500);var $=w.gap;$==null&&($=50),n.debug("Sending DTMF string "+_+" (duration "+z+"ms, gap "+$+"ms)"),k.dtmfSender.insertDTMF(_,z,$)},re=function(u){if(n.log("Cleaning WebRTC stuff"),F()){var k=i.webrtcConfig;if(k!=null){if(u===!0){var C={command:"hangup"};n.debug("Sending hangup request"),n.debug(C),s.send(JSON.stringify(C))}k.remoteStream=null,k.volume.timer&&clearInterval(k.volume.timer),k.volume.value=null,k.bitrate.timer&&clearInterval(k.bitrate.timer),k.bitrate.timer=null,k.bitrate.bsnow=null,k.bitrate.bsbefore=null,k.bitrate.tsnow=null,k.bitrate.tsbefore=null,k.bitrate.value=null;try{if(!k.streamExternal&&k.myStream!==null&&k.myStream!==void 0){n.log("Stopping local stream tracks");var w=k.myStream.getTracks();for(var _ in w){var z=w[_];n.log(z),z!=null&&z.stop()}}}catch{}k.streamExternal=!1,k.myStream=null;try{k.pc.close()}catch{}k.pc=null,k.candidates=null,k.mySdp=null,k.remoteSdp=null,k.iceDone=!1,k.dataChannel=null,k.dtmfSender=null}i.oncleanup()}},X=function(u,k,C,w){if(!F()&&!K())return n.warn("Invalid handle"),void C.error("Invalid handle");var _=i.webrtcConfig;n.log("streamsDone:",w),w&&(n.debug("  -- Audio tracks:",w.getAudioTracks()),n.debug("  -- Video tracks:",w.getVideoTracks()));var z=!1;if(_.myStream&&k.update&&!_.streamExternal){if((!k.update&&ee(k)||k.update&&(k.addAudio||k.replaceAudio))&&w.getAudioTracks()&&w.getAudioTracks().length)if(_.myStream.addTrack(w.getAudioTracks()[0]),k.replaceAudio&&S.a.browserDetails.browser==="firefox")for(var $ in n.log("Adding audio track:",w.getAudioTracks()[0]),_.pc.getSenders()){var ne=_.pc.getSenders()[$];ne&&ne.track&&ne.track.kind==="audio"&&ne.replaceTrack(w.getAudioTracks()[0])}else n.log((k.replaceAudio?"Replacing":"Adding")+" audio track:",w.getAudioTracks()[0]),_.pc.addTrack(w.getAudioTracks()[0],w)}else _.myStream=w,z=!0;if(!_.pc){var q={iceServers:C.iceServers,iceTransportPolicy:void 0,bundlePolicy:"balanced"},de={optional:[{DtlsSrtpKeyAgreement:!0}]};if(C.rtcConstraints&&y(C.rtcConstraints)==="object")for(var ae in n.debug("Adding custom PeerConnection constraints:",C.rtcConstraints),C.rtcConstraints)de.optional.push(C.rtcConstraints[ae]);S.a.browserDetails.browser==="edge"&&(q.bundlePolicy="max-bundle"),n.log("Creating PeerConnection"),n.debug(de),n.log("new RTCPeerConnection"+JSON.stringify({iceServers:q.iceServers,pc_constraints:de})),_.pc=new RTCPeerConnection(q,de),n.log("This is the peer connection created "+JSON.stringify(_.pc)),_.pc.getStats&&(_.volume.value=0,_.bitrate.value="0 kbits/sec"),n.log("Preparing local SDP and gathering candidates (trickle="+_.trickle+")"),_.pc.oniceconnectionstatechange=function(){_.pc&&i.iceState(_.pc.iceConnectionState)},_.pc.onicecandidate=function(ie){if(ie.candidate==null||S.a.browserDetails.browser==="edge"&&ie.candidate.candidate.indexOf("endOfCandidates")>0)n.log("End of candidates."),_.iceDone=!0,_.trickle===!0?R(C,{completed:!0}):function(me){if(F()||K()){var ue=i.webrtcConfig;n.log("Sending offer/answer SDP..."),ue.mySdp!==null&&ue.mySdp!==void 0?(ue.mySdp={type:ue.pc.localDescription.type,sdp:ue.pc.localDescription.sdp},ue.trickle===!1&&(ue.mySdp.trickle=!1),n.debug(me),ue.sdpSent=!0,me.success(ue.mySdp)):n.warn("Local SDP instance is invalid, not sending anything...")}else n.warn("Invalid handle, not sending anything")}(C);else{var B={candidate:ie.candidate.candidate,sdpMid:ie.candidate.sdpMid,sdpMLineIndex:ie.candidate.sdpMLineIndex};_.trickle===!0&&R(C,B)}},_.pc.ontrack=function(ie){n.log("Handling Remote Track"),n.debug(ie),ie.streams&&(_.remoteStream=ie.streams[0],i.onremotestream(_.remoteStream),ie.track&&!ie.track.onended&&(n.log("Adding onended callback to track:",ie.track),ie.track.onended=function(B){n.log("Remote track removed:",B),_.remoteStream&&(_.remoteStream.removeTrack(B.target),i.onremotestream(_.remoteStream))}))}}z&&w!=null&&(n.log("Adding local stream"),w.getTracks().forEach(function(ie){_.pc.addTrack(ie,w)})),_.myStream&&i.onlocalstream(_.myStream),u==null?function(ie,B){if(!F()&&!K())return n.warn("Invalid handle"),void B.error("Invalid handle");var me=i.webrtcConfig,ue=B.simulcast===!0;ue?n.log("Creating offer (iceDone="+me.iceDone+", simulcast="+ue+")"):n.log("Creating offer (iceDone="+me.iceDone+")");var ve={offerToReceiveAudio:O(ie)};B.iceRestart===!0&&(ve.iceRestart=!0),n.log(ve),me.pc.createOffer(function(_e){if(n.debug(_e),n.log("Setting local description"),me.mySdp=_e.sdp,me.pc.setLocalDescription(_e),me.mediaConstraints=ve,me.iceDone||me.trickle){n.log("Offer ready"),n.debug(B);var ye={type:_e.type,sdp:_e.sdp};B.success(ye)}else n.log("Waiting for all candidates...")},B.error,ve)}(k,C):_.pc.setRemoteDescription(new RTCSessionDescription(u),function(){if(n.log("Remote description accepted!"),_.remoteSdp=u.sdp,_.candidates&&_.candidates.length>0){for(var ie in _.candidates){var B=_.candidates[ie];n.debug("Adding remote candidate:",B),B&&B.completed!==!0?_.pc.addIceCandidate(new RTCIceCandidate(B)):_.pc.addIceCandidate()}_.candidates=[]}(function(me,ue){if(!F()&&!K())return n.warn("Invalid handle"),void ue.error("Invalid handle");var ve=i.webrtcConfig,_e=ue.simulcast===!0;_e?n.log("Creating answer (iceDone="+ve.iceDone+", simulcast="+_e+")"):n.log("Creating answer (iceDone="+ve.iceDone+")");var ye=null;ye=S.a.browserDetails.browser=="firefox"||S.a.browserDetails.browser=="edge"?{offerToReceiveAudio:O(me)}:{mandatory:{OfferToReceiveAudio:O(me)}},n.debug(ye),ve.pc.createAnswer(function(Oe){if(n.debug(Oe),n.log("Setting local description"),ve.mySdp=Oe.sdp,ve.pc.setLocalDescription(Oe),ve.mediaConstraints=ye,ve.iceDone||ve.trickle){var Ye={type:Oe.type,sdp:Oe.sdp};ue.success(Ye)}else n.log("Waiting for all candidates...")},ue.error,ye)})(k,C)},C.error)},R=function(u,k){if(a){if(!F()&&!K())return n.warn("Invalid handle"),void u.error("Invalid handle");var C={command:"trickle",candidate:k};n.vdebug("Sending trickle candidate"),n.vdebug(C),s.send(JSON.stringify(C))}else n.warn("Is the gateway down? (connected=false)")},P=function(){if(!F()&&!K())return n.warn("Invalid handle"),!0;var u=i.webrtcConfig;return u.pc===null||u.pc===void 0?(n.warn("Invalid PeerConnection"),!0):u.myStream===void 0||u.myStream===null?(n.warn("Invalid local MediaStream"),!0):u.myStream.getAudioTracks()===null||u.myStream.getAudioTracks()===void 0||u.myStream.getAudioTracks().length===0?(n.warn("No audio track"),!0):!u.myStream.getAudioTracks()[0].enabled},U=function(u){if(!F()&&!K())return n.warn("Invalid handle"),!1;var k=i.webrtcConfig;return k.pc===null||k.pc===void 0?(n.warn("Invalid PeerConnection"),!1):k.myStream===void 0||k.myStream===null?(n.warn("Invalid local MediaStream"),!1):k.myStream.getAudioTracks()===null||k.myStream.getAudioTracks()===void 0||k.myStream.getAudioTracks().length===0?(n.warn("No audio track"),!1):(n.log({"config.myStream.getAudioTracks()[0].enabled":k.myStream.getAudioTracks()[0].enabled}),k.myStream.getAudioTracks()[0].enabled=!u,!0)},H=function(){if(!F()&&!K())return n.warn("Invalid handle"),!1;var u=i.webrtcConfig;return u.pc.getStats&&S.a.browserDetails.browser=="chrome"?u.remoteStream===null||u.remoteStream===void 0?(n.warn("Remote stream unavailable"),0):u.volume.timer===null||u.volume.timer===void 0?(n.log("Starting volume monitor"),u.volume.timer=setInterval(function(){u.pc.getStats(function(k){for(var C=k.result(),w=0;w<C.length;w++){var _=C[w];_.type=="ssrc"&&_.stat("audioOutputLevel")&&(u.volume.value=_.stat("audioOutputLevel"))}})},200),0):u.volume.value:(n.log("Getting the remote volume unsupported by browser"),0)},I=function(){var u=function(){s.removeEventListener("message",k),s.removeEventListener("error",C),t&&clearTimeout(t),s.close()},k=function(){n.log("websocket closed successfully"),u()},C=function(){n.log("closing websocket on error"),u()};f("closed"),s.readyState==1?(s.addEventListener("message",k),s.addEventListener("error",C),s.send(JSON.stringify({command:"destroy"}))):C()},ee=function(u){return n.debug("isAudioSendEnabled:",u),u==null||u.audio!==!1&&(u.audioSend===void 0||u.audioSend===null||u.audioSend===!0)},pe=function(u){return n.debug("isAudioSendRequired:",u),u!=null&&u.audio!==!1&&u.audioSend!==!1&&u.failIfNoAudio!==void 0&&u.failIfNoAudio!==null&&u.failIfNoAudio===!0},O=function(u){return n.debug("isAudioRecvEnabled:",u),u==null||u.audio!==!1&&(u.audioRecv===void 0||u.audioRecv===null||u.audioRecv===!0)},J=function u(){a&&(t=setTimeout(u,3e4),n.log("keepalive"),s.send(JSON.stringify({command:"keepalive"})))},F=function(){var u=!1;return i&&(u=!0),u},K=function(){var u=!1;return i.webrtcConfig&&(u=!0),u};function oe(u,k,C,w,_,z,$){try{var ne=u[z]($),q=ne.value}catch(de){return void C(de)}ne.done?k(q):Promise.resolve(q).then(w,_)}var te=function(){var u,k=(u=regeneratorRuntime.mark(function C(w,_){return regeneratorRuntime.wrap(function(z){for(;;)switch(z.prev=z.next){case 0:return z.abrupt("return",new Promise(function($,ne){te.server=new WebSocket(w.server,["at-protocol",w.capabilityToken]),te.server.onopen=function(){var q,de;n.log("Sending initial request to Africa's Talking APIs "),q=_,de=te.server,s=de,f=q.emitEvent,b=function(){n.error("AfricasTalking Client Error: error occured on session creation"),I()},p=function(){n.log("Creating Session... ");var ae={webrtcConfig:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannel:null,dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},consentDialog:q.consentDialog,iceState:q.iceState,mediaState:q.mediaState,webrtcState:q.webrtcState,slowLink:q.slowLink,onmessage:q.onmessage,onlocalstream:q.onlocalstream,onremotestream:q.onremotestream,ondata:q.ondata,ondataopen:q.ondataopen,oncleanup:q.oncleanup,getVolume:function(){return H()},isAudioMuted:function(){return P()},muteAudio:function(){return U(!0)},unmuteAudio:function(){return U(!1)},getBitrate:function(){return j()},send:function(B){T(B)},data:function(B){L(B)},dtmf:function(B){ce(B)},createOffer:function(B){V(B)},createAnswer:function(B){V(B)},handleRemoteJsep:function(B){A(B)},hangup:function(B){re(B===!0)}};n.log({"my handle is":ae}),t=setTimeout(J,3e4),a=!0,i=ae,q.setHandle(ae);var ie=["iPad","iPhone","iPod"].indexOf(navigator.platform)>=0;window.addEventListener(ie?"pagehide":"unload",function(){s.close()})},$(te.server)},te.server.onmessage=function(q){n.log("Got this message from the websocket: "+q.data),D(JSON.parse(q.data)),$(te.server)},te.server.onclose=function(q){n.log("Lost connection to the gateway (is it down?)"+JSON.stringify(q)),I(),$(te.server)},te.server.onerror=function(q){n.error("AfricasTalking Client Error: Error connecting to the Africastalking WebSockets server... "+JSON.stringify(q)),ne(q)}}));case 1:case"end":return z.stop()}},C)}),function(){var C=this,w=arguments;return new Promise(function(_,z){var $=u.apply(C,w);function ne(de){oe($,_,z,ne,q,"next",de)}function q(de){oe($,_,z,ne,q,"throw",de)}ne(void 0)})});return function(C,w){return k.apply(this,arguments)}}();function Ce(u){if(n.log("Library initialized: "+u),n.log("Using WebSockets to contact Africastalking: "+u.server),u.capabilityToken===null||u.capabilityToken===void 0)return u.error("No capability token specified"),{};n.log({gatewayCallbacks:u});var k={server:u.server,capabilityToken:u.capabilityToken},C={setHandle:u.setHandle,emitEvent:u.emitEvent,destroyed:u.destroyed,error:u.error,oncleanup:u.oncleanup,onlocalstream:u.onlocalstream,onmessage:u.onmessage,onremotestream:u.onremotestream,consentDialog:function(){},mediaState:function(){},webrtcState:function(){},slowLink:function(){},iceState:function(){}};te(k,C).then(function(w){w.send(JSON.stringify({command:"create"}))}).catch(function(w){n.log("websocket Error: "+JSON.stringify(w))})}Ce.noop=function(){},Ce.isWebrtcSupported=function(){return window.RTCPeerConnection!==void 0&&window.RTCPeerConnection!==null&&navigator.getUserMedia!==void 0&&navigator.getUserMedia!==null};var Se=Ce,fe={},he=function(u){navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&(navigator.enumerateDevices=function(ne){navigator.mediaDevices.enumerateDevices().then(ne)});var k=[],C=location.protocol==="https:",w=!1;(typeof MediaStreamTrack<"u"&&"getSources"in MediaStreamTrack||navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices)&&(w=!0);var _,z=!1,$=!1;_=function(){fe={audio:z,audioCap:$},n.log({supportedDevices:fe}),u()},n.log({"finding supported devices":navigator.enumerateDevices,"some if statememt":navigator.mediaDevices,navigator}),w?(!navigator.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(navigator.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!navigator.enumerateDevices&&navigator.enumerateDevices&&(navigator.enumerateDevices=navigator.enumerateDevices.bind(navigator)),navigator.enumerateDevices?(k=[],navigator.enumerateDevices(function(ne){ne.forEach(function(q){var de,ae={};for(var ie in q)ae[ie]=q[ie];ae.kind==="audio"&&(ae.kind="audioinput"),k.forEach(function(B){B.id===ae.id&&B.kind===ae.kind&&(de=!0)}),de||(ae.deviceId||(ae.deviceId=ae.id),ae.id||(ae.id=ae.deviceId),ae.label?ae.kind!=="audioinput"||$||($=!0):(ae.label="Please invoke getUserMedia once.",C||(ae.label="HTTPs is required to get label of this "+ae.kind+" device.")),ae.kind==="audioinput"&&(z=!0),k.push(ae))}),_&&_()})):_&&_()):n.log("cant enumerate devices")};function Le(u,k){for(var C=0;C<k.length;C++){var w=k[C];w.enumerable=w.enumerable||!1,w.configurable=!0,"value"in w&&(w.writable=!0),Object.defineProperty(u,w.key,w)}}function Pe(u,k){if(!(u instanceof k))throw new TypeError("Cannot call a class as a function")}function Ee(u,k){for(var C=0;C<k.length;C++){var w=k[C];w.enumerable=w.enumerable||!1,w.configurable=!0,"value"in w&&(w.writable=!0),Object.defineProperty(u,w.key,w)}}var Y,le,Me,we,be,Re,Te=new(function(){function u(){(function(w,_){if(!(w instanceof _))throw new TypeError("Cannot call a class as a function")})(this,u),this.events={}}var k,C;return k=u,(C=[{key:"subscribe",value:function(w,_){var z=this;return this.events[w]||(this.events[w]=[]),this.events[w].push(_),function(){z.events[w]=z.events[w].filter(function($){return _!==$})}}},{key:"emit",value:function(w,_){var z=this.events[w];z&&z.forEach(function($){$.call(null,_)})}},{key:"unsubscribe",value:function(w){var _=this.events[w];return this.events[w]||(this.events[w]=[]),_&&this.events.splice(_),this}},{key:"unsubscribeAll",value:function(){return this.events={},this}}])&&Le(k.prototype,C),u}()),Ie=!1,qe=function(){function u(w){var _=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Pe(this,u);var z=_.iceServers,$=z===void 0?[]:z,ne=_.sounds,q=ne===void 0?{}:ne;this.token=w,this.initDone=!1,this.iceServers,this.atwebsocketUrl="wss://webrtc.africastalking.com/connect",Array.isArray($)&&$.length>0&&(this.iceServers=Qe($));var de=$e(q);be=new Audio(de.ringing),Re=new Audio(de.dialing),n.log({ringing:be,dialing:Re}),n.log({iceServers:this.iceServers}),Be.bind(this)()}var k,C;return k=u,(C=[{key:"on",value:function(w,_){Te.subscribe(w,_)}},{key:"logout",value:function(){Y&&Y.send({message:{request:"unregister"}})}},{key:"hold",value:function(){Y&&Y.send({message:{request:"hold"}})}},{key:"unhold",value:function(){Y&&Y.send({message:{request:"unhold"}})}},{key:"call",value:function(w){Re.play();var _=this.iceServers;he(function(){Y.createOffer({iceServers:_,media:{audioSend:!0,audioRecv:!0},success:function(z){n.debug("Got SDP!"),n.debug(z),n.log({to:w,jsep:z});var $={request:"call",to:w};Y.send({message:$,jsep:z}),we=w},error:function(z){n.error("AfricasTalking Client Error: ",z)}})})}},{key:"answer",value:function(){var w=this.iceServers;le=null,he(function(){Y.createAnswer({jsep:Me,iceServers:w,media:{audio:!0},success:function(_){n.debug("Got SDP! audio=true, video=true"),n.debug(_),Y.send({message:{request:"accept"},jsep:_})},error:function(_){n.error("AfricasTalking Client Error: ",_),Y.send({message:{request:"decline",code:480}})}})})}},{key:"dtmf",value:function(w){Y.dtmf({dtmf:{tones:w}})}},{key:"muteAudio",value:function(){return Y.muteAudio()}},{key:"unmuteAudio",value:function(){return Y.unmuteAudio()}},{key:"getVolume",value:function(){return Y.getVolume()}},{key:"isAudioMuted",value:function(){return Y.isMuted()}},{key:"hangup",value:function(){le?We():(Y.send({message:{request:"hangup"}}),Y.hangup())}},{key:"getCounterpartNum",value:function(){return we}}])&&Ee(k.prototype,C),u}();function Be(){var u=document.getElementById("remote-stream-audio");Y?Ne():this.initDone!==!0&&(n.log("creating remoteStreamAudio",u,be,Re),u||((u=document.createElement("audio")).id="remote-stream-audio",u.autoplay=!0,document.body.appendChild(u)),be.loop=!0,Re.loop=!0,this.initDone=!0,Se.isWebrtcSupported()?new Se({server:this.atwebsocketUrl,capabilityToken:this.token,setHandle:function(k){Y=k,he(function(){Ne()})},onmessage:function(k,C){n.log(" ::: Got a message :::"),n.log(JSON.stringify(k));var w=k.error;if(w==null||w==null){var _=k.result;if(n.log("This is the result "+_.toString),_!=null&&_.event!==void 0&&_.event!==null){var z=_.event;switch(z){case"registration_failed":return n.log("Registration failed: "+_.code+" "+_.reason),void Ne();case"registered":n.log("Successfully registered as "+_.username+"!"),Ie||(Ie=!0,Te.emit("ready"));break;case"unregistered":n.log("Successfully unregistered as "+_.username+"!"),Ie&&(Ie=!1,Te.emit("notready"));break;case"calling":n.log("Waiting for the peer to answer..."),Te.emit("calling");break;case"incomingcall":we=k.result.username.split("@")[0].split(":")[1],le=!0,be.play(),n.log("Incoming call from "+_.username+"!"),Me=C,Te.emit("incomingcall",{from:we});break;case"progress":n.log("There's early media from "+_.username+", wairing for the call!"),C!=null&&Ge(C);break;case"missed_call":we=k.result.caller.split("@")[0].split(":")[1],n.log("Missed call from "+_.caller+"!"),Te.emit("missedcall",{from:we});break;case"accepted":Re.pause(),be.pause(),n.log(_.username+" accepted the call!"),C!=null&&Ge(C),Te.emit("callaccepted");break;case"hangup":le=null,Re.pause(),be.pause(),n.log("Call hung up ("+_.code+" "+_.reason+")!"),Y.hangup(),Te.emit("hangup",{code:_.code,reason:_.reason});break;case"decline":le=null,Re.pause(),be.pause(),n.log("Call declined!"),Y.hangup(),Te.emit("hangup");break;default:n.log("Received random json request "+z.toString)}}}else Ie?(Re.pause(),be.pause(),Y.hangup()):n.log("User is not registered"+w)},emitEvent:function(k){Te.emit(k)},onlocalstream:function(k){n.log(" ::: Got a local stream :::"),n.log(JSON.stringify(k))},onremotestream:function(k){n.debug(" ::: Got a remote stream :::"),n.debug(JSON.stringify(k));var C=k.getAudioTracks();(function(w,_){S.a.browserDetails.browser==="chrome"?S.a.browserDetails.version>=43?w.srcObject=_:w.src!==void 0?w.src=URL.createObjectURL(_):n.error("AfricasTalking Client Error: Error attaching media stream to element"):w.srcObject=_})(u,new MediaStream(C))},oncleanup:function(){n.log(" ::: Got a cleanup notification :::")},error:function(k){Ie=!1,n.error("Africastalking Client Error: "+k),Te.unsubscribeAll()},destroyed:function(){Ie=!1,Te.unsubscribeAll()}}):n.error("AfricasTalking Client Error: No WebRTC support"))}var Ne=function(){Y?(n.log({"loggin in with handle in client":Y}),Y.send({message:{request:"register"}})):n.error("Africastalking error: Unable to initialize")},We=function(){le=null,Y.send({message:{request:"decline"}})},Ge=function(u){Y.handleRemoteJsep({jsep:u,error:function(){Y.send({message:{request:"hangup"}}),Y.hangup()}})},$e=function(u){return{dialing:u.dialing?u.dialing:"https://res.cloudinary.com/at-voice/video/upload/v1558426588/AT-voice-client-sdk/dialing_g4tn6r.mp3",ringing:u.ringing?u.ringing:"https://res.cloudinary.com/at-voice/video/upload/v1558426103/AT-voice-client-sdk/ringing_au0d1x.mp3"}},Qe=function(u){var k=[];return u.forEach(function(C){if(typeof C.urls=="string"&&C.urls.startsWith("stun:"))k.push({urls:C.urls});else if(typeof C.urls=="string"&&(C.urls.startsWith("turn:")||C.urls.startsWith("turns:")))k.push({urls:C.urls,username:C.username,credential:C.credential});else if(Array.isArray(C.urls)){var w=C.urls.filter(function(_){return typeof _=="string"&&(_.startsWith("turn:")||_.startsWith("turns:"))});w.length===C.urls.length?k.push({urls:w,username:C.username,credential:C.credential}):n.error("AfricasTalking Client Error: Invalid iceServer param ".concat(JSON.stringify(C)))}else n.error("AfricasTalking Client Error: Invalid iceServer param ".concat(JSON.stringify(C)))}),k},Ke=qe;Q.default={Client:Ke}}]).default})})(He);var rt=He.exports;const nt=Ze(rt),je=Ve(()=>{var g;return(g=ze().props.value.user)==null?void 0:g.token}),Ue=Ve(()=>ze().props.value.user.id);Je("orders");Je("");const at={components:{AppLayout:Xe},data:()=>({agent:null,currentUserId:Ue,search:"",stats:[],loading:!1,isMuted:!1,isOnHold:!1,itemsPerPage:5,tab:"calls",isCalling:!1,connection_active:!1,queueDialog:!1,transferDialog:!1,callAgentDialog:!1,queuedCalls:[],selectedAgent:null,availableAgents:[].filter(g=>status.available),callHistories:[],queuedCalls:[{call_id:1,phone_number:"+254711123456",status:"queued"},{call_id:2,phone_number:"+254712345678",status:"queued"},{call_id:3,phone_number:"+254713456789",status:"queued"},{call_id:4,phone_number:"+254714567890",status:"queued"}],queuedCallsheaders:[{title:"Call ID",value:"call_id"},{title:"Phone Number",value:"phone_number"},{title:"Status",value:"status"},{title:"Actions",value:"actions",sortable:!1}],headers:[{title:"Order NO",align:"start",key:"order_no"},{title:"Status",key:"status",align:"start"},{title:"COD",key:"COD",align:"end"},{title:"Client",key:"client",align:"start"},{title:"Phone",key:"phone",align:"start"},{text:"Actions",value:"actions",sortable:!1}],callsheaders:[{title:"Date",value:"created_at"},{title:"Caller No.",value:"callerNumber"},{title:"Destination Number",value:"destinationNumber"},{title:"clientDialed Number",value:"clientDialedNumber"},{title:"Duration In Seconds",value:"durationInSeconds"},{title:"Service Type",value:"description"},{title:"Caller Carrier",value:"callerCarrierName"},{title:"Call Status",value:"status"},{title:"HangupCause",value:"lastBridgeHangupCause"},{title:"Call Session State",value:"callSessionState"},{title:"Actions",value:"actions",sortable:!1}],serverItems:[],totalItems:2,statuses:["Pending","Shipped","Delivered","Cancelled"],statusModal:!1,phonePopup:!1,newCall:!1,incomingCallDialog:!1,incomingCall:{},callId:null,afClient:null,session:null,selectedItem:{phone:"",phone_number:""},eventLog:[]}),created(){this.fetchOrders(),this.fetchAgentstats(),this.fetchUsers()},methods:{playRecording(g){g.recordingUrl?window.open(g.recordingUrl,"_blank"):this.$toast.error("Recording not available")},getStatusColor(g){switch(g){case"ready":return"green";case"notready":return"orange";case"offline":case"closed":return"red";default:return"grey"}},getStatusText(g){switch(g){case"ready":return"Online";case"notready":return"Not Ready";case"offline":case"closed":return"Offline";default:return"Unknown"}},updateAgentStatus(g){const E=this.currentUserId;axios.post("/api/v1/user/status",{user_id:E,status:g}).then(G=>{const Q=G.data.user;this.agent=Q,console.log("Agent status updated:",Q.status)}).catch(G=>{console.error("Error updating agent status:",G)})},sendWhatsApp(g){const E=encodeURIComponent("Hello! Id like to follow up.");window.open(`https://wa.me/${g}?text=${E}`,"_blank")},sendTelegram(g){window.open(`https://t.me/${g}`,"_blank")},waitForToken(){return new Promise(g=>{const E=setInterval(()=>{this.userToken&&(clearInterval(E),g())},500)})},async initializeAfricastalking(){const g={sounds:{dialing:"https://support.solssa.com/storage/ringtones/office_phone.mp3",ringing:"https://support.solssa.com/storage/ringtones/office_phone.mp3"}};try{const E=new nt.Client(je.value,g);console.log("Africastalking client initialized."),console.log("AF object",E),this.afClient=E,E.on("ready",()=>{this.connection_active=!0,console.log("Africastalking WebRTC client is ready."),this.$toastr.success("WebRTC client is ready."),this.updateAgentStatus("ready")}),E.on("error",G=>{console.error("Africastalking Client Error:",G),this.$toastr.error("Client Error: "+G.message)}),E.on("closed",G=>{console.warn("Africastalking Client Connection Closed:",G),this.$toastr.warning("Connection closed."),this.updateAgentStatus("closed")}),E.on("incomingcall",G=>{console.log("Incoming call received."),console.log(`Incoming call from ${G.from}`),console.log("Event Data:",G),this.incomingCallDialog=!0,this.incomingCall={from:G.from,duration:"Connecting..."}}),E.on("hangup",G=>{console.log("Incoming call hung up:",G.reason),this.$toastr.error("Incoming call hung up: ",G.reason),this.incomingCallDialog=!1}),this.$webrtcClient=E}catch(E){console.error("Error initializing Africastalking WebRTC client:",E),this.$toastr.error("Failed to initialize WebRTC client: "+E.message)}},transferCall(){this.openTransferDialog()},async callClient(g){try{console.log(`Calling ${g} from System...`),this.afClient.call(g),console.log("Call initiated successfully."),this.$toastr.success("Call started."),this.isCalling=!0,this.afClient.on("afClienting",()=>{this.logEvent("afClient is in progress (calling)...")}),this.afClient.on("callaccepted",()=>{console.log("callaccepted"),this.$toastr.success("Call accepted!"),this.logEvent("Call accepted (bridged between caller and callee).")}),this.afClient.on("hangup",E=>{this.logEvent(`Call hung up (${E.code} - ${E.reason}).`),this.$toastr.error(`Call ended: ${E.reason}`),this.isCalling=!1,this.activeCall=null}),this.afClient.on("mute",()=>{this.logEvent("Call muted."),this.$toastr.info("Call muted.")}),this.afClient.on("unmute",()=>{this.logEvent("Call unmuted."),this.$toastr.info("Call unmuted.")}),this.afClient.on("hold",()=>{this.logEvent("Call on hold."),this.$toastr.info("Call on hold.")}),this.afClient.on("unhold",()=>{this.logEvent("Call resumed from hold."),this.$toastr.info("Call resumed from hold.")})}catch(E){console.error("Call initiation error:",E),this.$toastr.error("Call failed: "+E.message)}},answerCall(){this.incomingCall&&this.afClient.answer()},handleCall(g){if(this.isCalling=!0,this.selectedAgent=g,console.log("Selected agent:",g),this.phone_number=g.phone_number,console.log("Agent phone number:",this.phone_number),!this.afClient){console.error("Africastalking client is not initialized."),this.$toastr.error("Africastalking client is not initialized.");return}try{console.log("Attempting to call agent..."),this.afClient.call(this.phone_number),console.log("Call initiated successfully."),this.$toastr.success("Call initiated successfully.")}catch(E){console.error("Error while calling agent:",E),this.$toastr.error("Failed to call agent: "+E.message)}},hangupCall(){this.incomingCall&&(this.afClient.hangup(),console.log("call rejected"),this.$toastr.error("Call rejected."),this.incomingCallDialog=!1,this.isCalling=!1)},handleMute(){this.isCalling&&(this.isMuted=!this.isMuted,this.isMuted?this.afClient.muteAudio():this.afClient.unmuteAudio(),console.log("Client mute property:",this.afClient.isAudioMuted),console.log("Our internal state:",this.isMuted))},handleHoldToggle(){this.isCalling&&(this.afClient.hold(),this.isOnHold=!this.isOnHold,this.logEvent(this.isOnHold?"Call on hold.":"Call resumed from hold."))},logEvent(g){const E=new Date().toLocaleTimeString();this.eventLog.unshift(`${E}: ${g}`)},closeDialog(){this.callAgentDialog=!1},openCallAgent(){this.callAgentDialog=!0},openTransferDialog(){this.transferDialog=!0},openQueueDialog(){this.fetchQueuedCalls(),this.queueDialog=!0},fetchQueuedCalls(){axios.get("/api/v1/queued-calls").then(g=>{this.queuedCalls=g.data}).catch(g=>{console.error("Error fetching queued calls:",g)})},handleTransfer(){this.callId?axios.post("/api/v1/call-centre-transfer-call",{callId:this.callId,destination:"254700000000"}).then(E=>{console.log("Call transferred",E.data)}).catch(E=>{console.error("Error transferring the call",E)}):console.log("Call ID not available")},openStatusModal(g){this.selectedItem=g,this.statusModal=!0},updateStatus(g,E){g.status=E,this.statusModal=!1},openPhonePopup(g){this.selectedItem=g,this.phonePopup=!0},async loadItems(g){this.loading=!0;try{const{page:E,itemsPerPage:G,sortBy:Q}=g,x={page:E,per_page:G,search:this.search};Q.length>0&&(x.sort_by=Q[0].key,x.sort_desc=Q[0].order==="desc");const d=await axios.get("/api/v1/call-history",{params:x});this.callHistories=d.data.data,this.totalItems=d.data.total}catch(E){console.error("Failed to load call history:",E)}finally{this.loading=!1}},async fetchOrders(){axios.get("/api/v1/orders").then(g=>{this.orders=g.data.orders}).catch(g=>{console.error("Error fetching orders:",g)})},fetchAgentstats(){axios.get(`/api/v1/agent-stats/${Ue.value}`).then(g=>{this.stats=g.data,console.log("Agent stats:",this.stats)}).catch(g=>{console.error("Error fetching agent stats:",g)})},fetchUsers(){axios.get("/v1/users").then(g=>{this.agents=g.data,console.log("Agents:",this.agents)}).catch(g=>{console.error("Error fetching users:",g)})}},watch:{availableAgents(g){this.availableAgents=g.filter(E=>!E.isInCall)}},computed:{userInitials(){var x,d;const g=this.$page.props.auth.user.name;if(!g)return"";const E=g.trim().split(" "),G=((x=E[0])==null?void 0:x.charAt(0))||"",Q=((d=E[1])==null?void 0:d.charAt(0))||"";return(G+Q).toUpperCase()}},async mounted(){console.log("User Id:",Ue.value),console.log("User Token:",je.value),je.value||(console.warn("userToken is missing. Waiting for it..."),await this.waitForToken()),je.value?await this.initializeAfricastalking():console.error("Failed to retrieve userToken after waiting.")}},it={class:"p-4"},ot={class:"d-flex align-center"},st={class:"white--text text-h5"},ct={class:"flex-grow-1"},lt={class:"d-flex align-center"},dt={class:"text-h6 mb-0"},ut={class:"text-body-2 mb-0 grey--text"},pt={class:"d-flex align-center"},ft={class:"ml-2"},mt=N("div",{class:"text-caption grey--text"},"Connected",-1),vt={class:"text-h6"},gt={class:"d-flex align-center"},ht={class:"ml-2"},yt=N("div",{class:"text-caption grey--text"},"Outbound",-1),Ct={class:"text-h6"},St={class:"d-flex align-center"},bt={class:"ml-2"},Tt=N("div",{class:"text-caption grey--text"},"Incoming",-1),kt={class:"text-h6"},wt={class:"d-flex align-center"},_t={class:"ml-2"},Rt=N("div",{class:"text-caption grey--text"},"Rejected",-1),Pt={class:"text-h6"},Et={key:0},Dt=N("td",null,"Incoming Rejected",-1),It={class:"text-right"},Mt=N("td",null,"Outgoing Rejected",-1),Ot={class:"text-right"},xt=N("td",null,"Outgoing User Busy",-1),At={class:"text-right"},Lt=["onClick"],jt=["onClick"],Nt={class:"d-flex flex-wrap gap-2"},Ut=N("p",null,"Select an agent to call:",-1),Gt={class:"d-flex align-center mb-2"},Ft=N("strong",null,"Name:",-1),Vt={class:"d-flex align-center mb-2"},Jt=N("strong",null,"Email:",-1),zt={class:"d-flex align-center mb-2"},Ht=N("strong",null,"Phone:",-1),qt={class:"d-flex align-center mb-2"},Bt=N("strong",null,"Alternative Phone:",-1),Wt={class:"d-flex align-center"},$t=N("strong",null,"Address:",-1);function Qt(g,E,G,Q,x,d){const r=Z("v-icon"),o=Z("v-card-title"),e=Z("v-list-item-icon"),c=Z("v-list-item-title"),l=Z("v-list-item-content"),n=Z("v-list-item-action"),h=Z("v-list-item"),S=Z("v-badge"),y=Z("v-list"),s=Z("v-card-text"),f=Z("v-card"),t=Z("v-col"),a=Z("v-avatar"),i=Z("v-spacer"),p=Z("v-chip"),b=Z("v-divider"),D=Z("v-row"),T=Z("v-btn"),L=Z("v-simple-table"),V=Z("v-expand-transition"),A=Z("v-text-field"),j=Z("v-tab"),ce=Z("v-tabs"),re=Z("v-data-table-server"),X=Z("v-window-item"),R=Z("v-tooltip"),P=Z("v-data-table"),U=Z("v-window"),H=Z("v-card-actions"),I=Z("v-dialog"),ee=Z("v-container"),pe=Z("AppLayout");return se(),ge(pe,null,{default:m(()=>[N("div",it,[v(ee,{fluid:"",class:"pa-2"},{default:m(()=>[v(D,null,{default:m(()=>[v(t,{cols:"12",md:"6"},{default:m(()=>[v(f,{elevation:"2",class:"rounded-lg"},{default:m(()=>[v(o,{class:"primary white--text d-flex align-center py-3"},{default:m(()=>[v(r,{left:"",color:"white"},{default:m(()=>[M("mdi-lightning-bolt")]),_:1}),M(" Quick Actions ")]),_:1}),v(s,{class:"py-4"},{default:m(()=>[v(y,{nav:"",dense:""},{default:m(()=>[v(h,{onClick:E[0]||(E[0]=O=>g.newCall=!0),class:"rounded-lg mb-2 hover-elevation-2"},{default:m(()=>[v(e,null,{default:m(()=>[v(r,{color:"success"},{default:m(()=>[M("mdi-phone-plus")]),_:1})]),_:1}),v(l,null,{default:m(()=>[v(c,null,{default:m(()=>[M("Make a new Call")]),_:1})]),_:1}),v(n,null,{default:m(()=>[v(r,null,{default:m(()=>[M("mdi-chevron-right")]),_:1})]),_:1})]),_:1}),v(h,{onClick:d.openCallAgent,class:"rounded-lg mb-2 hover-elevation-2"},{default:m(()=>[v(e,null,{default:m(()=>[v(r,{color:"info"},{default:m(()=>[M("mdi-account-voice")]),_:1})]),_:1}),v(l,null,{default:m(()=>[v(c,null,{default:m(()=>[M("Call an agent")]),_:1})]),_:1}),v(n,null,{default:m(()=>[v(r,null,{default:m(()=>[M("mdi-chevron-right")]),_:1})]),_:1})]),_:1},8,["onClick"]),v(h,{class:"rounded-lg mb-2 hover-elevation-2"},{default:m(()=>[v(e,null,{default:m(()=>[v(r,{color:"error"},{default:m(()=>[M("mdi-phone-missed")]),_:1})]),_:1}),v(l,null,{default:m(()=>[v(c,null,{default:m(()=>[M("Missed Calls")]),_:1})]),_:1}),v(n,null,{default:m(()=>[v(S,{content:g.summary_call_missed,value:g.summary_call_missed>0,color:"error",overlap:""},{default:m(()=>[v(r,null,{default:m(()=>[M("mdi-chevron-right")]),_:1})]),_:1},8,["content","value"])]),_:1})]),_:1}),v(h,{onClick:d.openQueueDialog,class:"rounded-lg hover-elevation-2"},{default:m(()=>[v(e,null,{default:m(()=>[v(r,{color:"warning"},{default:m(()=>[M("mdi-account-multiple-check")]),_:1})]),_:1}),v(l,null,{default:m(()=>[v(c,null,{default:m(()=>[M("Check Queue")]),_:1})]),_:1}),v(n,null,{default:m(()=>[v(r,null,{default:m(()=>[M("mdi-chevron-right")]),_:1})]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1}),v(t,{cols:"12",md:"6"},{default:m(()=>[v(f,{elevation:"2",class:"rounded-lg"},{default:m(()=>[v(o,{class:"primary white--text d-flex align-center py-3"},{default:m(()=>[v(r,{left:"",color:"white"},{default:m(()=>[M("mdi-account-details")]),_:1}),M(" Agent Dashboard ")]),_:1}),v(s,{class:"py-4"},{default:m(()=>[N("div",ot,[v(a,{size:"60",color:"primary",class:"mr-4"},{default:m(()=>[N("span",st,W(d.userInitials),1)]),_:1}),N("div",ct,[N("div",lt,[N("div",null,[N("p",dt,W(g.$page.props.auth.user.name),1),N("p",ut,[v(r,{small:"",class:"mr-1"},{default:m(()=>[M("mdi-email")]),_:1}),M(" "+W(g.$page.props.auth.user.email),1)])]),v(i),g.agent?(se(),ge(p,{key:0,color:d.getStatusColor(g.agent.status),small:"",class:"white--text px-2"},{default:m(()=>[v(r,{left:"",small:""},{default:m(()=>[M("mdi-circle")]),_:1}),M(" "+W(d.getStatusText(g.agent.status)),1)]),_:1},8,["color"])):ke("",!0)])])]),v(b,{class:"my-4"}),v(D,{class:"mt-2"},{default:m(()=>[v(t,{cols:"12",sm:"6"},{default:m(()=>[v(f,{class:"rounded-lg pa-3 mb-3",outlined:""},{default:m(()=>[N("div",pt,[v(r,{color:"success",left:""},{default:m(()=>[M("mdi-phone-check")]),_:1}),N("div",ft,[mt,N("div",vt,W(g.summary_call_completed),1)])])]),_:1})]),_:1}),v(t,{cols:"12",sm:"6"},{default:m(()=>[v(f,{class:"rounded-lg pa-3 mb-3",outlined:""},{default:m(()=>[N("div",gt,[v(r,{color:"primary",left:""},{default:m(()=>[M("mdi-phone-outgoing")]),_:1}),N("div",ht,[yt,N("div",Ct,W(g.summary_outbound_call_completed),1)])])]),_:1})]),_:1}),v(t,{cols:"12",sm:"6"},{default:m(()=>[v(f,{class:"rounded-lg pa-3 mb-3",outlined:""},{default:m(()=>[N("div",St,[v(r,{color:"info",left:""},{default:m(()=>[M("mdi-phone-incoming")]),_:1}),N("div",bt,[Tt,N("div",kt,W(g.summary_inbound_call_completed),1)])])]),_:1})]),_:1}),v(t,{cols:"12",sm:"6"},{default:m(()=>[v(f,{class:"rounded-lg pa-3",outlined:""},{default:m(()=>[N("div",wt,[v(r,{color:"error",left:""},{default:m(()=>[M("mdi-phone-cancel")]),_:1}),N("div",_t,[Rt,N("div",Pt,W(g.rejectedIncomingCalls+g.rejectedOutingCalls),1)])])]),_:1})]),_:1})]),_:1}),v(T,{color:"primary",text:"",class:"mt-2",onClick:E[1]||(E[1]=O=>g.showCallDetails=!g.showCallDetails)},{default:m(()=>[M(W(g.showCallDetails?"Hide":"Show")+" detailed stats ",1),v(r,{right:""},{default:m(()=>[M(W(g.showCallDetails?"mdi-chevron-up":"mdi-chevron-down"),1)]),_:1})]),_:1}),v(V,null,{default:m(()=>[g.showCallDetails?(se(),De("div",Et,[v(b,{class:"my-3"}),v(L,{dense:""},{default:m(()=>[N("tbody",null,[N("tr",null,[Dt,N("td",It,W(g.rejectedIncomingCalls),1)]),N("tr",null,[Mt,N("td",Ot,W(g.rejectedOutingCalls),1)]),N("tr",null,[xt,N("td",At,W(g.userBusyOutgoingCalls),1)])])]),_:1})])):ke("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),v(f,null,{default:m(()=>[v(A,{modelValue:g.search,"onUpdate:modelValue":E[2]||(E[2]=O=>g.search=O),label:"Search","prepend-inner-icon":"mdi-magnify",outlined:"",dense:"",clearable:""},null,8,["modelValue"]),v(ce,{modelValue:g.tab,"onUpdate:modelValue":E[3]||(E[3]=O=>g.tab=O),color:"primary"},{default:m(()=>[v(j,{value:"calls"},{default:m(()=>[M("Calls")]),_:1}),v(j,{value:"orders"},{default:m(()=>[M("Orders")]),_:1})]),_:1},8,["modelValue"]),v(U,{modelValue:g.tab,"onUpdate:modelValue":E[5]||(E[5]=O=>g.tab=O)},{default:m(()=>[v(X,{value:"calls"},{default:m(()=>[v(re,{headers:g.callsheaders,items:g.callHistories,"item-value":"id","items-length":g.totalItems,loading:g.loading,search:g.search,"onUpdate:options":d.loadItems,class:"elevation-1 mt-4","items-per-page":"15"},{"item.actions":m(({item:O})=>[v(T,{color:"blue",onClick:J=>d.playRecording(O),rounded:"lg",block:""},{default:m(()=>[v(r,null,{default:m(()=>[M("mdi-play")]),_:1}),M(" Play ")]),_:2},1032,["onClick"])]),_:1},8,["headers","items","items-length","loading","search","onUpdate:options"])]),_:1}),v(X,{value:"orders"},{default:m(()=>[v(P,{headers:g.headers,items:g.orders,"show-select":"",modelValue:g.selected,"onUpdate:modelValue":E[4]||(E[4]=O=>g.selected=O),class:"elevation-1 mt-4"},{body:m(({items:O})=>[(se(!0),De(Ae,null,xe(O,J=>{var F,K;return se(),De("tr",{key:J.id},[N("td",null,[N("ul",null,[(se(!0),De(Ae,null,xe(J.orderItems,oe=>(se(),De("li",{key:oe.id},W(oe.name)+" (x"+W(oe.quantity)+") ",1))),128))])]),N("td",null,W(J.order_no),1),N("td",null,[N("span",{class:"clickable",onClick:oe=>d.openStatusModal(J)},W(J.status),9,Lt)]),N("td",null,W(J.total_price),1),N("td",null,W((F=J.client)==null?void 0:F.name),1),N("td",null,[N("span",{class:"clickable",onClick:oe=>d.openPhonePopup(J)},W((K=J.client)==null?void 0:K.phone_number),9,jt)]),N("td",null,[N("div",Nt,[v(R,{text:"View Details"},{activator:m(({props:oe})=>[v(T,et({icon:""},oe,{onClick:te=>g.viewDetails(J)}),{default:m(()=>[v(r,null,{default:m(()=>[M("mdi-eye")]),_:1})]),_:2},1040,["onClick"])]),_:2},1024)])])])}),128))]),_:1},8,["headers","items","modelValue"])]),_:1})]),_:1},8,["modelValue"])]),_:1}),v(I,{modelValue:g.callAgentDialog,"onUpdate:modelValue":E[6]||(E[6]=O=>g.callAgentDialog=O),"max-width":"600"},{default:m(()=>[v(f,null,{default:m(()=>[v(o,{class:"headline"},{default:m(()=>[M("Call an Agent")]),_:1}),v(s,null,{default:m(()=>[Ut,v(y,null,{default:m(()=>[(se(!0),De(Ae,null,xe(g.agents,O=>(se(),ge(h,{key:O.name,onClick:J=>d.handleCall(O),class:"agent-item"},{default:m(()=>[N("div",null,[N("strong",null,W(O.name),1),N("span",{class:Fe({"text-success":O.status==="available","text-warning":O.status==="engaged","text-grey":O.status==="offline"})}," - "+W(O.status),3)])]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),v(H,null,{default:m(()=>[v(T,{color:"blue darken-1",text:"",onClick:d.closeDialog},{default:m(()=>[M("Cancel")]),_:1},8,["onClick"]),g.isCalling?(se(),ge(T,{key:0,color:"red",onClick:d.hangupCall},{default:m(()=>[v(r,{left:""},{default:m(()=>[M("mdi-phone-off")]),_:1}),M(" Hangup ")]),_:1},8,["onClick"])):ke("",!0),g.isCalling?(se(),ge(T,{key:1,color:"grey",onClick:g.handleHold},{default:m(()=>[v(r,{left:""},{default:m(()=>[M("mdi-pause")]),_:1}),M(" Hold ")]),_:1},8,["onClick"])):ke("",!0),g.isCalling?(se(),ge(T,{key:2,color:"blue",onClick:d.openTransferDialog},{default:m(()=>[v(r,{left:""},{default:m(()=>[M("mdi-phone-transfer")]),_:1}),M(" Transfer ")]),_:1},8,["onClick"])):ke("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),v(I,{modelValue:g.statusModal,"onUpdate:modelValue":E[8]||(E[8]=O=>g.statusModal=O),"max-width":"400"},{default:m(()=>[v(f,null,{default:m(()=>[v(o,null,{default:m(()=>[M("Select Status")]),_:1}),v(s,null,{default:m(()=>[v(y,null,{default:m(()=>[(se(!0),De(Ae,null,xe(g.statuses,O=>(se(),ge(h,{key:O,onClick:J=>d.updateStatus(g.selectedItem,O)},{default:m(()=>[M(W(O),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),v(H,null,{default:m(()=>[v(T,{color:"primary",text:"",onClick:E[7]||(E[7]=O=>g.statusModal=!1)},{default:m(()=>[M("Close")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),v(I,{modelValue:g.queueDialog,"onUpdate:modelValue":E[10]||(E[10]=O=>g.queueDialog=O),"max-width":"600"},{default:m(()=>[v(f,null,{default:m(()=>[v(o,null,{default:m(()=>[M(" Queued Calls "),v(i),v(T,{icon:"",onClick:E[9]||(E[9]=O=>g.queueDialog=!1)},{default:m(()=>[v(r,null,{default:m(()=>[M("mdi-close")]),_:1})]),_:1})]),_:1}),v(s,null,{default:m(()=>[v(P,{headers:g.queuedCallsheaders,items:g.queuedCalls,"item-value":"id",class:"elevation-1"},{"item.actions":m(({item:O})=>[v(T,{color:"green",onClick:J=>g.dequeueCall(O.id)},{default:m(()=>[M(" Dequeue ")]),_:2},1032,["onClick"])]),_:1},8,["headers","items"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),v(I,{modelValue:g.newCall,"onUpdate:modelValue":E[14]||(E[14]=O=>g.newCall=O),"max-width":"800"},{default:m(()=>[v(f,null,{default:m(()=>[v(o,null,{default:m(()=>[M(" Client Details "),v(i),v(T,{icon:"",onClick:E[11]||(E[11]=O=>g.newCall=!1)},{default:m(()=>[v(r,null,{default:m(()=>[M("mdi-close")]),_:1})]),_:1})]),_:1}),v(s,null,{default:m(()=>[v(A,{modelValue:g.phone,"onUpdate:modelValue":E[12]||(E[12]=O=>g.phone=O),label:"Phone Number",type:"text",required:""},null,8,["modelValue"])]),_:1}),v(H,null,{default:m(()=>[N("div",null,[g.isCalling?ke("",!0):(se(),ge(T,{key:0,color:"success",onClick:E[13]||(E[13]=O=>d.callClient(g.phone))},{default:m(()=>[v(r,{left:""},{default:m(()=>[M("mdi-phone")]),_:1}),M(" Call Client ")]),_:1})),g.isCalling?(se(),ge(T,{key:1,color:"red",onClick:d.hangupCall},{default:m(()=>[v(r,{left:""},{default:m(()=>[M("mdi-phone-off")]),_:1}),M(" Hangup ")]),_:1},8,["onClick"])):ke("",!0),g.isCalling?(se(),ge(T,{key:2,color:"warning",onClick:d.handleMute},{default:m(()=>[v(r,{left:""},{default:m(()=>[M(W(g.isMuted?"mdi-microphone-off":"mdi-microphone"),1)]),_:1}),M(" "+W(g.isMuted?"Unmute":"Mute"),1)]),_:1},8,["onClick"])):ke("",!0),g.isCalling?(se(),ge(T,{key:3,color:"primary",onClick:d.handleHoldToggle},{default:m(()=>[v(r,{left:""},{default:m(()=>[M(W(g.isOnHold?"mdi-phone-transfer":"mdi-pause"),1)]),_:1}),M(" "+W(g.isOnHold?"Unhold":"Hold"),1)]),_:1},8,["onClick"])):ke("",!0),g.isCalling?(se(),ge(T,{key:4,color:"blue",onClick:d.openTransferDialog},{default:m(()=>[v(r,{left:""},{default:m(()=>[M("mdi-phone-transfer")]),_:1}),M(" Transfer ")]),_:1},8,["onClick"])):ke("",!0)])]),_:1})]),_:1})]),_:1},8,["modelValue"]),v(I,{modelValue:g.incomingCallDialog,"onUpdate:modelValue":E[16]||(E[16]=O=>g.incomingCallDialog=O),"max-width":"600"},{default:m(()=>[v(f,null,{default:m(()=>[v(o,null,{default:m(()=>[M(" Incoming Call "),v(i),v(T,{icon:"",onClick:E[15]||(E[15]=O=>g.incomingCallDialog=!1)},{default:m(()=>[v(r,null,{default:m(()=>[M("mdi-close")]),_:1})]),_:1})]),_:1}),v(s,null,{default:m(()=>[N("p",null,"Call from: "+W(g.incomingCall.from),1),N("p",null,"Duration: "+W(g.incomingCall.duration),1)]),_:1}),v(H,null,{default:m(()=>[v(T,{color:"success",onClick:d.answerCall},{default:m(()=>[M(" Answer ")]),_:1},8,["onClick"]),v(T,{color:"red",onClick:d.hangupCall},{default:m(()=>[M(" Reject ")]),_:1},8,["onClick"]),v(T,{color:"primary",onClick:d.transferCall},{default:m(()=>[M(" Transfer ")]),_:1},8,["onClick"]),g.isCalling?(se(),ge(T,{key:0,color:"warning",onClick:d.handleMute},{default:m(()=>[v(r,{left:""},{default:m(()=>[M(W(g.isMuted?"mdi-microphone-off":"mdi-microphone"),1)]),_:1}),M(" "+W(g.isMuted?"Unmute":"Mute"),1)]),_:1},8,["onClick"])):ke("",!0),g.isCalling?(se(),ge(T,{key:1,color:"primary",onClick:d.handleHoldToggle},{default:m(()=>[v(r,{left:""},{default:m(()=>[M(W(g.isOnHold?"mdi-phone-transfer":"mdi-pause"),1)]),_:1}),M(" "+W(g.isOnHold?"Unhold":"Hold"),1)]),_:1},8,["onClick"])):ke("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),v(I,{modelValue:g.transferDialog,"onUpdate:modelValue":E[18]||(E[18]=O=>g.transferDialog=O),"max-width":"600"},{default:m(()=>[v(f,null,{default:m(()=>[v(o,null,{default:m(()=>[M(" Transfer Call "),v(i),v(T,{icon:"",onClick:E[17]||(E[17]=O=>g.transferDialog=!1)},{default:m(()=>[v(r,null,{default:m(()=>[M("mdi-close")]),_:1})]),_:1})]),_:1}),v(s,null,{default:m(()=>[v(y,null,{default:m(()=>[(se(!0),De(Ae,null,xe(g.availableAgents,O=>(se(),ge(h,{onClick:J=>d.handleTransfer(O),key:O.name,class:"agent-item"},{default:m(()=>[N("div",null,[N("strong",null,W(g.agent.name),1),N("span",{class:Fe({"text-success":g.agent.status==="available","text-warning":g.agent.status==="engaged","text-grey":g.agent.status==="offline"})}," - "+W(g.agent.status),3)])]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),v(H)]),_:1})]),_:1},8,["modelValue"]),v(I,{modelValue:g.phonePopup,"onUpdate:modelValue":E[25]||(E[25]=O=>g.phonePopup=O),width:"800"},{default:m(()=>[v(f,null,{default:m(()=>[v(D,null,{default:m(()=>[v(t,{cols:"12",md:"6"},{default:m(()=>[v(f,null,{default:m(()=>[v(o,null,{default:m(()=>[M(" Client Details "),v(i),v(T,{icon:"",onClick:E[19]||(E[19]=O=>g.phonePopup=!1)},{default:m(()=>[v(r,null,{default:m(()=>[M("mdi-close")]),_:1})]),_:1})]),_:1}),v(s,null,{default:m(()=>{var O,J,F,K,oe;return[N("div",Gt,[v(r,{color:"primary",class:"mr-2"},{default:m(()=>[M("mdi-account")]),_:1}),Ft,M(" "+W((O=g.selectedItem)==null?void 0:O.client.name),1)]),N("div",Vt,[v(r,{color:"primary",class:"mr-2"},{default:m(()=>[M("mdi-email")]),_:1}),Jt,M(" "+W((J=g.selectedItem)==null?void 0:J.client.email),1)]),N("div",zt,[v(r,{color:"primary",class:"mr-2"},{default:m(()=>[M("mdi-phone")]),_:1}),Ht,M(" "+W((F=g.selectedItem)==null?void 0:F.client.phone_number),1)]),N("div",qt,[v(r,{color:"primary",class:"mr-2"},{default:m(()=>[M("mdi-phone-classic")]),_:1}),Bt,M(" "+W(((K=g.selectedItem)==null?void 0:K.client.alt_phone_number)||"N/A"),1)]),N("div",Wt,[v(r,{color:"primary",class:"mr-2"},{default:m(()=>[M("mdi-map-marker")]),_:1}),$t,M(" "+W(((oe=g.selectedItem)==null?void 0:oe.client.address)||"N/A"),1)])]}),_:1})]),_:1})]),_:1}),v(t,{cols:"12",md:"6"},{default:m(()=>[v(f,null,{default:m(()=>[v(y,{dense:""},{default:m(()=>[v(h,{onClick:E[20]||(E[20]=O=>{var J;return d.callClient((J=g.selectedItem)==null?void 0:J.phone)})},{default:m(()=>[v(e,null,{default:m(()=>[v(r,{color:"primary"},{default:m(()=>[M("mdi-phone")]),_:1})]),_:1}),v(l,null,{default:m(()=>[v(c,null,{default:m(()=>[M("Call Client")]),_:1})]),_:1})]),_:1}),v(h,{onClick:E[21]||(E[21]=O=>{var J;return g.sendSms((J=g.selectedItem)==null?void 0:J.phone)})},{default:m(()=>[v(e,null,{default:m(()=>[v(r,{color:"primary"},{default:m(()=>[M("mdi-message")]),_:1})]),_:1}),v(l,null,{default:m(()=>[v(c,null,{default:m(()=>[M("Send SMS")]),_:1})]),_:1})]),_:1}),v(h,{onClick:E[22]||(E[22]=O=>{var J;return d.sendWhatsApp((J=g.selectedItem)==null?void 0:J.phone)})},{default:m(()=>[v(e,null,{default:m(()=>[v(r,{color:"success"},{default:m(()=>[M("mdi-whatsapp")]),_:1})]),_:1}),v(l,null,{default:m(()=>[v(c,null,{default:m(()=>[M("Send WhatsApp Message")]),_:1})]),_:1})]),_:1}),v(h,{onClick:E[23]||(E[23]=O=>{var J;return g.sendEmail((J=g.selectedItem)==null?void 0:J.email)})},{default:m(()=>[v(e,null,{default:m(()=>[v(r,{color:"primary"},{default:m(()=>[M("mdi-email")]),_:1})]),_:1}),v(l,null,{default:m(()=>[v(c,null,{default:m(()=>[M("Send Email")]),_:1})]),_:1})]),_:1}),v(h,{onClick:E[24]||(E[24]=O=>{var J;return d.sendTelegram((J=g.selectedItem)==null?void 0:J.phone)})},{default:m(()=>[v(e,null,{default:m(()=>[v(r,{color:"info"},{default:m(()=>[M("mdi-telegram")]),_:1})]),_:1}),v(l,null,{default:m(()=>[v(c,null,{default:m(()=>[M("Send Telegram Message")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})])]),_:1})}const Zt=tt(at,[["render",Qt]]);export{Zt as default};

import{A as Ye}from"./AppLayout-TTcOwNTh.js";import{z as Xe,k as Fe,r as Ve,i as ne,o as le,c as ye,w as k,A as Je,a as G,b as w,f as x,d as Oe,g as xe,F as Le,e as Re,t as ae,n as Ge}from"./app-DUP5so0n.js";import{_ as Ze}from"./_plugin-vue_export-helper-DlAUqK2U.js";var ze={exports:{}};(function(T,D){(function(U,Q){T.exports=Q()})(window,function(){return function(U){var Q={};function L(d){if(Q[d])return Q[d].exports;var n=Q[d]={i:d,l:!1,exports:{}};return U[d].call(n.exports,n,n.exports,L),n.l=!0,n.exports}return L.m=U,L.c=Q,L.d=function(d,n,o){L.o(d,n)||Object.defineProperty(d,n,{enumerable:!0,get:o})},L.r=function(d){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(d,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(d,"__esModule",{value:!0})},L.t=function(d,n){if(1&n&&(d=L(d)),8&n||4&n&&typeof d=="object"&&d&&d.__esModule)return d;var o=Object.create(null);if(L.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:d}),2&n&&typeof d!="string")for(var e in d)L.d(o,e,(function(c){return d[c]}).bind(null,e));return o},L.n=function(d){var n=d&&d.__esModule?function(){return d.default}:function(){return d};return L.d(n,"a",n),n},L.o=function(d,n){return Object.prototype.hasOwnProperty.call(d,n)},L.p="",L(L.s=3)}([function(U,Q,L){(function(d){var n=L(6);U.exports=n({window:d.window})}).call(this,L(5))},function(U,Q,L){var d=!0,n=!0;function o(e,c,l){var r=e.match(c);return r&&r.length>=l&&parseInt(r[l],10)}U.exports={extractVersion:o,wrapPeerConnectionEvent:function(e,c,l){if(e.RTCPeerConnection){var r=e.RTCPeerConnection.prototype,h=r.addEventListener;r.addEventListener=function(g,s){if(g!==c)return h.apply(this,arguments);var p=function(t){var a=l(t);a&&s(a)};return this._eventMap=this._eventMap||{},this._eventMap[s]=p,h.apply(this,[g,p])};var C=r.removeEventListener;r.removeEventListener=function(g,s){if(g!==c||!this._eventMap||!this._eventMap[s])return C.apply(this,arguments);var p=this._eventMap[s];return delete this._eventMap[s],C.apply(this,[g,p])},Object.defineProperty(r,"on"+c,{get:function(){return this["_on"+c]},set:function(g){this["_on"+c]&&(this.removeEventListener(c,this["_on"+c]),delete this["_on"+c]),g&&this.addEventListener(c,this["_on"+c]=g)},enumerable:!0,configurable:!0})}},disableLog:function(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(d=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},disableWarnings:function(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(n=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))},log:function(){if(typeof window=="object"){if(d)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}},deprecated:function(e,c){n&&console.warn(e+" is deprecated, please use "+c+" instead.")},detectBrowser:function(e){var c=e&&e.navigator,l={browser:null,version:null};if(e===void 0||!e.navigator)return l.browser="Not a browser.",l;if(c.mozGetUserMedia)l.browser="firefox",l.version=o(c.userAgent,/Firefox\/(\d+)\./,1);else if(c.webkitGetUserMedia)l.browser="chrome",l.version=o(c.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(c.mediaDevices&&c.userAgent.match(/Edge\/(\d+).(\d+)$/))l.browser="edge",l.version=o(c.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!c.userAgent.match(/AppleWebKit\/(\d+)\./))return l.browser="Not a supported browser.",l;l.browser="safari",l.version=o(c.userAgent,/AppleWebKit\/(\d+)\./,1)}return l}}},function(U,Q,L){var d={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};d.localCName=d.generateIdentifier(),d.splitLines=function(n){return n.trim().split(`
`).map(function(o){return o.trim()})},d.splitSections=function(n){return n.split(`
m=`).map(function(o,e){return(e>0?"m="+o:o).trim()+`\r
`})},d.getDescription=function(n){var o=d.splitSections(n);return o&&o[0]},d.getMediaSections=function(n){var o=d.splitSections(n);return o.shift(),o},d.matchPrefix=function(n,o){return d.splitLines(n).filter(function(e){return e.indexOf(o)===0})},d.parseCandidate=function(n){for(var o,e={foundation:(o=n.indexOf("a=candidate:")===0?n.substring(12).split(" "):n.substring(10).split(" "))[0],component:parseInt(o[1],10),protocol:o[2].toLowerCase(),priority:parseInt(o[3],10),ip:o[4],address:o[4],port:parseInt(o[5],10),type:o[7]},c=8;c<o.length;c+=2)switch(o[c]){case"raddr":e.relatedAddress=o[c+1];break;case"rport":e.relatedPort=parseInt(o[c+1],10);break;case"tcptype":e.tcpType=o[c+1];break;case"ufrag":e.ufrag=o[c+1],e.usernameFragment=o[c+1];break;default:e[o[c]]=o[c+1]}return e},d.writeCandidate=function(n){var o=[];o.push(n.foundation),o.push(n.component),o.push(n.protocol.toUpperCase()),o.push(n.priority),o.push(n.address||n.ip),o.push(n.port);var e=n.type;return o.push("typ"),o.push(e),e!=="host"&&n.relatedAddress&&n.relatedPort&&(o.push("raddr"),o.push(n.relatedAddress),o.push("rport"),o.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(o.push("tcptype"),o.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(o.push("ufrag"),o.push(n.usernameFragment||n.ufrag)),"candidate:"+o.join(" ")},d.parseIceOptions=function(n){return n.substr(14).split(" ")},d.parseRtpMap=function(n){var o=n.substr(9).split(" "),e={payloadType:parseInt(o.shift(),10)};return o=o[0].split("/"),e.name=o[0],e.clockRate=parseInt(o[1],10),e.channels=o.length===3?parseInt(o[2],10):1,e.numChannels=e.channels,e},d.writeRtpMap=function(n){var o=n.payloadType;n.preferredPayloadType!==void 0&&(o=n.preferredPayloadType);var e=n.channels||n.numChannels||1;return"a=rtpmap:"+o+" "+n.name+"/"+n.clockRate+(e!==1?"/"+e:"")+`\r
`},d.parseExtmap=function(n){var o=n.substr(9).split(" ");return{id:parseInt(o[0],10),direction:o[0].indexOf("/")>0?o[0].split("/")[1]:"sendrecv",uri:o[1]}},d.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+`\r
`},d.parseFmtp=function(n){for(var o,e={},c=n.substr(n.indexOf(" ")+1).split(";"),l=0;l<c.length;l++)e[(o=c[l].trim().split("="))[0].trim()]=o[1];return e},d.writeFmtp=function(n){var o="",e=n.payloadType;if(n.preferredPayloadType!==void 0&&(e=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){var c=[];Object.keys(n.parameters).forEach(function(l){n.parameters[l]?c.push(l+"="+n.parameters[l]):c.push(l)}),o+="a=fmtp:"+e+" "+c.join(";")+`\r
`}return o},d.parseRtcpFb=function(n){var o=n.substr(n.indexOf(" ")+1).split(" ");return{type:o.shift(),parameter:o.join(" ")}},d.writeRtcpFb=function(n){var o="",e=n.payloadType;return n.preferredPayloadType!==void 0&&(e=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(function(c){o+="a=rtcp-fb:"+e+" "+c.type+(c.parameter&&c.parameter.length?" "+c.parameter:"")+`\r
`}),o},d.parseSsrcMedia=function(n){var o=n.indexOf(" "),e={ssrc:parseInt(n.substr(7,o-7),10)},c=n.indexOf(":",o);return c>-1?(e.attribute=n.substr(o+1,c-o-1),e.value=n.substr(c+1)):e.attribute=n.substr(o+1),e},d.parseSsrcGroup=function(n){var o=n.substr(13).split(" ");return{semantics:o.shift(),ssrcs:o.map(function(e){return parseInt(e,10)})}},d.getMid=function(n){var o=d.matchPrefix(n,"a=mid:")[0];if(o)return o.substr(6)},d.parseFingerprint=function(n){var o=n.substr(14).split(" ");return{algorithm:o[0].toLowerCase(),value:o[1]}},d.getDtlsParameters=function(n,o){return{role:"auto",fingerprints:d.matchPrefix(n+o,"a=fingerprint:").map(d.parseFingerprint)}},d.writeDtlsParameters=function(n,o){var e="a=setup:"+o+`\r
`;return n.fingerprints.forEach(function(c){e+="a=fingerprint:"+c.algorithm+" "+c.value+`\r
`}),e},d.getIceParameters=function(n,o){var e=d.splitLines(n);return{usernameFragment:(e=e.concat(d.splitLines(o))).filter(function(c){return c.indexOf("a=ice-ufrag:")===0})[0].substr(12),password:e.filter(function(c){return c.indexOf("a=ice-pwd:")===0})[0].substr(10)}},d.writeIceParameters=function(n){return"a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`},d.parseRtpParameters=function(n){for(var o={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},e=d.splitLines(n)[0].split(" "),c=3;c<e.length;c++){var l=e[c],r=d.matchPrefix(n,"a=rtpmap:"+l+" ")[0];if(r){var h=d.parseRtpMap(r),C=d.matchPrefix(n,"a=fmtp:"+l+" ");switch(h.parameters=C.length?d.parseFmtp(C[0]):{},h.rtcpFeedback=d.matchPrefix(n,"a=rtcp-fb:"+l+" ").map(d.parseRtcpFb),o.codecs.push(h),h.name.toUpperCase()){case"RED":case"ULPFEC":o.fecMechanisms.push(h.name.toUpperCase())}}}return d.matchPrefix(n,"a=extmap:").forEach(function(g){o.headerExtensions.push(d.parseExtmap(g))}),o},d.writeRtpDescription=function(n,o){var e="";e+="m="+n+" ",e+=o.codecs.length>0?"9":"0",e+=" UDP/TLS/RTP/SAVPF ",e+=o.codecs.map(function(l){return l.preferredPayloadType!==void 0?l.preferredPayloadType:l.payloadType}).join(" ")+`\r
`,e+=`c=IN IP4 0.0.0.0\r
`,e+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,o.codecs.forEach(function(l){e+=d.writeRtpMap(l),e+=d.writeFmtp(l),e+=d.writeRtcpFb(l)});var c=0;return o.codecs.forEach(function(l){l.maxptime>c&&(c=l.maxptime)}),c>0&&(e+="a=maxptime:"+c+`\r
`),e+=`a=rtcp-mux\r
`,o.headerExtensions&&o.headerExtensions.forEach(function(l){e+=d.writeExtmap(l)}),e},d.parseRtpEncodingParameters=function(n){var o,e=[],c=d.parseRtpParameters(n),l=c.fecMechanisms.indexOf("RED")!==-1,r=c.fecMechanisms.indexOf("ULPFEC")!==-1,h=d.matchPrefix(n,"a=ssrc:").map(function(p){return d.parseSsrcMedia(p)}).filter(function(p){return p.attribute==="cname"}),C=h.length>0&&h[0].ssrc,g=d.matchPrefix(n,"a=ssrc-group:FID").map(function(p){return p.substr(17).split(" ").map(function(t){return parseInt(t,10)})});g.length>0&&g[0].length>1&&g[0][0]===C&&(o=g[0][1]),c.codecs.forEach(function(p){if(p.name.toUpperCase()==="RTX"&&p.parameters.apt){var t={ssrc:C,codecPayloadType:parseInt(p.parameters.apt,10)};C&&o&&(t.rtx={ssrc:o}),e.push(t),l&&((t=JSON.parse(JSON.stringify(t))).fec={ssrc:C,mechanism:r?"red+ulpfec":"red"},e.push(t))}}),e.length===0&&C&&e.push({ssrc:C});var s=d.matchPrefix(n,"b=");return s.length&&(s=s[0].indexOf("b=TIAS:")===0?parseInt(s[0].substr(7),10):s[0].indexOf("b=AS:")===0?1e3*parseInt(s[0].substr(5),10)*.95-16e3:void 0,e.forEach(function(p){p.maxBitrate=s})),e},d.parseRtcpParameters=function(n){var o={},e=d.matchPrefix(n,"a=ssrc:").map(function(r){return d.parseSsrcMedia(r)}).filter(function(r){return r.attribute==="cname"})[0];e&&(o.cname=e.value,o.ssrc=e.ssrc);var c=d.matchPrefix(n,"a=rtcp-rsize");o.reducedSize=c.length>0,o.compound=c.length===0;var l=d.matchPrefix(n,"a=rtcp-mux");return o.mux=l.length>0,o},d.parseMsid=function(n){var o,e=d.matchPrefix(n,"a=msid:");if(e.length===1)return{stream:(o=e[0].substr(7).split(" "))[0],track:o[1]};var c=d.matchPrefix(n,"a=ssrc:").map(function(l){return d.parseSsrcMedia(l)}).filter(function(l){return l.attribute==="msid"});return c.length>0?{stream:(o=c[0].value.split(" "))[0],track:o[1]}:void 0},d.generateSessionId=function(){return Math.random().toString().substr(2,21)},d.writeSessionBoilerplate=function(n,o,e){var c=o!==void 0?o:2;return`v=0\r
o=`+(e||"thisisadapterortc")+" "+(n||d.generateSessionId())+" "+c+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},d.writeMediaSection=function(n,o,e,c){var l=d.writeRtpDescription(n.kind,o);if(l+=d.writeIceParameters(n.iceGatherer.getLocalParameters()),l+=d.writeDtlsParameters(n.dtlsTransport.getLocalParameters(),e==="offer"?"actpass":"active"),l+="a=mid:"+n.mid+`\r
`,n.direction?l+="a="+n.direction+`\r
`:n.rtpSender&&n.rtpReceiver?l+=`a=sendrecv\r
`:n.rtpSender?l+=`a=sendonly\r
`:n.rtpReceiver?l+=`a=recvonly\r
`:l+=`a=inactive\r
`,n.rtpSender){var r="msid:"+c.id+" "+n.rtpSender.track.id+`\r
`;l+="a="+r,l+="a=ssrc:"+n.sendEncodingParameters[0].ssrc+" "+r,n.sendEncodingParameters[0].rtx&&(l+="a=ssrc:"+n.sendEncodingParameters[0].rtx.ssrc+" "+r,l+="a=ssrc-group:FID "+n.sendEncodingParameters[0].ssrc+" "+n.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return l+="a=ssrc:"+n.sendEncodingParameters[0].ssrc+" cname:"+d.localCName+`\r
`,n.rtpSender&&n.sendEncodingParameters[0].rtx&&(l+="a=ssrc:"+n.sendEncodingParameters[0].rtx.ssrc+" cname:"+d.localCName+`\r
`),l},d.getDirection=function(n,o){for(var e=d.splitLines(n),c=0;c<e.length;c++)switch(e[c]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return e[c].substr(2)}return o?d.getDirection(o):"sendrecv"},d.getKind=function(n){return d.splitLines(n)[0].split(" ")[0].substr(2)},d.isRejected=function(n){return n.split(" ",2)[1]==="0"},d.parseMLine=function(n){var o=d.splitLines(n)[0].substr(2).split(" ");return{kind:o[0],port:parseInt(o[1],10),protocol:o[2],fmt:o.slice(3).join(" ")}},d.parseOLine=function(n){var o=d.matchPrefix(n,"o=")[0].substr(2).split(" ");return{username:o[0],sessionId:o[1],sessionVersion:parseInt(o[2],10),netType:o[3],addressType:o[4],address:o[5]}},d.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;for(var o=d.splitLines(n),e=0;e<o.length;e++)if(o[e].length<2||o[e].charAt(1)!=="=")return!1;return!0},U.exports=d},function(U,Q,L){L(4),U.exports=L(17)},function(U,Q,L){var d=function(n){var o=Object.prototype,e=o.hasOwnProperty,c=typeof Symbol=="function"?Symbol:{},l=c.iterator||"@@iterator",r=c.asyncIterator||"@@asyncIterator",h=c.toStringTag||"@@toStringTag";function C(E,m,I,J){var M=m&&m.prototype instanceof p?m:p,K=Object.create(M.prototype),de=new re(J||[]);return K._invoke=function(ve,ce,F){var Y="suspendedStart";return function(fe,X){if(Y==="executing")throw new Error("Generator is already running");if(Y==="completed"){if(fe==="throw")throw X;return $()}for(F.method=fe,F.arg=X;;){var Ce=F.delegate;if(Ce){var Se=N(Ce,F);if(Se){if(Se===s)continue;return Se}}if(F.method==="next")F.sent=F._sent=F.arg;else if(F.method==="throw"){if(Y==="suspendedStart")throw Y="completed",F.arg;F.dispatchException(F.arg)}else F.method==="return"&&F.abrupt("return",F.arg);Y="executing";var ue=g(ve,ce,F);if(ue.type==="normal"){if(Y=F.done?"completed":"suspendedYield",ue.arg===s)continue;return{value:ue.arg,done:F.done}}ue.type==="throw"&&(Y="completed",F.method="throw",F.arg=ue.arg)}}}(E,I,de),K}function g(E,m,I){try{return{type:"normal",arg:E.call(m,I)}}catch(J){return{type:"throw",arg:J}}}n.wrap=C;var s={};function p(){}function t(){}function a(){}var i={};i[l]=function(){return this};var f=Object.getPrototypeOf,y=f&&f(f(B([])));y&&y!==o&&e.call(y,l)&&(i=y);var _=a.prototype=p.prototype=Object.create(i);function R(E){["next","throw","return"].forEach(function(m){E[m]=function(I){return this._invoke(m,I)}})}function O(E,m){var I;this._invoke=function(J,M){function K(){return new m(function(de,ve){(function ce(F,Y,fe,X){var Ce=g(E[F],E,Y);if(Ce.type!=="throw"){var Se=Ce.arg,ue=Se.value;return ue&&typeof ue=="object"&&e.call(ue,"__await")?m.resolve(ue.__await).then(function(ge){ce("next",ge,fe,X)},function(ge){ce("throw",ge,fe,X)}):m.resolve(ue).then(function(ge){Se.value=ge,fe(Se)},function(ge){return ce("throw",ge,fe,X)})}X(Ce.arg)})(J,M,de,ve)})}return I=I?I.then(K,K):K()}}function N(E,m){var I=E.iterator[m.method];if(I===void 0){if(m.delegate=null,m.method==="throw"){if(E.iterator.return&&(m.method="return",m.arg=void 0,N(E,m),m.method==="throw"))return s;m.method="throw",m.arg=new TypeError("The iterator does not provide a 'throw' method")}return s}var J=g(I,E.iterator,m.arg);if(J.type==="throw")return m.method="throw",m.arg=J.arg,m.delegate=null,s;var M=J.arg;return M?M.done?(m[E.resultName]=M.value,m.next=E.nextLoc,m.method!=="return"&&(m.method="next",m.arg=void 0),m.delegate=null,s):M:(m.method="throw",m.arg=new TypeError("iterator result is not an object"),m.delegate=null,s)}function A(E){var m={tryLoc:E[0]};1 in E&&(m.catchLoc=E[1]),2 in E&&(m.finallyLoc=E[2],m.afterLoc=E[3]),this.tryEntries.push(m)}function j(E){var m=E.completion||{};m.type="normal",delete m.arg,E.completion=m}function re(E){this.tryEntries=[{tryLoc:"root"}],E.forEach(A,this),this.reset(!0)}function B(E){if(E){var m=E[l];if(m)return m.call(E);if(typeof E.next=="function")return E;if(!isNaN(E.length)){var I=-1,J=function M(){for(;++I<E.length;)if(e.call(E,I))return M.value=E[I],M.done=!1,M;return M.value=void 0,M.done=!0,M};return J.next=J}}return{next:$}}function $(){return{value:void 0,done:!0}}return t.prototype=_.constructor=a,a.constructor=t,a[h]=t.displayName="GeneratorFunction",n.isGeneratorFunction=function(E){var m=typeof E=="function"&&E.constructor;return!!m&&(m===t||(m.displayName||m.name)==="GeneratorFunction")},n.mark=function(E){return Object.setPrototypeOf?Object.setPrototypeOf(E,a):(E.__proto__=a,h in E||(E[h]="GeneratorFunction")),E.prototype=Object.create(_),E},n.awrap=function(E){return{__await:E}},R(O.prototype),O.prototype[r]=function(){return this},n.AsyncIterator=O,n.async=function(E,m,I,J,M){M===void 0&&(M=Promise);var K=new O(C(E,m,I,J),M);return n.isGeneratorFunction(m)?K:K.next().then(function(de){return de.done?de.value:K.next()})},R(_),_[h]="Generator",_[l]=function(){return this},_.toString=function(){return"[object Generator]"},n.keys=function(E){var m=[];for(var I in E)m.push(I);return m.reverse(),function J(){for(;m.length;){var M=m.pop();if(M in E)return J.value=M,J.done=!1,J}return J.done=!0,J}},n.values=B,re.prototype={constructor:re,reset:function(E){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(j),!E)for(var m in this)m.charAt(0)==="t"&&e.call(this,m)&&!isNaN(+m.slice(1))&&(this[m]=void 0)},stop:function(){this.done=!0;var E=this.tryEntries[0].completion;if(E.type==="throw")throw E.arg;return this.rval},dispatchException:function(E){if(this.done)throw E;var m=this;function I(ce,F){return K.type="throw",K.arg=E,m.next=ce,F&&(m.method="next",m.arg=void 0),!!F}for(var J=this.tryEntries.length-1;J>=0;--J){var M=this.tryEntries[J],K=M.completion;if(M.tryLoc==="root")return I("end");if(M.tryLoc<=this.prev){var de=e.call(M,"catchLoc"),ve=e.call(M,"finallyLoc");if(de&&ve){if(this.prev<M.catchLoc)return I(M.catchLoc,!0);if(this.prev<M.finallyLoc)return I(M.finallyLoc)}else if(de){if(this.prev<M.catchLoc)return I(M.catchLoc,!0)}else{if(!ve)throw new Error("try statement without catch or finally");if(this.prev<M.finallyLoc)return I(M.finallyLoc)}}}},abrupt:function(E,m){for(var I=this.tryEntries.length-1;I>=0;--I){var J=this.tryEntries[I];if(J.tryLoc<=this.prev&&e.call(J,"finallyLoc")&&this.prev<J.finallyLoc){var M=J;break}}M&&(E==="break"||E==="continue")&&M.tryLoc<=m&&m<=M.finallyLoc&&(M=null);var K=M?M.completion:{};return K.type=E,K.arg=m,M?(this.method="next",this.next=M.finallyLoc,s):this.complete(K)},complete:function(E,m){if(E.type==="throw")throw E.arg;return E.type==="break"||E.type==="continue"?this.next=E.arg:E.type==="return"?(this.rval=this.arg=E.arg,this.method="return",this.next="end"):E.type==="normal"&&m&&(this.next=m),s},finish:function(E){for(var m=this.tryEntries.length-1;m>=0;--m){var I=this.tryEntries[m];if(I.finallyLoc===E)return this.complete(I.completion,I.afterLoc),j(I),s}},catch:function(E){for(var m=this.tryEntries.length-1;m>=0;--m){var I=this.tryEntries[m];if(I.tryLoc===E){var J=I.completion;if(J.type==="throw"){var M=J.arg;j(I)}return M}}throw new Error("illegal catch attempt")},delegateYield:function(E,m,I){return this.delegate={iterator:B(E),resultName:m,nextLoc:I},this.method==="next"&&(this.arg=void 0),s}},n}(U.exports);try{regeneratorRuntime=d}catch{Function("r","regeneratorRuntime = r")(d)}},function(U,Q){var L;L=function(){return this}();try{L=L||new Function("return this")()}catch{typeof window=="object"&&(L=window)}U.exports=L},function(U,Q,L){var d=L(1);U.exports=function(n,o){var e=n&&n.window,c={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0};for(var l in o)hasOwnProperty.call(o,l)&&(c[l]=o[l]);var r=d.log,h=d.detectBrowser(e),C=L(7)||null,g=L(9)||null,s=L(13)||null,p=L(15)||null,t=L(16)||null,a={browserDetails:h,commonShim:t,extractVersion:d.extractVersion,disableLog:d.disableLog,disableWarnings:d.disableWarnings};switch(h.browser){case"chrome":if(!C||!C.shimPeerConnection||!c.shimChrome)return r("Chrome shim is not included in this adapter release."),a;r("adapter.js shimming chrome."),a.browserShim=C,t.shimCreateObjectURL(e),C.shimGetUserMedia(e),C.shimMediaStream(e),C.shimSourceObject(e),C.shimPeerConnection(e),C.shimOnTrack(e),C.shimAddTrackRemoveTrack(e),C.shimGetSendersWithDtmf(e),C.shimSenderReceiverGetStats(e),C.fixNegotiationNeeded(e),t.shimRTCIceCandidate(e),t.shimMaxMessageSize(e),t.shimSendThrowTypeError(e);break;case"firefox":if(!s||!s.shimPeerConnection||!c.shimFirefox)return r("Firefox shim is not included in this adapter release."),a;r("adapter.js shimming firefox."),a.browserShim=s,t.shimCreateObjectURL(e),s.shimGetUserMedia(e),s.shimSourceObject(e),s.shimPeerConnection(e),s.shimOnTrack(e),s.shimRemoveStream(e),s.shimSenderGetStats(e),s.shimReceiverGetStats(e),s.shimRTCDataChannel(e),t.shimRTCIceCandidate(e),t.shimMaxMessageSize(e),t.shimSendThrowTypeError(e);break;case"edge":if(!g||!g.shimPeerConnection||!c.shimEdge)return r("MS edge shim is not included in this adapter release."),a;r("adapter.js shimming edge."),a.browserShim=g,t.shimCreateObjectURL(e),g.shimGetUserMedia(e),g.shimPeerConnection(e),g.shimReplaceTrack(e),g.shimGetDisplayMedia(e),t.shimMaxMessageSize(e),t.shimSendThrowTypeError(e);break;case"safari":if(!p||!c.shimSafari)return r("Safari shim is not included in this adapter release."),a;r("adapter.js shimming safari."),a.browserShim=p,t.shimCreateObjectURL(e),p.shimRTCIceServerUrls(e),p.shimCreateOfferLegacy(e),p.shimCallbacksAPI(e),p.shimLocalStreamsAPI(e),p.shimRemoteStreamsAPI(e),p.shimTrackEventTransceiver(e),p.shimGetUserMedia(e),t.shimRTCIceCandidate(e),t.shimMaxMessageSize(e),t.shimSendThrowTypeError(e);break;default:r("Unsupported browser!")}return a}},function(U,Q,L){var d=L(1),n=d.log;function o(e,c,l){var r=l?"outbound-rtp":"inbound-rtp",h=new Map;if(c===null)return h;var C=[];return e.forEach(function(g){g.type==="track"&&g.trackIdentifier===c.id&&C.push(g)}),C.forEach(function(g){e.forEach(function(s){s.type===r&&s.trackId===g.id&&function p(t,a,i){a&&!i.has(a.id)&&(i.set(a.id,a),Object.keys(a).forEach(function(f){f.endsWith("Id")?p(t,t.get(a[f]),i):f.endsWith("Ids")&&a[f].forEach(function(y){p(t,t.get(y),i)})}))}(e,s,h)})}),h}U.exports={shimGetUserMedia:L(8),shimMediaStream:function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},shimOnTrack:function(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(l){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=l)},enumerable:!0,configurable:!0});var c=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var l=this;return l._ontrackpoly||(l._ontrackpoly=function(r){r.stream.addEventListener("addtrack",function(h){var C;C=e.RTCPeerConnection.prototype.getReceivers?l.getReceivers().find(function(s){return s.track&&s.track.id===h.track.id}):{track:h.track};var g=new Event("track");g.track=h.track,g.receiver=C,g.transceiver={receiver:C},g.streams=[r.stream],l.dispatchEvent(g)}),r.stream.getTracks().forEach(function(h){var C;C=e.RTCPeerConnection.prototype.getReceivers?l.getReceivers().find(function(s){return s.track&&s.track.id===h.id}):{track:h};var g=new Event("track");g.track=h,g.receiver=C,g.transceiver={receiver:C},g.streams=[r.stream],l.dispatchEvent(g)})},l.addEventListener("addstream",l._ontrackpoly)),c.apply(l,arguments)}}else d.wrapPeerConnectionEvent(e,"track",function(l){return l.transceiver||Object.defineProperty(l,"transceiver",{value:{receiver:l.receiver}}),l})},shimGetSendersWithDtmf:function(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var c=function(s,p){return{track:p,get dtmf(){return this._dtmf===void 0&&(p.kind==="audio"?this._dtmf=s.createDTMFSender(p):this._dtmf=null),this._dtmf},_pc:s}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var l=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(s,p){var t=this,a=l.apply(t,arguments);return a||(a=c(t,s),t._senders.push(a)),a};var r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(s){var p=this;r.apply(p,arguments);var t=p._senders.indexOf(s);t!==-1&&p._senders.splice(t,1)}}var h=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(s){var p=this;p._senders=p._senders||[],h.apply(p,[s]),s.getTracks().forEach(function(t){p._senders.push(c(p,t))})};var C=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(s){var p=this;p._senders=p._senders||[],C.apply(p,[s]),s.getTracks().forEach(function(t){var a=p._senders.find(function(i){return i.track===t});a&&p._senders.splice(p._senders.indexOf(a),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var g=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var s=this,p=g.apply(s,[]);return p.forEach(function(t){t._pc=s}),p},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},shimSenderReceiverGetStats:function(e){if(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var c=e.RTCPeerConnection.prototype.getSenders;c&&(e.RTCPeerConnection.prototype.getSenders=function(){var C=this,g=c.apply(C,[]);return g.forEach(function(s){s._pc=C}),g});var l=e.RTCPeerConnection.prototype.addTrack;l&&(e.RTCPeerConnection.prototype.addTrack=function(){var C=l.apply(this,arguments);return C._pc=this,C}),e.RTCRtpSender.prototype.getStats=function(){var C=this;return this._pc.getStats().then(function(g){return o(g,C.track,!0)})}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var r=e.RTCPeerConnection.prototype.getReceivers;r&&(e.RTCPeerConnection.prototype.getReceivers=function(){var C=this,g=r.apply(C,[]);return g.forEach(function(s){s._pc=C}),g}),d.wrapPeerConnectionEvent(e,"track",function(C){return C.receiver._pc=C.srcElement,C}),e.RTCRtpReceiver.prototype.getStats=function(){var C=this;return this._pc.getStats().then(function(g){return o(g,C.track,!1)})}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var h=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var C=this;if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var g,s,p,t=arguments[0];return C.getSenders().forEach(function(a){a.track===t&&(g?p=!0:g=a)}),C.getReceivers().forEach(function(a){return a.track===t&&(s?p=!0:s=a),a.track===t}),p||g&&s?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):g?g.getStats():s?s.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return h.apply(C,arguments)}}}},shimSourceObject:function(e){var c=e&&e.URL;typeof e=="object"&&e.HTMLMediaElement&&!("srcObject"in e.HTMLMediaElement.prototype)&&Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(l){var r=this;this._srcObject=l,this.src&&c.revokeObjectURL(this.src),l?(this.src=c.createObjectURL(l),l.addEventListener("addtrack",function(){r.src&&c.revokeObjectURL(r.src),r.src=c.createObjectURL(l)}),l.addEventListener("removetrack",function(){r.src&&c.revokeObjectURL(r.src),r.src=c.createObjectURL(l)})):this.src=""}})},shimAddTrackRemoveTrackWithNative:function(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var C=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(g){return C._shimmedLocalStreams[g][0]})};var c=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(C,g){if(!g)return c.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var s=c.apply(this,arguments);return this._shimmedLocalStreams[g.id]?this._shimmedLocalStreams[g.id].indexOf(s)===-1&&this._shimmedLocalStreams[g.id].push(s):this._shimmedLocalStreams[g.id]=[g,s],s};var l=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(C){var g=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},C.getTracks().forEach(function(t){if(g.getSenders().find(function(a){return a.track===t}))throw new DOMException("Track already exists.","InvalidAccessError")});var s=g.getSenders();l.apply(this,arguments);var p=g.getSenders().filter(function(t){return s.indexOf(t)===-1});this._shimmedLocalStreams[C.id]=[C].concat(p)};var r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(C){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[C.id],r.apply(this,arguments)};var h=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(C){var g=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},C&&Object.keys(this._shimmedLocalStreams).forEach(function(s){var p=g._shimmedLocalStreams[s].indexOf(C);p!==-1&&g._shimmedLocalStreams[s].splice(p,1),g._shimmedLocalStreams[s].length===1&&delete g._shimmedLocalStreams[s]}),h.apply(this,arguments)}},shimAddTrackRemoveTrack:function(e){if(e.RTCPeerConnection){var c=d.detectBrowser(e);if(e.RTCPeerConnection.prototype.addTrack&&c.version>=65)return this.shimAddTrackRemoveTrackWithNative(e);var l=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var t=this,a=l.apply(this);return t._reverseStreams=t._reverseStreams||{},a.map(function(i){return t._reverseStreams[i.id]})};var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var a=this;if(a._streams=a._streams||{},a._reverseStreams=a._reverseStreams||{},t.getTracks().forEach(function(f){if(a.getSenders().find(function(y){return y.track===f}))throw new DOMException("Track already exists.","InvalidAccessError")}),!a._reverseStreams[t.id]){var i=new e.MediaStream(t.getTracks());a._streams[t.id]=i,a._reverseStreams[i.id]=t,t=i}r.apply(a,[t])};var h=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(t){var a=this;a._streams=a._streams||{},a._reverseStreams=a._reverseStreams||{},h.apply(a,[a._streams[t.id]||t]),delete a._reverseStreams[a._streams[t.id]?a._streams[t.id].id:t.id],delete a._streams[t.id]},e.RTCPeerConnection.prototype.addTrack=function(t,a){var i=this;if(i.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var f=[].slice.call(arguments,1);if(f.length!==1||!f[0].getTracks().find(function(O){return O===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");var y=i.getSenders().find(function(O){return O.track===t});if(y)throw new DOMException("Track already exists.","InvalidAccessError");i._streams=i._streams||{},i._reverseStreams=i._reverseStreams||{};var _=i._streams[a.id];if(_)_.addTrack(t),Promise.resolve().then(function(){i.dispatchEvent(new Event("negotiationneeded"))});else{var R=new e.MediaStream([t]);i._streams[a.id]=R,i._reverseStreams[R.id]=a,i.addStream(R)}return i.getSenders().find(function(O){return O.track===t})},["createOffer","createAnswer"].forEach(function(t){var a=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var i=this,f=arguments,y=arguments.length&&typeof arguments[0]=="function";return y?a.apply(i,[function(_){var R=s(i,_);f[0].apply(null,[R])},function(_){f[1]&&f[1].apply(null,_)},arguments[2]]):a.apply(i,arguments).then(function(_){return s(i,_)})}});var C=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){var t=this;return arguments.length&&arguments[0].type&&(arguments[0]=p(t,arguments[0])),C.apply(t,arguments)};var g=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var t=g.get.apply(this);return t.type===""?t:s(this,t)}}),e.RTCPeerConnection.prototype.removeTrack=function(t){var a,i=this;if(i.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!t._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(t._pc!==i)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");i._streams=i._streams||{},Object.keys(i._streams).forEach(function(f){i._streams[f].getTracks().find(function(y){return t.track===y})&&(a=i._streams[f])}),a&&(a.getTracks().length===1?i.removeStream(i._reverseStreams[a.id]):a.removeTrack(t.track),i.dispatchEvent(new Event("negotiationneeded")))}}function s(t,a){var i=a.sdp;return Object.keys(t._reverseStreams||[]).forEach(function(f){var y=t._reverseStreams[f],_=t._streams[y.id];i=i.replace(new RegExp(_.id,"g"),y.id)}),new RTCSessionDescription({type:a.type,sdp:i})}function p(t,a){var i=a.sdp;return Object.keys(t._reverseStreams||[]).forEach(function(f){var y=t._reverseStreams[f],_=t._streams[y.id];i=i.replace(new RegExp(y.id,"g"),_.id)}),new RTCSessionDescription({type:a.type,sdp:i})}},shimPeerConnection:function(e){var c=d.detectBrowser(e);if(!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=function(h,C){return n("PeerConnection"),h&&h.iceTransportPolicy&&(h.iceTransports=h.iceTransportPolicy),new e.webkitRTCPeerConnection(h,C)},e.RTCPeerConnection.prototype=e.webkitRTCPeerConnection.prototype,e.webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.webkitRTCPeerConnection.generateCertificate}})),e.RTCPeerConnection){var l=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(h,C,g){var s=this,p=arguments;if(arguments.length>0&&typeof h=="function")return l.apply(this,arguments);if(l.length===0&&(arguments.length===0||typeof arguments[0]!="function"))return l.apply(this,[]);var t=function(f){var y={};return f.result().forEach(function(_){var R={id:_.id,timestamp:_.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[_.type]||_.type};_.names().forEach(function(O){R[O]=_.stat(O)}),y[R.id]=R}),y},a=function(f){return new Map(Object.keys(f).map(function(y){return[y,f[y]]}))};if(arguments.length>=2){var i=function(f){p[1](a(t(f)))};return l.apply(this,[i,arguments[0]])}return new Promise(function(f,y){l.apply(s,[function(_){f(a(t(_)))},y])}).then(C,g)},c.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(h){var C=e.RTCPeerConnection.prototype[h];e.RTCPeerConnection.prototype[h]=function(){var g=arguments,s=this,p=new Promise(function(t,a){C.apply(s,[g[0],t,a])});return g.length<2?p:p.then(function(){g[1].apply(null,[])},function(t){g.length>=3&&g[2].apply(null,[t])})}}),c.version<52&&["createOffer","createAnswer"].forEach(function(h){var C=e.RTCPeerConnection.prototype[h];e.RTCPeerConnection.prototype[h]=function(){var g=this;if(arguments.length<1||arguments.length===1&&typeof arguments[0]=="object"){var s=arguments.length===1?arguments[0]:void 0;return new Promise(function(p,t){C.apply(g,[p,t,s])})}return C.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(h){var C=e.RTCPeerConnection.prototype[h];e.RTCPeerConnection.prototype[h]=function(){return arguments[0]=new(h==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),C.apply(this,arguments)}});var r=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}},fixNegotiationNeeded:function(e){d.wrapPeerConnectionEvent(e,"negotiationneeded",function(c){if(c.target.signalingState==="stable")return c})},shimGetDisplayMedia:function(e,c){e.navigator&&e.navigator.mediaDevices&&!("getDisplayMedia"in e.navigator.mediaDevices)&&(typeof c=="function"?(e.navigator.mediaDevices.getDisplayMedia=function(l){return c(l).then(function(r){var h=l.video&&l.video.width,C=l.video&&l.video.height,g=l.video&&l.video.frameRate;return l.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:r,maxFrameRate:g||3}},h&&(l.video.mandatory.maxWidth=h),C&&(l.video.mandatory.maxHeight=C),e.navigator.mediaDevices.getUserMedia(l)})},e.navigator.getDisplayMedia=function(l){return d.deprecated("navigator.getDisplayMedia","navigator.mediaDevices.getDisplayMedia"),e.navigator.mediaDevices.getDisplayMedia(l)}):console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}}},function(U,Q,L){var d=L(1),n=d.log;U.exports=function(o){var e=d.detectBrowser(o),c=o&&o.navigator,l=function(s){if(typeof s!="object"||s.mandatory||s.optional)return s;var p={};return Object.keys(s).forEach(function(t){if(t!=="require"&&t!=="advanced"&&t!=="mediaSource"){var a=typeof s[t]=="object"?s[t]:{ideal:s[t]};a.exact!==void 0&&typeof a.exact=="number"&&(a.min=a.max=a.exact);var i=function(y,_){return y?y+_.charAt(0).toUpperCase()+_.slice(1):_==="deviceId"?"sourceId":_};if(a.ideal!==void 0){p.optional=p.optional||[];var f={};typeof a.ideal=="number"?(f[i("min",t)]=a.ideal,p.optional.push(f),(f={})[i("max",t)]=a.ideal,p.optional.push(f)):(f[i("",t)]=a.ideal,p.optional.push(f))}a.exact!==void 0&&typeof a.exact!="number"?(p.mandatory=p.mandatory||{},p.mandatory[i("",t)]=a.exact):["min","max"].forEach(function(y){a[y]!==void 0&&(p.mandatory=p.mandatory||{},p.mandatory[i(y,t)]=a[y])})}}),s.advanced&&(p.optional=(p.optional||[]).concat(s.advanced)),p},r=function(s,p){if(e.version>=61)return p(s);if((s=JSON.parse(JSON.stringify(s)))&&typeof s.audio=="object"){var t=function(y,_,R){_ in y&&!(R in y)&&(y[R]=y[_],delete y[_])};t((s=JSON.parse(JSON.stringify(s))).audio,"autoGainControl","googAutoGainControl"),t(s.audio,"noiseSuppression","googNoiseSuppression"),s.audio=l(s.audio)}if(s&&typeof s.video=="object"){var a=s.video.facingMode;a=a&&(typeof a=="object"?a:{ideal:a});var i,f=e.version<66;if(a&&(a.exact==="user"||a.exact==="environment"||a.ideal==="user"||a.ideal==="environment")&&(!c.mediaDevices.getSupportedConstraints||!c.mediaDevices.getSupportedConstraints().facingMode||f)&&(delete s.video.facingMode,a.exact==="environment"||a.ideal==="environment"?i=["back","rear"]:a.exact!=="user"&&a.ideal!=="user"||(i=["front"]),i))return c.mediaDevices.enumerateDevices().then(function(y){var _=(y=y.filter(function(R){return R.kind==="videoinput"})).find(function(R){return i.some(function(O){return R.label.toLowerCase().indexOf(O)!==-1})});return!_&&y.length&&i.indexOf("back")!==-1&&(_=y[y.length-1]),_&&(s.video.deviceId=a.exact?{exact:_.deviceId}:{ideal:_.deviceId}),s.video=l(s.video),n("chrome: "+JSON.stringify(s)),p(s)});s.video=l(s.video)}return n("chrome: "+JSON.stringify(s)),p(s)},h=function(s){return e.version>=64?s:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[s.name]||s.name,message:s.message,constraint:s.constraint||s.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};c.getUserMedia=function(s,p,t){r(s,function(a){c.webkitGetUserMedia(a,p,function(i){t&&t(h(i))})})};var C=function(s){return new Promise(function(p,t){c.getUserMedia(s,p,t)})};if(c.mediaDevices||(c.mediaDevices={getUserMedia:C,enumerateDevices:function(){return new Promise(function(s){var p={audio:"audioinput",video:"videoinput"};return o.MediaStreamTrack.getSources(function(t){s(t.map(function(a){return{label:a.label,kind:p[a.kind],deviceId:a.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),c.mediaDevices.getUserMedia){var g=c.mediaDevices.getUserMedia.bind(c.mediaDevices);c.mediaDevices.getUserMedia=function(s){return r(s,function(p){return g(p).then(function(t){if(p.audio&&!t.getAudioTracks().length||p.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(a){a.stop()}),new DOMException("","NotFoundError");return t},function(t){return Promise.reject(h(t))})})}}else c.mediaDevices.getUserMedia=function(s){return C(s)};c.mediaDevices.addEventListener===void 0&&(c.mediaDevices.addEventListener=function(){n("Dummy mediaDevices.addEventListener called.")}),c.mediaDevices.removeEventListener===void 0&&(c.mediaDevices.removeEventListener=function(){n("Dummy mediaDevices.removeEventListener called.")})}},function(U,Q,L){var d=L(1),n=L(10),o=L(11);U.exports={shimGetUserMedia:L(12),shimPeerConnection:function(e){var c=d.detectBrowser(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(h){return h}),e.RTCSessionDescription||(e.RTCSessionDescription=function(h){return h}),c.version<15025)){var l=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(h){l.set.call(this,h);var C=new Event("enabled");C.enabled=h,this.dispatchEvent(C)}})}e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)&&Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=new e.RTCDtmfSender(this):this.track.kind==="video"&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);var r=o(e,c.version);e.RTCPeerConnection=function(h){return h&&h.iceServers&&(h.iceServers=n(h.iceServers)),new r(h)},e.RTCPeerConnection.prototype=r.prototype},shimReplaceTrack:function(e){e.RTCRtpSender&&!("replaceTrack"in e.RTCRtpSender.prototype)&&(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)},shimGetDisplayMedia:function(e,c){if("getDisplayMedia"in e.navigator&&e.navigator.mediaDevices&&!("getDisplayMedia"in e.navigator.mediaDevices)){var l=e.navigator.getDisplayMedia;e.navigator.mediaDevices.getDisplayMedia=function(r){return l.call(e.navigator,r)},e.navigator.getDisplayMedia=function(r){return d.deprecated("navigator.getDisplayMedia","navigator.mediaDevices.getDisplayMedia"),l.call(e.navigator,r)}}}}},function(U,Q,L){var d=L(1);U.exports=function(n,o){var e=!1;return(n=JSON.parse(JSON.stringify(n))).filter(function(c){if(c&&(c.urls||c.url)){var l=c.urls||c.url;c.url&&!c.urls&&d.deprecated("RTCIceServer.url","RTCIceServer.urls");var r=typeof l=="string";return r&&(l=[l]),l=l.filter(function(h){return h.indexOf("turn:")===0&&h.indexOf("transport=udp")!==-1&&h.indexOf("turn:[")===-1&&!e?(e=!0,!0):h.indexOf("stun:")===0&&o>=14393&&h.indexOf("?transport=udp")===-1}),delete c.url,c.urls=r?l[0]:l,!!l.length}})}},function(U,Q,L){var d=L(2);function n(r,h,C,g,s){var p=d.writeRtpDescription(r.kind,h);if(p+=d.writeIceParameters(r.iceGatherer.getLocalParameters()),p+=d.writeDtlsParameters(r.dtlsTransport.getLocalParameters(),C==="offer"?"actpass":s||"active"),p+="a=mid:"+r.mid+`\r
`,r.rtpSender&&r.rtpReceiver?p+=`a=sendrecv\r
`:r.rtpSender?p+=`a=sendonly\r
`:r.rtpReceiver?p+=`a=recvonly\r
`:p+=`a=inactive\r
`,r.rtpSender){var t=r.rtpSender._initialTrackId||r.rtpSender.track.id;r.rtpSender._initialTrackId=t;var a="msid:"+(g?g.id:"-")+" "+t+`\r
`;p+="a="+a,p+="a=ssrc:"+r.sendEncodingParameters[0].ssrc+" "+a,r.sendEncodingParameters[0].rtx&&(p+="a=ssrc:"+r.sendEncodingParameters[0].rtx.ssrc+" "+a,p+="a=ssrc-group:FID "+r.sendEncodingParameters[0].ssrc+" "+r.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return p+="a=ssrc:"+r.sendEncodingParameters[0].ssrc+" cname:"+d.localCName+`\r
`,r.rtpSender&&r.sendEncodingParameters[0].rtx&&(p+="a=ssrc:"+r.sendEncodingParameters[0].rtx.ssrc+" cname:"+d.localCName+`\r
`),p}function o(r,h){var C={codecs:[],headerExtensions:[],fecMechanisms:[]},g=function(p,t){p=parseInt(p,10);for(var a=0;a<t.length;a++)if(t[a].payloadType===p||t[a].preferredPayloadType===p)return t[a]},s=function(p,t,a,i){var f=g(p.parameters.apt,a),y=g(t.parameters.apt,i);return f&&y&&f.name.toLowerCase()===y.name.toLowerCase()};return r.codecs.forEach(function(p){for(var t=0;t<h.codecs.length;t++){var a=h.codecs[t];if(p.name.toLowerCase()===a.name.toLowerCase()&&p.clockRate===a.clockRate){if(p.name.toLowerCase()==="rtx"&&p.parameters&&a.parameters.apt&&!s(p,a,r.codecs,h.codecs))continue;(a=JSON.parse(JSON.stringify(a))).numChannels=Math.min(p.numChannels,a.numChannels),C.codecs.push(a),a.rtcpFeedback=a.rtcpFeedback.filter(function(i){for(var f=0;f<p.rtcpFeedback.length;f++)if(p.rtcpFeedback[f].type===i.type&&p.rtcpFeedback[f].parameter===i.parameter)return!0;return!1});break}}}),r.headerExtensions.forEach(function(p){for(var t=0;t<h.headerExtensions.length;t++){var a=h.headerExtensions[t];if(p.uri===a.uri){C.headerExtensions.push(a);break}}}),C}function e(r,h,C){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[h][r].indexOf(C)!==-1}function c(r,h){var C=r.getRemoteCandidates().find(function(g){return h.foundation===g.foundation&&h.ip===g.ip&&h.port===g.port&&h.priority===g.priority&&h.protocol===g.protocol&&h.type===g.type});return C||r.addRemoteCandidate(h),!C}function l(r,h){var C=new Error(h);return C.name=r,C.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[r],C}U.exports=function(r,h){function C(t,a){a.addTrack(t),a.dispatchEvent(new r.MediaStreamTrackEvent("addtrack",{track:t}))}function g(t,a,i,f){var y=new Event("track");y.track=a,y.receiver=i,y.transceiver={receiver:i},y.streams=f,r.setTimeout(function(){t._dispatchEvent("track",y)})}var s=function(t){var a=this,i=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(y){a[y]=i[y].bind(i)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",t=JSON.parse(JSON.stringify(t||{})),this.usingBundle=t.bundlePolicy==="max-bundle",t.rtcpMuxPolicy==="negotiate")throw l("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(t.rtcpMuxPolicy||(t.rtcpMuxPolicy="require"),t.iceTransportPolicy){case"all":case"relay":break;default:t.iceTransportPolicy="all"}switch(t.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:t.bundlePolicy="balanced"}if(t.iceServers=function(y,_){var R=!1;return(y=JSON.parse(JSON.stringify(y))).filter(function(O){if(O&&(O.urls||O.url)){var N=O.urls||O.url;O.url&&!O.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var A=typeof N=="string";return A&&(N=[N]),N=N.filter(function(j){return j.indexOf("turn:")===0&&j.indexOf("transport=udp")!==-1&&j.indexOf("turn:[")===-1&&!R?(R=!0,!0):j.indexOf("stun:")===0&&_>=14393&&j.indexOf("?transport=udp")===-1}),delete O.url,O.urls=A?N[0]:N,!!N.length}})}(t.iceServers||[],h),this._iceGatherers=[],t.iceCandidatePoolSize)for(var f=t.iceCandidatePoolSize;f>0;f--)this._iceGatherers.push(new r.RTCIceGatherer({iceServers:t.iceServers,gatherPolicy:t.iceTransportPolicy}));else t.iceCandidatePoolSize=0;this._config=t,this.transceivers=[],this._sdpSessionId=d.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(s.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(s.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),s.prototype.onicecandidate=null,s.prototype.onaddstream=null,s.prototype.ontrack=null,s.prototype.onremovestream=null,s.prototype.onsignalingstatechange=null,s.prototype.oniceconnectionstatechange=null,s.prototype.onconnectionstatechange=null,s.prototype.onicegatheringstatechange=null,s.prototype.onnegotiationneeded=null,s.prototype.ondatachannel=null,s.prototype._dispatchEvent=function(t,a){this._isClosed||(this.dispatchEvent(a),typeof this["on"+t]=="function"&&this["on"+t](a))},s.prototype._emitGatheringStateChange=function(){var t=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",t)},s.prototype.getConfiguration=function(){return this._config},s.prototype.getLocalStreams=function(){return this.localStreams},s.prototype.getRemoteStreams=function(){return this.remoteStreams},s.prototype._createTransceiver=function(t,a){var i=this.transceivers.length>0,f={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:t,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&i)f.iceTransport=this.transceivers[0].iceTransport,f.dtlsTransport=this.transceivers[0].dtlsTransport;else{var y=this._createIceAndDtlsTransports();f.iceTransport=y.iceTransport,f.dtlsTransport=y.dtlsTransport}return a||this.transceivers.push(f),f},s.prototype.addTrack=function(t,a){if(this._isClosed)throw l("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var i;if(this.transceivers.find(function(y){return y.track===t}))throw l("InvalidAccessError","Track already exists.");for(var f=0;f<this.transceivers.length;f++)this.transceivers[f].track||this.transceivers[f].kind!==t.kind||(i=this.transceivers[f]);return i||(i=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),this.localStreams.indexOf(a)===-1&&this.localStreams.push(a),i.track=t,i.stream=a,i.rtpSender=new r.RTCRtpSender(t,i.dtlsTransport),i.rtpSender},s.prototype.addStream=function(t){var a=this;if(h>=15025)t.getTracks().forEach(function(f){a.addTrack(f,t)});else{var i=t.clone();t.getTracks().forEach(function(f,y){var _=i.getTracks()[y];f.addEventListener("enabled",function(R){_.enabled=R.enabled})}),i.getTracks().forEach(function(f){a.addTrack(f,i)})}},s.prototype.removeTrack=function(t){if(this._isClosed)throw l("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof r.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var a=this.transceivers.find(function(f){return f.rtpSender===t});if(!a)throw l("InvalidAccessError","Sender was not created by this connection.");var i=a.stream;a.rtpSender.stop(),a.rtpSender=null,a.track=null,a.stream=null,this.transceivers.map(function(f){return f.stream}).indexOf(i)===-1&&this.localStreams.indexOf(i)>-1&&this.localStreams.splice(this.localStreams.indexOf(i),1),this._maybeFireNegotiationNeeded()},s.prototype.removeStream=function(t){var a=this;t.getTracks().forEach(function(i){var f=a.getSenders().find(function(y){return y.track===i});f&&a.removeTrack(f)})},s.prototype.getSenders=function(){return this.transceivers.filter(function(t){return!!t.rtpSender}).map(function(t){return t.rtpSender})},s.prototype.getReceivers=function(){return this.transceivers.filter(function(t){return!!t.rtpReceiver}).map(function(t){return t.rtpReceiver})},s.prototype._createIceGatherer=function(t,a){var i=this;if(a&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var f=new r.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(f,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(y){var _=!y.candidate||Object.keys(y.candidate).length===0;f.state=_?"completed":"gathering",i.transceivers[t].bufferedCandidateEvents!==null&&i.transceivers[t].bufferedCandidateEvents.push(y)},f.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),f},s.prototype._gather=function(t,a){var i=this,f=this.transceivers[a].iceGatherer;if(!f.onlocalcandidate){var y=this.transceivers[a].bufferedCandidateEvents;this.transceivers[a].bufferedCandidateEvents=null,f.removeEventListener("localcandidate",this.transceivers[a].bufferCandidates),f.onlocalcandidate=function(_){if(!(i.usingBundle&&a>0)){var R=new Event("icecandidate");R.candidate={sdpMid:t,sdpMLineIndex:a};var O=_.candidate,N=!O||Object.keys(O).length===0;if(N)f.state!=="new"&&f.state!=="gathering"||(f.state="completed");else{f.state==="new"&&(f.state="gathering"),O.component=1,O.ufrag=f.getLocalParameters().usernameFragment;var A=d.writeCandidate(O);R.candidate=Object.assign(R.candidate,d.parseCandidate(A)),R.candidate.candidate=A,R.candidate.toJSON=function(){return{candidate:R.candidate.candidate,sdpMid:R.candidate.sdpMid,sdpMLineIndex:R.candidate.sdpMLineIndex,usernameFragment:R.candidate.usernameFragment}}}var j=d.getMediaSections(i._localDescription.sdp);j[R.candidate.sdpMLineIndex]+=N?`a=end-of-candidates\r
`:"a="+R.candidate.candidate+`\r
`,i._localDescription.sdp=d.getDescription(i._localDescription.sdp)+j.join("");var re=i.transceivers.every(function(B){return B.iceGatherer&&B.iceGatherer.state==="completed"});i.iceGatheringState!=="gathering"&&(i.iceGatheringState="gathering",i._emitGatheringStateChange()),N||i._dispatchEvent("icecandidate",R),re&&(i._dispatchEvent("icecandidate",new Event("icecandidate")),i.iceGatheringState="complete",i._emitGatheringStateChange())}},r.setTimeout(function(){y.forEach(function(_){f.onlocalcandidate(_)})},0)}},s.prototype._createIceAndDtlsTransports=function(){var t=this,a=new r.RTCIceTransport(null);a.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var i=new r.RTCDtlsTransport(a);return i.ondtlsstatechange=function(){t._updateConnectionState()},i.onerror=function(){Object.defineProperty(i,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:a,dtlsTransport:i}},s.prototype._disposeIceAndDtlsTransports=function(t){var a=this.transceivers[t].iceGatherer;a&&(delete a.onlocalcandidate,delete this.transceivers[t].iceGatherer);var i=this.transceivers[t].iceTransport;i&&(delete i.onicestatechange,delete this.transceivers[t].iceTransport);var f=this.transceivers[t].dtlsTransport;f&&(delete f.ondtlsstatechange,delete f.onerror,delete this.transceivers[t].dtlsTransport)},s.prototype._transceive=function(t,a,i){var f=o(t.localCapabilities,t.remoteCapabilities);a&&t.rtpSender&&(f.encodings=t.sendEncodingParameters,f.rtcp={cname:d.localCName,compound:t.rtcpParameters.compound},t.recvEncodingParameters.length&&(f.rtcp.ssrc=t.recvEncodingParameters[0].ssrc),t.rtpSender.send(f)),i&&t.rtpReceiver&&f.codecs.length>0&&(t.kind==="video"&&t.recvEncodingParameters&&h<15019&&t.recvEncodingParameters.forEach(function(y){delete y.rtx}),t.recvEncodingParameters.length?f.encodings=t.recvEncodingParameters:f.encodings=[{}],f.rtcp={compound:t.rtcpParameters.compound},t.rtcpParameters.cname&&(f.rtcp.cname=t.rtcpParameters.cname),t.sendEncodingParameters.length&&(f.rtcp.ssrc=t.sendEncodingParameters[0].ssrc),t.rtpReceiver.receive(f))},s.prototype.setLocalDescription=function(t){var a,i,f=this;if(["offer","answer"].indexOf(t.type)===-1)return Promise.reject(l("TypeError",'Unsupported type "'+t.type+'"'));if(!e("setLocalDescription",t.type,f.signalingState)||f._isClosed)return Promise.reject(l("InvalidStateError","Can not set local "+t.type+" in state "+f.signalingState));if(t.type==="offer")a=d.splitSections(t.sdp),i=a.shift(),a.forEach(function(_,R){var O=d.parseRtpParameters(_);f.transceivers[R].localCapabilities=O}),f.transceivers.forEach(function(_,R){f._gather(_.mid,R)});else if(t.type==="answer"){a=d.splitSections(f._remoteDescription.sdp),i=a.shift();var y=d.matchPrefix(i,"a=ice-lite").length>0;a.forEach(function(_,R){var O=f.transceivers[R],N=O.iceGatherer,A=O.iceTransport,j=O.dtlsTransport,re=O.localCapabilities,B=O.remoteCapabilities;if(!(d.isRejected(_)&&d.matchPrefix(_,"a=bundle-only").length===0)&&!O.rejected){var $=d.getIceParameters(_,i),E=d.getDtlsParameters(_,i);y&&(E.role="server"),f.usingBundle&&R!==0||(f._gather(O.mid,R),A.state==="new"&&A.start(N,$,y?"controlling":"controlled"),j.state==="new"&&j.start(E));var m=o(re,B);f._transceive(O,m.codecs.length>0,!1)}})}return f._localDescription={type:t.type,sdp:t.sdp},t.type==="offer"?f._updateSignalingState("have-local-offer"):f._updateSignalingState("stable"),Promise.resolve()},s.prototype.setRemoteDescription=function(t){var a=this;if(["offer","answer"].indexOf(t.type)===-1)return Promise.reject(l("TypeError",'Unsupported type "'+t.type+'"'));if(!e("setRemoteDescription",t.type,a.signalingState)||a._isClosed)return Promise.reject(l("InvalidStateError","Can not set remote "+t.type+" in state "+a.signalingState));var i={};a.remoteStreams.forEach(function(A){i[A.id]=A});var f=[],y=d.splitSections(t.sdp),_=y.shift(),R=d.matchPrefix(_,"a=ice-lite").length>0,O=d.matchPrefix(_,"a=group:BUNDLE ").length>0;a.usingBundle=O;var N=d.matchPrefix(_,"a=ice-options:")[0];return a.canTrickleIceCandidates=!!N&&N.substr(14).split(" ").indexOf("trickle")>=0,y.forEach(function(A,j){var re=d.splitLines(A),B=d.getKind(A),$=d.isRejected(A)&&d.matchPrefix(A,"a=bundle-only").length===0,E=re[0].substr(2).split(" ")[2],m=d.getDirection(A,_),I=d.parseMsid(A),J=d.getMid(A)||d.generateIdentifier();if($||B==="application"&&(E==="DTLS/SCTP"||E==="UDP/DTLS/SCTP"))a.transceivers[j]={mid:J,kind:B,protocol:E,rejected:!0};else{var M,K,de,ve,ce,F,Y,fe,X;!$&&a.transceivers[j]&&a.transceivers[j].rejected&&(a.transceivers[j]=a._createTransceiver(B,!0));var Ce,Se,ue=d.parseRtpParameters(A);$||(Ce=d.getIceParameters(A,_),(Se=d.getDtlsParameters(A,_)).role="client"),Y=d.parseRtpEncodingParameters(A);var ge=d.parseRtcpParameters(A),Ae=d.matchPrefix(A,"a=end-of-candidates",_).length>0,Ee=d.matchPrefix(A,"a=candidate:").map(function(ie){return d.parseCandidate(ie)}).filter(function(ie){return ie.component===1});if((t.type==="offer"||t.type==="answer")&&!$&&O&&j>0&&a.transceivers[j]&&(a._disposeIceAndDtlsTransports(j),a.transceivers[j].iceGatherer=a.transceivers[0].iceGatherer,a.transceivers[j].iceTransport=a.transceivers[0].iceTransport,a.transceivers[j].dtlsTransport=a.transceivers[0].dtlsTransport,a.transceivers[j].rtpSender&&a.transceivers[j].rtpSender.setTransport(a.transceivers[0].dtlsTransport),a.transceivers[j].rtpReceiver&&a.transceivers[j].rtpReceiver.setTransport(a.transceivers[0].dtlsTransport)),t.type!=="offer"||$)t.type==="answer"&&!$&&(K=(M=a.transceivers[j]).iceGatherer,de=M.iceTransport,ve=M.dtlsTransport,ce=M.rtpReceiver,F=M.sendEncodingParameters,fe=M.localCapabilities,a.transceivers[j].recvEncodingParameters=Y,a.transceivers[j].remoteCapabilities=ue,a.transceivers[j].rtcpParameters=ge,Ee.length&&de.state==="new"&&(!R&&!Ae||O&&j!==0?Ee.forEach(function(ie){c(M.iceTransport,ie)}):de.setRemoteCandidates(Ee)),O&&j!==0||(de.state==="new"&&de.start(K,Ce,"controlling"),ve.state==="new"&&ve.start(Se)),!o(M.localCapabilities,M.remoteCapabilities).codecs.filter(function(ie){return ie.name.toLowerCase()==="rtx"}).length&&M.sendEncodingParameters[0].rtx&&delete M.sendEncodingParameters[0].rtx,a._transceive(M,m==="sendrecv"||m==="recvonly",m==="sendrecv"||m==="sendonly"),!ce||m!=="sendrecv"&&m!=="sendonly"?delete M.rtpReceiver:(X=ce.track,I?(i[I.stream]||(i[I.stream]=new r.MediaStream),C(X,i[I.stream]),f.push([X,ce,i[I.stream]])):(i.default||(i.default=new r.MediaStream),C(X,i.default),f.push([X,ce,i.default]))));else{(M=a.transceivers[j]||a._createTransceiver(B)).mid=J,M.iceGatherer||(M.iceGatherer=a._createIceGatherer(j,O)),Ee.length&&M.iceTransport.state==="new"&&(!Ae||O&&j!==0?Ee.forEach(function(ie){c(M.iceTransport,ie)}):M.iceTransport.setRemoteCandidates(Ee)),fe=r.RTCRtpReceiver.getCapabilities(B),h<15019&&(fe.codecs=fe.codecs.filter(function(ie){return ie.name!=="rtx"})),F=M.sendEncodingParameters||[{ssrc:1001*(2*j+2)}];var _e,W=!1;m==="sendrecv"||m==="sendonly"?(W=!M.rtpReceiver,ce=M.rtpReceiver||new r.RTCRtpReceiver(M.dtlsTransport,B),W&&(X=ce.track,I&&I.stream==="-"||(I?(i[I.stream]||(i[I.stream]=new r.MediaStream,Object.defineProperty(i[I.stream],"id",{get:function(){return I.stream}})),Object.defineProperty(X,"id",{get:function(){return I.track}}),_e=i[I.stream]):(i.default||(i.default=new r.MediaStream),_e=i.default)),_e&&(C(X,_e),M.associatedRemoteMediaStreams.push(_e)),f.push([X,ce,_e]))):M.rtpReceiver&&M.rtpReceiver.track&&(M.associatedRemoteMediaStreams.forEach(function(ie){var Ie=ie.getTracks().find(function(ke){return ke.id===M.rtpReceiver.track.id});Ie&&function(ke,Te){Te.removeTrack(ke),Te.dispatchEvent(new r.MediaStreamTrackEvent("removetrack",{track:ke}))}(Ie,ie)}),M.associatedRemoteMediaStreams=[]),M.localCapabilities=fe,M.remoteCapabilities=ue,M.rtpReceiver=ce,M.rtcpParameters=ge,M.sendEncodingParameters=F,M.recvEncodingParameters=Y,a._transceive(a.transceivers[j],!1,W)}}}),a._dtlsRole===void 0&&(a._dtlsRole=t.type==="offer"?"active":"passive"),a._remoteDescription={type:t.type,sdp:t.sdp},t.type==="offer"?a._updateSignalingState("have-remote-offer"):a._updateSignalingState("stable"),Object.keys(i).forEach(function(A){var j=i[A];if(j.getTracks().length){if(a.remoteStreams.indexOf(j)===-1){a.remoteStreams.push(j);var re=new Event("addstream");re.stream=j,r.setTimeout(function(){a._dispatchEvent("addstream",re)})}f.forEach(function(B){var $=B[0],E=B[1];j.id===B[2].id&&g(a,$,E,[j])})}}),f.forEach(function(A){A[2]||g(a,A[0],A[1],[])}),r.setTimeout(function(){a&&a.transceivers&&a.transceivers.forEach(function(A){A.iceTransport&&A.iceTransport.state==="new"&&A.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),A.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},s.prototype.close=function(){this.transceivers.forEach(function(t){t.iceTransport&&t.iceTransport.stop(),t.dtlsTransport&&t.dtlsTransport.stop(),t.rtpSender&&t.rtpSender.stop(),t.rtpReceiver&&t.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},s.prototype._updateSignalingState=function(t){this.signalingState=t;var a=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",a)},s.prototype._maybeFireNegotiationNeeded=function(){var t=this;this.signalingState==="stable"&&this.needNegotiation!==!0&&(this.needNegotiation=!0,r.setTimeout(function(){if(t.needNegotiation){t.needNegotiation=!1;var a=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",a)}},0))},s.prototype._updateIceConnectionState=function(){var t,a={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(f){f.iceTransport&&!f.rejected&&a[f.iceTransport.state]++}),t="new",a.failed>0?t="failed":a.checking>0?t="checking":a.disconnected>0?t="disconnected":a.new>0?t="new":a.connected>0?t="connected":a.completed>0&&(t="completed"),t!==this.iceConnectionState){this.iceConnectionState=t;var i=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",i)}},s.prototype._updateConnectionState=function(){var t,a={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(f){f.iceTransport&&f.dtlsTransport&&!f.rejected&&(a[f.iceTransport.state]++,a[f.dtlsTransport.state]++)}),a.connected+=a.completed,t="new",a.failed>0?t="failed":a.connecting>0?t="connecting":a.disconnected>0?t="disconnected":a.new>0?t="new":a.connected>0&&(t="connected"),t!==this.connectionState){this.connectionState=t;var i=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",i)}},s.prototype.createOffer=function(){var t=this;if(t._isClosed)return Promise.reject(l("InvalidStateError","Can not call createOffer after close"));var a=t.transceivers.filter(function(R){return R.kind==="audio"}).length,i=t.transceivers.filter(function(R){return R.kind==="video"}).length,f=arguments[0];if(f){if(f.mandatory||f.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");f.offerToReceiveAudio!==void 0&&(a=f.offerToReceiveAudio===!0?1:f.offerToReceiveAudio===!1?0:f.offerToReceiveAudio),f.offerToReceiveVideo!==void 0&&(i=f.offerToReceiveVideo===!0?1:f.offerToReceiveVideo===!1?0:f.offerToReceiveVideo)}for(t.transceivers.forEach(function(R){R.kind==="audio"?--a<0&&(R.wantReceive=!1):R.kind==="video"&&--i<0&&(R.wantReceive=!1)});a>0||i>0;)a>0&&(t._createTransceiver("audio"),a--),i>0&&(t._createTransceiver("video"),i--);var y=d.writeSessionBoilerplate(t._sdpSessionId,t._sdpSessionVersion++);t.transceivers.forEach(function(R,O){var N=R.track,A=R.kind,j=R.mid||d.generateIdentifier();R.mid=j,R.iceGatherer||(R.iceGatherer=t._createIceGatherer(O,t.usingBundle));var re=r.RTCRtpSender.getCapabilities(A);h<15019&&(re.codecs=re.codecs.filter(function($){return $.name!=="rtx"})),re.codecs.forEach(function($){$.name==="H264"&&$.parameters["level-asymmetry-allowed"]===void 0&&($.parameters["level-asymmetry-allowed"]="1"),R.remoteCapabilities&&R.remoteCapabilities.codecs&&R.remoteCapabilities.codecs.forEach(function(E){$.name.toLowerCase()===E.name.toLowerCase()&&$.clockRate===E.clockRate&&($.preferredPayloadType=E.payloadType)})}),re.headerExtensions.forEach(function($){(R.remoteCapabilities&&R.remoteCapabilities.headerExtensions||[]).forEach(function(E){$.uri===E.uri&&($.id=E.id)})});var B=R.sendEncodingParameters||[{ssrc:1001*(2*O+1)}];N&&h>=15019&&A==="video"&&!B[0].rtx&&(B[0].rtx={ssrc:B[0].ssrc+1}),R.wantReceive&&(R.rtpReceiver=new r.RTCRtpReceiver(R.dtlsTransport,A)),R.localCapabilities=re,R.sendEncodingParameters=B}),t._config.bundlePolicy!=="max-compat"&&(y+="a=group:BUNDLE "+t.transceivers.map(function(R){return R.mid}).join(" ")+`\r
`),y+=`a=ice-options:trickle\r
`,t.transceivers.forEach(function(R,O){y+=n(R,R.localCapabilities,"offer",R.stream,t._dtlsRole),y+=`a=rtcp-rsize\r
`,!R.iceGatherer||t.iceGatheringState==="new"||O!==0&&t.usingBundle||(R.iceGatherer.getLocalCandidates().forEach(function(N){N.component=1,y+="a="+d.writeCandidate(N)+`\r
`}),R.iceGatherer.state==="completed"&&(y+=`a=end-of-candidates\r
`))});var _=new r.RTCSessionDescription({type:"offer",sdp:y});return Promise.resolve(_)},s.prototype.createAnswer=function(){var t=this;if(t._isClosed)return Promise.reject(l("InvalidStateError","Can not call createAnswer after close"));if(t.signalingState!=="have-remote-offer"&&t.signalingState!=="have-local-pranswer")return Promise.reject(l("InvalidStateError","Can not call createAnswer in signalingState "+t.signalingState));var a=d.writeSessionBoilerplate(t._sdpSessionId,t._sdpSessionVersion++);t.usingBundle&&(a+="a=group:BUNDLE "+t.transceivers.map(function(y){return y.mid}).join(" ")+`\r
`),a+=`a=ice-options:trickle\r
`;var i=d.getMediaSections(t._remoteDescription.sdp).length;t.transceivers.forEach(function(y,_){if(!(_+1>i)){if(y.rejected)return y.kind==="application"?y.protocol==="DTLS/SCTP"?a+=`m=application 0 DTLS/SCTP 5000\r
`:a+="m=application 0 "+y.protocol+` webrtc-datachannel\r
`:y.kind==="audio"?a+=`m=audio 0 UDP/TLS/RTP/SAVPF 0\r
a=rtpmap:0 PCMU/8000\r
`:y.kind==="video"&&(a+=`m=video 0 UDP/TLS/RTP/SAVPF 120\r
a=rtpmap:120 VP8/90000\r
`),void(a+=`c=IN IP4 0.0.0.0\r
a=inactive\r
a=mid:`+y.mid+`\r
`);var R;y.stream&&(y.kind==="audio"?R=y.stream.getAudioTracks()[0]:y.kind==="video"&&(R=y.stream.getVideoTracks()[0]),R&&h>=15019&&y.kind==="video"&&!y.sendEncodingParameters[0].rtx&&(y.sendEncodingParameters[0].rtx={ssrc:y.sendEncodingParameters[0].ssrc+1}));var O=o(y.localCapabilities,y.remoteCapabilities);!O.codecs.filter(function(N){return N.name.toLowerCase()==="rtx"}).length&&y.sendEncodingParameters[0].rtx&&delete y.sendEncodingParameters[0].rtx,a+=n(y,O,"answer",y.stream,t._dtlsRole),y.rtcpParameters&&y.rtcpParameters.reducedSize&&(a+=`a=rtcp-rsize\r
`)}});var f=new r.RTCSessionDescription({type:"answer",sdp:a});return Promise.resolve(f)},s.prototype.addIceCandidate=function(t){var a,i=this;return t&&t.sdpMLineIndex===void 0&&!t.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(f,y){if(!i._remoteDescription)return y(l("InvalidStateError","Can not add ICE candidate without a remote description"));if(t&&t.candidate!==""){var _=t.sdpMLineIndex;if(t.sdpMid){for(var R=0;R<i.transceivers.length;R++)if(i.transceivers[R].mid===t.sdpMid){_=R;break}}var O=i.transceivers[_];if(!O)return y(l("OperationError","Can not add ICE candidate"));if(O.rejected)return f();var N=Object.keys(t.candidate).length>0?d.parseCandidate(t.candidate):{};if(N.protocol==="tcp"&&(N.port===0||N.port===9)||N.component&&N.component!==1)return f();if((_===0||_>0&&O.iceTransport!==i.transceivers[0].iceTransport)&&!c(O.iceTransport,N))return y(l("OperationError","Can not add ICE candidate"));var A=t.candidate.trim();A.indexOf("a=")===0&&(A=A.substr(2)),(a=d.getMediaSections(i._remoteDescription.sdp))[_]+="a="+(N.type?A:"end-of-candidates")+`\r
`,i._remoteDescription.sdp=d.getDescription(i._remoteDescription.sdp)+a.join("")}else for(var j=0;j<i.transceivers.length&&(i.transceivers[j].rejected||(i.transceivers[j].iceTransport.addRemoteCandidate({}),(a=d.getMediaSections(i._remoteDescription.sdp))[j]+=`a=end-of-candidates\r
`,i._remoteDescription.sdp=d.getDescription(i._remoteDescription.sdp)+a.join(""),!i.usingBundle));j++);f()})},s.prototype.getStats=function(t){if(t&&t instanceof r.MediaStreamTrack){var a=null;if(this.transceivers.forEach(function(f){f.rtpSender&&f.rtpSender.track===t?a=f.rtpSender:f.rtpReceiver&&f.rtpReceiver.track===t&&(a=f.rtpReceiver)}),!a)throw l("InvalidAccessError","Invalid selector.");return a.getStats()}var i=[];return this.transceivers.forEach(function(f){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(y){f[y]&&i.push(f[y].getStats())})}),Promise.all(i).then(function(f){var y=new Map;return f.forEach(function(_){_.forEach(function(R){y.set(R.id,R)})}),y})},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(t){var a=r[t];if(a&&a.prototype&&a.prototype.getStats){var i=a.prototype.getStats;a.prototype.getStats=function(){return i.apply(this).then(function(f){var y=new Map;return Object.keys(f).forEach(function(_){var R;f[_].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(R=f[_]).type]||R.type,y.set(_,f[_])}),y})}}});var p=["createOffer","createAnswer"];return p.forEach(function(t){var a=s.prototype[t];s.prototype[t]=function(){var i=arguments;return typeof i[0]=="function"||typeof i[1]=="function"?a.apply(this,[arguments[2]]).then(function(f){typeof i[0]=="function"&&i[0].apply(null,[f])},function(f){typeof i[1]=="function"&&i[1].apply(null,[f])}):a.apply(this,arguments)}}),(p=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(t){var a=s.prototype[t];s.prototype[t]=function(){var i=arguments;return typeof i[1]=="function"||typeof i[2]=="function"?a.apply(this,arguments).then(function(){typeof i[1]=="function"&&i[1].apply(null)},function(f){typeof i[2]=="function"&&i[2].apply(null,[f])}):a.apply(this,arguments)}}),["getStats"].forEach(function(t){var a=s.prototype[t];s.prototype[t]=function(){var i=arguments;return typeof i[1]=="function"?a.apply(this,arguments).then(function(){typeof i[1]=="function"&&i[1].apply(null)}):a.apply(this,arguments)}}),s}},function(U,Q,L){U.exports=function(d){var n=d&&d.navigator,o=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(e){return o(e).catch(function(c){return Promise.reject(function(l){return{name:{PermissionDeniedError:"NotAllowedError"}[l.name]||l.name,message:l.message,constraint:l.constraint,toString:function(){return this.name}}}(c))})}}},function(U,Q,L){var d=L(1);U.exports={shimGetUserMedia:L(14),shimOnTrack:function(n){typeof n=="object"&&n.RTCPeerConnection&&!("ontrack"in n.RTCPeerConnection.prototype)&&Object.defineProperty(n.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(o){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=o),this.addEventListener("addstream",this._ontrackpoly=(function(e){e.stream.getTracks().forEach((function(c){var l=new Event("track");l.track=c,l.receiver={track:c},l.transceiver={receiver:l.receiver},l.streams=[e.stream],this.dispatchEvent(l)}).bind(this))}).bind(this))},enumerable:!0,configurable:!0}),typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimSourceObject:function(n){typeof n=="object"&&n.HTMLMediaElement&&!("srcObject"in n.HTMLMediaElement.prototype)&&Object.defineProperty(n.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(o){this.mozSrcObject=o}})},shimPeerConnection:function(n){var o=d.detectBrowser(n);if(typeof n=="object"&&(n.RTCPeerConnection||n.mozRTCPeerConnection)){n.RTCPeerConnection||(n.RTCPeerConnection=function(r,h){if(o.version<38&&r&&r.iceServers){for(var C=[],g=0;g<r.iceServers.length;g++){var s=r.iceServers[g];if(s.hasOwnProperty("urls"))for(var p=0;p<s.urls.length;p++){var t={url:s.urls[p]};s.urls[p].indexOf("turn")===0&&(t.username=s.username,t.credential=s.credential),C.push(t)}else C.push(r.iceServers[g])}r.iceServers=C}return new n.mozRTCPeerConnection(r,h)},n.RTCPeerConnection.prototype=n.mozRTCPeerConnection.prototype,n.mozRTCPeerConnection.generateCertificate&&Object.defineProperty(n.RTCPeerConnection,"generateCertificate",{get:function(){return n.mozRTCPeerConnection.generateCertificate}}),n.RTCSessionDescription=n.mozRTCSessionDescription,n.RTCIceCandidate=n.mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){var h=n.RTCPeerConnection.prototype[r];n.RTCPeerConnection.prototype[r]=function(){return arguments[0]=new(r==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),h.apply(this,arguments)}});var e=n.RTCPeerConnection.prototype.addIceCandidate;n.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?e.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var c={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},l=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(r,h,C){return l.apply(this,[r||null]).then(function(g){if(o.version<48&&(g=function(s){var p=new Map;return Object.keys(s).forEach(function(t){p.set(t,s[t]),p[t]=s[t]}),p}(g)),o.version<53&&!h)try{g.forEach(function(s){s.type=c[s.type]||s.type})}catch(s){if(s.name!=="TypeError")throw s;g.forEach(function(p,t){g.set(t,Object.assign({},p,{type:c[p.type]||p.type}))})}return g}).then(h,C)}}},shimSenderGetStats:function(n){if(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender&&(!n.RTCRtpSender||!("getStats"in n.RTCRtpSender.prototype))){var o=n.RTCPeerConnection.prototype.getSenders;o&&(n.RTCPeerConnection.prototype.getSenders=function(){var c=this,l=o.apply(c,[]);return l.forEach(function(r){r._pc=c}),l});var e=n.RTCPeerConnection.prototype.addTrack;e&&(n.RTCPeerConnection.prototype.addTrack=function(){var c=e.apply(this,arguments);return c._pc=this,c}),n.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}},shimReceiverGetStats:function(n){if(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender&&(!n.RTCRtpSender||!("getStats"in n.RTCRtpReceiver.prototype))){var o=n.RTCPeerConnection.prototype.getReceivers;o&&(n.RTCPeerConnection.prototype.getReceivers=function(){var e=this,c=o.apply(e,[]);return c.forEach(function(l){l._pc=e}),c}),d.wrapPeerConnectionEvent(n,"track",function(e){return e.receiver._pc=e.srcElement,e}),n.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}},shimRemoveStream:function(n){n.RTCPeerConnection&&!("removeStream"in n.RTCPeerConnection.prototype)&&(n.RTCPeerConnection.prototype.removeStream=function(o){var e=this;d.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(c){c.track&&o.getTracks().indexOf(c.track)!==-1&&e.removeTrack(c)})})},shimRTCDataChannel:function(n){n.DataChannel&&!n.RTCDataChannel&&(n.RTCDataChannel=n.DataChannel)},shimGetDisplayMedia:function(n,o){n.navigator&&n.navigator.mediaDevices&&!("getDisplayMedia"in n.navigator.mediaDevices)&&(n.navigator.mediaDevices.getDisplayMedia=function(e){if(!e||!e.video){var c=new DOMException("getDisplayMedia without video constraints is undefined");return c.name="NotFoundError",c.code=8,Promise.reject(c)}return e.video===!0?e.video={mediaSource:o}:e.video.mediaSource=o,n.navigator.mediaDevices.getUserMedia(e)},n.navigator.getDisplayMedia=function(e){return d.deprecated("navigator.getDisplayMedia","navigator.mediaDevices.getDisplayMedia"),n.navigator.mediaDevices.getDisplayMedia(e)})}}},function(U,Q,L){var d=L(1),n=d.log;U.exports=function(o){var e=d.detectBrowser(o),c=o&&o.navigator,l=o&&o.MediaStreamTrack,r=function(i){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[i.name]||i.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[i.message]||i.message,constraint:i.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},h=function(i,f,y){var _=function(R){if(typeof R!="object"||R.require)return R;var O=[];return Object.keys(R).forEach(function(N){if(N!=="require"&&N!=="advanced"&&N!=="mediaSource"){var A=R[N]=typeof R[N]=="object"?R[N]:{ideal:R[N]};if(A.min===void 0&&A.max===void 0&&A.exact===void 0||O.push(N),A.exact!==void 0&&(typeof A.exact=="number"?A.min=A.max=A.exact:R[N]=A.exact,delete A.exact),A.ideal!==void 0){R.advanced=R.advanced||[];var j={};typeof A.ideal=="number"?j[N]={min:A.ideal,max:A.ideal}:j[N]=A.ideal,R.advanced.push(j),delete A.ideal,Object.keys(A).length||delete R[N]}}}),O.length&&(R.require=O),R};return i=JSON.parse(JSON.stringify(i)),e.version<38&&(n("spec: "+JSON.stringify(i)),i.audio&&(i.audio=_(i.audio)),i.video&&(i.video=_(i.video)),n("ff37: "+JSON.stringify(i))),c.mozGetUserMedia(i,f,function(R){y(r(R))})};if(c.mediaDevices||(c.mediaDevices={getUserMedia:function(i){return new Promise(function(f,y){h(i,f,y)})},addEventListener:function(){},removeEventListener:function(){}}),c.mediaDevices.enumerateDevices=c.mediaDevices.enumerateDevices||function(){return new Promise(function(i){i([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},e.version<41){var C=c.mediaDevices.enumerateDevices.bind(c.mediaDevices);c.mediaDevices.enumerateDevices=function(){return C().then(void 0,function(i){if(i.name==="NotFoundError")return[];throw i})}}if(e.version<49){var g=c.mediaDevices.getUserMedia.bind(c.mediaDevices);c.mediaDevices.getUserMedia=function(i){return g(i).then(function(f){if(i.audio&&!f.getAudioTracks().length||i.video&&!f.getVideoTracks().length)throw f.getTracks().forEach(function(y){y.stop()}),new DOMException("The object can not be found here.","NotFoundError");return f},function(f){return Promise.reject(r(f))})}}if(!(e.version>55&&"autoGainControl"in c.mediaDevices.getSupportedConstraints())){var s=function(i,f,y){f in i&&!(y in i)&&(i[y]=i[f],delete i[f])},p=c.mediaDevices.getUserMedia.bind(c.mediaDevices);if(c.mediaDevices.getUserMedia=function(i){return typeof i=="object"&&typeof i.audio=="object"&&(i=JSON.parse(JSON.stringify(i)),s(i.audio,"autoGainControl","mozAutoGainControl"),s(i.audio,"noiseSuppression","mozNoiseSuppression")),p(i)},l&&l.prototype.getSettings){var t=l.prototype.getSettings;l.prototype.getSettings=function(){var i=t.apply(this,arguments);return s(i,"mozAutoGainControl","autoGainControl"),s(i,"mozNoiseSuppression","noiseSuppression"),i}}if(l&&l.prototype.applyConstraints){var a=l.prototype.applyConstraints;l.prototype.applyConstraints=function(i){return this.kind==="audio"&&typeof i=="object"&&(i=JSON.parse(JSON.stringify(i)),s(i,"autoGainControl","mozAutoGainControl"),s(i,"noiseSuppression","mozNoiseSuppression")),a.apply(this,[i])}}}c.getUserMedia=function(i,f,y){if(e.version<44)return h(i,f,y);d.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),c.mediaDevices.getUserMedia(i).then(f,y)}}},function(U,Q,L){var d=L(1);U.exports={shimLocalStreamsAPI:function(n){if(typeof n=="object"&&n.RTCPeerConnection){if("getLocalStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),"getStreamById"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getStreamById=function(e){var c=null;return this._localStreams&&this._localStreams.forEach(function(l){l.id===e&&(c=l)}),this._remoteStreams&&this._remoteStreams.forEach(function(l){l.id===e&&(c=l)}),c}),!("addStream"in n.RTCPeerConnection.prototype)){var o=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.indexOf(e)===-1&&this._localStreams.push(e);var c=this;e.getTracks().forEach(function(l){o.call(c,l,e)})},n.RTCPeerConnection.prototype.addTrack=function(e,c){return c&&(this._localStreams?this._localStreams.indexOf(c)===-1&&this._localStreams.push(c):this._localStreams=[c]),o.call(this,e,c)}}"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);var c=this._localStreams.indexOf(e);if(c!==-1){this._localStreams.splice(c,1);var l=this,r=e.getTracks();this.getSenders().forEach(function(h){r.indexOf(h.track)!==-1&&l.removeTrack(h)})}})}},shimRemoteStreamsAPI:function(n){if(typeof n=="object"&&n.RTCPeerConnection&&("getRemoteStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in n.RTCPeerConnection.prototype))){Object.defineProperty(n.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){this._onaddstream&&this.removeEventListener("addstream",this._onaddstream),this.addEventListener("addstream",this._onaddstream=e)}});var o=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(c){c.streams.forEach(function(l){if(e._remoteStreams||(e._remoteStreams=[]),!(e._remoteStreams.indexOf(l)>=0)){e._remoteStreams.push(l);var r=new Event("addstream");r.stream=l,e.dispatchEvent(r)}})}),o.apply(e,arguments)}}},shimCallbacksAPI:function(n){if(typeof n=="object"&&n.RTCPeerConnection){var o=n.RTCPeerConnection.prototype,e=o.createOffer,c=o.createAnswer,l=o.setLocalDescription,r=o.setRemoteDescription,h=o.addIceCandidate;o.createOffer=function(g,s){var p=arguments.length>=2?arguments[2]:arguments[0],t=e.apply(this,[p]);return s?(t.then(g,s),Promise.resolve()):t},o.createAnswer=function(g,s){var p=arguments.length>=2?arguments[2]:arguments[0],t=c.apply(this,[p]);return s?(t.then(g,s),Promise.resolve()):t};var C=function(g,s,p){var t=l.apply(this,[g]);return p?(t.then(s,p),Promise.resolve()):t};o.setLocalDescription=C,C=function(g,s,p){var t=r.apply(this,[g]);return p?(t.then(s,p),Promise.resolve()):t},o.setRemoteDescription=C,C=function(g,s,p){var t=h.apply(this,[g]);return p?(t.then(s,p),Promise.resolve()):t},o.addIceCandidate=C}},shimGetUserMedia:function(n){var o=n&&n.navigator;o.getUserMedia||(o.webkitGetUserMedia?o.getUserMedia=o.webkitGetUserMedia.bind(o):o.mediaDevices&&o.mediaDevices.getUserMedia&&(o.getUserMedia=(function(e,c,l){o.mediaDevices.getUserMedia(e).then(c,l)}).bind(o)))},shimRTCIceServerUrls:function(n){var o=n.RTCPeerConnection;n.RTCPeerConnection=function(e,c){if(e&&e.iceServers){for(var l=[],r=0;r<e.iceServers.length;r++){var h=e.iceServers[r];!h.hasOwnProperty("urls")&&h.hasOwnProperty("url")?(d.deprecated("RTCIceServer.url","RTCIceServer.urls"),(h=JSON.parse(JSON.stringify(h))).urls=h.url,delete h.url,l.push(h)):l.push(e.iceServers[r])}e.iceServers=l}return new o(e,c)},n.RTCPeerConnection.prototype=o.prototype,"generateCertificate"in n.RTCPeerConnection&&Object.defineProperty(n.RTCPeerConnection,"generateCertificate",{get:function(){return o.generateCertificate}})},shimTrackEventTransceiver:function(n){typeof n=="object"&&n.RTCPeerConnection&&"receiver"in n.RTCTrackEvent.prototype&&!n.RTCTransceiver&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimCreateOfferLegacy:function(n){var o=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(e){var c=this;if(e){e.offerToReceiveAudio!==void 0&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var l=c.getTransceivers().find(function(h){return h.sender.track&&h.sender.track.kind==="audio"});e.offerToReceiveAudio===!1&&l?l.direction==="sendrecv"?l.setDirection?l.setDirection("sendonly"):l.direction="sendonly":l.direction==="recvonly"&&(l.setDirection?l.setDirection("inactive"):l.direction="inactive"):e.offerToReceiveAudio!==!0||l||c.addTransceiver("audio"),e.offerToReceiveVideo!==void 0&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var r=c.getTransceivers().find(function(h){return h.sender.track&&h.sender.track.kind==="video"});e.offerToReceiveVideo===!1&&r?r.direction==="sendrecv"?r.setDirection("sendonly"):r.direction==="recvonly"&&r.setDirection("inactive"):e.offerToReceiveVideo!==!0||r||c.addTransceiver("video")}return o.apply(c,arguments)}}}},function(U,Q,L){var d=L(2),n=L(1);U.exports={shimRTCIceCandidate:function(o){if(!(!o.RTCIceCandidate||o.RTCIceCandidate&&"foundation"in o.RTCIceCandidate.prototype)){var e=o.RTCIceCandidate;o.RTCIceCandidate=function(c){if(typeof c=="object"&&c.candidate&&c.candidate.indexOf("a=")===0&&((c=JSON.parse(JSON.stringify(c))).candidate=c.candidate.substr(2)),c.candidate&&c.candidate.length){var l=new e(c),r=d.parseCandidate(c.candidate),h=Object.assign(l,r);return h.toJSON=function(){return{candidate:h.candidate,sdpMid:h.sdpMid,sdpMLineIndex:h.sdpMLineIndex,usernameFragment:h.usernameFragment}},h}return new e(c)},o.RTCIceCandidate.prototype=e.prototype,n.wrapPeerConnectionEvent(o,"icecandidate",function(c){return c.candidate&&Object.defineProperty(c,"candidate",{value:new o.RTCIceCandidate(c.candidate),writable:"false"}),c})}},shimCreateObjectURL:function(o){var e=o&&o.URL;if(typeof o=="object"&&o.HTMLMediaElement&&"srcObject"in o.HTMLMediaElement.prototype&&e.createObjectURL&&e.revokeObjectURL){var c=e.createObjectURL.bind(e),l=e.revokeObjectURL.bind(e),r=new Map,h=0;e.createObjectURL=function(s){if("getTracks"in s){var p="polyblob:"+ ++h;return r.set(p,s),n.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream"),p}return c(s)},e.revokeObjectURL=function(s){l(s),r.delete(s)};var C=Object.getOwnPropertyDescriptor(o.HTMLMediaElement.prototype,"src");Object.defineProperty(o.HTMLMediaElement.prototype,"src",{get:function(){return C.get.apply(this)},set:function(s){return this.srcObject=r.get(s)||null,C.set.apply(this,[s])}});var g=o.HTMLMediaElement.prototype.setAttribute;o.HTMLMediaElement.prototype.setAttribute=function(){return arguments.length===2&&(""+arguments[0]).toLowerCase()==="src"&&(this.srcObject=r.get(arguments[1])||null),g.apply(this,arguments)}}},shimMaxMessageSize:function(o){if(!o.RTCSctpTransport&&o.RTCPeerConnection){var e=n.detectBrowser(o);"sctp"in o.RTCPeerConnection.prototype||Object.defineProperty(o.RTCPeerConnection.prototype,"sctp",{get:function(){return this._sctp===void 0?null:this._sctp}});var c=function(g){var s=d.splitSections(g.sdp);return s.shift(),s.some(function(p){var t=d.parseMLine(p);return t&&t.kind==="application"&&t.protocol.indexOf("SCTP")!==-1})},l=function(g){var s=g.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(s===null||s.length<2)return-1;var p=parseInt(s[1],10);return p!=p?-1:p},r=function(g){var s=65536;return e.browser==="firefox"&&(s=e.version<57?g===-1?16384:2147483637:e.version<60?e.version===57?65535:65536:2147483637),s},h=function(g,s){var p=65536;e.browser==="firefox"&&e.version===57&&(p=65535);var t=d.matchPrefix(g.sdp,"a=max-message-size:");return t.length>0?p=parseInt(t[0].substr(19),10):e.browser==="firefox"&&s!==-1&&(p=2147483637),p},C=o.RTCPeerConnection.prototype.setRemoteDescription;o.RTCPeerConnection.prototype.setRemoteDescription=function(){var g=this;if(g._sctp=null,c(arguments[0])){var s,p=l(arguments[0]),t=r(p),a=h(arguments[0],p);s=t===0&&a===0?Number.POSITIVE_INFINITY:t===0||a===0?Math.max(t,a):Math.min(t,a);var i={};Object.defineProperty(i,"maxMessageSize",{get:function(){return s}}),g._sctp=i}return C.apply(g,arguments)}}},shimSendThrowTypeError:function(o){if(o.RTCPeerConnection&&"createDataChannel"in o.RTCPeerConnection.prototype){var e=o.RTCPeerConnection.prototype.createDataChannel;o.RTCPeerConnection.prototype.createDataChannel=function(){var l=this,r=e.apply(l,arguments);return c(r,l),r},n.wrapPeerConnectionEvent(o,"datachannel",function(l){return c(l.channel,l.target),l})}function c(l,r){var h=l.send;l.send=function(){var C=arguments[0],g=C.length||C.size||C.byteLength;if(l.readyState==="open"&&r.sctp&&g>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return h.apply(l,arguments)}}}}},function(U,Q,L){L.r(Q),typeof console<"u"&&console.log!==void 0||(console={log:function(){}});var d=function(){},n=function(){},o=function(){},e=function(){},c=function(){},l=function(){};l=console.error.bind(console);var r={trace:d,debug:n,vdebug:o,log:e,warn:c,error:l},h=L(0),C=L.n(h);function g(u){return(g=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(S){return typeof S}:function(S){return S&&typeof Symbol=="function"&&S.constructor===Symbol&&S!==Symbol.prototype?"symbol":typeof S})(u)}var s=null,p=null,t=null,a=!1,i=null,f=null,y=null,_=function(u){switch(u.response){case"keepalive":r.vdebug("Got a keepalive");break;case"ack":r.debug("Got an ack"),r.debug(u);break;case"success":r.debug("Got a success"),r.debug(u),f(u);break;case"closed":r.debug("Got a closed connection"),r.debug(u),y();break;case"offline":r.debug("Connection is offline, token expired"),r.debug(u),p("offline");break;case"trickle":if(!F()&&!Y())return void r.debug("This handle is not attached to this session");var S=u.candidate,v=i.webrtcConfig;r.debug("Got a trickled candidate"),r.debug(S),v.pc&&v.remoteSdp?(r.debug("Adding remote candidate:",S),S&&S.completed!==!0?v.pc.addIceCandidate(new RTCIceCandidate(S)):v.pc.addIceCandidate()):(r.debug("We didn't do setRemoteDescription (trickle got here before the offer?), caching candidate"),v.candidates||(v.candidates=[]),v.candidates.push(S),r.debug(v.candidates));break;case"webrtcup":if(!F())return void r.debug("This handle is not attached");i.webrtcState(!0);break;case"hangup":if(r.debug("Got a hangup event"),r.debug(u),!F())return void r.debug("This handle is not attached");i.webrtcState(!1,u.reason),i.hangup();break;case"media":if(r.debug("Got a media event"),r.debug(u),!F())return void r.debug("This handle is not attached");i.mediaState(u.type,u.receiving);break;case"slowlink":if(r.debug("Got a slowlink event"),r.debug(u),!F())return void r.debug("This handle is not attached");i.slowLink(u.uplink,u.nacks);break;case"error":r.error("AfricasTalking Client Error: "+u.error.code+" "+u.error.reason),r.debug(u);break;case"event":if(r.log("Got an event"),r.log(u),u.eventdata===void 0||u.eventdata===null)return void r.warn("Missing eventdata...");if(r.log(u.eventdata),!F())return void r.warn("This handle is not attachedddd");u.jsep!==void 0&&u.jsep!==null&&(r.log("Handling SDP as well..."),r.log(u.jsep)),i.onmessage!==null&&i.onmessage!==void 0?(r.log("Notifying application..."),i.onmessage(u.eventdata,u.jsep)):r.debug("No provided notification callback");break;default:r.warn("Unknown message/event  "+u),r.debug(u)}},R=function(u){if(!a)return r.warn("Is the gateway down? (connected=false)"),void u.error("Is the gateway down? (connected=false)");if(!F()&&!Y())return r.warn("Invalid handle"),void u.error("Invalid handle");var S=u.message,v=u.jsep,b={command:"message",body:S};v!=null&&(b.jsep=v),r.debug("Sending message to web socket"),r.debug(b),r.debug("Sending a request to Africa's Talking"+b),s.send(JSON.stringify(b))},O=function(u){if(!F()&&!Y())return r.warn("Invalid handle"),void u.error("Invalid handle");var S=i.webrtcConfig,v=u.text;if(v==null)return r.warn("Invalid text"),void u.error("Invalid text");r.log("Sending string on data channel: "+v),S.dataChannel.send(v),u.success()},N=function(u){var S=u.jsep;u.media=u.media||{audio:!0};var v=u.media;if(!F()&&!Y())return r.warn("Invalid handle"),void u.error("Invalid handle");var b=i.webrtcConfig;if(b.pc===void 0||b.pc===null)r.log("Creating a new media session"),v.update=!1;else if(b.pc!==void 0&&b.pc!==null)if(r.log("Updating existing media session"),v.update=!0,u.stream!==null&&u.stream!==void 0)u.stream!==b.myStream&&r.log("Renegotiation involves a new external stream");else{if(v.addAudio){if(v.replaceAudio=!1,v.removeAudio=!1,v.audioSend=!0,b.myStream&&b.myStream.getAudioTracks()&&b.myStream.getAudioTracks().length)return r.error("AfricasTalking Client Error: Can't add audio stream, there already is one"),void u.error("AfricasTalking Client Error: Can't add audio stream, there already is one")}else v.removeAudio?(v.replaceAudio=!1,v.addAudio=!1,v.audioSend=!1):v.replaceAudio&&(v.addAudio=!1,v.removeAudio=!1,v.audioSend=!0);b.myStream===null||b.myStream===void 0?(v.replaceAudio&&(v.replaceAudio=!1,v.addAudio=!0,v.audioSend=!0),K(v)&&(v.addAudio=!0)):b.myStream.getAudioTracks()!==null&&b.myStream.getAudioTracks()!==void 0&&b.myStream.getAudioTracks().length!==0||(v.replaceAudio&&(v.replaceAudio=!1,v.addAudio=!0,v.audioSend=!0),K(v)&&(v.addAudio=!0))}if(v.update&&!b.streamExternal&&(v.removeAudio||v.replaceAudio)){if(b.myStream&&b.myStream.getAudioTracks()&&b.myStream.getAudioTracks().length){var P=b.myStream.getAudioTracks()[0];r.log("Removing audio track:",P),b.myStream.removeTrack(P);try{P.stop()}catch(H){r.log("Error removing audio track:",H)}}if(b.pc.getSenders()&&b.pc.getSenders().length&&!v.replaceAudio&&C.a.browserDetails.browser==="firefox")for(var V in b.pc.getSenders()){var q=b.pc.getSenders()[V];q&&q.track&&q.track.kind==="audio"&&(r.log("Removing audio sender:",q),b.pc.removeTrack(q))}}if(u.stream!==null&&u.stream!==void 0){var Z=u.stream;if(r.log("MediaStream provided by the application"),r.debug(Z),v.update&&b.myStream&&b.myStream!==u.stream&&!b.streamExternal){try{var z=b.myStream.getTracks();for(var oe in z){var ee=z[oe];r.log(ee),ee!=null&&ee.stop()}}catch{}b.myStream=null}return b.streamExternal=!0,void $(S,v,u,Z)}if(r.log("Executing isAudioSendEnabled"),K(v)){i.consentDialog(!0);var te=K(v);te===!0&&v!=null&&v!=null&&g(v.audio)==="object"&&(te=v.audio),v!=null&&v.video==="screen"||navigator.mediaDevices.enumerateDevices().then(function(H){var pe=H.some(function(he){return he.kind==="audioinput"}),se=K(v),me=de(v);if((se||me)&&!(se&&pe)&&me)return i.consentDialog(!1),u.error("Audio capture is required, but no capture device found"),!1;var we={audio:!!pe&&te,video:!1};r.debug("getUserMedia constraints",we),navigator.mediaDevices.getUserMedia(we).then(function(he){i.consentDialog(!1),$(S,v,u,he)}).catch(function(he){i.consentDialog(!1),u.error({code:he.code,name:he.name,message:he.message})})}).catch(function(H){i.consentDialog(!1),u.error("enumerateDevices error",H)})}else $(S,v,u)},A=function(u){var S=u.jsep;if(!F()&&!Y())return r.warn("Invalid handle"),void u.error("Invalid handle");var v=i.webrtcConfig;if(S!=null){if(v.pc===null)return r.warn("Wait, no PeerConnection?? if this is an answer, use createAnswer and not handleRemoteJsep"),void u.error("No PeerConnection: if this is an answer, use createAnswer and not handleRemoteJsep");v.pc.setRemoteDescription(new RTCSessionDescription(S),function(){if(r.log("Remote description accepted!"),v.remoteSdp=S.sdp,v.candidates&&v.candidates.length>0){for(var b in v.candidates){var P=v.candidates[b];r.debug("Adding remote candidate:",P),P&&P.completed!==!0?v.pc.addIceCandidate(new RTCIceCandidate(P)):v.pc.addIceCandidate()}v.candidates=[]}},u.error)}else u.error("Invalid JSEP")},j=function(){if(!F()&&!Y())return r.warn("Invalid handle"),"Invalid handle";var u=i.webrtcConfig;return u.pc===null||u.pc===void 0?"Invalid PeerConnection":u.pc.getStats?u.bitrate.timer===null||u.bitrate.timer===void 0?(r.log("Starting bitrate timer (via getStats)"),u.bitrate.timer=setInterval(function(){u.pc.getStats().then(function(S){S.forEach(function(v){if(v){var b=!1;if((v.mediaType==="video"||v.id.toLowerCase().indexOf("video")>-1)&&v.type==="inbound-rtp"&&v.id.indexOf("rtcp")<0?b=!0:v.type!="ssrc"||!v.bytesReceived||v.googCodecName!=="VP8"&&v.googCodecName!==""||(b=!0),b)if(u.bitrate.bsnow=v.bytesReceived,u.bitrate.tsnow=v.timestamp,u.bitrate.bsbefore===null||u.bitrate.tsbefore===null)u.bitrate.bsbefore=u.bitrate.bsnow,u.bitrate.tsbefore=u.bitrate.tsnow;else{var P=u.bitrate.tsnow-u.bitrate.tsbefore;C.a.browserDetails.browser=="safari"&&(P/=1e3);var V=Math.round(8*(u.bitrate.bsnow-u.bitrate.bsbefore)/P);u.bitrate.value=V+" kbits/sec",u.bitrate.bsbefore=u.bitrate.bsnow,u.bitrate.tsbefore=u.bitrate.tsnow}}})})},1e3),"0 kbits/sec"):u.bitrate.value:(r.warn("Getting the video bitrate unsupported by browser"),"Feature unsupported by browser")},re=function(u){if(!F()&&!Y())return r.warn("Invalid handle"),void u.error("Invalid handle");var S=i.webrtcConfig;if(S.dtmfSender===null||S.dtmfSender===void 0){if(S.pc!==void 0&&S.pc!==null){var v=S.pc.getSenders().find(function(Z){return Z.track&&Z.track.kind==="audio"});if(!v)return r.warn("Invalid DTMF configuration (no audio track)"),void u.error("Invalid DTMF configuration (no audio track)");S.dtmfSender=v.dtmf,S.dtmfSender&&(r.log("Created DTMF Sender"),S.dtmfSender.ontonechange=function(Z){r.debug("Sent DTMF tone: "+Z.tone)}),r.log({"config.dtmfSender":S.dtmfSender})}if(S.dtmfSender===null||S.dtmfSender===void 0)return r.warn("Invalid DTMF configuration"),void u.error("Invalid DTMF configuration")}var b=u.dtmf;if(b==null)return r.warn("Invalid DTMF parameters"),void u.error("Invalid DTMF parameters");var P=b.tones;if(P==null)return r.warn("Invalid DTMF string"),void u.error("Invalid DTMF string");var V=b.duration;V==null&&(V=500);var q=b.gap;q==null&&(q=50),r.debug("Sending DTMF string "+P+" (duration "+V+"ms, gap "+q+"ms)"),S.dtmfSender.insertDTMF(P,V,q)},B=function(u){if(r.log("Cleaning WebRTC stuff"),F()){var S=i.webrtcConfig;if(S!=null){if(u===!0){var v={command:"hangup"};r.debug("Sending hangup request"),r.debug(v),s.send(JSON.stringify(v))}S.remoteStream=null,S.volume.timer&&clearInterval(S.volume.timer),S.volume.value=null,S.bitrate.timer&&clearInterval(S.bitrate.timer),S.bitrate.timer=null,S.bitrate.bsnow=null,S.bitrate.bsbefore=null,S.bitrate.tsnow=null,S.bitrate.tsbefore=null,S.bitrate.value=null;try{if(!S.streamExternal&&S.myStream!==null&&S.myStream!==void 0){r.log("Stopping local stream tracks");var b=S.myStream.getTracks();for(var P in b){var V=b[P];r.log(V),V!=null&&V.stop()}}}catch{}S.streamExternal=!1,S.myStream=null;try{S.pc.close()}catch{}S.pc=null,S.candidates=null,S.mySdp=null,S.remoteSdp=null,S.iceDone=!1,S.dataChannel=null,S.dtmfSender=null}i.oncleanup()}},$=function(u,S,v,b){if(!F()&&!Y())return r.warn("Invalid handle"),void v.error("Invalid handle");var P=i.webrtcConfig;r.log("streamsDone:",b),b&&(r.debug("  -- Audio tracks:",b.getAudioTracks()),r.debug("  -- Video tracks:",b.getVideoTracks()));var V=!1;if(P.myStream&&S.update&&!P.streamExternal){if((!S.update&&K(S)||S.update&&(S.addAudio||S.replaceAudio))&&b.getAudioTracks()&&b.getAudioTracks().length)if(P.myStream.addTrack(b.getAudioTracks()[0]),S.replaceAudio&&C.a.browserDetails.browser==="firefox")for(var q in r.log("Adding audio track:",b.getAudioTracks()[0]),P.pc.getSenders()){var Z=P.pc.getSenders()[q];Z&&Z.track&&Z.track.kind==="audio"&&Z.replaceTrack(b.getAudioTracks()[0])}else r.log((S.replaceAudio?"Replacing":"Adding")+" audio track:",b.getAudioTracks()[0]),P.pc.addTrack(b.getAudioTracks()[0],b)}else P.myStream=b,V=!0;if(!P.pc){var z={iceServers:v.iceServers,iceTransportPolicy:void 0,bundlePolicy:"balanced"},oe={optional:[{DtlsSrtpKeyAgreement:!0}]};if(v.rtcConstraints&&g(v.rtcConstraints)==="object")for(var ee in r.debug("Adding custom PeerConnection constraints:",v.rtcConstraints),v.rtcConstraints)oe.optional.push(v.rtcConstraints[ee]);C.a.browserDetails.browser==="edge"&&(z.bundlePolicy="max-bundle"),r.log("Creating PeerConnection"),r.debug(oe),r.log("new RTCPeerConnection"+JSON.stringify({iceServers:z.iceServers,pc_constraints:oe})),P.pc=new RTCPeerConnection(z,oe),r.log("This is the peer connection created "+JSON.stringify(P.pc)),P.pc.getStats&&(P.volume.value=0,P.bitrate.value="0 kbits/sec"),r.log("Preparing local SDP and gathering candidates (trickle="+P.trickle+")"),P.pc.oniceconnectionstatechange=function(){P.pc&&i.iceState(P.pc.iceConnectionState)},P.pc.onicecandidate=function(te){if(te.candidate==null||C.a.browserDetails.browser==="edge"&&te.candidate.candidate.indexOf("endOfCandidates")>0)r.log("End of candidates."),P.iceDone=!0,P.trickle===!0?E(v,{completed:!0}):function(pe){if(F()||Y()){var se=i.webrtcConfig;r.log("Sending offer/answer SDP..."),se.mySdp!==null&&se.mySdp!==void 0?(se.mySdp={type:se.pc.localDescription.type,sdp:se.pc.localDescription.sdp},se.trickle===!1&&(se.mySdp.trickle=!1),r.debug(pe),se.sdpSent=!0,pe.success(se.mySdp)):r.warn("Local SDP instance is invalid, not sending anything...")}else r.warn("Invalid handle, not sending anything")}(v);else{var H={candidate:te.candidate.candidate,sdpMid:te.candidate.sdpMid,sdpMLineIndex:te.candidate.sdpMLineIndex};P.trickle===!0&&E(v,H)}},P.pc.ontrack=function(te){r.log("Handling Remote Track"),r.debug(te),te.streams&&(P.remoteStream=te.streams[0],i.onremotestream(P.remoteStream),te.track&&!te.track.onended&&(r.log("Adding onended callback to track:",te.track),te.track.onended=function(H){r.log("Remote track removed:",H),P.remoteStream&&(P.remoteStream.removeTrack(H.target),i.onremotestream(P.remoteStream))}))}}V&&b!=null&&(r.log("Adding local stream"),b.getTracks().forEach(function(te){P.pc.addTrack(te,b)})),P.myStream&&i.onlocalstream(P.myStream),u==null?function(te,H){if(!F()&&!Y())return r.warn("Invalid handle"),void H.error("Invalid handle");var pe=i.webrtcConfig,se=H.simulcast===!0;se?r.log("Creating offer (iceDone="+pe.iceDone+", simulcast="+se+")"):r.log("Creating offer (iceDone="+pe.iceDone+")");var me={offerToReceiveAudio:ve(te)};H.iceRestart===!0&&(me.iceRestart=!0),r.log(me),pe.pc.createOffer(function(we){if(r.debug(we),r.log("Setting local description"),pe.mySdp=we.sdp,pe.pc.setLocalDescription(we),pe.mediaConstraints=me,pe.iceDone||pe.trickle){r.log("Offer ready"),r.debug(H);var he={type:we.type,sdp:we.sdp};H.success(he)}else r.log("Waiting for all candidates...")},H.error,me)}(S,v):P.pc.setRemoteDescription(new RTCSessionDescription(u),function(){if(r.log("Remote description accepted!"),P.remoteSdp=u.sdp,P.candidates&&P.candidates.length>0){for(var te in P.candidates){var H=P.candidates[te];r.debug("Adding remote candidate:",H),H&&H.completed!==!0?P.pc.addIceCandidate(new RTCIceCandidate(H)):P.pc.addIceCandidate()}P.candidates=[]}(function(pe,se){if(!F()&&!Y())return r.warn("Invalid handle"),void se.error("Invalid handle");var me=i.webrtcConfig,we=se.simulcast===!0;we?r.log("Creating answer (iceDone="+me.iceDone+", simulcast="+we+")"):r.log("Creating answer (iceDone="+me.iceDone+")");var he=null;he=C.a.browserDetails.browser=="firefox"||C.a.browserDetails.browser=="edge"?{offerToReceiveAudio:ve(pe)}:{mandatory:{OfferToReceiveAudio:ve(pe)}},r.debug(he),me.pc.createAnswer(function(Me){if(r.debug(Me),r.log("Setting local description"),me.mySdp=Me.sdp,me.pc.setLocalDescription(Me),me.mediaConstraints=he,me.iceDone||me.trickle){var Ke={type:Me.type,sdp:Me.sdp};se.success(Ke)}else r.log("Waiting for all candidates...")},se.error,he)})(S,v)},v.error)},E=function(u,S){if(a){if(!F()&&!Y())return r.warn("Invalid handle"),void u.error("Invalid handle");var v={command:"trickle",candidate:S};r.vdebug("Sending trickle candidate"),r.vdebug(v),s.send(JSON.stringify(v))}else r.warn("Is the gateway down? (connected=false)")},m=function(){if(!F()&&!Y())return r.warn("Invalid handle"),!0;var u=i.webrtcConfig;return u.pc===null||u.pc===void 0?(r.warn("Invalid PeerConnection"),!0):u.myStream===void 0||u.myStream===null?(r.warn("Invalid local MediaStream"),!0):u.myStream.getAudioTracks()===null||u.myStream.getAudioTracks()===void 0||u.myStream.getAudioTracks().length===0?(r.warn("No audio track"),!0):!u.myStream.getAudioTracks()[0].enabled},I=function(u){if(!F()&&!Y())return r.warn("Invalid handle"),!1;var S=i.webrtcConfig;return S.pc===null||S.pc===void 0?(r.warn("Invalid PeerConnection"),!1):S.myStream===void 0||S.myStream===null?(r.warn("Invalid local MediaStream"),!1):S.myStream.getAudioTracks()===null||S.myStream.getAudioTracks()===void 0||S.myStream.getAudioTracks().length===0?(r.warn("No audio track"),!1):(r.log({"config.myStream.getAudioTracks()[0].enabled":S.myStream.getAudioTracks()[0].enabled}),S.myStream.getAudioTracks()[0].enabled=!u,!0)},J=function(){if(!F()&&!Y())return r.warn("Invalid handle"),!1;var u=i.webrtcConfig;return u.pc.getStats&&C.a.browserDetails.browser=="chrome"?u.remoteStream===null||u.remoteStream===void 0?(r.warn("Remote stream unavailable"),0):u.volume.timer===null||u.volume.timer===void 0?(r.log("Starting volume monitor"),u.volume.timer=setInterval(function(){u.pc.getStats(function(S){for(var v=S.result(),b=0;b<v.length;b++){var P=v[b];P.type=="ssrc"&&P.stat("audioOutputLevel")&&(u.volume.value=P.stat("audioOutputLevel"))}})},200),0):u.volume.value:(r.log("Getting the remote volume unsupported by browser"),0)},M=function(){var u=function(){s.removeEventListener("message",S),s.removeEventListener("error",v),t&&clearTimeout(t),s.close()},S=function(){r.log("websocket closed successfully"),u()},v=function(){r.log("closing websocket on error"),u()};p("closed"),s.readyState==1?(s.addEventListener("message",S),s.addEventListener("error",v),s.send(JSON.stringify({command:"destroy"}))):v()},K=function(u){return r.debug("isAudioSendEnabled:",u),u==null||u.audio!==!1&&(u.audioSend===void 0||u.audioSend===null||u.audioSend===!0)},de=function(u){return r.debug("isAudioSendRequired:",u),u!=null&&u.audio!==!1&&u.audioSend!==!1&&u.failIfNoAudio!==void 0&&u.failIfNoAudio!==null&&u.failIfNoAudio===!0},ve=function(u){return r.debug("isAudioRecvEnabled:",u),u==null||u.audio!==!1&&(u.audioRecv===void 0||u.audioRecv===null||u.audioRecv===!0)},ce=function u(){a&&(t=setTimeout(u,3e4),r.log("keepalive"),s.send(JSON.stringify({command:"keepalive"})))},F=function(){var u=!1;return i&&(u=!0),u},Y=function(){var u=!1;return i.webrtcConfig&&(u=!0),u};function fe(u,S,v,b,P,V,q){try{var Z=u[V](q),z=Z.value}catch(oe){return void v(oe)}Z.done?S(z):Promise.resolve(z).then(b,P)}var X=function(){var u,S=(u=regeneratorRuntime.mark(function v(b,P){return regeneratorRuntime.wrap(function(V){for(;;)switch(V.prev=V.next){case 0:return V.abrupt("return",new Promise(function(q,Z){X.server=new WebSocket(b.server,["at-protocol",b.capabilityToken]),X.server.onopen=function(){var z,oe;r.log("Sending initial request to Africa's Talking APIs "),z=P,oe=X.server,s=oe,p=z.emitEvent,y=function(){r.error("AfricasTalking Client Error: error occured on session creation"),M()},f=function(){r.log("Creating Session... ");var ee={webrtcConfig:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannel:null,dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},consentDialog:z.consentDialog,iceState:z.iceState,mediaState:z.mediaState,webrtcState:z.webrtcState,slowLink:z.slowLink,onmessage:z.onmessage,onlocalstream:z.onlocalstream,onremotestream:z.onremotestream,ondata:z.ondata,ondataopen:z.ondataopen,oncleanup:z.oncleanup,getVolume:function(){return J()},isAudioMuted:function(){return m()},muteAudio:function(){return I(!0)},unmuteAudio:function(){return I(!1)},getBitrate:function(){return j()},send:function(H){R(H)},data:function(H){O(H)},dtmf:function(H){re(H)},createOffer:function(H){N(H)},createAnswer:function(H){N(H)},handleRemoteJsep:function(H){A(H)},hangup:function(H){B(H===!0)}};r.log({"my handle is":ee}),t=setTimeout(ce,3e4),a=!0,i=ee,z.setHandle(ee);var te=["iPad","iPhone","iPod"].indexOf(navigator.platform)>=0;window.addEventListener(te?"pagehide":"unload",function(){s.close()})},q(X.server)},X.server.onmessage=function(z){r.log("Got this message from the websocket: "+z.data),_(JSON.parse(z.data)),q(X.server)},X.server.onclose=function(z){r.log("Lost connection to the gateway (is it down?)"+JSON.stringify(z)),M(),q(X.server)},X.server.onerror=function(z){r.error("AfricasTalking Client Error: Error connecting to the Africastalking WebSockets server... "+JSON.stringify(z)),Z(z)}}));case 1:case"end":return V.stop()}},v)}),function(){var v=this,b=arguments;return new Promise(function(P,V){var q=u.apply(v,b);function Z(oe){fe(q,P,V,Z,z,"next",oe)}function z(oe){fe(q,P,V,Z,z,"throw",oe)}Z(void 0)})});return function(v,b){return S.apply(this,arguments)}}();function Ce(u){if(r.log("Library initialized: "+u),r.log("Using WebSockets to contact Africastalking: "+u.server),u.capabilityToken===null||u.capabilityToken===void 0)return u.error("No capability token specified"),{};r.log({gatewayCallbacks:u});var S={server:u.server,capabilityToken:u.capabilityToken},v={setHandle:u.setHandle,emitEvent:u.emitEvent,destroyed:u.destroyed,error:u.error,oncleanup:u.oncleanup,onlocalstream:u.onlocalstream,onmessage:u.onmessage,onremotestream:u.onremotestream,consentDialog:function(){},mediaState:function(){},webrtcState:function(){},slowLink:function(){},iceState:function(){}};X(S,v).then(function(b){b.send(JSON.stringify({command:"create"}))}).catch(function(b){r.log("websocket Error: "+JSON.stringify(b))})}Ce.noop=function(){},Ce.isWebrtcSupported=function(){return window.RTCPeerConnection!==void 0&&window.RTCPeerConnection!==null&&navigator.getUserMedia!==void 0&&navigator.getUserMedia!==null};var Se=Ce,ue={},ge=function(u){navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&(navigator.enumerateDevices=function(Z){navigator.mediaDevices.enumerateDevices().then(Z)});var S=[],v=location.protocol==="https:",b=!1;(typeof MediaStreamTrack<"u"&&"getSources"in MediaStreamTrack||navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices)&&(b=!0);var P,V=!1,q=!1;P=function(){ue={audio:V,audioCap:q},r.log({supportedDevices:ue}),u()},r.log({"finding supported devices":navigator.enumerateDevices,"some if statememt":navigator.mediaDevices,navigator}),b?(!navigator.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(navigator.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!navigator.enumerateDevices&&navigator.enumerateDevices&&(navigator.enumerateDevices=navigator.enumerateDevices.bind(navigator)),navigator.enumerateDevices?(S=[],navigator.enumerateDevices(function(Z){Z.forEach(function(z){var oe,ee={};for(var te in z)ee[te]=z[te];ee.kind==="audio"&&(ee.kind="audioinput"),S.forEach(function(H){H.id===ee.id&&H.kind===ee.kind&&(oe=!0)}),oe||(ee.deviceId||(ee.deviceId=ee.id),ee.id||(ee.id=ee.deviceId),ee.label?ee.kind!=="audioinput"||q||(q=!0):(ee.label="Please invoke getUserMedia once.",v||(ee.label="HTTPs is required to get label of this "+ee.kind+" device.")),ee.kind==="audioinput"&&(V=!0),S.push(ee))}),P&&P()})):P&&P()):r.log("cant enumerate devices")};function Ae(u,S){for(var v=0;v<S.length;v++){var b=S[v];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(u,b.key,b)}}function Ee(u,S){if(!(u instanceof S))throw new TypeError("Cannot call a class as a function")}function _e(u,S){for(var v=0;v<S.length;v++){var b=S[v];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(u,b.key,b)}}var W,ie,Ie,ke,Te,Pe,be=new(function(){function u(){(function(b,P){if(!(b instanceof P))throw new TypeError("Cannot call a class as a function")})(this,u),this.events={}}var S,v;return S=u,(v=[{key:"subscribe",value:function(b,P){var V=this;return this.events[b]||(this.events[b]=[]),this.events[b].push(P),function(){V.events[b]=V.events[b].filter(function(q){return P!==q})}}},{key:"emit",value:function(b,P){var V=this.events[b];V&&V.forEach(function(q){q.call(null,P)})}},{key:"unsubscribe",value:function(b){var P=this.events[b];return this.events[b]||(this.events[b]=[]),P&&this.events.splice(P),this}},{key:"unsubscribeAll",value:function(){return this.events={},this}}])&&Ae(S.prototype,v),u}()),De=!1,He=function(){function u(b){var P=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Ee(this,u);var V=P.iceServers,q=V===void 0?[]:V,Z=P.sounds,z=Z===void 0?{}:Z;this.token=b,this.initDone=!1,this.iceServers,this.atwebsocketUrl="wss://webrtc.africastalking.com/connect",Array.isArray(q)&&q.length>0&&(this.iceServers=$e(q));var oe=Be(z);Te=new Audio(oe.ringing),Pe=new Audio(oe.dialing),r.log({ringing:Te,dialing:Pe}),r.log({iceServers:this.iceServers}),qe.bind(this)()}var S,v;return S=u,(v=[{key:"on",value:function(b,P){be.subscribe(b,P)}},{key:"logout",value:function(){W&&W.send({message:{request:"unregister"}})}},{key:"hold",value:function(){W&&W.send({message:{request:"hold"}})}},{key:"unhold",value:function(){W&&W.send({message:{request:"unhold"}})}},{key:"call",value:function(b){Pe.play();var P=this.iceServers;ge(function(){W.createOffer({iceServers:P,media:{audioSend:!0,audioRecv:!0},success:function(V){r.debug("Got SDP!"),r.debug(V),r.log({to:b,jsep:V});var q={request:"call",to:b};W.send({message:q,jsep:V}),ke=b},error:function(V){r.error("AfricasTalking Client Error: ",V)}})})}},{key:"answer",value:function(){var b=this.iceServers;ie=null,ge(function(){W.createAnswer({jsep:Ie,iceServers:b,media:{audio:!0},success:function(P){r.debug("Got SDP! audio=true, video=true"),r.debug(P),W.send({message:{request:"accept"},jsep:P})},error:function(P){r.error("AfricasTalking Client Error: ",P),W.send({message:{request:"decline",code:480}})}})})}},{key:"dtmf",value:function(b){W.dtmf({dtmf:{tones:b}})}},{key:"muteAudio",value:function(){return W.muteAudio()}},{key:"unmuteAudio",value:function(){return W.unmuteAudio()}},{key:"getVolume",value:function(){return W.getVolume()}},{key:"isAudioMuted",value:function(){return W.isMuted()}},{key:"hangup",value:function(){ie?We():(W.send({message:{request:"hangup"}}),W.hangup())}},{key:"getCounterpartNum",value:function(){return ke}}])&&_e(S.prototype,v),u}();function qe(){var u=document.getElementById("remote-stream-audio");W?Ne():this.initDone!==!0&&(r.log("creating remoteStreamAudio",u,Te,Pe),u||((u=document.createElement("audio")).id="remote-stream-audio",u.autoplay=!0,document.body.appendChild(u)),Te.loop=!0,Pe.loop=!0,this.initDone=!0,Se.isWebrtcSupported()?new Se({server:this.atwebsocketUrl,capabilityToken:this.token,setHandle:function(S){W=S,ge(function(){Ne()})},onmessage:function(S,v){r.log(" ::: Got a message :::"),r.log(JSON.stringify(S));var b=S.error;if(b==null||b==null){var P=S.result;if(r.log("This is the result "+P.toString),P!=null&&P.event!==void 0&&P.event!==null){var V=P.event;switch(V){case"registration_failed":return r.log("Registration failed: "+P.code+" "+P.reason),void Ne();case"registered":r.log("Successfully registered as "+P.username+"!"),De||(De=!0,be.emit("ready"));break;case"unregistered":r.log("Successfully unregistered as "+P.username+"!"),De&&(De=!1,be.emit("notready"));break;case"calling":r.log("Waiting for the peer to answer..."),be.emit("calling");break;case"incomingcall":ke=S.result.username.split("@")[0].split(":")[1],ie=!0,Te.play(),r.log("Incoming call from "+P.username+"!"),Ie=v,be.emit("incomingcall",{from:ke});break;case"progress":r.log("There's early media from "+P.username+", wairing for the call!"),v!=null&&Ue(v);break;case"missed_call":ke=S.result.caller.split("@")[0].split(":")[1],r.log("Missed call from "+P.caller+"!"),be.emit("missedcall",{from:ke});break;case"accepted":Pe.pause(),Te.pause(),r.log(P.username+" accepted the call!"),v!=null&&Ue(v),be.emit("callaccepted");break;case"hangup":ie=null,Pe.pause(),Te.pause(),r.log("Call hung up ("+P.code+" "+P.reason+")!"),W.hangup(),be.emit("hangup",{code:P.code,reason:P.reason});break;case"decline":ie=null,Pe.pause(),Te.pause(),r.log("Call declined!"),W.hangup(),be.emit("hangup");break;default:r.log("Received random json request "+V.toString)}}}else De?(Pe.pause(),Te.pause(),W.hangup()):r.log("User is not registered"+b)},emitEvent:function(S){be.emit(S)},onlocalstream:function(S){r.log(" ::: Got a local stream :::"),r.log(JSON.stringify(S))},onremotestream:function(S){r.debug(" ::: Got a remote stream :::"),r.debug(JSON.stringify(S));var v=S.getAudioTracks();(function(b,P){C.a.browserDetails.browser==="chrome"?C.a.browserDetails.version>=43?b.srcObject=P:b.src!==void 0?b.src=URL.createObjectURL(P):r.error("AfricasTalking Client Error: Error attaching media stream to element"):b.srcObject=P})(u,new MediaStream(v))},oncleanup:function(){r.log(" ::: Got a cleanup notification :::")},error:function(S){De=!1,r.error("Africastalking Client Error: "+S),be.unsubscribeAll()},destroyed:function(){De=!1,be.unsubscribeAll()}}):r.error("AfricasTalking Client Error: No WebRTC support"))}var Ne=function(){W?(r.log({"loggin in with handle in client":W}),W.send({message:{request:"register"}})):r.error("Africastalking error: Unable to initialize")},We=function(){ie=null,W.send({message:{request:"decline"}})},Ue=function(u){W.handleRemoteJsep({jsep:u,error:function(){W.send({message:{request:"hangup"}}),W.hangup()}})},Be=function(u){return{dialing:u.dialing?u.dialing:"https://res.cloudinary.com/at-voice/video/upload/v1558426588/AT-voice-client-sdk/dialing_g4tn6r.mp3",ringing:u.ringing?u.ringing:"https://res.cloudinary.com/at-voice/video/upload/v1558426103/AT-voice-client-sdk/ringing_au0d1x.mp3"}},$e=function(u){var S=[];return u.forEach(function(v){if(typeof v.urls=="string"&&v.urls.startsWith("stun:"))S.push({urls:v.urls});else if(typeof v.urls=="string"&&(v.urls.startsWith("turn:")||v.urls.startsWith("turns:")))S.push({urls:v.urls,username:v.username,credential:v.credential});else if(Array.isArray(v.urls)){var b=v.urls.filter(function(P){return typeof P=="string"&&(P.startsWith("turn:")||P.startsWith("turns:"))});b.length===v.urls.length?S.push({urls:b,username:v.username,credential:v.credential}):r.error("AfricasTalking Client Error: Invalid iceServer param ".concat(JSON.stringify(v)))}else r.error("AfricasTalking Client Error: Invalid iceServer param ".concat(JSON.stringify(v)))}),S},Qe=He;Q.default={Client:Qe}}]).default})})(ze);var et=ze.exports;const tt=Xe(et),je=Fe(()=>{var T;return(T=Je().props.value.user)==null?void 0:T.token});Fe(()=>{var T;return(T=Je().props.value.user)==null?void 0:T.id});const rt=[{product:"Phone",status:"Shipped",COD:500,client:"John Doe",phone:"123-456-7890",email:"john@example.com",altPhone:"111-222-3333",location:"Portland, Oregon",orders:[{product:"Tablet",status:"Delivered"},{product:"Laptop",status:"Pending"}]}],nt={async fetch({page:T,itemsPerPage:D,sortBy:U,search:Q}){return new Promise(L=>{setTimeout(()=>{const d=(T-1)*D,n=d+D,o=rt.filter(c=>!0),e=o.slice(d,n);L({items:e,total:o.length})},500)})}};Ve("orders");Ve("");const at={components:{AppLayout:Ye},data:()=>({stats:[],loading:!1,isMuted:!1,isOnHold:!1,itemsPerPage:5,tab:"calls",isCalling:!1,connection_active:!1,queueDialog:!1,transferDialog:!1,callAgentDialog:!1,queuedCalls:[],selectedAgent:null,availableAgents:[].filter(T=>status.available),callHistories:[],queuedCalls:[{call_id:1,phone_number:"+254711123456",status:"queued"},{call_id:2,phone_number:"+254712345678",status:"queued"},{call_id:3,phone_number:"+254713456789",status:"queued"},{call_id:4,phone_number:"+254714567890",status:"queued"}],queuedCallsheaders:[{title:"Call ID",value:"call_id"},{title:"Phone Number",value:"phone_number"},{title:"Status",value:"status"},{title:"Actions",value:"actions",sortable:!1}],headers:[{title:"Product",align:"start",key:"product"},{title:"Status",key:"status",align:"start"},{title:"COD",key:"COD",align:"end"},{title:"Client",key:"client",align:"start"},{title:"Phone",key:"phone",align:"start"}],callsheaders:[{title:"Date",value:"created_at"},{title:"Caller No.",value:"callerNumber"},{title:"Destination Number",value:"destinationNumber"},{title:"clientDialed Number",value:"clientDialedNumber"},{title:"Duration In Seconds",value:"durationInSeconds"},{title:"Caller Carrier",value:"callerCarrier"},{title:"Call Status",value:"status"},{title:"HangupCause",value:"lastBridgeHangupCause"},{title:"Call Session State",value:"callSessionState"},{title:"Actions",value:"actions",sortable:!1}],serverItems:[{product:"Phone",status:"Shipped",COD:500,client:"John Doe",phone:"741821113"},{product:"Tablet",status:"Pending",COD:700,client:"Jane Doe",phone:"751458911"}],totalItems:2,statuses:["Pending","Shipped","Delivered","Cancelled"],statusModal:!1,phonePopup:!1,newCall:!1,incomingCallDialog:!1,incomingCall:{},callId:null,afClient:null,session:null,selectedItem:{phone:"",phone_number:""},eventLog:[]}),created(){this.fetchCallHistory(),this.fetchAgentstats(),this.fetchUsers()},methods:{sendWhatsApp(T){const D=encodeURIComponent("Hello! I’d like to follow up.");window.open(`https://wa.me/${T}?text=${D}`,"_blank")},sendTelegram(T){window.open(`https://t.me/${T}`,"_blank")},waitForToken(){return new Promise(T=>{const D=setInterval(()=>{this.userToken&&(clearInterval(D),T())},500)})},async initializeAfricastalking(){const T={sounds:{dialing:"https://support.solssa.com/storage/ringtones/office_phone.mp3",ringing:"https://support.solssa.com/storage/ringtones/office_phone.mp3"}};try{const D=new tt.Client(je.value,T);console.log("Africastalking client initialized."),console.log("AF object",D),this.afClient=D,D.on("ready",()=>{this.connection_active=!0,console.log("Africastalking WebRTC client is ready."),this.$toastr.success("WebRTC client is ready.")}),D.on("error",U=>{console.error("Africastalking Client Error:",U),this.$toastr.error("Client Error: "+U.message)}),D.on("closed",U=>{console.warn("Africastalking Client Connection Closed:",U),this.$toastr.warning("Connection closed.")}),D.on("incomingcall",U=>{console.log("Incoming call received."),console.log(`Incoming call from ${U.from}`),console.log("Event Data:",U),this.incomingCallDialog=!0,this.incomingCall={from:U.from,duration:"Connecting..."}}),D.on("hangup",U=>{console.log("Incoming call hung up:",U.reason),this.$toastr.error("Incoming call hung up: ",U.reason),this.incomingCallDialog=!1}),this.$webrtcClient=D}catch(D){console.error("Error initializing Africastalking WebRTC client:",D),this.$toastr.error("Failed to initialize WebRTC client: "+D.message)}},transferCall(){this.openTransferDialog()},async callClient(T){try{console.log(`Calling ${T} from System...`),this.afClient.call(T),console.log("Call initiated successfully."),this.$toastr.success("Call started."),this.isCalling=!0,this.afClient.on("afClienting",()=>{this.logEvent("afClient is in progress (calling)...")}),this.afClient.on("callaccepted",()=>{console.log("callaccepted"),this.$toastr.success("Call accepted!"),this.logEvent("Call accepted (bridged between caller and callee).")}),this.afClient.on("hangup",D=>{this.logEvent(`Call hung up (${D.code} - ${D.reason}).`),this.$toastr.error(`Call ended: ${D.reason}`),this.isCalling=!1,this.activeCall=null}),this.afClient.on("mute",()=>{this.logEvent("Call muted."),this.$toastr.info("Call muted.")}),this.afClient.on("unmute",()=>{this.logEvent("Call unmuted."),this.$toastr.info("Call unmuted.")}),this.afClient.on("hold",()=>{this.logEvent("Call on hold."),this.$toastr.info("Call on hold.")}),this.afClient.on("unhold",()=>{this.logEvent("Call resumed from hold."),this.$toastr.info("Call resumed from hold.")})}catch(D){console.error("Call initiation error:",D),this.$toastr.error("Call failed: "+D.message)}},answerCall(){this.incomingCall&&this.afClient.answer()},handleCall(T){if(this.isCalling=!0,this.selectedAgent=T,console.log("Selected agent:",T),this.phone_number=T.phone_number,console.log("Agent phone number:",this.phone_number),!this.afClient){console.error("Africastalking client is not initialized."),this.$toastr.error("Africastalking client is not initialized.");return}try{console.log("Attempting to call agent..."),this.afClient.call(this.phone_number),console.log("Call initiated successfully."),this.$toastr.success("Call initiated successfully.")}catch(D){console.error("Error while calling agent:",D),this.$toastr.error("Failed to call agent: "+D.message)}},hangupCall(){this.incomingCall&&(this.afClient.hangup(),console.log("call rejected"),this.$toastr.error("Call rejected."),this.incomingCallDialog=!1,this.isCalling=!1)},handleMute(){this.isCalling&&(this.isMuted=!this.isMuted,this.isMuted?this.afClient.muteAudio():this.afClient.unmuteAudio(),console.log("Client mute property:",this.afClient.isAudioMuted),console.log("Our internal state:",this.isMuted))},handleHoldToggle(){this.isCalling&&(this.afClient.hold(),this.isOnHold=!this.isOnHold,this.logEvent(this.isOnHold?"Call on hold.":"Call resumed from hold."))},logEvent(T){const D=new Date().toLocaleTimeString();this.eventLog.unshift(`${D}: ${T}`)},closeDialog(){this.callAgentDialog=!1},openCallAgent(){this.callAgentDialog=!0},openTransferDialog(){this.transferDialog=!0},openQueueDialog(){this.fetchQueuedCalls(),this.queueDialog=!0},fetchQueuedCalls(){axios.get("/api/v1/queued-calls").then(T=>{this.queuedCalls=T.data}).catch(T=>{console.error("Error fetching queued calls:",T)})},handleTransfer(){this.callId?axios.post("/api/v1/call-centre-transfer-call",{callId:this.callId,destination:"254700000000"}).then(D=>{console.log("Call transferred",D.data)}).catch(D=>{console.error("Error transferring the call",D)}):console.log("Call ID not available")},loadItems({page:T,itemsPerPage:D,sortBy:U}){nt.fetch({page:T,itemsPerPage:D,sortBy:U,search:{}}).then(({items:Q,total:L})=>{this.serverItems=Q,this.totalItems=L})},openStatusModal(T){this.selectedItem=T,this.statusModal=!0},updateStatus(T,D){T.status=D,this.statusModal=!1},openPhonePopup(T){this.selectedItem=T,this.phonePopup=!0},async fetchCallHistory(){axios.get("/api/v1/call-history").then(T=>{this.callHistories=T.data.callHistories}).catch(T=>{console.error("Error fetching call history:",T)})},fetchAgentstats(){axios.get("api/v1/agent-stats"/+this.userId).then(T=>{this.stats=T.data,console.log("Agent stats:",this.stats)}).catch(T=>{console.error("Error fetching agent stats:",T)})},fetchUsers(){axios.get("/v1/users").then(T=>{this.agents=T.data}).catch(T=>{console.error("Error fetching users:",T)})}},watch:{availableAgents(T){this.availableAgents=T.filter(D=>!D.isInCall)}},async mounted(){console.log("User Token:",je.value),je.value||(console.warn("userToken is missing. Waiting for it..."),await this.waitForToken()),je.value?await this.initializeAfricastalking():console.error("Failed to retrieve userToken after waiting.")}},it={class:"p-4"},ot=G("span",{class:"ml-3"},"Make a new Call",-1),st=G("span",{class:"ml-3"},"Call an agent",-1),ct={class:"d-flex align-center mt-2"},lt=G("span",{class:"ml-3"},"Missed Calls",-1),dt=G("span",{class:"ml-auto"},"60,400",-1),ut=G("span",{class:"ml-3"},"Check Queue",-1),pt=G("span",{class:"ml-auto"},"...",-1),ft={class:"d-flex align-center"},mt=G("span",null,"AM",-1),vt=G("div",null,[G("p",{class:"mb-0"},"John Mwacahro"),G("small",null,"john.boxleo@gmail.com")],-1),gt=G("div",{class:"mt-4"},[G("p",null,[x("Calls connected: "),G("strong",null,"0")]),G("p",null,[x("Calls made: "),G("strong",null,"0")]),G("p",null,[x("Calls rejected: "),G("strong",null,"0")]),G("p",null,[x("Incoming Calls: "),G("strong",null,"0")])],-1),ht=["onClick"],yt=["onClick"],Ct=G("p",null,"Select an agent to call:",-1),St={class:"d-flex align-center mb-2"},Tt=G("strong",null,"Name:",-1),bt={class:"d-flex align-center mb-2"},kt=G("strong",null,"Email:",-1),wt={class:"d-flex align-center mb-2"},Rt=G("strong",null,"Phone:",-1),Pt={class:"d-flex align-center mb-2"},Et=G("strong",null,"Alternative Phone:",-1),_t={class:"d-flex align-center"},Dt=G("strong",null,"Address:",-1);function It(T,D,U,Q,L,d){const n=ne("v-icon"),o=ne("v-card-text"),e=ne("v-card"),c=ne("v-col"),l=ne("v-avatar"),r=ne("v-chip"),h=ne("v-row"),C=ne("v-text-field"),g=ne("v-tab"),s=ne("v-tabs"),p=ne("v-btn"),t=ne("v-data-table-server"),a=ne("v-window-item"),i=ne("v-data-table"),f=ne("v-window"),y=ne("v-card-title"),_=ne("v-list-item"),R=ne("v-list"),O=ne("v-card-actions"),N=ne("v-dialog"),A=ne("v-spacer"),j=ne("v-list-item-icon"),re=ne("v-list-item-title"),B=ne("v-list-item-content"),$=ne("v-container"),E=ne("AppLayout");return le(),ye(E,null,{default:k(()=>[G("div",it,[w($,null,{default:k(()=>[w(h,null,{default:k(()=>[w(c,{cols:"12",md:"6"},{default:k(()=>[w(e,null,{default:k(()=>[w(o,null,{default:k(()=>[G("div",{class:"d-flex align-center",onClick:D[0]||(D[0]=m=>T.newCall=!0)},[w(n,{color:"green"},{default:k(()=>[x("mdi-phone")]),_:1}),ot]),G("div",{class:"d-flex align-center mt-2",onClick:D[1]||(D[1]=(...m)=>d.openCallAgent&&d.openCallAgent(...m))},[w(n,{color:"blue"},{default:k(()=>[x("mdi-account")]),_:1}),st]),G("div",ct,[w(n,{color:"red"},{default:k(()=>[x("mdi-phone-missed")]),_:1}),lt,dt]),G("div",{class:"d-flex align-center mt-2",onClick:D[2]||(D[2]=(...m)=>d.openQueueDialog&&d.openQueueDialog(...m))},[w(n,{color:"orange"},{default:k(()=>[x("mdi-check-decagram")]),_:1}),ut,pt])]),_:1})]),_:1})]),_:1}),w(c,{cols:"12",md:"6"},{default:k(()=>[w(e,null,{default:k(()=>[w(o,null,{default:k(()=>[G("div",ft,[w(l,{class:"mr-3",color:"blue",size:"40"},{default:k(()=>[mt]),_:1}),vt,w(r,{class:"ml-auto",color:"green","text-color":"white"},{default:k(()=>[x("Online")]),_:1})]),gt]),_:1})]),_:1})]),_:1})]),_:1}),w(e,null,{default:k(()=>[w(C,{modelValue:T.searchQuery,"onUpdate:modelValue":D[3]||(D[3]=m=>T.searchQuery=m),label:"Search","prepend-inner-icon":"mdi-magnify",outlined:"",dense:"",clearable:""},null,8,["modelValue"]),w(s,{modelValue:T.tab,"onUpdate:modelValue":D[4]||(D[4]=m=>T.tab=m),color:"primary"},{default:k(()=>[w(g,{value:"calls"},{default:k(()=>[x("Calls")]),_:1}),w(g,{value:"orders"},{default:k(()=>[x("Orders")]),_:1}),w(g,{value:"tickets"},{default:k(()=>[x("tickets")]),_:1})]),_:1},8,["modelValue"]),w(f,{modelValue:T.tab,"onUpdate:modelValue":D[6]||(D[6]=m=>T.tab=m)},{default:k(()=>[w(a,{value:"calls"},{default:k(()=>[w(t,{headers:T.callsheaders,items:T.callHistories,"item-value":"id","items-length":T.totalItems,loading:T.loading,search:T.search,"onUpdate:options":d.loadItems,class:"elevation-1 mt-4","items-per-page":"15"},{"item.actions":k(({item:m})=>[w(p,{color:"blue",onClick:I=>T.playRecording(m),rounded:"lg",block:""},{default:k(()=>[w(n,null,{default:k(()=>[x("mdi-play")]),_:1}),x(" Play ")]),_:2},1032,["onClick"])]),_:1},8,["headers","items","items-length","loading","search","onUpdate:options"])]),_:1}),w(a,{value:"orders"},{default:k(()=>[w(i,{headers:T.headers,items:T.serverItems,"show-select":"",modelValue:T.selected,"onUpdate:modelValue":D[5]||(D[5]=m=>T.selected=m),class:"elevation-1 mt-4"},{body:k(({items:m})=>[(le(!0),Oe(Le,null,xe(m,I=>(le(),Oe("tr",{key:I.product},[G("td",null,ae(I.product),1),G("td",null,[G("span",{class:"clickable",onClick:J=>d.openStatusModal(I)},ae(I.status),9,ht)]),G("td",null,ae(I.COD),1),G("td",null,ae(I.client),1),G("td",null,[G("span",{class:"clickable",onClick:J=>d.openPhonePopup(I)},ae(I.phone),9,yt)])]))),128))]),_:1},8,["headers","items","modelValue"])]),_:1})]),_:1},8,["modelValue"])]),_:1}),w(N,{modelValue:T.callAgentDialog,"onUpdate:modelValue":D[7]||(D[7]=m=>T.callAgentDialog=m),"max-width":"600"},{default:k(()=>[w(e,null,{default:k(()=>[w(y,{class:"headline"},{default:k(()=>[x("Call an Agent")]),_:1}),w(o,null,{default:k(()=>[Ct,w(R,null,{default:k(()=>[(le(!0),Oe(Le,null,xe(T.agents,m=>(le(),ye(_,{key:m.name,onClick:I=>d.handleCall(m),class:"agent-item"},{default:k(()=>[G("div",null,[G("strong",null,ae(m.name),1),G("span",{class:Ge({"text-success":m.status==="available","text-warning":m.status==="engaged","text-grey":m.status==="offline"})}," - "+ae(m.status),3)])]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),w(O,null,{default:k(()=>[w(p,{color:"blue darken-1",text:"",onClick:d.closeDialog},{default:k(()=>[x("Cancel")]),_:1},8,["onClick"]),T.isCalling?(le(),ye(p,{key:0,color:"red",onClick:d.hangupCall},{default:k(()=>[w(n,{left:""},{default:k(()=>[x("mdi-phone-off")]),_:1}),x(" Hangup ")]),_:1},8,["onClick"])):Re("",!0),T.isCalling?(le(),ye(p,{key:1,color:"grey",onClick:T.handleHold},{default:k(()=>[w(n,{left:""},{default:k(()=>[x("mdi-pause")]),_:1}),x(" Hold ")]),_:1},8,["onClick"])):Re("",!0),T.isCalling?(le(),ye(p,{key:2,color:"blue",onClick:d.openTransferDialog},{default:k(()=>[w(n,{left:""},{default:k(()=>[x("mdi-phone-transfer")]),_:1}),x(" Transfer ")]),_:1},8,["onClick"])):Re("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),w(N,{modelValue:T.statusModal,"onUpdate:modelValue":D[9]||(D[9]=m=>T.statusModal=m),"max-width":"400"},{default:k(()=>[w(e,null,{default:k(()=>[w(y,null,{default:k(()=>[x("Select Status")]),_:1}),w(o,null,{default:k(()=>[w(R,null,{default:k(()=>[(le(!0),Oe(Le,null,xe(T.statuses,m=>(le(),ye(_,{key:m,onClick:I=>d.updateStatus(T.selectedItem,m)},{default:k(()=>[x(ae(m),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),w(O,null,{default:k(()=>[w(p,{color:"primary",text:"",onClick:D[8]||(D[8]=m=>T.statusModal=!1)},{default:k(()=>[x("Close")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),w(N,{modelValue:T.queueDialog,"onUpdate:modelValue":D[11]||(D[11]=m=>T.queueDialog=m),"max-width":"600"},{default:k(()=>[w(e,null,{default:k(()=>[w(y,null,{default:k(()=>[x(" Queued Calls "),w(A),w(p,{icon:"",onClick:D[10]||(D[10]=m=>T.queueDialog=!1)},{default:k(()=>[w(n,null,{default:k(()=>[x("mdi-close")]),_:1})]),_:1})]),_:1}),w(o,null,{default:k(()=>[w(i,{headers:T.queuedCallsheaders,items:T.queuedCalls,"item-value":"id",class:"elevation-1"},{"item.actions":k(({item:m})=>[w(p,{color:"green",onClick:I=>T.dequeueCall(m.id)},{default:k(()=>[x(" Dequeue ")]),_:2},1032,["onClick"])]),_:1},8,["headers","items"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),w(N,{modelValue:T.newCall,"onUpdate:modelValue":D[15]||(D[15]=m=>T.newCall=m),"max-width":"800"},{default:k(()=>[w(e,null,{default:k(()=>[w(y,null,{default:k(()=>[x(" Client Details "),w(A),w(p,{icon:"",onClick:D[12]||(D[12]=m=>T.newCall=!1)},{default:k(()=>[w(n,null,{default:k(()=>[x("mdi-close")]),_:1})]),_:1})]),_:1}),w(o,null,{default:k(()=>[w(C,{modelValue:T.phone,"onUpdate:modelValue":D[13]||(D[13]=m=>T.phone=m),label:"Phone Number",type:"text",required:""},null,8,["modelValue"])]),_:1}),w(O,null,{default:k(()=>[G("div",null,[T.isCalling?Re("",!0):(le(),ye(p,{key:0,color:"success",onClick:D[14]||(D[14]=m=>d.callClient(T.phone))},{default:k(()=>[w(n,{left:""},{default:k(()=>[x("mdi-phone")]),_:1}),x(" Call Client ")]),_:1})),T.isCalling?(le(),ye(p,{key:1,color:"red",onClick:d.hangupCall},{default:k(()=>[w(n,{left:""},{default:k(()=>[x("mdi-phone-off")]),_:1}),x(" Hangup ")]),_:1},8,["onClick"])):Re("",!0),T.isCalling?(le(),ye(p,{key:2,color:"warning",onClick:d.handleMute},{default:k(()=>[w(n,{left:""},{default:k(()=>[x(ae(T.isMuted?"mdi-microphone-off":"mdi-microphone"),1)]),_:1}),x(" "+ae(T.isMuted?"Unmute":"Mute"),1)]),_:1},8,["onClick"])):Re("",!0),T.isCalling?(le(),ye(p,{key:3,color:"primary",onClick:d.handleHoldToggle},{default:k(()=>[w(n,{left:""},{default:k(()=>[x(ae(T.isOnHold?"mdi-phone-transfer":"mdi-pause"),1)]),_:1}),x(" "+ae(T.isOnHold?"Unhold":"Hold"),1)]),_:1},8,["onClick"])):Re("",!0),T.isCalling?(le(),ye(p,{key:4,color:"blue",onClick:d.openTransferDialog},{default:k(()=>[w(n,{left:""},{default:k(()=>[x("mdi-phone-transfer")]),_:1}),x(" Transfer ")]),_:1},8,["onClick"])):Re("",!0)])]),_:1})]),_:1})]),_:1},8,["modelValue"]),w(N,{modelValue:T.incomingCallDialog,"onUpdate:modelValue":D[17]||(D[17]=m=>T.incomingCallDialog=m),"max-width":"600"},{default:k(()=>[w(e,null,{default:k(()=>[w(y,null,{default:k(()=>[x(" Incoming Call "),w(A),w(p,{icon:"",onClick:D[16]||(D[16]=m=>T.incomingCallDialog=!1)},{default:k(()=>[w(n,null,{default:k(()=>[x("mdi-close")]),_:1})]),_:1})]),_:1}),w(o,null,{default:k(()=>[G("p",null,"Call from: "+ae(T.incomingCall.from),1),G("p",null,"Duration: "+ae(T.incomingCall.duration),1)]),_:1}),w(O,null,{default:k(()=>[w(p,{color:"success",onClick:d.answerCall},{default:k(()=>[x(" Answer ")]),_:1},8,["onClick"]),w(p,{color:"red",onClick:d.hangupCall},{default:k(()=>[x(" Reject ")]),_:1},8,["onClick"]),w(p,{color:"primary",onClick:d.transferCall},{default:k(()=>[x(" Transfer ")]),_:1},8,["onClick"]),T.isCalling?(le(),ye(p,{key:0,color:"warning",onClick:d.handleMute},{default:k(()=>[w(n,{left:""},{default:k(()=>[x(ae(T.isMuted?"mdi-microphone-off":"mdi-microphone"),1)]),_:1}),x(" "+ae(T.isMuted?"Unmute":"Mute"),1)]),_:1},8,["onClick"])):Re("",!0),T.isCalling?(le(),ye(p,{key:1,color:"primary",onClick:d.handleHoldToggle},{default:k(()=>[w(n,{left:""},{default:k(()=>[x(ae(T.isOnHold?"mdi-phone-transfer":"mdi-pause"),1)]),_:1}),x(" "+ae(T.isOnHold?"Unhold":"Hold"),1)]),_:1},8,["onClick"])):Re("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),w(N,{modelValue:T.transferDialog,"onUpdate:modelValue":D[19]||(D[19]=m=>T.transferDialog=m),"max-width":"600"},{default:k(()=>[w(e,null,{default:k(()=>[w(y,null,{default:k(()=>[x(" Transfer Call "),w(A),w(p,{icon:"",onClick:D[18]||(D[18]=m=>T.transferDialog=!1)},{default:k(()=>[w(n,null,{default:k(()=>[x("mdi-close")]),_:1})]),_:1})]),_:1}),w(o,null,{default:k(()=>[w(R,null,{default:k(()=>[(le(!0),Oe(Le,null,xe(T.availableAgents,m=>(le(),ye(_,{onClick:I=>d.handleTransfer(m),key:m.name,class:"agent-item"},{default:k(()=>[G("div",null,[G("strong",null,ae(T.agent.name),1),G("span",{class:Ge({"text-success":T.agent.status==="available","text-warning":T.agent.status==="engaged","text-grey":T.agent.status==="offline"})}," - "+ae(T.agent.status),3)])]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),w(O)]),_:1})]),_:1},8,["modelValue"]),w(N,{modelValue:T.phonePopup,"onUpdate:modelValue":D[26]||(D[26]=m=>T.phonePopup=m),width:"800"},{default:k(()=>[w(e,null,{default:k(()=>[w(h,null,{default:k(()=>[w(c,{cols:"12",md:"6"},{default:k(()=>[w(e,null,{default:k(()=>[w(y,null,{default:k(()=>[x(" Client Details "),w(A),w(p,{icon:"",onClick:D[20]||(D[20]=m=>T.phonePopup=!1)},{default:k(()=>[w(n,null,{default:k(()=>[x("mdi-close")]),_:1})]),_:1})]),_:1}),w(o,null,{default:k(()=>{var m,I,J,M,K;return[G("div",St,[w(n,{color:"primary",class:"mr-2"},{default:k(()=>[x("mdi-account")]),_:1}),Tt,x(" "+ae((m=T.selectedItem)==null?void 0:m.client),1)]),G("div",bt,[w(n,{color:"primary",class:"mr-2"},{default:k(()=>[x("mdi-email")]),_:1}),kt,x(" "+ae((I=T.selectedItem)==null?void 0:I.email),1)]),G("div",wt,[w(n,{color:"primary",class:"mr-2"},{default:k(()=>[x("mdi-phone")]),_:1}),Rt,x(" "+ae((J=T.selectedItem)==null?void 0:J.phone),1)]),G("div",Pt,[w(n,{color:"primary",class:"mr-2"},{default:k(()=>[x("mdi-phone-classic")]),_:1}),Et,x(" "+ae(((M=T.selectedItem)==null?void 0:M.altPhone)||"N/A"),1)]),G("div",_t,[w(n,{color:"primary",class:"mr-2"},{default:k(()=>[x("mdi-map-marker")]),_:1}),Dt,x(" "+ae(((K=T.selectedItem)==null?void 0:K.location)||"N/A"),1)])]}),_:1})]),_:1})]),_:1}),w(c,{cols:"12",md:"6"},{default:k(()=>[w(e,null,{default:k(()=>[w(R,{dense:""},{default:k(()=>[w(_,{onClick:D[21]||(D[21]=m=>{var I;return d.callClient((I=T.selectedItem)==null?void 0:I.phone)})},{default:k(()=>[w(j,null,{default:k(()=>[w(n,{color:"primary"},{default:k(()=>[x("mdi-phone")]),_:1})]),_:1}),w(B,null,{default:k(()=>[w(re,null,{default:k(()=>[x("Call Client")]),_:1})]),_:1})]),_:1}),w(_,{onClick:D[22]||(D[22]=m=>{var I;return T.sendSms((I=T.selectedItem)==null?void 0:I.phone)})},{default:k(()=>[w(j,null,{default:k(()=>[w(n,{color:"primary"},{default:k(()=>[x("mdi-message")]),_:1})]),_:1}),w(B,null,{default:k(()=>[w(re,null,{default:k(()=>[x("Send SMS")]),_:1})]),_:1})]),_:1}),w(_,{onClick:D[23]||(D[23]=m=>{var I;return d.sendWhatsApp((I=T.selectedItem)==null?void 0:I.phone)})},{default:k(()=>[w(j,null,{default:k(()=>[w(n,{color:"success"},{default:k(()=>[x("mdi-whatsapp")]),_:1})]),_:1}),w(B,null,{default:k(()=>[w(re,null,{default:k(()=>[x("Send WhatsApp Message")]),_:1})]),_:1})]),_:1}),w(_,{onClick:D[24]||(D[24]=m=>{var I;return T.sendEmail((I=T.selectedItem)==null?void 0:I.email)})},{default:k(()=>[w(j,null,{default:k(()=>[w(n,{color:"primary"},{default:k(()=>[x("mdi-email")]),_:1})]),_:1}),w(B,null,{default:k(()=>[w(re,null,{default:k(()=>[x("Send Email")]),_:1})]),_:1})]),_:1}),w(_,{onClick:D[25]||(D[25]=m=>{var I;return d.sendTelegram((I=T.selectedItem)==null?void 0:I.phone)})},{default:k(()=>[w(j,null,{default:k(()=>[w(n,{color:"info"},{default:k(()=>[x("mdi-telegram")]),_:1})]),_:1}),w(B,null,{default:k(()=>[w(re,null,{default:k(()=>[x("Send Telegram Message")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})])]),_:1})}const xt=Ze(at,[["render",It]]);export{xt as default};

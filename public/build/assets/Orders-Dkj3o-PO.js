import{A as $e}from"./AppLayout-BqWHYPIp.js";import{z as Qe,r as je,i as ae,o as de,c as ye,w,a as F,b as R,f as L,d as Oe,g as Ae,F as Le,e as Re,t as ne,n as Ge}from"./app-BwzjHxNJ.js";import{_ as Ke}from"./_plugin-vue_export-helper-DlAUqK2U.js";var Fe={exports:{}};(function(k,I){(function(J,z){k.exports=z()})(window,function(){return function(J){var z={};function O(l){if(z[l])return z[l].exports;var r=z[l]={i:l,l:!1,exports:{}};return J[l].call(r.exports,r,r.exports,O),r.l=!0,r.exports}return O.m=J,O.c=z,O.d=function(l,r,o){O.o(l,r)||Object.defineProperty(l,r,{enumerable:!0,get:o})},O.r=function(l){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(l,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(l,"__esModule",{value:!0})},O.t=function(l,r){if(1&r&&(l=O(l)),8&r||4&r&&typeof l=="object"&&l&&l.__esModule)return l;var o=Object.create(null);if(O.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:l}),2&r&&typeof l!="string")for(var e in l)O.d(o,e,(function(c){return l[c]}).bind(null,e));return o},O.n=function(l){var r=l&&l.__esModule?function(){return l.default}:function(){return l};return O.d(r,"a",r),r},O.o=function(l,r){return Object.prototype.hasOwnProperty.call(l,r)},O.p="",O(O.s=3)}([function(J,z,O){(function(l){var r=O(6);J.exports=r({window:l.window})}).call(this,O(5))},function(J,z,O){var l=!0,r=!0;function o(e,c,d){var n=e.match(c);return n&&n.length>=d&&parseInt(n[d],10)}J.exports={extractVersion:o,wrapPeerConnectionEvent:function(e,c,d){if(e.RTCPeerConnection){var n=e.RTCPeerConnection.prototype,g=n.addEventListener;n.addEventListener=function(v,s){if(v!==c)return g.apply(this,arguments);var u=function(t){var a=d(t);a&&s(a)};return this._eventMap=this._eventMap||{},this._eventMap[s]=u,g.apply(this,[v,u])};var h=n.removeEventListener;n.removeEventListener=function(v,s){if(v!==c||!this._eventMap||!this._eventMap[s])return h.apply(this,arguments);var u=this._eventMap[s];return delete this._eventMap[s],h.apply(this,[v,u])},Object.defineProperty(n,"on"+c,{get:function(){return this["_on"+c]},set:function(v){this["_on"+c]&&(this.removeEventListener(c,this["_on"+c]),delete this["_on"+c]),v&&this.addEventListener(c,this["_on"+c]=v)},enumerable:!0,configurable:!0})}},disableLog:function(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(l=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},disableWarnings:function(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(r=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))},log:function(){if(typeof window=="object"){if(l)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}},deprecated:function(e,c){r&&console.warn(e+" is deprecated, please use "+c+" instead.")},detectBrowser:function(e){var c=e&&e.navigator,d={browser:null,version:null};if(e===void 0||!e.navigator)return d.browser="Not a browser.",d;if(c.mozGetUserMedia)d.browser="firefox",d.version=o(c.userAgent,/Firefox\/(\d+)\./,1);else if(c.webkitGetUserMedia)d.browser="chrome",d.version=o(c.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(c.mediaDevices&&c.userAgent.match(/Edge\/(\d+).(\d+)$/))d.browser="edge",d.version=o(c.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!c.userAgent.match(/AppleWebKit\/(\d+)\./))return d.browser="Not a supported browser.",d;d.browser="safari",d.version=o(c.userAgent,/AppleWebKit\/(\d+)\./,1)}return d}}},function(J,z,O){var l={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};l.localCName=l.generateIdentifier(),l.splitLines=function(r){return r.trim().split(`
`).map(function(o){return o.trim()})},l.splitSections=function(r){return r.split(`
m=`).map(function(o,e){return(e>0?"m="+o:o).trim()+`\r
`})},l.getDescription=function(r){var o=l.splitSections(r);return o&&o[0]},l.getMediaSections=function(r){var o=l.splitSections(r);return o.shift(),o},l.matchPrefix=function(r,o){return l.splitLines(r).filter(function(e){return e.indexOf(o)===0})},l.parseCandidate=function(r){for(var o,e={foundation:(o=r.indexOf("a=candidate:")===0?r.substring(12).split(" "):r.substring(10).split(" "))[0],component:parseInt(o[1],10),protocol:o[2].toLowerCase(),priority:parseInt(o[3],10),ip:o[4],address:o[4],port:parseInt(o[5],10),type:o[7]},c=8;c<o.length;c+=2)switch(o[c]){case"raddr":e.relatedAddress=o[c+1];break;case"rport":e.relatedPort=parseInt(o[c+1],10);break;case"tcptype":e.tcpType=o[c+1];break;case"ufrag":e.ufrag=o[c+1],e.usernameFragment=o[c+1];break;default:e[o[c]]=o[c+1]}return e},l.writeCandidate=function(r){var o=[];o.push(r.foundation),o.push(r.component),o.push(r.protocol.toUpperCase()),o.push(r.priority),o.push(r.address||r.ip),o.push(r.port);var e=r.type;return o.push("typ"),o.push(e),e!=="host"&&r.relatedAddress&&r.relatedPort&&(o.push("raddr"),o.push(r.relatedAddress),o.push("rport"),o.push(r.relatedPort)),r.tcpType&&r.protocol.toLowerCase()==="tcp"&&(o.push("tcptype"),o.push(r.tcpType)),(r.usernameFragment||r.ufrag)&&(o.push("ufrag"),o.push(r.usernameFragment||r.ufrag)),"candidate:"+o.join(" ")},l.parseIceOptions=function(r){return r.substr(14).split(" ")},l.parseRtpMap=function(r){var o=r.substr(9).split(" "),e={payloadType:parseInt(o.shift(),10)};return o=o[0].split("/"),e.name=o[0],e.clockRate=parseInt(o[1],10),e.channels=o.length===3?parseInt(o[2],10):1,e.numChannels=e.channels,e},l.writeRtpMap=function(r){var o=r.payloadType;r.preferredPayloadType!==void 0&&(o=r.preferredPayloadType);var e=r.channels||r.numChannels||1;return"a=rtpmap:"+o+" "+r.name+"/"+r.clockRate+(e!==1?"/"+e:"")+`\r
`},l.parseExtmap=function(r){var o=r.substr(9).split(" ");return{id:parseInt(o[0],10),direction:o[0].indexOf("/")>0?o[0].split("/")[1]:"sendrecv",uri:o[1]}},l.writeExtmap=function(r){return"a=extmap:"+(r.id||r.preferredId)+(r.direction&&r.direction!=="sendrecv"?"/"+r.direction:"")+" "+r.uri+`\r
`},l.parseFmtp=function(r){for(var o,e={},c=r.substr(r.indexOf(" ")+1).split(";"),d=0;d<c.length;d++)e[(o=c[d].trim().split("="))[0].trim()]=o[1];return e},l.writeFmtp=function(r){var o="",e=r.payloadType;if(r.preferredPayloadType!==void 0&&(e=r.preferredPayloadType),r.parameters&&Object.keys(r.parameters).length){var c=[];Object.keys(r.parameters).forEach(function(d){r.parameters[d]?c.push(d+"="+r.parameters[d]):c.push(d)}),o+="a=fmtp:"+e+" "+c.join(";")+`\r
`}return o},l.parseRtcpFb=function(r){var o=r.substr(r.indexOf(" ")+1).split(" ");return{type:o.shift(),parameter:o.join(" ")}},l.writeRtcpFb=function(r){var o="",e=r.payloadType;return r.preferredPayloadType!==void 0&&(e=r.preferredPayloadType),r.rtcpFeedback&&r.rtcpFeedback.length&&r.rtcpFeedback.forEach(function(c){o+="a=rtcp-fb:"+e+" "+c.type+(c.parameter&&c.parameter.length?" "+c.parameter:"")+`\r
`}),o},l.parseSsrcMedia=function(r){var o=r.indexOf(" "),e={ssrc:parseInt(r.substr(7,o-7),10)},c=r.indexOf(":",o);return c>-1?(e.attribute=r.substr(o+1,c-o-1),e.value=r.substr(c+1)):e.attribute=r.substr(o+1),e},l.parseSsrcGroup=function(r){var o=r.substr(13).split(" ");return{semantics:o.shift(),ssrcs:o.map(function(e){return parseInt(e,10)})}},l.getMid=function(r){var o=l.matchPrefix(r,"a=mid:")[0];if(o)return o.substr(6)},l.parseFingerprint=function(r){var o=r.substr(14).split(" ");return{algorithm:o[0].toLowerCase(),value:o[1]}},l.getDtlsParameters=function(r,o){return{role:"auto",fingerprints:l.matchPrefix(r+o,"a=fingerprint:").map(l.parseFingerprint)}},l.writeDtlsParameters=function(r,o){var e="a=setup:"+o+`\r
`;return r.fingerprints.forEach(function(c){e+="a=fingerprint:"+c.algorithm+" "+c.value+`\r
`}),e},l.getIceParameters=function(r,o){var e=l.splitLines(r);return{usernameFragment:(e=e.concat(l.splitLines(o))).filter(function(c){return c.indexOf("a=ice-ufrag:")===0})[0].substr(12),password:e.filter(function(c){return c.indexOf("a=ice-pwd:")===0})[0].substr(10)}},l.writeIceParameters=function(r){return"a=ice-ufrag:"+r.usernameFragment+`\r
a=ice-pwd:`+r.password+`\r
`},l.parseRtpParameters=function(r){for(var o={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},e=l.splitLines(r)[0].split(" "),c=3;c<e.length;c++){var d=e[c],n=l.matchPrefix(r,"a=rtpmap:"+d+" ")[0];if(n){var g=l.parseRtpMap(n),h=l.matchPrefix(r,"a=fmtp:"+d+" ");switch(g.parameters=h.length?l.parseFmtp(h[0]):{},g.rtcpFeedback=l.matchPrefix(r,"a=rtcp-fb:"+d+" ").map(l.parseRtcpFb),o.codecs.push(g),g.name.toUpperCase()){case"RED":case"ULPFEC":o.fecMechanisms.push(g.name.toUpperCase())}}}return l.matchPrefix(r,"a=extmap:").forEach(function(v){o.headerExtensions.push(l.parseExtmap(v))}),o},l.writeRtpDescription=function(r,o){var e="";e+="m="+r+" ",e+=o.codecs.length>0?"9":"0",e+=" UDP/TLS/RTP/SAVPF ",e+=o.codecs.map(function(d){return d.preferredPayloadType!==void 0?d.preferredPayloadType:d.payloadType}).join(" ")+`\r
`,e+=`c=IN IP4 0.0.0.0\r
`,e+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,o.codecs.forEach(function(d){e+=l.writeRtpMap(d),e+=l.writeFmtp(d),e+=l.writeRtcpFb(d)});var c=0;return o.codecs.forEach(function(d){d.maxptime>c&&(c=d.maxptime)}),c>0&&(e+="a=maxptime:"+c+`\r
`),e+=`a=rtcp-mux\r
`,o.headerExtensions&&o.headerExtensions.forEach(function(d){e+=l.writeExtmap(d)}),e},l.parseRtpEncodingParameters=function(r){var o,e=[],c=l.parseRtpParameters(r),d=c.fecMechanisms.indexOf("RED")!==-1,n=c.fecMechanisms.indexOf("ULPFEC")!==-1,g=l.matchPrefix(r,"a=ssrc:").map(function(u){return l.parseSsrcMedia(u)}).filter(function(u){return u.attribute==="cname"}),h=g.length>0&&g[0].ssrc,v=l.matchPrefix(r,"a=ssrc-group:FID").map(function(u){return u.substr(17).split(" ").map(function(t){return parseInt(t,10)})});v.length>0&&v[0].length>1&&v[0][0]===h&&(o=v[0][1]),c.codecs.forEach(function(u){if(u.name.toUpperCase()==="RTX"&&u.parameters.apt){var t={ssrc:h,codecPayloadType:parseInt(u.parameters.apt,10)};h&&o&&(t.rtx={ssrc:o}),e.push(t),d&&((t=JSON.parse(JSON.stringify(t))).fec={ssrc:h,mechanism:n?"red+ulpfec":"red"},e.push(t))}}),e.length===0&&h&&e.push({ssrc:h});var s=l.matchPrefix(r,"b=");return s.length&&(s=s[0].indexOf("b=TIAS:")===0?parseInt(s[0].substr(7),10):s[0].indexOf("b=AS:")===0?1e3*parseInt(s[0].substr(5),10)*.95-16e3:void 0,e.forEach(function(u){u.maxBitrate=s})),e},l.parseRtcpParameters=function(r){var o={},e=l.matchPrefix(r,"a=ssrc:").map(function(n){return l.parseSsrcMedia(n)}).filter(function(n){return n.attribute==="cname"})[0];e&&(o.cname=e.value,o.ssrc=e.ssrc);var c=l.matchPrefix(r,"a=rtcp-rsize");o.reducedSize=c.length>0,o.compound=c.length===0;var d=l.matchPrefix(r,"a=rtcp-mux");return o.mux=d.length>0,o},l.parseMsid=function(r){var o,e=l.matchPrefix(r,"a=msid:");if(e.length===1)return{stream:(o=e[0].substr(7).split(" "))[0],track:o[1]};var c=l.matchPrefix(r,"a=ssrc:").map(function(d){return l.parseSsrcMedia(d)}).filter(function(d){return d.attribute==="msid"});return c.length>0?{stream:(o=c[0].value.split(" "))[0],track:o[1]}:void 0},l.generateSessionId=function(){return Math.random().toString().substr(2,21)},l.writeSessionBoilerplate=function(r,o,e){var c=o!==void 0?o:2;return`v=0\r
o=`+(e||"thisisadapterortc")+" "+(r||l.generateSessionId())+" "+c+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},l.writeMediaSection=function(r,o,e,c){var d=l.writeRtpDescription(r.kind,o);if(d+=l.writeIceParameters(r.iceGatherer.getLocalParameters()),d+=l.writeDtlsParameters(r.dtlsTransport.getLocalParameters(),e==="offer"?"actpass":"active"),d+="a=mid:"+r.mid+`\r
`,r.direction?d+="a="+r.direction+`\r
`:r.rtpSender&&r.rtpReceiver?d+=`a=sendrecv\r
`:r.rtpSender?d+=`a=sendonly\r
`:r.rtpReceiver?d+=`a=recvonly\r
`:d+=`a=inactive\r
`,r.rtpSender){var n="msid:"+c.id+" "+r.rtpSender.track.id+`\r
`;d+="a="+n,d+="a=ssrc:"+r.sendEncodingParameters[0].ssrc+" "+n,r.sendEncodingParameters[0].rtx&&(d+="a=ssrc:"+r.sendEncodingParameters[0].rtx.ssrc+" "+n,d+="a=ssrc-group:FID "+r.sendEncodingParameters[0].ssrc+" "+r.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return d+="a=ssrc:"+r.sendEncodingParameters[0].ssrc+" cname:"+l.localCName+`\r
`,r.rtpSender&&r.sendEncodingParameters[0].rtx&&(d+="a=ssrc:"+r.sendEncodingParameters[0].rtx.ssrc+" cname:"+l.localCName+`\r
`),d},l.getDirection=function(r,o){for(var e=l.splitLines(r),c=0;c<e.length;c++)switch(e[c]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return e[c].substr(2)}return o?l.getDirection(o):"sendrecv"},l.getKind=function(r){return l.splitLines(r)[0].split(" ")[0].substr(2)},l.isRejected=function(r){return r.split(" ",2)[1]==="0"},l.parseMLine=function(r){var o=l.splitLines(r)[0].substr(2).split(" ");return{kind:o[0],port:parseInt(o[1],10),protocol:o[2],fmt:o.slice(3).join(" ")}},l.parseOLine=function(r){var o=l.matchPrefix(r,"o=")[0].substr(2).split(" ");return{username:o[0],sessionId:o[1],sessionVersion:parseInt(o[2],10),netType:o[3],addressType:o[4],address:o[5]}},l.isValidSDP=function(r){if(typeof r!="string"||r.length===0)return!1;for(var o=l.splitLines(r),e=0;e<o.length;e++)if(o[e].length<2||o[e].charAt(1)!=="=")return!1;return!0},J.exports=l},function(J,z,O){O(4),J.exports=O(17)},function(J,z,O){var l=function(r){var o=Object.prototype,e=o.hasOwnProperty,c=typeof Symbol=="function"?Symbol:{},d=c.iterator||"@@iterator",n=c.asyncIterator||"@@asyncIterator",g=c.toStringTag||"@@toStringTag";function h(P,E,N,W){var M=E&&E.prototype instanceof u?E:u,re=Object.create(M.prototype),le=new D(W||[]);return re._invoke=function(ve,ce,V){var Y="suspendedStart";return function(fe,X){if(Y==="executing")throw new Error("Generator is already running");if(Y==="completed"){if(fe==="throw")throw X;return Q()}for(V.method=fe,V.arg=X;;){var Ce=V.delegate;if(Ce){var Se=G(Ce,V);if(Se){if(Se===s)continue;return Se}}if(V.method==="next")V.sent=V._sent=V.arg;else if(V.method==="throw"){if(Y==="suspendedStart")throw Y="completed",V.arg;V.dispatchException(V.arg)}else V.method==="return"&&V.abrupt("return",V.arg);Y="executing";var ue=v(ve,ce,V);if(ue.type==="normal"){if(Y=V.done?"completed":"suspendedYield",ue.arg===s)continue;return{value:ue.arg,done:V.done}}ue.type==="throw"&&(Y="completed",V.method="throw",V.arg=ue.arg)}}}(P,N,le),re}function v(P,E,N){try{return{type:"normal",arg:P.call(E,N)}}catch(W){return{type:"throw",arg:W}}}r.wrap=h;var s={};function u(){}function t(){}function a(){}var i={};i[d]=function(){return this};var f=Object.getPrototypeOf,y=f&&f(f(U([])));y&&y!==o&&e.call(y,d)&&(i=y);var _=a.prototype=u.prototype=Object.create(i);function T(P){["next","throw","return"].forEach(function(E){P[E]=function(N){return this._invoke(E,N)}})}function x(P,E){var N;this._invoke=function(W,M){function re(){return new E(function(le,ve){(function ce(V,Y,fe,X){var Ce=v(P[V],P,Y);if(Ce.type!=="throw"){var Se=Ce.arg,ue=Se.value;return ue&&typeof ue=="object"&&e.call(ue,"__await")?E.resolve(ue.__await).then(function(ge){ce("next",ge,fe,X)},function(ge){ce("throw",ge,fe,X)}):E.resolve(ue).then(function(ge){Se.value=ge,fe(Se)},function(ge){return ce("throw",ge,fe,X)})}X(Ce.arg)})(W,M,le,ve)})}return N=N?N.then(re,re):re()}}function G(P,E){var N=P.iterator[E.method];if(N===void 0){if(E.delegate=null,E.method==="throw"){if(P.iterator.return&&(E.method="return",E.arg=void 0,G(P,E),E.method==="throw"))return s;E.method="throw",E.arg=new TypeError("The iterator does not provide a 'throw' method")}return s}var W=v(N,P.iterator,E.arg);if(W.type==="throw")return E.method="throw",E.arg=W.arg,E.delegate=null,s;var M=W.arg;return M?M.done?(E[P.resultName]=M.value,E.next=P.nextLoc,E.method!=="return"&&(E.method="next",E.arg=void 0),E.delegate=null,s):M:(E.method="throw",E.arg=new TypeError("iterator result is not an object"),E.delegate=null,s)}function A(P){var E={tryLoc:P[0]};1 in P&&(E.catchLoc=P[1]),2 in P&&(E.finallyLoc=P[2],E.afterLoc=P[3]),this.tryEntries.push(E)}function j(P){var E=P.completion||{};E.type="normal",delete E.arg,P.completion=E}function D(P){this.tryEntries=[{tryLoc:"root"}],P.forEach(A,this),this.reset(!0)}function U(P){if(P){var E=P[d];if(E)return E.call(P);if(typeof P.next=="function")return P;if(!isNaN(P.length)){var N=-1,W=function M(){for(;++N<P.length;)if(e.call(P,N))return M.value=P[N],M.done=!1,M;return M.value=void 0,M.done=!0,M};return W.next=W}}return{next:Q}}function Q(){return{value:void 0,done:!0}}return t.prototype=_.constructor=a,a.constructor=t,a[g]=t.displayName="GeneratorFunction",r.isGeneratorFunction=function(P){var E=typeof P=="function"&&P.constructor;return!!E&&(E===t||(E.displayName||E.name)==="GeneratorFunction")},r.mark=function(P){return Object.setPrototypeOf?Object.setPrototypeOf(P,a):(P.__proto__=a,g in P||(P[g]="GeneratorFunction")),P.prototype=Object.create(_),P},r.awrap=function(P){return{__await:P}},T(x.prototype),x.prototype[n]=function(){return this},r.AsyncIterator=x,r.async=function(P,E,N,W,M){M===void 0&&(M=Promise);var re=new x(h(P,E,N,W),M);return r.isGeneratorFunction(E)?re:re.next().then(function(le){return le.done?le.value:re.next()})},T(_),_[g]="Generator",_[d]=function(){return this},_.toString=function(){return"[object Generator]"},r.keys=function(P){var E=[];for(var N in P)E.push(N);return E.reverse(),function W(){for(;E.length;){var M=E.pop();if(M in P)return W.value=M,W.done=!1,W}return W.done=!0,W}},r.values=U,D.prototype={constructor:D,reset:function(P){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(j),!P)for(var E in this)E.charAt(0)==="t"&&e.call(this,E)&&!isNaN(+E.slice(1))&&(this[E]=void 0)},stop:function(){this.done=!0;var P=this.tryEntries[0].completion;if(P.type==="throw")throw P.arg;return this.rval},dispatchException:function(P){if(this.done)throw P;var E=this;function N(ce,V){return re.type="throw",re.arg=P,E.next=ce,V&&(E.method="next",E.arg=void 0),!!V}for(var W=this.tryEntries.length-1;W>=0;--W){var M=this.tryEntries[W],re=M.completion;if(M.tryLoc==="root")return N("end");if(M.tryLoc<=this.prev){var le=e.call(M,"catchLoc"),ve=e.call(M,"finallyLoc");if(le&&ve){if(this.prev<M.catchLoc)return N(M.catchLoc,!0);if(this.prev<M.finallyLoc)return N(M.finallyLoc)}else if(le){if(this.prev<M.catchLoc)return N(M.catchLoc,!0)}else{if(!ve)throw new Error("try statement without catch or finally");if(this.prev<M.finallyLoc)return N(M.finallyLoc)}}}},abrupt:function(P,E){for(var N=this.tryEntries.length-1;N>=0;--N){var W=this.tryEntries[N];if(W.tryLoc<=this.prev&&e.call(W,"finallyLoc")&&this.prev<W.finallyLoc){var M=W;break}}M&&(P==="break"||P==="continue")&&M.tryLoc<=E&&E<=M.finallyLoc&&(M=null);var re=M?M.completion:{};return re.type=P,re.arg=E,M?(this.method="next",this.next=M.finallyLoc,s):this.complete(re)},complete:function(P,E){if(P.type==="throw")throw P.arg;return P.type==="break"||P.type==="continue"?this.next=P.arg:P.type==="return"?(this.rval=this.arg=P.arg,this.method="return",this.next="end"):P.type==="normal"&&E&&(this.next=E),s},finish:function(P){for(var E=this.tryEntries.length-1;E>=0;--E){var N=this.tryEntries[E];if(N.finallyLoc===P)return this.complete(N.completion,N.afterLoc),j(N),s}},catch:function(P){for(var E=this.tryEntries.length-1;E>=0;--E){var N=this.tryEntries[E];if(N.tryLoc===P){var W=N.completion;if(W.type==="throw"){var M=W.arg;j(N)}return M}}throw new Error("illegal catch attempt")},delegateYield:function(P,E,N){return this.delegate={iterator:U(P),resultName:E,nextLoc:N},this.method==="next"&&(this.arg=void 0),s}},r}(J.exports);try{regeneratorRuntime=l}catch{Function("r","regeneratorRuntime = r")(l)}},function(J,z){var O;O=function(){return this}();try{O=O||new Function("return this")()}catch{typeof window=="object"&&(O=window)}J.exports=O},function(J,z,O){var l=O(1);J.exports=function(r,o){var e=r&&r.window,c={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0};for(var d in o)hasOwnProperty.call(o,d)&&(c[d]=o[d]);var n=l.log,g=l.detectBrowser(e),h=O(7)||null,v=O(9)||null,s=O(13)||null,u=O(15)||null,t=O(16)||null,a={browserDetails:g,commonShim:t,extractVersion:l.extractVersion,disableLog:l.disableLog,disableWarnings:l.disableWarnings};switch(g.browser){case"chrome":if(!h||!h.shimPeerConnection||!c.shimChrome)return n("Chrome shim is not included in this adapter release."),a;n("adapter.js shimming chrome."),a.browserShim=h,t.shimCreateObjectURL(e),h.shimGetUserMedia(e),h.shimMediaStream(e),h.shimSourceObject(e),h.shimPeerConnection(e),h.shimOnTrack(e),h.shimAddTrackRemoveTrack(e),h.shimGetSendersWithDtmf(e),h.shimSenderReceiverGetStats(e),h.fixNegotiationNeeded(e),t.shimRTCIceCandidate(e),t.shimMaxMessageSize(e),t.shimSendThrowTypeError(e);break;case"firefox":if(!s||!s.shimPeerConnection||!c.shimFirefox)return n("Firefox shim is not included in this adapter release."),a;n("adapter.js shimming firefox."),a.browserShim=s,t.shimCreateObjectURL(e),s.shimGetUserMedia(e),s.shimSourceObject(e),s.shimPeerConnection(e),s.shimOnTrack(e),s.shimRemoveStream(e),s.shimSenderGetStats(e),s.shimReceiverGetStats(e),s.shimRTCDataChannel(e),t.shimRTCIceCandidate(e),t.shimMaxMessageSize(e),t.shimSendThrowTypeError(e);break;case"edge":if(!v||!v.shimPeerConnection||!c.shimEdge)return n("MS edge shim is not included in this adapter release."),a;n("adapter.js shimming edge."),a.browserShim=v,t.shimCreateObjectURL(e),v.shimGetUserMedia(e),v.shimPeerConnection(e),v.shimReplaceTrack(e),v.shimGetDisplayMedia(e),t.shimMaxMessageSize(e),t.shimSendThrowTypeError(e);break;case"safari":if(!u||!c.shimSafari)return n("Safari shim is not included in this adapter release."),a;n("adapter.js shimming safari."),a.browserShim=u,t.shimCreateObjectURL(e),u.shimRTCIceServerUrls(e),u.shimCreateOfferLegacy(e),u.shimCallbacksAPI(e),u.shimLocalStreamsAPI(e),u.shimRemoteStreamsAPI(e),u.shimTrackEventTransceiver(e),u.shimGetUserMedia(e),t.shimRTCIceCandidate(e),t.shimMaxMessageSize(e),t.shimSendThrowTypeError(e);break;default:n("Unsupported browser!")}return a}},function(J,z,O){var l=O(1),r=l.log;function o(e,c,d){var n=d?"outbound-rtp":"inbound-rtp",g=new Map;if(c===null)return g;var h=[];return e.forEach(function(v){v.type==="track"&&v.trackIdentifier===c.id&&h.push(v)}),h.forEach(function(v){e.forEach(function(s){s.type===n&&s.trackId===v.id&&function u(t,a,i){a&&!i.has(a.id)&&(i.set(a.id,a),Object.keys(a).forEach(function(f){f.endsWith("Id")?u(t,t.get(a[f]),i):f.endsWith("Ids")&&a[f].forEach(function(y){u(t,t.get(y),i)})}))}(e,s,g)})}),g}J.exports={shimGetUserMedia:O(8),shimMediaStream:function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},shimOnTrack:function(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(d){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=d)},enumerable:!0,configurable:!0});var c=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var d=this;return d._ontrackpoly||(d._ontrackpoly=function(n){n.stream.addEventListener("addtrack",function(g){var h;h=e.RTCPeerConnection.prototype.getReceivers?d.getReceivers().find(function(s){return s.track&&s.track.id===g.track.id}):{track:g.track};var v=new Event("track");v.track=g.track,v.receiver=h,v.transceiver={receiver:h},v.streams=[n.stream],d.dispatchEvent(v)}),n.stream.getTracks().forEach(function(g){var h;h=e.RTCPeerConnection.prototype.getReceivers?d.getReceivers().find(function(s){return s.track&&s.track.id===g.id}):{track:g};var v=new Event("track");v.track=g,v.receiver=h,v.transceiver={receiver:h},v.streams=[n.stream],d.dispatchEvent(v)})},d.addEventListener("addstream",d._ontrackpoly)),c.apply(d,arguments)}}else l.wrapPeerConnectionEvent(e,"track",function(d){return d.transceiver||Object.defineProperty(d,"transceiver",{value:{receiver:d.receiver}}),d})},shimGetSendersWithDtmf:function(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var c=function(s,u){return{track:u,get dtmf(){return this._dtmf===void 0&&(u.kind==="audio"?this._dtmf=s.createDTMFSender(u):this._dtmf=null),this._dtmf},_pc:s}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var d=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(s,u){var t=this,a=d.apply(t,arguments);return a||(a=c(t,s),t._senders.push(a)),a};var n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(s){var u=this;n.apply(u,arguments);var t=u._senders.indexOf(s);t!==-1&&u._senders.splice(t,1)}}var g=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(s){var u=this;u._senders=u._senders||[],g.apply(u,[s]),s.getTracks().forEach(function(t){u._senders.push(c(u,t))})};var h=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(s){var u=this;u._senders=u._senders||[],h.apply(u,[s]),s.getTracks().forEach(function(t){var a=u._senders.find(function(i){return i.track===t});a&&u._senders.splice(u._senders.indexOf(a),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var v=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var s=this,u=v.apply(s,[]);return u.forEach(function(t){t._pc=s}),u},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},shimSenderReceiverGetStats:function(e){if(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var c=e.RTCPeerConnection.prototype.getSenders;c&&(e.RTCPeerConnection.prototype.getSenders=function(){var h=this,v=c.apply(h,[]);return v.forEach(function(s){s._pc=h}),v});var d=e.RTCPeerConnection.prototype.addTrack;d&&(e.RTCPeerConnection.prototype.addTrack=function(){var h=d.apply(this,arguments);return h._pc=this,h}),e.RTCRtpSender.prototype.getStats=function(){var h=this;return this._pc.getStats().then(function(v){return o(v,h.track,!0)})}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){var h=this,v=n.apply(h,[]);return v.forEach(function(s){s._pc=h}),v}),l.wrapPeerConnectionEvent(e,"track",function(h){return h.receiver._pc=h.srcElement,h}),e.RTCRtpReceiver.prototype.getStats=function(){var h=this;return this._pc.getStats().then(function(v){return o(v,h.track,!1)})}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var g=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var h=this;if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var v,s,u,t=arguments[0];return h.getSenders().forEach(function(a){a.track===t&&(v?u=!0:v=a)}),h.getReceivers().forEach(function(a){return a.track===t&&(s?u=!0:s=a),a.track===t}),u||v&&s?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):v?v.getStats():s?s.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return g.apply(h,arguments)}}}},shimSourceObject:function(e){var c=e&&e.URL;typeof e=="object"&&e.HTMLMediaElement&&!("srcObject"in e.HTMLMediaElement.prototype)&&Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(d){var n=this;this._srcObject=d,this.src&&c.revokeObjectURL(this.src),d?(this.src=c.createObjectURL(d),d.addEventListener("addtrack",function(){n.src&&c.revokeObjectURL(n.src),n.src=c.createObjectURL(d)}),d.addEventListener("removetrack",function(){n.src&&c.revokeObjectURL(n.src),n.src=c.createObjectURL(d)})):this.src=""}})},shimAddTrackRemoveTrackWithNative:function(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var h=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(v){return h._shimmedLocalStreams[v][0]})};var c=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(h,v){if(!v)return c.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var s=c.apply(this,arguments);return this._shimmedLocalStreams[v.id]?this._shimmedLocalStreams[v.id].indexOf(s)===-1&&this._shimmedLocalStreams[v.id].push(s):this._shimmedLocalStreams[v.id]=[v,s],s};var d=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(h){var v=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},h.getTracks().forEach(function(t){if(v.getSenders().find(function(a){return a.track===t}))throw new DOMException("Track already exists.","InvalidAccessError")});var s=v.getSenders();d.apply(this,arguments);var u=v.getSenders().filter(function(t){return s.indexOf(t)===-1});this._shimmedLocalStreams[h.id]=[h].concat(u)};var n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(h){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[h.id],n.apply(this,arguments)};var g=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(h){var v=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},h&&Object.keys(this._shimmedLocalStreams).forEach(function(s){var u=v._shimmedLocalStreams[s].indexOf(h);u!==-1&&v._shimmedLocalStreams[s].splice(u,1),v._shimmedLocalStreams[s].length===1&&delete v._shimmedLocalStreams[s]}),g.apply(this,arguments)}},shimAddTrackRemoveTrack:function(e){if(e.RTCPeerConnection){var c=l.detectBrowser(e);if(e.RTCPeerConnection.prototype.addTrack&&c.version>=65)return this.shimAddTrackRemoveTrackWithNative(e);var d=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var t=this,a=d.apply(this);return t._reverseStreams=t._reverseStreams||{},a.map(function(i){return t._reverseStreams[i.id]})};var n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var a=this;if(a._streams=a._streams||{},a._reverseStreams=a._reverseStreams||{},t.getTracks().forEach(function(f){if(a.getSenders().find(function(y){return y.track===f}))throw new DOMException("Track already exists.","InvalidAccessError")}),!a._reverseStreams[t.id]){var i=new e.MediaStream(t.getTracks());a._streams[t.id]=i,a._reverseStreams[i.id]=t,t=i}n.apply(a,[t])};var g=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(t){var a=this;a._streams=a._streams||{},a._reverseStreams=a._reverseStreams||{},g.apply(a,[a._streams[t.id]||t]),delete a._reverseStreams[a._streams[t.id]?a._streams[t.id].id:t.id],delete a._streams[t.id]},e.RTCPeerConnection.prototype.addTrack=function(t,a){var i=this;if(i.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var f=[].slice.call(arguments,1);if(f.length!==1||!f[0].getTracks().find(function(x){return x===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");var y=i.getSenders().find(function(x){return x.track===t});if(y)throw new DOMException("Track already exists.","InvalidAccessError");i._streams=i._streams||{},i._reverseStreams=i._reverseStreams||{};var _=i._streams[a.id];if(_)_.addTrack(t),Promise.resolve().then(function(){i.dispatchEvent(new Event("negotiationneeded"))});else{var T=new e.MediaStream([t]);i._streams[a.id]=T,i._reverseStreams[T.id]=a,i.addStream(T)}return i.getSenders().find(function(x){return x.track===t})},["createOffer","createAnswer"].forEach(function(t){var a=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var i=this,f=arguments,y=arguments.length&&typeof arguments[0]=="function";return y?a.apply(i,[function(_){var T=s(i,_);f[0].apply(null,[T])},function(_){f[1]&&f[1].apply(null,_)},arguments[2]]):a.apply(i,arguments).then(function(_){return s(i,_)})}});var h=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){var t=this;return arguments.length&&arguments[0].type&&(arguments[0]=u(t,arguments[0])),h.apply(t,arguments)};var v=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var t=v.get.apply(this);return t.type===""?t:s(this,t)}}),e.RTCPeerConnection.prototype.removeTrack=function(t){var a,i=this;if(i.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!t._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(t._pc!==i)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");i._streams=i._streams||{},Object.keys(i._streams).forEach(function(f){i._streams[f].getTracks().find(function(y){return t.track===y})&&(a=i._streams[f])}),a&&(a.getTracks().length===1?i.removeStream(i._reverseStreams[a.id]):a.removeTrack(t.track),i.dispatchEvent(new Event("negotiationneeded")))}}function s(t,a){var i=a.sdp;return Object.keys(t._reverseStreams||[]).forEach(function(f){var y=t._reverseStreams[f],_=t._streams[y.id];i=i.replace(new RegExp(_.id,"g"),y.id)}),new RTCSessionDescription({type:a.type,sdp:i})}function u(t,a){var i=a.sdp;return Object.keys(t._reverseStreams||[]).forEach(function(f){var y=t._reverseStreams[f],_=t._streams[y.id];i=i.replace(new RegExp(y.id,"g"),_.id)}),new RTCSessionDescription({type:a.type,sdp:i})}},shimPeerConnection:function(e){var c=l.detectBrowser(e);if(!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=function(g,h){return r("PeerConnection"),g&&g.iceTransportPolicy&&(g.iceTransports=g.iceTransportPolicy),new e.webkitRTCPeerConnection(g,h)},e.RTCPeerConnection.prototype=e.webkitRTCPeerConnection.prototype,e.webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.webkitRTCPeerConnection.generateCertificate}})),e.RTCPeerConnection){var d=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(g,h,v){var s=this,u=arguments;if(arguments.length>0&&typeof g=="function")return d.apply(this,arguments);if(d.length===0&&(arguments.length===0||typeof arguments[0]!="function"))return d.apply(this,[]);var t=function(f){var y={};return f.result().forEach(function(_){var T={id:_.id,timestamp:_.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[_.type]||_.type};_.names().forEach(function(x){T[x]=_.stat(x)}),y[T.id]=T}),y},a=function(f){return new Map(Object.keys(f).map(function(y){return[y,f[y]]}))};if(arguments.length>=2){var i=function(f){u[1](a(t(f)))};return d.apply(this,[i,arguments[0]])}return new Promise(function(f,y){d.apply(s,[function(_){f(a(t(_)))},y])}).then(h,v)},c.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(g){var h=e.RTCPeerConnection.prototype[g];e.RTCPeerConnection.prototype[g]=function(){var v=arguments,s=this,u=new Promise(function(t,a){h.apply(s,[v[0],t,a])});return v.length<2?u:u.then(function(){v[1].apply(null,[])},function(t){v.length>=3&&v[2].apply(null,[t])})}}),c.version<52&&["createOffer","createAnswer"].forEach(function(g){var h=e.RTCPeerConnection.prototype[g];e.RTCPeerConnection.prototype[g]=function(){var v=this;if(arguments.length<1||arguments.length===1&&typeof arguments[0]=="object"){var s=arguments.length===1?arguments[0]:void 0;return new Promise(function(u,t){h.apply(v,[u,t,s])})}return h.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(g){var h=e.RTCPeerConnection.prototype[g];e.RTCPeerConnection.prototype[g]=function(){return arguments[0]=new(g==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),h.apply(this,arguments)}});var n=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}},fixNegotiationNeeded:function(e){l.wrapPeerConnectionEvent(e,"negotiationneeded",function(c){if(c.target.signalingState==="stable")return c})},shimGetDisplayMedia:function(e,c){e.navigator&&e.navigator.mediaDevices&&!("getDisplayMedia"in e.navigator.mediaDevices)&&(typeof c=="function"?(e.navigator.mediaDevices.getDisplayMedia=function(d){return c(d).then(function(n){var g=d.video&&d.video.width,h=d.video&&d.video.height,v=d.video&&d.video.frameRate;return d.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:n,maxFrameRate:v||3}},g&&(d.video.mandatory.maxWidth=g),h&&(d.video.mandatory.maxHeight=h),e.navigator.mediaDevices.getUserMedia(d)})},e.navigator.getDisplayMedia=function(d){return l.deprecated("navigator.getDisplayMedia","navigator.mediaDevices.getDisplayMedia"),e.navigator.mediaDevices.getDisplayMedia(d)}):console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}}},function(J,z,O){var l=O(1),r=l.log;J.exports=function(o){var e=l.detectBrowser(o),c=o&&o.navigator,d=function(s){if(typeof s!="object"||s.mandatory||s.optional)return s;var u={};return Object.keys(s).forEach(function(t){if(t!=="require"&&t!=="advanced"&&t!=="mediaSource"){var a=typeof s[t]=="object"?s[t]:{ideal:s[t]};a.exact!==void 0&&typeof a.exact=="number"&&(a.min=a.max=a.exact);var i=function(y,_){return y?y+_.charAt(0).toUpperCase()+_.slice(1):_==="deviceId"?"sourceId":_};if(a.ideal!==void 0){u.optional=u.optional||[];var f={};typeof a.ideal=="number"?(f[i("min",t)]=a.ideal,u.optional.push(f),(f={})[i("max",t)]=a.ideal,u.optional.push(f)):(f[i("",t)]=a.ideal,u.optional.push(f))}a.exact!==void 0&&typeof a.exact!="number"?(u.mandatory=u.mandatory||{},u.mandatory[i("",t)]=a.exact):["min","max"].forEach(function(y){a[y]!==void 0&&(u.mandatory=u.mandatory||{},u.mandatory[i(y,t)]=a[y])})}}),s.advanced&&(u.optional=(u.optional||[]).concat(s.advanced)),u},n=function(s,u){if(e.version>=61)return u(s);if((s=JSON.parse(JSON.stringify(s)))&&typeof s.audio=="object"){var t=function(y,_,T){_ in y&&!(T in y)&&(y[T]=y[_],delete y[_])};t((s=JSON.parse(JSON.stringify(s))).audio,"autoGainControl","googAutoGainControl"),t(s.audio,"noiseSuppression","googNoiseSuppression"),s.audio=d(s.audio)}if(s&&typeof s.video=="object"){var a=s.video.facingMode;a=a&&(typeof a=="object"?a:{ideal:a});var i,f=e.version<66;if(a&&(a.exact==="user"||a.exact==="environment"||a.ideal==="user"||a.ideal==="environment")&&(!c.mediaDevices.getSupportedConstraints||!c.mediaDevices.getSupportedConstraints().facingMode||f)&&(delete s.video.facingMode,a.exact==="environment"||a.ideal==="environment"?i=["back","rear"]:a.exact!=="user"&&a.ideal!=="user"||(i=["front"]),i))return c.mediaDevices.enumerateDevices().then(function(y){var _=(y=y.filter(function(T){return T.kind==="videoinput"})).find(function(T){return i.some(function(x){return T.label.toLowerCase().indexOf(x)!==-1})});return!_&&y.length&&i.indexOf("back")!==-1&&(_=y[y.length-1]),_&&(s.video.deviceId=a.exact?{exact:_.deviceId}:{ideal:_.deviceId}),s.video=d(s.video),r("chrome: "+JSON.stringify(s)),u(s)});s.video=d(s.video)}return r("chrome: "+JSON.stringify(s)),u(s)},g=function(s){return e.version>=64?s:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[s.name]||s.name,message:s.message,constraint:s.constraint||s.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};c.getUserMedia=function(s,u,t){n(s,function(a){c.webkitGetUserMedia(a,u,function(i){t&&t(g(i))})})};var h=function(s){return new Promise(function(u,t){c.getUserMedia(s,u,t)})};if(c.mediaDevices||(c.mediaDevices={getUserMedia:h,enumerateDevices:function(){return new Promise(function(s){var u={audio:"audioinput",video:"videoinput"};return o.MediaStreamTrack.getSources(function(t){s(t.map(function(a){return{label:a.label,kind:u[a.kind],deviceId:a.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),c.mediaDevices.getUserMedia){var v=c.mediaDevices.getUserMedia.bind(c.mediaDevices);c.mediaDevices.getUserMedia=function(s){return n(s,function(u){return v(u).then(function(t){if(u.audio&&!t.getAudioTracks().length||u.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(a){a.stop()}),new DOMException("","NotFoundError");return t},function(t){return Promise.reject(g(t))})})}}else c.mediaDevices.getUserMedia=function(s){return h(s)};c.mediaDevices.addEventListener===void 0&&(c.mediaDevices.addEventListener=function(){r("Dummy mediaDevices.addEventListener called.")}),c.mediaDevices.removeEventListener===void 0&&(c.mediaDevices.removeEventListener=function(){r("Dummy mediaDevices.removeEventListener called.")})}},function(J,z,O){var l=O(1),r=O(10),o=O(11);J.exports={shimGetUserMedia:O(12),shimPeerConnection:function(e){var c=l.detectBrowser(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(g){return g}),e.RTCSessionDescription||(e.RTCSessionDescription=function(g){return g}),c.version<15025)){var d=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(g){d.set.call(this,g);var h=new Event("enabled");h.enabled=g,this.dispatchEvent(h)}})}e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)&&Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=new e.RTCDtmfSender(this):this.track.kind==="video"&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);var n=o(e,c.version);e.RTCPeerConnection=function(g){return g&&g.iceServers&&(g.iceServers=r(g.iceServers)),new n(g)},e.RTCPeerConnection.prototype=n.prototype},shimReplaceTrack:function(e){e.RTCRtpSender&&!("replaceTrack"in e.RTCRtpSender.prototype)&&(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)},shimGetDisplayMedia:function(e,c){if("getDisplayMedia"in e.navigator&&e.navigator.mediaDevices&&!("getDisplayMedia"in e.navigator.mediaDevices)){var d=e.navigator.getDisplayMedia;e.navigator.mediaDevices.getDisplayMedia=function(n){return d.call(e.navigator,n)},e.navigator.getDisplayMedia=function(n){return l.deprecated("navigator.getDisplayMedia","navigator.mediaDevices.getDisplayMedia"),d.call(e.navigator,n)}}}}},function(J,z,O){var l=O(1);J.exports=function(r,o){var e=!1;return(r=JSON.parse(JSON.stringify(r))).filter(function(c){if(c&&(c.urls||c.url)){var d=c.urls||c.url;c.url&&!c.urls&&l.deprecated("RTCIceServer.url","RTCIceServer.urls");var n=typeof d=="string";return n&&(d=[d]),d=d.filter(function(g){return g.indexOf("turn:")===0&&g.indexOf("transport=udp")!==-1&&g.indexOf("turn:[")===-1&&!e?(e=!0,!0):g.indexOf("stun:")===0&&o>=14393&&g.indexOf("?transport=udp")===-1}),delete c.url,c.urls=n?d[0]:d,!!d.length}})}},function(J,z,O){var l=O(2);function r(n,g,h,v,s){var u=l.writeRtpDescription(n.kind,g);if(u+=l.writeIceParameters(n.iceGatherer.getLocalParameters()),u+=l.writeDtlsParameters(n.dtlsTransport.getLocalParameters(),h==="offer"?"actpass":s||"active"),u+="a=mid:"+n.mid+`\r
`,n.rtpSender&&n.rtpReceiver?u+=`a=sendrecv\r
`:n.rtpSender?u+=`a=sendonly\r
`:n.rtpReceiver?u+=`a=recvonly\r
`:u+=`a=inactive\r
`,n.rtpSender){var t=n.rtpSender._initialTrackId||n.rtpSender.track.id;n.rtpSender._initialTrackId=t;var a="msid:"+(v?v.id:"-")+" "+t+`\r
`;u+="a="+a,u+="a=ssrc:"+n.sendEncodingParameters[0].ssrc+" "+a,n.sendEncodingParameters[0].rtx&&(u+="a=ssrc:"+n.sendEncodingParameters[0].rtx.ssrc+" "+a,u+="a=ssrc-group:FID "+n.sendEncodingParameters[0].ssrc+" "+n.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return u+="a=ssrc:"+n.sendEncodingParameters[0].ssrc+" cname:"+l.localCName+`\r
`,n.rtpSender&&n.sendEncodingParameters[0].rtx&&(u+="a=ssrc:"+n.sendEncodingParameters[0].rtx.ssrc+" cname:"+l.localCName+`\r
`),u}function o(n,g){var h={codecs:[],headerExtensions:[],fecMechanisms:[]},v=function(u,t){u=parseInt(u,10);for(var a=0;a<t.length;a++)if(t[a].payloadType===u||t[a].preferredPayloadType===u)return t[a]},s=function(u,t,a,i){var f=v(u.parameters.apt,a),y=v(t.parameters.apt,i);return f&&y&&f.name.toLowerCase()===y.name.toLowerCase()};return n.codecs.forEach(function(u){for(var t=0;t<g.codecs.length;t++){var a=g.codecs[t];if(u.name.toLowerCase()===a.name.toLowerCase()&&u.clockRate===a.clockRate){if(u.name.toLowerCase()==="rtx"&&u.parameters&&a.parameters.apt&&!s(u,a,n.codecs,g.codecs))continue;(a=JSON.parse(JSON.stringify(a))).numChannels=Math.min(u.numChannels,a.numChannels),h.codecs.push(a),a.rtcpFeedback=a.rtcpFeedback.filter(function(i){for(var f=0;f<u.rtcpFeedback.length;f++)if(u.rtcpFeedback[f].type===i.type&&u.rtcpFeedback[f].parameter===i.parameter)return!0;return!1});break}}}),n.headerExtensions.forEach(function(u){for(var t=0;t<g.headerExtensions.length;t++){var a=g.headerExtensions[t];if(u.uri===a.uri){h.headerExtensions.push(a);break}}}),h}function e(n,g,h){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[g][n].indexOf(h)!==-1}function c(n,g){var h=n.getRemoteCandidates().find(function(v){return g.foundation===v.foundation&&g.ip===v.ip&&g.port===v.port&&g.priority===v.priority&&g.protocol===v.protocol&&g.type===v.type});return h||n.addRemoteCandidate(g),!h}function d(n,g){var h=new Error(g);return h.name=n,h.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[n],h}J.exports=function(n,g){function h(t,a){a.addTrack(t),a.dispatchEvent(new n.MediaStreamTrackEvent("addtrack",{track:t}))}function v(t,a,i,f){var y=new Event("track");y.track=a,y.receiver=i,y.transceiver={receiver:i},y.streams=f,n.setTimeout(function(){t._dispatchEvent("track",y)})}var s=function(t){var a=this,i=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(y){a[y]=i[y].bind(i)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",t=JSON.parse(JSON.stringify(t||{})),this.usingBundle=t.bundlePolicy==="max-bundle",t.rtcpMuxPolicy==="negotiate")throw d("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(t.rtcpMuxPolicy||(t.rtcpMuxPolicy="require"),t.iceTransportPolicy){case"all":case"relay":break;default:t.iceTransportPolicy="all"}switch(t.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:t.bundlePolicy="balanced"}if(t.iceServers=function(y,_){var T=!1;return(y=JSON.parse(JSON.stringify(y))).filter(function(x){if(x&&(x.urls||x.url)){var G=x.urls||x.url;x.url&&!x.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var A=typeof G=="string";return A&&(G=[G]),G=G.filter(function(j){return j.indexOf("turn:")===0&&j.indexOf("transport=udp")!==-1&&j.indexOf("turn:[")===-1&&!T?(T=!0,!0):j.indexOf("stun:")===0&&_>=14393&&j.indexOf("?transport=udp")===-1}),delete x.url,x.urls=A?G[0]:G,!!G.length}})}(t.iceServers||[],g),this._iceGatherers=[],t.iceCandidatePoolSize)for(var f=t.iceCandidatePoolSize;f>0;f--)this._iceGatherers.push(new n.RTCIceGatherer({iceServers:t.iceServers,gatherPolicy:t.iceTransportPolicy}));else t.iceCandidatePoolSize=0;this._config=t,this.transceivers=[],this._sdpSessionId=l.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(s.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(s.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),s.prototype.onicecandidate=null,s.prototype.onaddstream=null,s.prototype.ontrack=null,s.prototype.onremovestream=null,s.prototype.onsignalingstatechange=null,s.prototype.oniceconnectionstatechange=null,s.prototype.onconnectionstatechange=null,s.prototype.onicegatheringstatechange=null,s.prototype.onnegotiationneeded=null,s.prototype.ondatachannel=null,s.prototype._dispatchEvent=function(t,a){this._isClosed||(this.dispatchEvent(a),typeof this["on"+t]=="function"&&this["on"+t](a))},s.prototype._emitGatheringStateChange=function(){var t=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",t)},s.prototype.getConfiguration=function(){return this._config},s.prototype.getLocalStreams=function(){return this.localStreams},s.prototype.getRemoteStreams=function(){return this.remoteStreams},s.prototype._createTransceiver=function(t,a){var i=this.transceivers.length>0,f={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:t,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&i)f.iceTransport=this.transceivers[0].iceTransport,f.dtlsTransport=this.transceivers[0].dtlsTransport;else{var y=this._createIceAndDtlsTransports();f.iceTransport=y.iceTransport,f.dtlsTransport=y.dtlsTransport}return a||this.transceivers.push(f),f},s.prototype.addTrack=function(t,a){if(this._isClosed)throw d("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var i;if(this.transceivers.find(function(y){return y.track===t}))throw d("InvalidAccessError","Track already exists.");for(var f=0;f<this.transceivers.length;f++)this.transceivers[f].track||this.transceivers[f].kind!==t.kind||(i=this.transceivers[f]);return i||(i=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),this.localStreams.indexOf(a)===-1&&this.localStreams.push(a),i.track=t,i.stream=a,i.rtpSender=new n.RTCRtpSender(t,i.dtlsTransport),i.rtpSender},s.prototype.addStream=function(t){var a=this;if(g>=15025)t.getTracks().forEach(function(f){a.addTrack(f,t)});else{var i=t.clone();t.getTracks().forEach(function(f,y){var _=i.getTracks()[y];f.addEventListener("enabled",function(T){_.enabled=T.enabled})}),i.getTracks().forEach(function(f){a.addTrack(f,i)})}},s.prototype.removeTrack=function(t){if(this._isClosed)throw d("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof n.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var a=this.transceivers.find(function(f){return f.rtpSender===t});if(!a)throw d("InvalidAccessError","Sender was not created by this connection.");var i=a.stream;a.rtpSender.stop(),a.rtpSender=null,a.track=null,a.stream=null,this.transceivers.map(function(f){return f.stream}).indexOf(i)===-1&&this.localStreams.indexOf(i)>-1&&this.localStreams.splice(this.localStreams.indexOf(i),1),this._maybeFireNegotiationNeeded()},s.prototype.removeStream=function(t){var a=this;t.getTracks().forEach(function(i){var f=a.getSenders().find(function(y){return y.track===i});f&&a.removeTrack(f)})},s.prototype.getSenders=function(){return this.transceivers.filter(function(t){return!!t.rtpSender}).map(function(t){return t.rtpSender})},s.prototype.getReceivers=function(){return this.transceivers.filter(function(t){return!!t.rtpReceiver}).map(function(t){return t.rtpReceiver})},s.prototype._createIceGatherer=function(t,a){var i=this;if(a&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var f=new n.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(f,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(y){var _=!y.candidate||Object.keys(y.candidate).length===0;f.state=_?"completed":"gathering",i.transceivers[t].bufferedCandidateEvents!==null&&i.transceivers[t].bufferedCandidateEvents.push(y)},f.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),f},s.prototype._gather=function(t,a){var i=this,f=this.transceivers[a].iceGatherer;if(!f.onlocalcandidate){var y=this.transceivers[a].bufferedCandidateEvents;this.transceivers[a].bufferedCandidateEvents=null,f.removeEventListener("localcandidate",this.transceivers[a].bufferCandidates),f.onlocalcandidate=function(_){if(!(i.usingBundle&&a>0)){var T=new Event("icecandidate");T.candidate={sdpMid:t,sdpMLineIndex:a};var x=_.candidate,G=!x||Object.keys(x).length===0;if(G)f.state!=="new"&&f.state!=="gathering"||(f.state="completed");else{f.state==="new"&&(f.state="gathering"),x.component=1,x.ufrag=f.getLocalParameters().usernameFragment;var A=l.writeCandidate(x);T.candidate=Object.assign(T.candidate,l.parseCandidate(A)),T.candidate.candidate=A,T.candidate.toJSON=function(){return{candidate:T.candidate.candidate,sdpMid:T.candidate.sdpMid,sdpMLineIndex:T.candidate.sdpMLineIndex,usernameFragment:T.candidate.usernameFragment}}}var j=l.getMediaSections(i._localDescription.sdp);j[T.candidate.sdpMLineIndex]+=G?`a=end-of-candidates\r
`:"a="+T.candidate.candidate+`\r
`,i._localDescription.sdp=l.getDescription(i._localDescription.sdp)+j.join("");var D=i.transceivers.every(function(U){return U.iceGatherer&&U.iceGatherer.state==="completed"});i.iceGatheringState!=="gathering"&&(i.iceGatheringState="gathering",i._emitGatheringStateChange()),G||i._dispatchEvent("icecandidate",T),D&&(i._dispatchEvent("icecandidate",new Event("icecandidate")),i.iceGatheringState="complete",i._emitGatheringStateChange())}},n.setTimeout(function(){y.forEach(function(_){f.onlocalcandidate(_)})},0)}},s.prototype._createIceAndDtlsTransports=function(){var t=this,a=new n.RTCIceTransport(null);a.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var i=new n.RTCDtlsTransport(a);return i.ondtlsstatechange=function(){t._updateConnectionState()},i.onerror=function(){Object.defineProperty(i,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:a,dtlsTransport:i}},s.prototype._disposeIceAndDtlsTransports=function(t){var a=this.transceivers[t].iceGatherer;a&&(delete a.onlocalcandidate,delete this.transceivers[t].iceGatherer);var i=this.transceivers[t].iceTransport;i&&(delete i.onicestatechange,delete this.transceivers[t].iceTransport);var f=this.transceivers[t].dtlsTransport;f&&(delete f.ondtlsstatechange,delete f.onerror,delete this.transceivers[t].dtlsTransport)},s.prototype._transceive=function(t,a,i){var f=o(t.localCapabilities,t.remoteCapabilities);a&&t.rtpSender&&(f.encodings=t.sendEncodingParameters,f.rtcp={cname:l.localCName,compound:t.rtcpParameters.compound},t.recvEncodingParameters.length&&(f.rtcp.ssrc=t.recvEncodingParameters[0].ssrc),t.rtpSender.send(f)),i&&t.rtpReceiver&&f.codecs.length>0&&(t.kind==="video"&&t.recvEncodingParameters&&g<15019&&t.recvEncodingParameters.forEach(function(y){delete y.rtx}),t.recvEncodingParameters.length?f.encodings=t.recvEncodingParameters:f.encodings=[{}],f.rtcp={compound:t.rtcpParameters.compound},t.rtcpParameters.cname&&(f.rtcp.cname=t.rtcpParameters.cname),t.sendEncodingParameters.length&&(f.rtcp.ssrc=t.sendEncodingParameters[0].ssrc),t.rtpReceiver.receive(f))},s.prototype.setLocalDescription=function(t){var a,i,f=this;if(["offer","answer"].indexOf(t.type)===-1)return Promise.reject(d("TypeError",'Unsupported type "'+t.type+'"'));if(!e("setLocalDescription",t.type,f.signalingState)||f._isClosed)return Promise.reject(d("InvalidStateError","Can not set local "+t.type+" in state "+f.signalingState));if(t.type==="offer")a=l.splitSections(t.sdp),i=a.shift(),a.forEach(function(_,T){var x=l.parseRtpParameters(_);f.transceivers[T].localCapabilities=x}),f.transceivers.forEach(function(_,T){f._gather(_.mid,T)});else if(t.type==="answer"){a=l.splitSections(f._remoteDescription.sdp),i=a.shift();var y=l.matchPrefix(i,"a=ice-lite").length>0;a.forEach(function(_,T){var x=f.transceivers[T],G=x.iceGatherer,A=x.iceTransport,j=x.dtlsTransport,D=x.localCapabilities,U=x.remoteCapabilities;if(!(l.isRejected(_)&&l.matchPrefix(_,"a=bundle-only").length===0)&&!x.rejected){var Q=l.getIceParameters(_,i),P=l.getDtlsParameters(_,i);y&&(P.role="server"),f.usingBundle&&T!==0||(f._gather(x.mid,T),A.state==="new"&&A.start(G,Q,y?"controlling":"controlled"),j.state==="new"&&j.start(P));var E=o(D,U);f._transceive(x,E.codecs.length>0,!1)}})}return f._localDescription={type:t.type,sdp:t.sdp},t.type==="offer"?f._updateSignalingState("have-local-offer"):f._updateSignalingState("stable"),Promise.resolve()},s.prototype.setRemoteDescription=function(t){var a=this;if(["offer","answer"].indexOf(t.type)===-1)return Promise.reject(d("TypeError",'Unsupported type "'+t.type+'"'));if(!e("setRemoteDescription",t.type,a.signalingState)||a._isClosed)return Promise.reject(d("InvalidStateError","Can not set remote "+t.type+" in state "+a.signalingState));var i={};a.remoteStreams.forEach(function(A){i[A.id]=A});var f=[],y=l.splitSections(t.sdp),_=y.shift(),T=l.matchPrefix(_,"a=ice-lite").length>0,x=l.matchPrefix(_,"a=group:BUNDLE ").length>0;a.usingBundle=x;var G=l.matchPrefix(_,"a=ice-options:")[0];return a.canTrickleIceCandidates=!!G&&G.substr(14).split(" ").indexOf("trickle")>=0,y.forEach(function(A,j){var D=l.splitLines(A),U=l.getKind(A),Q=l.isRejected(A)&&l.matchPrefix(A,"a=bundle-only").length===0,P=D[0].substr(2).split(" ")[2],E=l.getDirection(A,_),N=l.parseMsid(A),W=l.getMid(A)||l.generateIdentifier();if(Q||U==="application"&&(P==="DTLS/SCTP"||P==="UDP/DTLS/SCTP"))a.transceivers[j]={mid:W,kind:U,protocol:P,rejected:!0};else{var M,re,le,ve,ce,V,Y,fe,X;!Q&&a.transceivers[j]&&a.transceivers[j].rejected&&(a.transceivers[j]=a._createTransceiver(U,!0));var Ce,Se,ue=l.parseRtpParameters(A);Q||(Ce=l.getIceParameters(A,_),(Se=l.getDtlsParameters(A,_)).role="client"),Y=l.parseRtpEncodingParameters(A);var ge=l.parseRtcpParameters(A),xe=l.matchPrefix(A,"a=end-of-candidates",_).length>0,Ee=l.matchPrefix(A,"a=candidate:").map(function(ie){return l.parseCandidate(ie)}).filter(function(ie){return ie.component===1});if((t.type==="offer"||t.type==="answer")&&!Q&&x&&j>0&&a.transceivers[j]&&(a._disposeIceAndDtlsTransports(j),a.transceivers[j].iceGatherer=a.transceivers[0].iceGatherer,a.transceivers[j].iceTransport=a.transceivers[0].iceTransport,a.transceivers[j].dtlsTransport=a.transceivers[0].dtlsTransport,a.transceivers[j].rtpSender&&a.transceivers[j].rtpSender.setTransport(a.transceivers[0].dtlsTransport),a.transceivers[j].rtpReceiver&&a.transceivers[j].rtpReceiver.setTransport(a.transceivers[0].dtlsTransport)),t.type!=="offer"||Q)t.type==="answer"&&!Q&&(re=(M=a.transceivers[j]).iceGatherer,le=M.iceTransport,ve=M.dtlsTransport,ce=M.rtpReceiver,V=M.sendEncodingParameters,fe=M.localCapabilities,a.transceivers[j].recvEncodingParameters=Y,a.transceivers[j].remoteCapabilities=ue,a.transceivers[j].rtcpParameters=ge,Ee.length&&le.state==="new"&&(!T&&!xe||x&&j!==0?Ee.forEach(function(ie){c(M.iceTransport,ie)}):le.setRemoteCandidates(Ee)),x&&j!==0||(le.state==="new"&&le.start(re,Ce,"controlling"),ve.state==="new"&&ve.start(Se)),!o(M.localCapabilities,M.remoteCapabilities).codecs.filter(function(ie){return ie.name.toLowerCase()==="rtx"}).length&&M.sendEncodingParameters[0].rtx&&delete M.sendEncodingParameters[0].rtx,a._transceive(M,E==="sendrecv"||E==="recvonly",E==="sendrecv"||E==="sendonly"),!ce||E!=="sendrecv"&&E!=="sendonly"?delete M.rtpReceiver:(X=ce.track,N?(i[N.stream]||(i[N.stream]=new n.MediaStream),h(X,i[N.stream]),f.push([X,ce,i[N.stream]])):(i.default||(i.default=new n.MediaStream),h(X,i.default),f.push([X,ce,i.default]))));else{(M=a.transceivers[j]||a._createTransceiver(U)).mid=W,M.iceGatherer||(M.iceGatherer=a._createIceGatherer(j,x)),Ee.length&&M.iceTransport.state==="new"&&(!xe||x&&j!==0?Ee.forEach(function(ie){c(M.iceTransport,ie)}):M.iceTransport.setRemoteCandidates(Ee)),fe=n.RTCRtpReceiver.getCapabilities(U),g<15019&&(fe.codecs=fe.codecs.filter(function(ie){return ie.name!=="rtx"})),V=M.sendEncodingParameters||[{ssrc:1001*(2*j+2)}];var _e,K=!1;E==="sendrecv"||E==="sendonly"?(K=!M.rtpReceiver,ce=M.rtpReceiver||new n.RTCRtpReceiver(M.dtlsTransport,U),K&&(X=ce.track,N&&N.stream==="-"||(N?(i[N.stream]||(i[N.stream]=new n.MediaStream,Object.defineProperty(i[N.stream],"id",{get:function(){return N.stream}})),Object.defineProperty(X,"id",{get:function(){return N.track}}),_e=i[N.stream]):(i.default||(i.default=new n.MediaStream),_e=i.default)),_e&&(h(X,_e),M.associatedRemoteMediaStreams.push(_e)),f.push([X,ce,_e]))):M.rtpReceiver&&M.rtpReceiver.track&&(M.associatedRemoteMediaStreams.forEach(function(ie){var Me=ie.getTracks().find(function(ke){return ke.id===M.rtpReceiver.track.id});Me&&function(ke,Te){Te.removeTrack(ke),Te.dispatchEvent(new n.MediaStreamTrackEvent("removetrack",{track:ke}))}(Me,ie)}),M.associatedRemoteMediaStreams=[]),M.localCapabilities=fe,M.remoteCapabilities=ue,M.rtpReceiver=ce,M.rtcpParameters=ge,M.sendEncodingParameters=V,M.recvEncodingParameters=Y,a._transceive(a.transceivers[j],!1,K)}}}),a._dtlsRole===void 0&&(a._dtlsRole=t.type==="offer"?"active":"passive"),a._remoteDescription={type:t.type,sdp:t.sdp},t.type==="offer"?a._updateSignalingState("have-remote-offer"):a._updateSignalingState("stable"),Object.keys(i).forEach(function(A){var j=i[A];if(j.getTracks().length){if(a.remoteStreams.indexOf(j)===-1){a.remoteStreams.push(j);var D=new Event("addstream");D.stream=j,n.setTimeout(function(){a._dispatchEvent("addstream",D)})}f.forEach(function(U){var Q=U[0],P=U[1];j.id===U[2].id&&v(a,Q,P,[j])})}}),f.forEach(function(A){A[2]||v(a,A[0],A[1],[])}),n.setTimeout(function(){a&&a.transceivers&&a.transceivers.forEach(function(A){A.iceTransport&&A.iceTransport.state==="new"&&A.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),A.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},s.prototype.close=function(){this.transceivers.forEach(function(t){t.iceTransport&&t.iceTransport.stop(),t.dtlsTransport&&t.dtlsTransport.stop(),t.rtpSender&&t.rtpSender.stop(),t.rtpReceiver&&t.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},s.prototype._updateSignalingState=function(t){this.signalingState=t;var a=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",a)},s.prototype._maybeFireNegotiationNeeded=function(){var t=this;this.signalingState==="stable"&&this.needNegotiation!==!0&&(this.needNegotiation=!0,n.setTimeout(function(){if(t.needNegotiation){t.needNegotiation=!1;var a=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",a)}},0))},s.prototype._updateIceConnectionState=function(){var t,a={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(f){f.iceTransport&&!f.rejected&&a[f.iceTransport.state]++}),t="new",a.failed>0?t="failed":a.checking>0?t="checking":a.disconnected>0?t="disconnected":a.new>0?t="new":a.connected>0?t="connected":a.completed>0&&(t="completed"),t!==this.iceConnectionState){this.iceConnectionState=t;var i=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",i)}},s.prototype._updateConnectionState=function(){var t,a={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(f){f.iceTransport&&f.dtlsTransport&&!f.rejected&&(a[f.iceTransport.state]++,a[f.dtlsTransport.state]++)}),a.connected+=a.completed,t="new",a.failed>0?t="failed":a.connecting>0?t="connecting":a.disconnected>0?t="disconnected":a.new>0?t="new":a.connected>0&&(t="connected"),t!==this.connectionState){this.connectionState=t;var i=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",i)}},s.prototype.createOffer=function(){var t=this;if(t._isClosed)return Promise.reject(d("InvalidStateError","Can not call createOffer after close"));var a=t.transceivers.filter(function(T){return T.kind==="audio"}).length,i=t.transceivers.filter(function(T){return T.kind==="video"}).length,f=arguments[0];if(f){if(f.mandatory||f.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");f.offerToReceiveAudio!==void 0&&(a=f.offerToReceiveAudio===!0?1:f.offerToReceiveAudio===!1?0:f.offerToReceiveAudio),f.offerToReceiveVideo!==void 0&&(i=f.offerToReceiveVideo===!0?1:f.offerToReceiveVideo===!1?0:f.offerToReceiveVideo)}for(t.transceivers.forEach(function(T){T.kind==="audio"?--a<0&&(T.wantReceive=!1):T.kind==="video"&&--i<0&&(T.wantReceive=!1)});a>0||i>0;)a>0&&(t._createTransceiver("audio"),a--),i>0&&(t._createTransceiver("video"),i--);var y=l.writeSessionBoilerplate(t._sdpSessionId,t._sdpSessionVersion++);t.transceivers.forEach(function(T,x){var G=T.track,A=T.kind,j=T.mid||l.generateIdentifier();T.mid=j,T.iceGatherer||(T.iceGatherer=t._createIceGatherer(x,t.usingBundle));var D=n.RTCRtpSender.getCapabilities(A);g<15019&&(D.codecs=D.codecs.filter(function(Q){return Q.name!=="rtx"})),D.codecs.forEach(function(Q){Q.name==="H264"&&Q.parameters["level-asymmetry-allowed"]===void 0&&(Q.parameters["level-asymmetry-allowed"]="1"),T.remoteCapabilities&&T.remoteCapabilities.codecs&&T.remoteCapabilities.codecs.forEach(function(P){Q.name.toLowerCase()===P.name.toLowerCase()&&Q.clockRate===P.clockRate&&(Q.preferredPayloadType=P.payloadType)})}),D.headerExtensions.forEach(function(Q){(T.remoteCapabilities&&T.remoteCapabilities.headerExtensions||[]).forEach(function(P){Q.uri===P.uri&&(Q.id=P.id)})});var U=T.sendEncodingParameters||[{ssrc:1001*(2*x+1)}];G&&g>=15019&&A==="video"&&!U[0].rtx&&(U[0].rtx={ssrc:U[0].ssrc+1}),T.wantReceive&&(T.rtpReceiver=new n.RTCRtpReceiver(T.dtlsTransport,A)),T.localCapabilities=D,T.sendEncodingParameters=U}),t._config.bundlePolicy!=="max-compat"&&(y+="a=group:BUNDLE "+t.transceivers.map(function(T){return T.mid}).join(" ")+`\r
`),y+=`a=ice-options:trickle\r
`,t.transceivers.forEach(function(T,x){y+=r(T,T.localCapabilities,"offer",T.stream,t._dtlsRole),y+=`a=rtcp-rsize\r
`,!T.iceGatherer||t.iceGatheringState==="new"||x!==0&&t.usingBundle||(T.iceGatherer.getLocalCandidates().forEach(function(G){G.component=1,y+="a="+l.writeCandidate(G)+`\r
`}),T.iceGatherer.state==="completed"&&(y+=`a=end-of-candidates\r
`))});var _=new n.RTCSessionDescription({type:"offer",sdp:y});return Promise.resolve(_)},s.prototype.createAnswer=function(){var t=this;if(t._isClosed)return Promise.reject(d("InvalidStateError","Can not call createAnswer after close"));if(t.signalingState!=="have-remote-offer"&&t.signalingState!=="have-local-pranswer")return Promise.reject(d("InvalidStateError","Can not call createAnswer in signalingState "+t.signalingState));var a=l.writeSessionBoilerplate(t._sdpSessionId,t._sdpSessionVersion++);t.usingBundle&&(a+="a=group:BUNDLE "+t.transceivers.map(function(y){return y.mid}).join(" ")+`\r
`),a+=`a=ice-options:trickle\r
`;var i=l.getMediaSections(t._remoteDescription.sdp).length;t.transceivers.forEach(function(y,_){if(!(_+1>i)){if(y.rejected)return y.kind==="application"?y.protocol==="DTLS/SCTP"?a+=`m=application 0 DTLS/SCTP 5000\r
`:a+="m=application 0 "+y.protocol+` webrtc-datachannel\r
`:y.kind==="audio"?a+=`m=audio 0 UDP/TLS/RTP/SAVPF 0\r
a=rtpmap:0 PCMU/8000\r
`:y.kind==="video"&&(a+=`m=video 0 UDP/TLS/RTP/SAVPF 120\r
a=rtpmap:120 VP8/90000\r
`),void(a+=`c=IN IP4 0.0.0.0\r
a=inactive\r
a=mid:`+y.mid+`\r
`);var T;y.stream&&(y.kind==="audio"?T=y.stream.getAudioTracks()[0]:y.kind==="video"&&(T=y.stream.getVideoTracks()[0]),T&&g>=15019&&y.kind==="video"&&!y.sendEncodingParameters[0].rtx&&(y.sendEncodingParameters[0].rtx={ssrc:y.sendEncodingParameters[0].ssrc+1}));var x=o(y.localCapabilities,y.remoteCapabilities);!x.codecs.filter(function(G){return G.name.toLowerCase()==="rtx"}).length&&y.sendEncodingParameters[0].rtx&&delete y.sendEncodingParameters[0].rtx,a+=r(y,x,"answer",y.stream,t._dtlsRole),y.rtcpParameters&&y.rtcpParameters.reducedSize&&(a+=`a=rtcp-rsize\r
`)}});var f=new n.RTCSessionDescription({type:"answer",sdp:a});return Promise.resolve(f)},s.prototype.addIceCandidate=function(t){var a,i=this;return t&&t.sdpMLineIndex===void 0&&!t.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(f,y){if(!i._remoteDescription)return y(d("InvalidStateError","Can not add ICE candidate without a remote description"));if(t&&t.candidate!==""){var _=t.sdpMLineIndex;if(t.sdpMid){for(var T=0;T<i.transceivers.length;T++)if(i.transceivers[T].mid===t.sdpMid){_=T;break}}var x=i.transceivers[_];if(!x)return y(d("OperationError","Can not add ICE candidate"));if(x.rejected)return f();var G=Object.keys(t.candidate).length>0?l.parseCandidate(t.candidate):{};if(G.protocol==="tcp"&&(G.port===0||G.port===9)||G.component&&G.component!==1)return f();if((_===0||_>0&&x.iceTransport!==i.transceivers[0].iceTransport)&&!c(x.iceTransport,G))return y(d("OperationError","Can not add ICE candidate"));var A=t.candidate.trim();A.indexOf("a=")===0&&(A=A.substr(2)),(a=l.getMediaSections(i._remoteDescription.sdp))[_]+="a="+(G.type?A:"end-of-candidates")+`\r
`,i._remoteDescription.sdp=l.getDescription(i._remoteDescription.sdp)+a.join("")}else for(var j=0;j<i.transceivers.length&&(i.transceivers[j].rejected||(i.transceivers[j].iceTransport.addRemoteCandidate({}),(a=l.getMediaSections(i._remoteDescription.sdp))[j]+=`a=end-of-candidates\r
`,i._remoteDescription.sdp=l.getDescription(i._remoteDescription.sdp)+a.join(""),!i.usingBundle));j++);f()})},s.prototype.getStats=function(t){if(t&&t instanceof n.MediaStreamTrack){var a=null;if(this.transceivers.forEach(function(f){f.rtpSender&&f.rtpSender.track===t?a=f.rtpSender:f.rtpReceiver&&f.rtpReceiver.track===t&&(a=f.rtpReceiver)}),!a)throw d("InvalidAccessError","Invalid selector.");return a.getStats()}var i=[];return this.transceivers.forEach(function(f){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(y){f[y]&&i.push(f[y].getStats())})}),Promise.all(i).then(function(f){var y=new Map;return f.forEach(function(_){_.forEach(function(T){y.set(T.id,T)})}),y})},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(t){var a=n[t];if(a&&a.prototype&&a.prototype.getStats){var i=a.prototype.getStats;a.prototype.getStats=function(){return i.apply(this).then(function(f){var y=new Map;return Object.keys(f).forEach(function(_){var T;f[_].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(T=f[_]).type]||T.type,y.set(_,f[_])}),y})}}});var u=["createOffer","createAnswer"];return u.forEach(function(t){var a=s.prototype[t];s.prototype[t]=function(){var i=arguments;return typeof i[0]=="function"||typeof i[1]=="function"?a.apply(this,[arguments[2]]).then(function(f){typeof i[0]=="function"&&i[0].apply(null,[f])},function(f){typeof i[1]=="function"&&i[1].apply(null,[f])}):a.apply(this,arguments)}}),(u=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(t){var a=s.prototype[t];s.prototype[t]=function(){var i=arguments;return typeof i[1]=="function"||typeof i[2]=="function"?a.apply(this,arguments).then(function(){typeof i[1]=="function"&&i[1].apply(null)},function(f){typeof i[2]=="function"&&i[2].apply(null,[f])}):a.apply(this,arguments)}}),["getStats"].forEach(function(t){var a=s.prototype[t];s.prototype[t]=function(){var i=arguments;return typeof i[1]=="function"?a.apply(this,arguments).then(function(){typeof i[1]=="function"&&i[1].apply(null)}):a.apply(this,arguments)}}),s}},function(J,z,O){J.exports=function(l){var r=l&&l.navigator,o=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(e){return o(e).catch(function(c){return Promise.reject(function(d){return{name:{PermissionDeniedError:"NotAllowedError"}[d.name]||d.name,message:d.message,constraint:d.constraint,toString:function(){return this.name}}}(c))})}}},function(J,z,O){var l=O(1);J.exports={shimGetUserMedia:O(14),shimOnTrack:function(r){typeof r=="object"&&r.RTCPeerConnection&&!("ontrack"in r.RTCPeerConnection.prototype)&&Object.defineProperty(r.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(o){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=o),this.addEventListener("addstream",this._ontrackpoly=(function(e){e.stream.getTracks().forEach((function(c){var d=new Event("track");d.track=c,d.receiver={track:c},d.transceiver={receiver:d.receiver},d.streams=[e.stream],this.dispatchEvent(d)}).bind(this))}).bind(this))},enumerable:!0,configurable:!0}),typeof r=="object"&&r.RTCTrackEvent&&"receiver"in r.RTCTrackEvent.prototype&&!("transceiver"in r.RTCTrackEvent.prototype)&&Object.defineProperty(r.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimSourceObject:function(r){typeof r=="object"&&r.HTMLMediaElement&&!("srcObject"in r.HTMLMediaElement.prototype)&&Object.defineProperty(r.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(o){this.mozSrcObject=o}})},shimPeerConnection:function(r){var o=l.detectBrowser(r);if(typeof r=="object"&&(r.RTCPeerConnection||r.mozRTCPeerConnection)){r.RTCPeerConnection||(r.RTCPeerConnection=function(n,g){if(o.version<38&&n&&n.iceServers){for(var h=[],v=0;v<n.iceServers.length;v++){var s=n.iceServers[v];if(s.hasOwnProperty("urls"))for(var u=0;u<s.urls.length;u++){var t={url:s.urls[u]};s.urls[u].indexOf("turn")===0&&(t.username=s.username,t.credential=s.credential),h.push(t)}else h.push(n.iceServers[v])}n.iceServers=h}return new r.mozRTCPeerConnection(n,g)},r.RTCPeerConnection.prototype=r.mozRTCPeerConnection.prototype,r.mozRTCPeerConnection.generateCertificate&&Object.defineProperty(r.RTCPeerConnection,"generateCertificate",{get:function(){return r.mozRTCPeerConnection.generateCertificate}}),r.RTCSessionDescription=r.mozRTCSessionDescription,r.RTCIceCandidate=r.mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){var g=r.RTCPeerConnection.prototype[n];r.RTCPeerConnection.prototype[n]=function(){return arguments[0]=new(n==="addIceCandidate"?r.RTCIceCandidate:r.RTCSessionDescription)(arguments[0]),g.apply(this,arguments)}});var e=r.RTCPeerConnection.prototype.addIceCandidate;r.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?e.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var c={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},d=r.RTCPeerConnection.prototype.getStats;r.RTCPeerConnection.prototype.getStats=function(n,g,h){return d.apply(this,[n||null]).then(function(v){if(o.version<48&&(v=function(s){var u=new Map;return Object.keys(s).forEach(function(t){u.set(t,s[t]),u[t]=s[t]}),u}(v)),o.version<53&&!g)try{v.forEach(function(s){s.type=c[s.type]||s.type})}catch(s){if(s.name!=="TypeError")throw s;v.forEach(function(u,t){v.set(t,Object.assign({},u,{type:c[u.type]||u.type}))})}return v}).then(g,h)}}},shimSenderGetStats:function(r){if(typeof r=="object"&&r.RTCPeerConnection&&r.RTCRtpSender&&(!r.RTCRtpSender||!("getStats"in r.RTCRtpSender.prototype))){var o=r.RTCPeerConnection.prototype.getSenders;o&&(r.RTCPeerConnection.prototype.getSenders=function(){var c=this,d=o.apply(c,[]);return d.forEach(function(n){n._pc=c}),d});var e=r.RTCPeerConnection.prototype.addTrack;e&&(r.RTCPeerConnection.prototype.addTrack=function(){var c=e.apply(this,arguments);return c._pc=this,c}),r.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}},shimReceiverGetStats:function(r){if(typeof r=="object"&&r.RTCPeerConnection&&r.RTCRtpSender&&(!r.RTCRtpSender||!("getStats"in r.RTCRtpReceiver.prototype))){var o=r.RTCPeerConnection.prototype.getReceivers;o&&(r.RTCPeerConnection.prototype.getReceivers=function(){var e=this,c=o.apply(e,[]);return c.forEach(function(d){d._pc=e}),c}),l.wrapPeerConnectionEvent(r,"track",function(e){return e.receiver._pc=e.srcElement,e}),r.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}},shimRemoveStream:function(r){r.RTCPeerConnection&&!("removeStream"in r.RTCPeerConnection.prototype)&&(r.RTCPeerConnection.prototype.removeStream=function(o){var e=this;l.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(c){c.track&&o.getTracks().indexOf(c.track)!==-1&&e.removeTrack(c)})})},shimRTCDataChannel:function(r){r.DataChannel&&!r.RTCDataChannel&&(r.RTCDataChannel=r.DataChannel)},shimGetDisplayMedia:function(r,o){r.navigator&&r.navigator.mediaDevices&&!("getDisplayMedia"in r.navigator.mediaDevices)&&(r.navigator.mediaDevices.getDisplayMedia=function(e){if(!e||!e.video){var c=new DOMException("getDisplayMedia without video constraints is undefined");return c.name="NotFoundError",c.code=8,Promise.reject(c)}return e.video===!0?e.video={mediaSource:o}:e.video.mediaSource=o,r.navigator.mediaDevices.getUserMedia(e)},r.navigator.getDisplayMedia=function(e){return l.deprecated("navigator.getDisplayMedia","navigator.mediaDevices.getDisplayMedia"),r.navigator.mediaDevices.getDisplayMedia(e)})}}},function(J,z,O){var l=O(1),r=l.log;J.exports=function(o){var e=l.detectBrowser(o),c=o&&o.navigator,d=o&&o.MediaStreamTrack,n=function(i){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[i.name]||i.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[i.message]||i.message,constraint:i.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},g=function(i,f,y){var _=function(T){if(typeof T!="object"||T.require)return T;var x=[];return Object.keys(T).forEach(function(G){if(G!=="require"&&G!=="advanced"&&G!=="mediaSource"){var A=T[G]=typeof T[G]=="object"?T[G]:{ideal:T[G]};if(A.min===void 0&&A.max===void 0&&A.exact===void 0||x.push(G),A.exact!==void 0&&(typeof A.exact=="number"?A.min=A.max=A.exact:T[G]=A.exact,delete A.exact),A.ideal!==void 0){T.advanced=T.advanced||[];var j={};typeof A.ideal=="number"?j[G]={min:A.ideal,max:A.ideal}:j[G]=A.ideal,T.advanced.push(j),delete A.ideal,Object.keys(A).length||delete T[G]}}}),x.length&&(T.require=x),T};return i=JSON.parse(JSON.stringify(i)),e.version<38&&(r("spec: "+JSON.stringify(i)),i.audio&&(i.audio=_(i.audio)),i.video&&(i.video=_(i.video)),r("ff37: "+JSON.stringify(i))),c.mozGetUserMedia(i,f,function(T){y(n(T))})};if(c.mediaDevices||(c.mediaDevices={getUserMedia:function(i){return new Promise(function(f,y){g(i,f,y)})},addEventListener:function(){},removeEventListener:function(){}}),c.mediaDevices.enumerateDevices=c.mediaDevices.enumerateDevices||function(){return new Promise(function(i){i([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},e.version<41){var h=c.mediaDevices.enumerateDevices.bind(c.mediaDevices);c.mediaDevices.enumerateDevices=function(){return h().then(void 0,function(i){if(i.name==="NotFoundError")return[];throw i})}}if(e.version<49){var v=c.mediaDevices.getUserMedia.bind(c.mediaDevices);c.mediaDevices.getUserMedia=function(i){return v(i).then(function(f){if(i.audio&&!f.getAudioTracks().length||i.video&&!f.getVideoTracks().length)throw f.getTracks().forEach(function(y){y.stop()}),new DOMException("The object can not be found here.","NotFoundError");return f},function(f){return Promise.reject(n(f))})}}if(!(e.version>55&&"autoGainControl"in c.mediaDevices.getSupportedConstraints())){var s=function(i,f,y){f in i&&!(y in i)&&(i[y]=i[f],delete i[f])},u=c.mediaDevices.getUserMedia.bind(c.mediaDevices);if(c.mediaDevices.getUserMedia=function(i){return typeof i=="object"&&typeof i.audio=="object"&&(i=JSON.parse(JSON.stringify(i)),s(i.audio,"autoGainControl","mozAutoGainControl"),s(i.audio,"noiseSuppression","mozNoiseSuppression")),u(i)},d&&d.prototype.getSettings){var t=d.prototype.getSettings;d.prototype.getSettings=function(){var i=t.apply(this,arguments);return s(i,"mozAutoGainControl","autoGainControl"),s(i,"mozNoiseSuppression","noiseSuppression"),i}}if(d&&d.prototype.applyConstraints){var a=d.prototype.applyConstraints;d.prototype.applyConstraints=function(i){return this.kind==="audio"&&typeof i=="object"&&(i=JSON.parse(JSON.stringify(i)),s(i,"autoGainControl","mozAutoGainControl"),s(i,"noiseSuppression","mozNoiseSuppression")),a.apply(this,[i])}}}c.getUserMedia=function(i,f,y){if(e.version<44)return g(i,f,y);l.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),c.mediaDevices.getUserMedia(i).then(f,y)}}},function(J,z,O){var l=O(1);J.exports={shimLocalStreamsAPI:function(r){if(typeof r=="object"&&r.RTCPeerConnection){if("getLocalStreams"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),"getStreamById"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.getStreamById=function(e){var c=null;return this._localStreams&&this._localStreams.forEach(function(d){d.id===e&&(c=d)}),this._remoteStreams&&this._remoteStreams.forEach(function(d){d.id===e&&(c=d)}),c}),!("addStream"in r.RTCPeerConnection.prototype)){var o=r.RTCPeerConnection.prototype.addTrack;r.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.indexOf(e)===-1&&this._localStreams.push(e);var c=this;e.getTracks().forEach(function(d){o.call(c,d,e)})},r.RTCPeerConnection.prototype.addTrack=function(e,c){return c&&(this._localStreams?this._localStreams.indexOf(c)===-1&&this._localStreams.push(c):this._localStreams=[c]),o.call(this,e,c)}}"removeStream"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);var c=this._localStreams.indexOf(e);if(c!==-1){this._localStreams.splice(c,1);var d=this,n=e.getTracks();this.getSenders().forEach(function(g){n.indexOf(g.track)!==-1&&d.removeTrack(g)})}})}},shimRemoteStreamsAPI:function(r){if(typeof r=="object"&&r.RTCPeerConnection&&("getRemoteStreams"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in r.RTCPeerConnection.prototype))){Object.defineProperty(r.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){this._onaddstream&&this.removeEventListener("addstream",this._onaddstream),this.addEventListener("addstream",this._onaddstream=e)}});var o=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(c){c.streams.forEach(function(d){if(e._remoteStreams||(e._remoteStreams=[]),!(e._remoteStreams.indexOf(d)>=0)){e._remoteStreams.push(d);var n=new Event("addstream");n.stream=d,e.dispatchEvent(n)}})}),o.apply(e,arguments)}}},shimCallbacksAPI:function(r){if(typeof r=="object"&&r.RTCPeerConnection){var o=r.RTCPeerConnection.prototype,e=o.createOffer,c=o.createAnswer,d=o.setLocalDescription,n=o.setRemoteDescription,g=o.addIceCandidate;o.createOffer=function(v,s){var u=arguments.length>=2?arguments[2]:arguments[0],t=e.apply(this,[u]);return s?(t.then(v,s),Promise.resolve()):t},o.createAnswer=function(v,s){var u=arguments.length>=2?arguments[2]:arguments[0],t=c.apply(this,[u]);return s?(t.then(v,s),Promise.resolve()):t};var h=function(v,s,u){var t=d.apply(this,[v]);return u?(t.then(s,u),Promise.resolve()):t};o.setLocalDescription=h,h=function(v,s,u){var t=n.apply(this,[v]);return u?(t.then(s,u),Promise.resolve()):t},o.setRemoteDescription=h,h=function(v,s,u){var t=g.apply(this,[v]);return u?(t.then(s,u),Promise.resolve()):t},o.addIceCandidate=h}},shimGetUserMedia:function(r){var o=r&&r.navigator;o.getUserMedia||(o.webkitGetUserMedia?o.getUserMedia=o.webkitGetUserMedia.bind(o):o.mediaDevices&&o.mediaDevices.getUserMedia&&(o.getUserMedia=(function(e,c,d){o.mediaDevices.getUserMedia(e).then(c,d)}).bind(o)))},shimRTCIceServerUrls:function(r){var o=r.RTCPeerConnection;r.RTCPeerConnection=function(e,c){if(e&&e.iceServers){for(var d=[],n=0;n<e.iceServers.length;n++){var g=e.iceServers[n];!g.hasOwnProperty("urls")&&g.hasOwnProperty("url")?(l.deprecated("RTCIceServer.url","RTCIceServer.urls"),(g=JSON.parse(JSON.stringify(g))).urls=g.url,delete g.url,d.push(g)):d.push(e.iceServers[n])}e.iceServers=d}return new o(e,c)},r.RTCPeerConnection.prototype=o.prototype,"generateCertificate"in r.RTCPeerConnection&&Object.defineProperty(r.RTCPeerConnection,"generateCertificate",{get:function(){return o.generateCertificate}})},shimTrackEventTransceiver:function(r){typeof r=="object"&&r.RTCPeerConnection&&"receiver"in r.RTCTrackEvent.prototype&&!r.RTCTransceiver&&Object.defineProperty(r.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimCreateOfferLegacy:function(r){var o=r.RTCPeerConnection.prototype.createOffer;r.RTCPeerConnection.prototype.createOffer=function(e){var c=this;if(e){e.offerToReceiveAudio!==void 0&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var d=c.getTransceivers().find(function(g){return g.sender.track&&g.sender.track.kind==="audio"});e.offerToReceiveAudio===!1&&d?d.direction==="sendrecv"?d.setDirection?d.setDirection("sendonly"):d.direction="sendonly":d.direction==="recvonly"&&(d.setDirection?d.setDirection("inactive"):d.direction="inactive"):e.offerToReceiveAudio!==!0||d||c.addTransceiver("audio"),e.offerToReceiveVideo!==void 0&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var n=c.getTransceivers().find(function(g){return g.sender.track&&g.sender.track.kind==="video"});e.offerToReceiveVideo===!1&&n?n.direction==="sendrecv"?n.setDirection("sendonly"):n.direction==="recvonly"&&n.setDirection("inactive"):e.offerToReceiveVideo!==!0||n||c.addTransceiver("video")}return o.apply(c,arguments)}}}},function(J,z,O){var l=O(2),r=O(1);J.exports={shimRTCIceCandidate:function(o){if(!(!o.RTCIceCandidate||o.RTCIceCandidate&&"foundation"in o.RTCIceCandidate.prototype)){var e=o.RTCIceCandidate;o.RTCIceCandidate=function(c){if(typeof c=="object"&&c.candidate&&c.candidate.indexOf("a=")===0&&((c=JSON.parse(JSON.stringify(c))).candidate=c.candidate.substr(2)),c.candidate&&c.candidate.length){var d=new e(c),n=l.parseCandidate(c.candidate),g=Object.assign(d,n);return g.toJSON=function(){return{candidate:g.candidate,sdpMid:g.sdpMid,sdpMLineIndex:g.sdpMLineIndex,usernameFragment:g.usernameFragment}},g}return new e(c)},o.RTCIceCandidate.prototype=e.prototype,r.wrapPeerConnectionEvent(o,"icecandidate",function(c){return c.candidate&&Object.defineProperty(c,"candidate",{value:new o.RTCIceCandidate(c.candidate),writable:"false"}),c})}},shimCreateObjectURL:function(o){var e=o&&o.URL;if(typeof o=="object"&&o.HTMLMediaElement&&"srcObject"in o.HTMLMediaElement.prototype&&e.createObjectURL&&e.revokeObjectURL){var c=e.createObjectURL.bind(e),d=e.revokeObjectURL.bind(e),n=new Map,g=0;e.createObjectURL=function(s){if("getTracks"in s){var u="polyblob:"+ ++g;return n.set(u,s),r.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream"),u}return c(s)},e.revokeObjectURL=function(s){d(s),n.delete(s)};var h=Object.getOwnPropertyDescriptor(o.HTMLMediaElement.prototype,"src");Object.defineProperty(o.HTMLMediaElement.prototype,"src",{get:function(){return h.get.apply(this)},set:function(s){return this.srcObject=n.get(s)||null,h.set.apply(this,[s])}});var v=o.HTMLMediaElement.prototype.setAttribute;o.HTMLMediaElement.prototype.setAttribute=function(){return arguments.length===2&&(""+arguments[0]).toLowerCase()==="src"&&(this.srcObject=n.get(arguments[1])||null),v.apply(this,arguments)}}},shimMaxMessageSize:function(o){if(!o.RTCSctpTransport&&o.RTCPeerConnection){var e=r.detectBrowser(o);"sctp"in o.RTCPeerConnection.prototype||Object.defineProperty(o.RTCPeerConnection.prototype,"sctp",{get:function(){return this._sctp===void 0?null:this._sctp}});var c=function(v){var s=l.splitSections(v.sdp);return s.shift(),s.some(function(u){var t=l.parseMLine(u);return t&&t.kind==="application"&&t.protocol.indexOf("SCTP")!==-1})},d=function(v){var s=v.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(s===null||s.length<2)return-1;var u=parseInt(s[1],10);return u!=u?-1:u},n=function(v){var s=65536;return e.browser==="firefox"&&(s=e.version<57?v===-1?16384:2147483637:e.version<60?e.version===57?65535:65536:2147483637),s},g=function(v,s){var u=65536;e.browser==="firefox"&&e.version===57&&(u=65535);var t=l.matchPrefix(v.sdp,"a=max-message-size:");return t.length>0?u=parseInt(t[0].substr(19),10):e.browser==="firefox"&&s!==-1&&(u=2147483637),u},h=o.RTCPeerConnection.prototype.setRemoteDescription;o.RTCPeerConnection.prototype.setRemoteDescription=function(){var v=this;if(v._sctp=null,c(arguments[0])){var s,u=d(arguments[0]),t=n(u),a=g(arguments[0],u);s=t===0&&a===0?Number.POSITIVE_INFINITY:t===0||a===0?Math.max(t,a):Math.min(t,a);var i={};Object.defineProperty(i,"maxMessageSize",{get:function(){return s}}),v._sctp=i}return h.apply(v,arguments)}}},shimSendThrowTypeError:function(o){if(o.RTCPeerConnection&&"createDataChannel"in o.RTCPeerConnection.prototype){var e=o.RTCPeerConnection.prototype.createDataChannel;o.RTCPeerConnection.prototype.createDataChannel=function(){var d=this,n=e.apply(d,arguments);return c(n,d),n},r.wrapPeerConnectionEvent(o,"datachannel",function(d){return c(d.channel,d.target),d})}function c(d,n){var g=d.send;d.send=function(){var h=arguments[0],v=h.length||h.size||h.byteLength;if(d.readyState==="open"&&n.sctp&&v>n.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+n.sctp.maxMessageSize+" bytes)");return g.apply(d,arguments)}}}}},function(J,z,O){O.r(z),typeof console<"u"&&console.log!==void 0||(console={log:function(){}});var l=function(){},r=function(){},o=function(){},e=function(){},c=function(){},d=function(){};d=console.error.bind(console);var n={trace:l,debug:r,vdebug:o,log:e,warn:c,error:d},g=O(0),h=O.n(g);function v(p){return(v=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(C){return typeof C}:function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C})(p)}var s=null,u=null,t=null,a=!1,i=null,f=null,y=null,_=function(p){switch(p.response){case"keepalive":n.vdebug("Got a keepalive");break;case"ack":n.debug("Got an ack"),n.debug(p);break;case"success":n.debug("Got a success"),n.debug(p),f(p);break;case"closed":n.debug("Got a closed connection"),n.debug(p),y();break;case"offline":n.debug("Connection is offline, token expired"),n.debug(p),u("offline");break;case"trickle":if(!V()&&!Y())return void n.debug("This handle is not attached to this session");var C=p.candidate,m=i.webrtcConfig;n.debug("Got a trickled candidate"),n.debug(C),m.pc&&m.remoteSdp?(n.debug("Adding remote candidate:",C),C&&C.completed!==!0?m.pc.addIceCandidate(new RTCIceCandidate(C)):m.pc.addIceCandidate()):(n.debug("We didn't do setRemoteDescription (trickle got here before the offer?), caching candidate"),m.candidates||(m.candidates=[]),m.candidates.push(C),n.debug(m.candidates));break;case"webrtcup":if(!V())return void n.debug("This handle is not attached");i.webrtcState(!0);break;case"hangup":if(n.debug("Got a hangup event"),n.debug(p),!V())return void n.debug("This handle is not attached");i.webrtcState(!1,p.reason),i.hangup();break;case"media":if(n.debug("Got a media event"),n.debug(p),!V())return void n.debug("This handle is not attached");i.mediaState(p.type,p.receiving);break;case"slowlink":if(n.debug("Got a slowlink event"),n.debug(p),!V())return void n.debug("This handle is not attached");i.slowLink(p.uplink,p.nacks);break;case"error":n.error("AfricasTalking Client Error: "+p.error.code+" "+p.error.reason),n.debug(p);break;case"event":if(n.log("Got an event"),n.log(p),p.eventdata===void 0||p.eventdata===null)return void n.warn("Missing eventdata...");if(n.log(p.eventdata),!V())return void n.warn("This handle is not attachedddd");p.jsep!==void 0&&p.jsep!==null&&(n.log("Handling SDP as well..."),n.log(p.jsep)),i.onmessage!==null&&i.onmessage!==void 0?(n.log("Notifying application..."),i.onmessage(p.eventdata,p.jsep)):n.debug("No provided notification callback");break;default:n.warn("Unknown message/event  "+p),n.debug(p)}},T=function(p){if(!a)return n.warn("Is the gateway down? (connected=false)"),void p.error("Is the gateway down? (connected=false)");if(!V()&&!Y())return n.warn("Invalid handle"),void p.error("Invalid handle");var C=p.message,m=p.jsep,S={command:"message",body:C};m!=null&&(S.jsep=m),n.debug("Sending message to web socket"),n.debug(S),n.debug("Sending a request to Africa's Talking"+S),s.send(JSON.stringify(S))},x=function(p){if(!V()&&!Y())return n.warn("Invalid handle"),void p.error("Invalid handle");var C=i.webrtcConfig,m=p.text;if(m==null)return n.warn("Invalid text"),void p.error("Invalid text");n.log("Sending string on data channel: "+m),C.dataChannel.send(m),p.success()},G=function(p){var C=p.jsep;p.media=p.media||{audio:!0};var m=p.media;if(!V()&&!Y())return n.warn("Invalid handle"),void p.error("Invalid handle");var S=i.webrtcConfig;if(S.pc===void 0||S.pc===null)n.log("Creating a new media session"),m.update=!1;else if(S.pc!==void 0&&S.pc!==null)if(n.log("Updating existing media session"),m.update=!0,p.stream!==null&&p.stream!==void 0)p.stream!==S.myStream&&n.log("Renegotiation involves a new external stream");else{if(m.addAudio){if(m.replaceAudio=!1,m.removeAudio=!1,m.audioSend=!0,S.myStream&&S.myStream.getAudioTracks()&&S.myStream.getAudioTracks().length)return n.error("AfricasTalking Client Error: Can't add audio stream, there already is one"),void p.error("AfricasTalking Client Error: Can't add audio stream, there already is one")}else m.removeAudio?(m.replaceAudio=!1,m.addAudio=!1,m.audioSend=!1):m.replaceAudio&&(m.addAudio=!1,m.removeAudio=!1,m.audioSend=!0);S.myStream===null||S.myStream===void 0?(m.replaceAudio&&(m.replaceAudio=!1,m.addAudio=!0,m.audioSend=!0),re(m)&&(m.addAudio=!0)):S.myStream.getAudioTracks()!==null&&S.myStream.getAudioTracks()!==void 0&&S.myStream.getAudioTracks().length!==0||(m.replaceAudio&&(m.replaceAudio=!1,m.addAudio=!0,m.audioSend=!0),re(m)&&(m.addAudio=!0))}if(m.update&&!S.streamExternal&&(m.removeAudio||m.replaceAudio)){if(S.myStream&&S.myStream.getAudioTracks()&&S.myStream.getAudioTracks().length){var b=S.myStream.getAudioTracks()[0];n.log("Removing audio track:",b),S.myStream.removeTrack(b);try{b.stop()}catch(B){n.log("Error removing audio track:",B)}}if(S.pc.getSenders()&&S.pc.getSenders().length&&!m.replaceAudio&&h.a.browserDetails.browser==="firefox")for(var H in S.pc.getSenders()){var $=S.pc.getSenders()[H];$&&$.track&&$.track.kind==="audio"&&(n.log("Removing audio sender:",$),S.pc.removeTrack($))}}if(p.stream!==null&&p.stream!==void 0){var Z=p.stream;if(n.log("MediaStream provided by the application"),n.debug(Z),m.update&&S.myStream&&S.myStream!==p.stream&&!S.streamExternal){try{var q=S.myStream.getTracks();for(var oe in q){var ee=q[oe];n.log(ee),ee!=null&&ee.stop()}}catch{}S.myStream=null}return S.streamExternal=!0,void Q(C,m,p,Z)}if(n.log("Executing isAudioSendEnabled"),re(m)){i.consentDialog(!0);var te=re(m);te===!0&&m!=null&&m!=null&&v(m.audio)==="object"&&(te=m.audio),m!=null&&m.video==="screen"||navigator.mediaDevices.enumerateDevices().then(function(B){var pe=B.some(function(he){return he.kind==="audioinput"}),se=re(m),me=le(m);if((se||me)&&!(se&&pe)&&me)return i.consentDialog(!1),p.error("Audio capture is required, but no capture device found"),!1;var we={audio:!!pe&&te,video:!1};n.debug("getUserMedia constraints",we),navigator.mediaDevices.getUserMedia(we).then(function(he){i.consentDialog(!1),Q(C,m,p,he)}).catch(function(he){i.consentDialog(!1),p.error({code:he.code,name:he.name,message:he.message})})}).catch(function(B){i.consentDialog(!1),p.error("enumerateDevices error",B)})}else Q(C,m,p)},A=function(p){var C=p.jsep;if(!V()&&!Y())return n.warn("Invalid handle"),void p.error("Invalid handle");var m=i.webrtcConfig;if(C!=null){if(m.pc===null)return n.warn("Wait, no PeerConnection?? if this is an answer, use createAnswer and not handleRemoteJsep"),void p.error("No PeerConnection: if this is an answer, use createAnswer and not handleRemoteJsep");m.pc.setRemoteDescription(new RTCSessionDescription(C),function(){if(n.log("Remote description accepted!"),m.remoteSdp=C.sdp,m.candidates&&m.candidates.length>0){for(var S in m.candidates){var b=m.candidates[S];n.debug("Adding remote candidate:",b),b&&b.completed!==!0?m.pc.addIceCandidate(new RTCIceCandidate(b)):m.pc.addIceCandidate()}m.candidates=[]}},p.error)}else p.error("Invalid JSEP")},j=function(){if(!V()&&!Y())return n.warn("Invalid handle"),"Invalid handle";var p=i.webrtcConfig;return p.pc===null||p.pc===void 0?"Invalid PeerConnection":p.pc.getStats?p.bitrate.timer===null||p.bitrate.timer===void 0?(n.log("Starting bitrate timer (via getStats)"),p.bitrate.timer=setInterval(function(){p.pc.getStats().then(function(C){C.forEach(function(m){if(m){var S=!1;if((m.mediaType==="video"||m.id.toLowerCase().indexOf("video")>-1)&&m.type==="inbound-rtp"&&m.id.indexOf("rtcp")<0?S=!0:m.type!="ssrc"||!m.bytesReceived||m.googCodecName!=="VP8"&&m.googCodecName!==""||(S=!0),S)if(p.bitrate.bsnow=m.bytesReceived,p.bitrate.tsnow=m.timestamp,p.bitrate.bsbefore===null||p.bitrate.tsbefore===null)p.bitrate.bsbefore=p.bitrate.bsnow,p.bitrate.tsbefore=p.bitrate.tsnow;else{var b=p.bitrate.tsnow-p.bitrate.tsbefore;h.a.browserDetails.browser=="safari"&&(b/=1e3);var H=Math.round(8*(p.bitrate.bsnow-p.bitrate.bsbefore)/b);p.bitrate.value=H+" kbits/sec",p.bitrate.bsbefore=p.bitrate.bsnow,p.bitrate.tsbefore=p.bitrate.tsnow}}})})},1e3),"0 kbits/sec"):p.bitrate.value:(n.warn("Getting the video bitrate unsupported by browser"),"Feature unsupported by browser")},D=function(p){if(!V()&&!Y())return n.warn("Invalid handle"),void p.error("Invalid handle");var C=i.webrtcConfig;if(C.dtmfSender===null||C.dtmfSender===void 0){if(C.pc!==void 0&&C.pc!==null){var m=C.pc.getSenders().find(function(Z){return Z.track&&Z.track.kind==="audio"});if(!m)return n.warn("Invalid DTMF configuration (no audio track)"),void p.error("Invalid DTMF configuration (no audio track)");C.dtmfSender=m.dtmf,C.dtmfSender&&(n.log("Created DTMF Sender"),C.dtmfSender.ontonechange=function(Z){n.debug("Sent DTMF tone: "+Z.tone)}),n.log({"config.dtmfSender":C.dtmfSender})}if(C.dtmfSender===null||C.dtmfSender===void 0)return n.warn("Invalid DTMF configuration"),void p.error("Invalid DTMF configuration")}var S=p.dtmf;if(S==null)return n.warn("Invalid DTMF parameters"),void p.error("Invalid DTMF parameters");var b=S.tones;if(b==null)return n.warn("Invalid DTMF string"),void p.error("Invalid DTMF string");var H=S.duration;H==null&&(H=500);var $=S.gap;$==null&&($=50),n.debug("Sending DTMF string "+b+" (duration "+H+"ms, gap "+$+"ms)"),C.dtmfSender.insertDTMF(b,H,$)},U=function(p){if(n.log("Cleaning WebRTC stuff"),V()){var C=i.webrtcConfig;if(C!=null){if(p===!0){var m={command:"hangup"};n.debug("Sending hangup request"),n.debug(m),s.send(JSON.stringify(m))}C.remoteStream=null,C.volume.timer&&clearInterval(C.volume.timer),C.volume.value=null,C.bitrate.timer&&clearInterval(C.bitrate.timer),C.bitrate.timer=null,C.bitrate.bsnow=null,C.bitrate.bsbefore=null,C.bitrate.tsnow=null,C.bitrate.tsbefore=null,C.bitrate.value=null;try{if(!C.streamExternal&&C.myStream!==null&&C.myStream!==void 0){n.log("Stopping local stream tracks");var S=C.myStream.getTracks();for(var b in S){var H=S[b];n.log(H),H!=null&&H.stop()}}}catch{}C.streamExternal=!1,C.myStream=null;try{C.pc.close()}catch{}C.pc=null,C.candidates=null,C.mySdp=null,C.remoteSdp=null,C.iceDone=!1,C.dataChannel=null,C.dtmfSender=null}i.oncleanup()}},Q=function(p,C,m,S){if(!V()&&!Y())return n.warn("Invalid handle"),void m.error("Invalid handle");var b=i.webrtcConfig;n.log("streamsDone:",S),S&&(n.debug("  -- Audio tracks:",S.getAudioTracks()),n.debug("  -- Video tracks:",S.getVideoTracks()));var H=!1;if(b.myStream&&C.update&&!b.streamExternal){if((!C.update&&re(C)||C.update&&(C.addAudio||C.replaceAudio))&&S.getAudioTracks()&&S.getAudioTracks().length)if(b.myStream.addTrack(S.getAudioTracks()[0]),C.replaceAudio&&h.a.browserDetails.browser==="firefox")for(var $ in n.log("Adding audio track:",S.getAudioTracks()[0]),b.pc.getSenders()){var Z=b.pc.getSenders()[$];Z&&Z.track&&Z.track.kind==="audio"&&Z.replaceTrack(S.getAudioTracks()[0])}else n.log((C.replaceAudio?"Replacing":"Adding")+" audio track:",S.getAudioTracks()[0]),b.pc.addTrack(S.getAudioTracks()[0],S)}else b.myStream=S,H=!0;if(!b.pc){var q={iceServers:m.iceServers,iceTransportPolicy:void 0,bundlePolicy:"balanced"},oe={optional:[{DtlsSrtpKeyAgreement:!0}]};if(m.rtcConstraints&&v(m.rtcConstraints)==="object")for(var ee in n.debug("Adding custom PeerConnection constraints:",m.rtcConstraints),m.rtcConstraints)oe.optional.push(m.rtcConstraints[ee]);h.a.browserDetails.browser==="edge"&&(q.bundlePolicy="max-bundle"),n.log("Creating PeerConnection"),n.debug(oe),n.log("new RTCPeerConnection"+JSON.stringify({iceServers:q.iceServers,pc_constraints:oe})),b.pc=new RTCPeerConnection(q,oe),n.log("This is the peer connection created "+JSON.stringify(b.pc)),b.pc.getStats&&(b.volume.value=0,b.bitrate.value="0 kbits/sec"),n.log("Preparing local SDP and gathering candidates (trickle="+b.trickle+")"),b.pc.oniceconnectionstatechange=function(){b.pc&&i.iceState(b.pc.iceConnectionState)},b.pc.onicecandidate=function(te){if(te.candidate==null||h.a.browserDetails.browser==="edge"&&te.candidate.candidate.indexOf("endOfCandidates")>0)n.log("End of candidates."),b.iceDone=!0,b.trickle===!0?P(m,{completed:!0}):function(pe){if(V()||Y()){var se=i.webrtcConfig;n.log("Sending offer/answer SDP..."),se.mySdp!==null&&se.mySdp!==void 0?(se.mySdp={type:se.pc.localDescription.type,sdp:se.pc.localDescription.sdp},se.trickle===!1&&(se.mySdp.trickle=!1),n.debug(pe),se.sdpSent=!0,pe.success(se.mySdp)):n.warn("Local SDP instance is invalid, not sending anything...")}else n.warn("Invalid handle, not sending anything")}(m);else{var B={candidate:te.candidate.candidate,sdpMid:te.candidate.sdpMid,sdpMLineIndex:te.candidate.sdpMLineIndex};b.trickle===!0&&P(m,B)}},b.pc.ontrack=function(te){n.log("Handling Remote Track"),n.debug(te),te.streams&&(b.remoteStream=te.streams[0],i.onremotestream(b.remoteStream),te.track&&!te.track.onended&&(n.log("Adding onended callback to track:",te.track),te.track.onended=function(B){n.log("Remote track removed:",B),b.remoteStream&&(b.remoteStream.removeTrack(B.target),i.onremotestream(b.remoteStream))}))}}H&&S!=null&&(n.log("Adding local stream"),S.getTracks().forEach(function(te){b.pc.addTrack(te,S)})),b.myStream&&i.onlocalstream(b.myStream),p==null?function(te,B){if(!V()&&!Y())return n.warn("Invalid handle"),void B.error("Invalid handle");var pe=i.webrtcConfig,se=B.simulcast===!0;se?n.log("Creating offer (iceDone="+pe.iceDone+", simulcast="+se+")"):n.log("Creating offer (iceDone="+pe.iceDone+")");var me={offerToReceiveAudio:ve(te)};B.iceRestart===!0&&(me.iceRestart=!0),n.log(me),pe.pc.createOffer(function(we){if(n.debug(we),n.log("Setting local description"),pe.mySdp=we.sdp,pe.pc.setLocalDescription(we),pe.mediaConstraints=me,pe.iceDone||pe.trickle){n.log("Offer ready"),n.debug(B);var he={type:we.type,sdp:we.sdp};B.success(he)}else n.log("Waiting for all candidates...")},B.error,me)}(C,m):b.pc.setRemoteDescription(new RTCSessionDescription(p),function(){if(n.log("Remote description accepted!"),b.remoteSdp=p.sdp,b.candidates&&b.candidates.length>0){for(var te in b.candidates){var B=b.candidates[te];n.debug("Adding remote candidate:",B),B&&B.completed!==!0?b.pc.addIceCandidate(new RTCIceCandidate(B)):b.pc.addIceCandidate()}b.candidates=[]}(function(pe,se){if(!V()&&!Y())return n.warn("Invalid handle"),void se.error("Invalid handle");var me=i.webrtcConfig,we=se.simulcast===!0;we?n.log("Creating answer (iceDone="+me.iceDone+", simulcast="+we+")"):n.log("Creating answer (iceDone="+me.iceDone+")");var he=null;he=h.a.browserDetails.browser=="firefox"||h.a.browserDetails.browser=="edge"?{offerToReceiveAudio:ve(pe)}:{mandatory:{OfferToReceiveAudio:ve(pe)}},n.debug(he),me.pc.createAnswer(function(Ie){if(n.debug(Ie),n.log("Setting local description"),me.mySdp=Ie.sdp,me.pc.setLocalDescription(Ie),me.mediaConstraints=he,me.iceDone||me.trickle){var We={type:Ie.type,sdp:Ie.sdp};se.success(We)}else n.log("Waiting for all candidates...")},se.error,he)})(C,m)},m.error)},P=function(p,C){if(a){if(!V()&&!Y())return n.warn("Invalid handle"),void p.error("Invalid handle");var m={command:"trickle",candidate:C};n.vdebug("Sending trickle candidate"),n.vdebug(m),s.send(JSON.stringify(m))}else n.warn("Is the gateway down? (connected=false)")},E=function(){if(!V()&&!Y())return n.warn("Invalid handle"),!0;var p=i.webrtcConfig;return p.pc===null||p.pc===void 0?(n.warn("Invalid PeerConnection"),!0):p.myStream===void 0||p.myStream===null?(n.warn("Invalid local MediaStream"),!0):p.myStream.getAudioTracks()===null||p.myStream.getAudioTracks()===void 0||p.myStream.getAudioTracks().length===0?(n.warn("No audio track"),!0):!p.myStream.getAudioTracks()[0].enabled},N=function(p){if(!V()&&!Y())return n.warn("Invalid handle"),!1;var C=i.webrtcConfig;return C.pc===null||C.pc===void 0?(n.warn("Invalid PeerConnection"),!1):C.myStream===void 0||C.myStream===null?(n.warn("Invalid local MediaStream"),!1):C.myStream.getAudioTracks()===null||C.myStream.getAudioTracks()===void 0||C.myStream.getAudioTracks().length===0?(n.warn("No audio track"),!1):(n.log({"config.myStream.getAudioTracks()[0].enabled":C.myStream.getAudioTracks()[0].enabled}),C.myStream.getAudioTracks()[0].enabled=!p,!0)},W=function(){if(!V()&&!Y())return n.warn("Invalid handle"),!1;var p=i.webrtcConfig;return p.pc.getStats&&h.a.browserDetails.browser=="chrome"?p.remoteStream===null||p.remoteStream===void 0?(n.warn("Remote stream unavailable"),0):p.volume.timer===null||p.volume.timer===void 0?(n.log("Starting volume monitor"),p.volume.timer=setInterval(function(){p.pc.getStats(function(C){for(var m=C.result(),S=0;S<m.length;S++){var b=m[S];b.type=="ssrc"&&b.stat("audioOutputLevel")&&(p.volume.value=b.stat("audioOutputLevel"))}})},200),0):p.volume.value:(n.log("Getting the remote volume unsupported by browser"),0)},M=function(){var p=function(){s.removeEventListener("message",C),s.removeEventListener("error",m),t&&clearTimeout(t),s.close()},C=function(){n.log("websocket closed successfully"),p()},m=function(){n.log("closing websocket on error"),p()};u("closed"),s.readyState==1?(s.addEventListener("message",C),s.addEventListener("error",m),s.send(JSON.stringify({command:"destroy"}))):m()},re=function(p){return n.debug("isAudioSendEnabled:",p),p==null||p.audio!==!1&&(p.audioSend===void 0||p.audioSend===null||p.audioSend===!0)},le=function(p){return n.debug("isAudioSendRequired:",p),p!=null&&p.audio!==!1&&p.audioSend!==!1&&p.failIfNoAudio!==void 0&&p.failIfNoAudio!==null&&p.failIfNoAudio===!0},ve=function(p){return n.debug("isAudioRecvEnabled:",p),p==null||p.audio!==!1&&(p.audioRecv===void 0||p.audioRecv===null||p.audioRecv===!0)},ce=function p(){a&&(t=setTimeout(p,3e4),n.log("keepalive"),s.send(JSON.stringify({command:"keepalive"})))},V=function(){var p=!1;return i&&(p=!0),p},Y=function(){var p=!1;return i.webrtcConfig&&(p=!0),p};function fe(p,C,m,S,b,H,$){try{var Z=p[H]($),q=Z.value}catch(oe){return void m(oe)}Z.done?C(q):Promise.resolve(q).then(S,b)}var X=function(){var p,C=(p=regeneratorRuntime.mark(function m(S,b){return regeneratorRuntime.wrap(function(H){for(;;)switch(H.prev=H.next){case 0:return H.abrupt("return",new Promise(function($,Z){X.server=new WebSocket(S.server,["at-protocol",S.capabilityToken]),X.server.onopen=function(){var q,oe;n.log("Sending initial request to Africa's Talking APIs "),q=b,oe=X.server,s=oe,u=q.emitEvent,y=function(){n.error("AfricasTalking Client Error: error occured on session creation"),M()},f=function(){n.log("Creating Session... ");var ee={webrtcConfig:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannel:null,dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},consentDialog:q.consentDialog,iceState:q.iceState,mediaState:q.mediaState,webrtcState:q.webrtcState,slowLink:q.slowLink,onmessage:q.onmessage,onlocalstream:q.onlocalstream,onremotestream:q.onremotestream,ondata:q.ondata,ondataopen:q.ondataopen,oncleanup:q.oncleanup,getVolume:function(){return W()},isAudioMuted:function(){return E()},muteAudio:function(){return N(!0)},unmuteAudio:function(){return N(!1)},getBitrate:function(){return j()},send:function(B){T(B)},data:function(B){x(B)},dtmf:function(B){D(B)},createOffer:function(B){G(B)},createAnswer:function(B){G(B)},handleRemoteJsep:function(B){A(B)},hangup:function(B){U(B===!0)}};n.log({"my handle is":ee}),t=setTimeout(ce,3e4),a=!0,i=ee,q.setHandle(ee);var te=["iPad","iPhone","iPod"].indexOf(navigator.platform)>=0;window.addEventListener(te?"pagehide":"unload",function(){s.close()})},$(X.server)},X.server.onmessage=function(q){n.log("Got this message from the websocket: "+q.data),_(JSON.parse(q.data)),$(X.server)},X.server.onclose=function(q){n.log("Lost connection to the gateway (is it down?)"+JSON.stringify(q)),M(),$(X.server)},X.server.onerror=function(q){n.error("AfricasTalking Client Error: Error connecting to the Africastalking WebSockets server... "+JSON.stringify(q)),Z(q)}}));case 1:case"end":return H.stop()}},m)}),function(){var m=this,S=arguments;return new Promise(function(b,H){var $=p.apply(m,S);function Z(oe){fe($,b,H,Z,q,"next",oe)}function q(oe){fe($,b,H,Z,q,"throw",oe)}Z(void 0)})});return function(m,S){return C.apply(this,arguments)}}();function Ce(p){if(n.log("Library initialized: "+p),n.log("Using WebSockets to contact Africastalking: "+p.server),p.capabilityToken===null||p.capabilityToken===void 0)return p.error("No capability token specified"),{};n.log({gatewayCallbacks:p});var C={server:p.server,capabilityToken:p.capabilityToken},m={setHandle:p.setHandle,emitEvent:p.emitEvent,destroyed:p.destroyed,error:p.error,oncleanup:p.oncleanup,onlocalstream:p.onlocalstream,onmessage:p.onmessage,onremotestream:p.onremotestream,consentDialog:function(){},mediaState:function(){},webrtcState:function(){},slowLink:function(){},iceState:function(){}};X(C,m).then(function(S){S.send(JSON.stringify({command:"create"}))}).catch(function(S){n.log("websocket Error: "+JSON.stringify(S))})}Ce.noop=function(){},Ce.isWebrtcSupported=function(){return window.RTCPeerConnection!==void 0&&window.RTCPeerConnection!==null&&navigator.getUserMedia!==void 0&&navigator.getUserMedia!==null};var Se=Ce,ue={},ge=function(p){navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&(navigator.enumerateDevices=function(Z){navigator.mediaDevices.enumerateDevices().then(Z)});var C=[],m=location.protocol==="https:",S=!1;(typeof MediaStreamTrack<"u"&&"getSources"in MediaStreamTrack||navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices)&&(S=!0);var b,H=!1,$=!1;b=function(){ue={audio:H,audioCap:$},n.log({supportedDevices:ue}),p()},n.log({"finding supported devices":navigator.enumerateDevices,"some if statememt":navigator.mediaDevices,navigator}),S?(!navigator.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(navigator.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!navigator.enumerateDevices&&navigator.enumerateDevices&&(navigator.enumerateDevices=navigator.enumerateDevices.bind(navigator)),navigator.enumerateDevices?(C=[],navigator.enumerateDevices(function(Z){Z.forEach(function(q){var oe,ee={};for(var te in q)ee[te]=q[te];ee.kind==="audio"&&(ee.kind="audioinput"),C.forEach(function(B){B.id===ee.id&&B.kind===ee.kind&&(oe=!0)}),oe||(ee.deviceId||(ee.deviceId=ee.id),ee.id||(ee.id=ee.deviceId),ee.label?ee.kind!=="audioinput"||$||($=!0):(ee.label="Please invoke getUserMedia once.",m||(ee.label="HTTPs is required to get label of this "+ee.kind+" device.")),ee.kind==="audioinput"&&(H=!0),C.push(ee))}),b&&b()})):b&&b()):n.log("cant enumerate devices")};function xe(p,C){for(var m=0;m<C.length;m++){var S=C[m];S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(p,S.key,S)}}function Ee(p,C){if(!(p instanceof C))throw new TypeError("Cannot call a class as a function")}function _e(p,C){for(var m=0;m<C.length;m++){var S=C[m];S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(p,S.key,S)}}var K,ie,Me,ke,Te,Pe,be=new(function(){function p(){(function(S,b){if(!(S instanceof b))throw new TypeError("Cannot call a class as a function")})(this,p),this.events={}}var C,m;return C=p,(m=[{key:"subscribe",value:function(S,b){var H=this;return this.events[S]||(this.events[S]=[]),this.events[S].push(b),function(){H.events[S]=H.events[S].filter(function($){return b!==$})}}},{key:"emit",value:function(S,b){var H=this.events[S];H&&H.forEach(function($){$.call(null,b)})}},{key:"unsubscribe",value:function(S){var b=this.events[S];return this.events[S]||(this.events[S]=[]),b&&this.events.splice(b),this}},{key:"unsubscribeAll",value:function(){return this.events={},this}}])&&xe(C.prototype,m),p}()),De=!1,Ve=function(){function p(S){var b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Ee(this,p);var H=b.iceServers,$=H===void 0?[]:H,Z=b.sounds,q=Z===void 0?{}:Z;this.token=S,this.initDone=!1,this.iceServers,this.atwebsocketUrl="wss://webrtc.africastalking.com/connect",Array.isArray($)&&$.length>0&&(this.iceServers=qe($));var oe=ze(q);Te=new Audio(oe.ringing),Pe=new Audio(oe.dialing),n.log({ringing:Te,dialing:Pe}),n.log({iceServers:this.iceServers}),Je.bind(this)()}var C,m;return C=p,(m=[{key:"on",value:function(S,b){be.subscribe(S,b)}},{key:"logout",value:function(){K&&K.send({message:{request:"unregister"}})}},{key:"hold",value:function(){K&&K.send({message:{request:"hold"}})}},{key:"unhold",value:function(){K&&K.send({message:{request:"unhold"}})}},{key:"call",value:function(S){Pe.play();var b=this.iceServers;ge(function(){K.createOffer({iceServers:b,media:{audioSend:!0,audioRecv:!0},success:function(H){n.debug("Got SDP!"),n.debug(H),n.log({to:S,jsep:H});var $={request:"call",to:S};K.send({message:$,jsep:H}),ke=S},error:function(H){n.error("AfricasTalking Client Error: ",H)}})})}},{key:"answer",value:function(){var S=this.iceServers;ie=null,ge(function(){K.createAnswer({jsep:Me,iceServers:S,media:{audio:!0},success:function(b){n.debug("Got SDP! audio=true, video=true"),n.debug(b),K.send({message:{request:"accept"},jsep:b})},error:function(b){n.error("AfricasTalking Client Error: ",b),K.send({message:{request:"decline",code:480}})}})})}},{key:"dtmf",value:function(S){K.dtmf({dtmf:{tones:S}})}},{key:"muteAudio",value:function(){return K.muteAudio()}},{key:"unmuteAudio",value:function(){return K.unmuteAudio()}},{key:"getVolume",value:function(){return K.getVolume()}},{key:"isAudioMuted",value:function(){return K.isMuted()}},{key:"hangup",value:function(){ie?He():(K.send({message:{request:"hangup"}}),K.hangup())}},{key:"getCounterpartNum",value:function(){return ke}}])&&_e(C.prototype,m),p}();function Je(){var p=document.getElementById("remote-stream-audio");K?Ne():this.initDone!==!0&&(n.log("creating remoteStreamAudio",p,Te,Pe),p||((p=document.createElement("audio")).id="remote-stream-audio",p.autoplay=!0,document.body.appendChild(p)),Te.loop=!0,Pe.loop=!0,this.initDone=!0,Se.isWebrtcSupported()?new Se({server:this.atwebsocketUrl,capabilityToken:this.token,setHandle:function(C){K=C,ge(function(){Ne()})},onmessage:function(C,m){n.log(" ::: Got a message :::"),n.log(JSON.stringify(C));var S=C.error;if(S==null||S==null){var b=C.result;if(n.log("This is the result "+b.toString),b!=null&&b.event!==void 0&&b.event!==null){var H=b.event;switch(H){case"registration_failed":return n.log("Registration failed: "+b.code+" "+b.reason),void Ne();case"registered":n.log("Successfully registered as "+b.username+"!"),De||(De=!0,be.emit("ready"));break;case"unregistered":n.log("Successfully unregistered as "+b.username+"!"),De&&(De=!1,be.emit("notready"));break;case"calling":n.log("Waiting for the peer to answer..."),be.emit("calling");break;case"incomingcall":ke=C.result.username.split("@")[0].split(":")[1],ie=!0,Te.play(),n.log("Incoming call from "+b.username+"!"),Me=m,be.emit("incomingcall",{from:ke});break;case"progress":n.log("There's early media from "+b.username+", wairing for the call!"),m!=null&&Ue(m);break;case"missed_call":ke=C.result.caller.split("@")[0].split(":")[1],n.log("Missed call from "+b.caller+"!"),be.emit("missedcall",{from:ke});break;case"accepted":Pe.pause(),Te.pause(),n.log(b.username+" accepted the call!"),m!=null&&Ue(m),be.emit("callaccepted");break;case"hangup":ie=null,Pe.pause(),Te.pause(),n.log("Call hung up ("+b.code+" "+b.reason+")!"),K.hangup(),be.emit("hangup",{code:b.code,reason:b.reason});break;case"decline":ie=null,Pe.pause(),Te.pause(),n.log("Call declined!"),K.hangup(),be.emit("hangup");break;default:n.log("Received random json request "+H.toString)}}}else De?(Pe.pause(),Te.pause(),K.hangup()):n.log("User is not registered"+S)},emitEvent:function(C){be.emit(C)},onlocalstream:function(C){n.log(" ::: Got a local stream :::"),n.log(JSON.stringify(C))},onremotestream:function(C){n.debug(" ::: Got a remote stream :::"),n.debug(JSON.stringify(C));var m=C.getAudioTracks();(function(S,b){h.a.browserDetails.browser==="chrome"?h.a.browserDetails.version>=43?S.srcObject=b:S.src!==void 0?S.src=URL.createObjectURL(b):n.error("AfricasTalking Client Error: Error attaching media stream to element"):S.srcObject=b})(p,new MediaStream(m))},oncleanup:function(){n.log(" ::: Got a cleanup notification :::")},error:function(C){De=!1,n.error("Africastalking Client Error: "+C),be.unsubscribeAll()},destroyed:function(){De=!1,be.unsubscribeAll()}}):n.error("AfricasTalking Client Error: No WebRTC support"))}var Ne=function(){K?(n.log({"loggin in with handle in client":K}),K.send({message:{request:"register"}})):n.error("Africastalking error: Unable to initialize")},He=function(){ie=null,K.send({message:{request:"decline"}})},Ue=function(p){K.handleRemoteJsep({jsep:p,error:function(){K.send({message:{request:"hangup"}}),K.hangup()}})},ze=function(p){return{dialing:p.dialing?p.dialing:"https://res.cloudinary.com/at-voice/video/upload/v1558426588/AT-voice-client-sdk/dialing_g4tn6r.mp3",ringing:p.ringing?p.ringing:"https://res.cloudinary.com/at-voice/video/upload/v1558426103/AT-voice-client-sdk/ringing_au0d1x.mp3"}},qe=function(p){var C=[];return p.forEach(function(m){if(typeof m.urls=="string"&&m.urls.startsWith("stun:"))C.push({urls:m.urls});else if(typeof m.urls=="string"&&(m.urls.startsWith("turn:")||m.urls.startsWith("turns:")))C.push({urls:m.urls,username:m.username,credential:m.credential});else if(Array.isArray(m.urls)){var S=m.urls.filter(function(b){return typeof b=="string"&&(b.startsWith("turn:")||b.startsWith("turns:"))});S.length===m.urls.length?C.push({urls:S,username:m.username,credential:m.credential}):n.error("AfricasTalking Client Error: Invalid iceServer param ".concat(JSON.stringify(m)))}else n.error("AfricasTalking Client Error: Invalid iceServer param ".concat(JSON.stringify(m)))}),C},Be=Ve;z.default={Client:Be}}]).default})})(Fe);var Ye=Fe.exports;const Xe=Qe(Ye),Ze=[{product:"Phone",status:"Shipped",COD:500,client:"John Doe",phone:"123-456-7890",email:"john@example.com",altPhone:"111-222-3333",location:"Portland, Oregon",orders:[{product:"Tablet",status:"Delivered"},{product:"Laptop",status:"Pending"}]}],et={async fetch({page:k,itemsPerPage:I,sortBy:J,search:z}){return new Promise(O=>{setTimeout(()=>{const l=(k-1)*I,r=l+I,o=Ze.filter(c=>!0),e=o.slice(l,r);O({items:e,total:o.length})},500)})}};je("orders");je("");const tt={setup(){const k=je(!1),I=je(!1);return{isMuted:k,isOnHold:I,handleMute:()=>{k.value=!k.value},handleHoldToggle:()=>{I.value=!I.value}}},components:{AppLayout:$e},data:()=>({isMuted:!1,isOnHold:!1,itemsPerPage:5,tab:"calls",isCalling:!1,connection_active:!1,queueDialog:!1,transferDialog:!1,callAgentDialog:!1,queuedCalls:[],selectedAgent:null,availableAgents:[].filter(k=>status.available),queuedCalls:[{call_id:1,phone_number:"+254711123456",status:"queued"},{call_id:2,phone_number:"+254712345678",status:"queued"},{call_id:3,phone_number:"+254713456789",status:"queued"},{call_id:4,phone_number:"+254714567890",status:"queued"}],queuedCallsheaders:[{title:"Call ID",value:"call_id"},{title:"Phone Number",value:"phone_number"},{title:"Status",value:"status"},{title:"Actions",value:"actions",sortable:!1}],headers:[{title:"Product",align:"start",key:"product"},{title:"Status",key:"status",align:"start"},{title:"COD",key:"COD",align:"end"},{title:"Client",key:"client",align:"start"},{title:"Phone",key:"phone",align:"start"}],callsheaders:[{title:"Date",value:"created_at"},{title:"Caller No.",value:"callerNumber"},{title:"Destination Number",value:"destinationNumber"},{title:"clientDialed Number",value:"clientDialedNumber"},{title:"Duration In Seconds",value:"durationInSeconds"},{title:"Caller Carrier",value:"callerCarrier"},{title:"Call Status",value:"status"},{title:"HangupCause",value:"lastBridgeHangupCause"},{title:"Call Session State",value:"callSessionState"},{title:"Actions",value:"actions",sortable:!1}],serverItems:[{product:"Phone",status:"Shipped",COD:500,client:"John Doe",phone:"741821113"},{product:"Tablet",status:"Pending",COD:700,client:"Jane Doe",phone:"751458911"}],loading:!1,totalItems:2,statuses:["Pending","Shipped","Delivered","Cancelled"],statusModal:!1,phonePopup:!1,newCall:!1,incomingCallDialog:!1,incomingCall:{},callId:null,afClient:null,session:null,selectedItem:{phone:""},eventLog:[]}),methods:{async initializeAfricastalking(){const k={sounds:{dialing:"https://support.solssa.com/storage/ringtones/office_phone.mp3",ringing:"https://support.solssa.com/storage/ringtones/office_phone.mp3"}};try{const I=await axios.get("/api/v1/voice-token");console.log("API Response:",I.data);const J=I.data.updatedTokens;if(!J||J.length===0){console.error("No tokens found in response."),this.$toastr.error("No tokens available.");return}const z=J[0].token;if(console.log("Using token:"),!z){console.error("Token is missing from response."),this.$toastr.error("Invalid token received.");return}const O=new Xe.Client(z,k);console.log("Africastalking client initialized."),this.afClient=O,O.on("ready",()=>{this.connection_active=!0,console.log("Africastalking WebRTC client is ready."),this.$toastr.success("WebRTC client is ready.")}),O.on("error",r=>{console.error("Africastalking Client Error:",r),this.$toastr.error("Client Error: "+r.message)}),O.on("closed",r=>{console.warn("Africastalking Client Connection Closed:",r),this.$toastr.warning("Connection closed.")}),O.on("incomingcall",r=>{console.log("Incoming call received."),console.log(`Incoming call from ${r.from}`),console.log("Event Data:",r),this.incomingCallDialog=!0,this.incomingCall={from:r.from,duration:"Connecting..."}}),O.on("hangup",r=>{console.log("Incoming call hung up:",hangup.reason),this.$toastr.error("Incoming call hung up: "+hangup.reason),this.incomingCallDialog=!1});let l=event.call;this.$webrtcClient=O}catch(I){console.error("Error initializing Africastalking WebRTC client:",I),this.$toastr.error("Failed to initialize WebRTC client: "+I.message)}},transferCall(){this.openTransferDialog()},async callClient(k){try{console.log(`Calling ${k} from +254711082159...`),this.afClient.call(k),console.log("Call initiated successfully."),this.$toastr.success("Call started."),this.isCalling=!0,this.afClient.on("afClienting",()=>{this.logEvent("afClient is in progress (calling)...")}),this.afClient.on("callaccepted",()=>{console.log("callaccepted"),this.$toastr.success("Call accepted!"),this.logEvent("Call accepted (bridged between caller and callee).")}),this.afClient.on("hangup",I=>{this.logEvent(`Call hung up (${I.code} - ${I.reason}).`),this.$toastr.error(`Call ended: ${I.reason}`),this.isCalling=!1,this.activeCall=null}),this.afClient.on("mute",()=>{this.logEvent("Call muted."),this.$toastr.info("Call muted.")}),this.afClient.on("unmute",()=>{this.logEvent("Call unmuted."),this.$toastr.info("Call unmuted.")}),this.afClient.on("hold",()=>{this.logEvent("Call on hold."),this.$toastr.info("Call on hold.")}),this.afClient.on("unhold",()=>{this.logEvent("Call resumed from hold."),this.$toastr.info("Call resumed from hold.")})}catch(I){console.error("Call initiation error:",I),this.$toastr.error("Call failed: "+I.message)}},answerCall(){this.incomingCall&&this.afClient.answer()},hangupCall(){this.incomingCall&&(this.afClient.hangup(),console.log("call rejected"),this.$toastr.error("Call rejected."),this.incomingCallDialog=!1,this.isCalling=!1)},handleMute(){this.isCalling&&(this.afClient.mute(),this.isMuted=!this.isMuted,console.log("call is muted"))},handleHoldToggle(){this.isCalling&&(this.afClient.hold(),this.isOnHold=!this.isOnHold,this.logEvent(this.isOnHold?"Call on hold.":"Call resumed from hold."))},logEvent(k){const I=new Date().toLocaleTimeString();this.eventLog.unshift(`${I}: ${k}`)},closeDialog(){this.callAgentDialog=!1},openCallAgent(){this.callAgentDialog=!0},openTransferDialog(){this.transferDialog=!0},openQueueDialog(){this.fetchQueuedCalls(),this.queueDialog=!0},fetchQueuedCalls(){axios.get("/api/v1/queued-calls").then(k=>{this.queuedCalls=k.data}).catch(k=>{console.error("Error fetching queued calls:",k)})},loadItems({page:k,itemsPerPage:I,sortBy:J}){this.loading=!0,et.fetch({page:k,itemsPerPage:I,sortBy:J,search:{}}).then(({items:z,total:O})=>{this.serverItems=z,this.totalItems=O,this.loading=!1})},openStatusModal(k){this.selectedItem=k,this.statusModal=!0},updateStatus(k,I){k.status=I,this.statusModal=!1},openPhonePopup(k){this.selectedItem=k,this.phonePopup=!0},handleCall(k){this.selectedAgent=k,this.callAgentDialog=!1,console.log("Calling agent:",k)},async fetchCallHistory(){axios.get("/api/v1/call-history").then(k=>{this.calls=k.data.callHistories}).catch(k=>{console.error("Error fetching call history:",k)})},async fetchOrders(){axios.get("/api/v1/orders").then(k=>{this.orders=k.data.orders}).catch(k=>{console.error("Error fetching orders:",k)})},fetchUsers(){axios.get("/v1/users").then(k=>{this.agents=k.data}).catch(k=>{console.error("Error fetching users:",k)})}},watch:{availableAgents(k){this.availableAgents=k.filter(I=>!I.isInCall)}},async mounted(){await this.initializeAfricastalking(),this.fetchOrders()},created(){this.fetchCallHistory(),this.fetchUsers()}},rt={class:"p-4"},nt=F("span",{class:"ml-3"},"Make a new Call",-1),at=F("span",{class:"ml-3"},"Call an agent",-1),it={class:"d-flex align-center mt-2"},ot=F("span",{class:"ml-3"},"Missed Calls",-1),st=F("span",{class:"ml-auto"},"60,400",-1),ct=F("span",{class:"ml-3"},"Check Queue",-1),dt=F("span",{class:"ml-auto"},"...",-1),lt={class:"d-flex align-center"},ut=F("span",null,"AM",-1),pt=F("div",null,[F("p",{class:"mb-0"},"John Mwacahro"),F("small",null,"john.boxleo@gmail.com")],-1),ft=F("div",{class:"mt-4"},[F("p",null,[L("Calls connected: "),F("strong",null,"0")]),F("p",null,[L("Calls made: "),F("strong",null,"0")]),F("p",null,[L("Calls rejected: "),F("strong",null,"0")]),F("p",null,[L("Incoming Calls: "),F("strong",null,"0")])],-1),mt=["onClick"],vt=["onClick"],gt=F("p",null,"Select an agent to call:",-1),ht=F("strong",null,"Name:",-1),yt=F("strong",null,"Email:",-1),Ct=F("strong",null,"Phone:",-1),St=F("strong",null,"Alternative Phone:",-1),Tt=F("strong",null,"Location:",-1);function bt(k,I,J,z,O,l){const r=ae("v-icon"),o=ae("v-card-text"),e=ae("v-card"),c=ae("v-col"),d=ae("v-avatar"),n=ae("v-chip"),g=ae("v-row"),h=ae("v-text-field"),v=ae("v-tab"),s=ae("v-tabs"),u=ae("v-btn"),t=ae("v-data-table"),a=ae("v-window-item"),i=ae("v-window"),f=ae("v-card-title"),y=ae("v-list-item"),_=ae("v-list"),T=ae("v-card-actions"),x=ae("v-dialog"),G=ae("v-spacer"),A=ae("v-container"),j=ae("AppLayout");return de(),ye(j,null,{default:w(()=>[F("div",rt,[R(A,null,{default:w(()=>[R(g,null,{default:w(()=>[R(c,{cols:"12",md:"6"},{default:w(()=>[R(e,null,{default:w(()=>[R(o,null,{default:w(()=>[F("div",{class:"d-flex align-center",onClick:I[0]||(I[0]=D=>k.newCall=!0)},[R(r,{color:"green"},{default:w(()=>[L("mdi-phone")]),_:1}),nt]),F("div",{class:"d-flex align-center mt-2",onClick:I[1]||(I[1]=(...D)=>l.openCallAgent&&l.openCallAgent(...D))},[R(r,{color:"blue"},{default:w(()=>[L("mdi-account")]),_:1}),at]),F("div",it,[R(r,{color:"red"},{default:w(()=>[L("mdi-phone-missed")]),_:1}),ot,st]),F("div",{class:"d-flex align-center mt-2",onClick:I[2]||(I[2]=(...D)=>l.openQueueDialog&&l.openQueueDialog(...D))},[R(r,{color:"orange"},{default:w(()=>[L("mdi-check-decagram")]),_:1}),ct,dt])]),_:1})]),_:1})]),_:1}),R(c,{cols:"12",md:"6"},{default:w(()=>[R(e,null,{default:w(()=>[R(o,null,{default:w(()=>[F("div",lt,[R(d,{class:"mr-3",color:"blue",size:"40"},{default:w(()=>[ut]),_:1}),pt,R(n,{class:"ml-auto",color:"green","text-color":"white"},{default:w(()=>[L("Online")]),_:1})]),ft]),_:1})]),_:1})]),_:1})]),_:1}),R(e,null,{default:w(()=>[R(h,{modelValue:k.searchQuery,"onUpdate:modelValue":I[3]||(I[3]=D=>k.searchQuery=D),label:"Search","prepend-inner-icon":"mdi-magnify",outlined:"",dense:"",clearable:""},null,8,["modelValue"]),R(s,{modelValue:k.tab,"onUpdate:modelValue":I[4]||(I[4]=D=>k.tab=D),color:"primary"},{default:w(()=>[R(v,{value:"calls"},{default:w(()=>[L("Calls")]),_:1}),R(v,{value:"orders"},{default:w(()=>[L("Orders")]),_:1})]),_:1},8,["modelValue"]),R(i,{modelValue:k.tab,"onUpdate:modelValue":I[5]||(I[5]=D=>k.tab=D)},{default:w(()=>[R(a,{value:"calls"},{default:w(()=>[R(t,{headers:k.callsheaders,items:k.calls,"item-value":"id",class:"elevation-1 mt-4","items-per-page":15},{"item.actions":w(({item:D})=>[R(u,{color:"blue",onClick:U=>k.playRecording(D),rounded:"lg",block:""},{default:w(()=>[R(r,null,{default:w(()=>[L("mdi-play")]),_:1}),L(" Play ")]),_:2},1032,["onClick"])]),_:1},8,["headers","items"])]),_:1}),R(a,{value:"orders"},{default:w(()=>[R(t,{headers:k.headers,items:k.serverItems,loading:k.loading,class:"elevation-1 mt-4"},{body:w(({items:D})=>[(de(!0),Oe(Le,null,Ae(D,U=>(de(),Oe("tr",{key:U.product},[F("td",null,ne(U.product),1),F("td",null,[F("span",{class:"clickable",onClick:Q=>l.openStatusModal(U)},ne(U.status),9,mt)]),F("td",null,ne(U.COD),1),F("td",null,ne(U.client),1),F("td",null,[F("span",{class:"clickable",onClick:Q=>l.openPhonePopup(U)},ne(U.phone),9,vt)])]))),128))]),_:1},8,["headers","items","loading"])]),_:1})]),_:1},8,["modelValue"])]),_:1}),R(x,{modelValue:k.callAgentDialog,"onUpdate:modelValue":I[6]||(I[6]=D=>k.callAgentDialog=D),"max-width":"400"},{default:w(()=>[R(e,null,{default:w(()=>[R(f,{class:"headline"},{default:w(()=>[L("Call an Agent")]),_:1}),R(o,null,{default:w(()=>[gt,R(_,null,{default:w(()=>[(de(!0),Oe(Le,null,Ae(k.agents,D=>(de(),ye(y,{key:D.name,onClick:U=>l.handleCall(D),class:"agent-item"},{default:w(()=>[F("div",null,[F("strong",null,ne(D.name),1),F("span",{class:Ge({"text-success":D.status==="available","text-warning":D.status==="engaged","text-grey":D.status==="offline"})}," - "+ne(D.status),3)])]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),R(T,null,{default:w(()=>[R(u,{color:"blue darken-1",text:"",onClick:l.closeDialog},{default:w(()=>[L("Cancel")]),_:1},8,["onClick"]),k.isCalling?(de(),ye(u,{key:0,color:"red",onClick:l.hangupCall},{default:w(()=>[R(r,{left:""},{default:w(()=>[L("mdi-phone-off")]),_:1}),L(" Hangup ")]),_:1},8,["onClick"])):Re("",!0),k.isCalling?(de(),ye(u,{key:1,color:"grey",onClick:k.handleHold},{default:w(()=>[R(r,{left:""},{default:w(()=>[L("mdi-pause")]),_:1}),L(" Hold ")]),_:1},8,["onClick"])):Re("",!0),k.isCalling?(de(),ye(u,{key:2,color:"blue",onClick:l.openTransferDialog},{default:w(()=>[R(r,{left:""},{default:w(()=>[L("mdi-phone-transfer")]),_:1}),L(" Transfer ")]),_:1},8,["onClick"])):Re("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),R(x,{modelValue:k.statusModal,"onUpdate:modelValue":I[8]||(I[8]=D=>k.statusModal=D),"max-width":"400"},{default:w(()=>[R(e,null,{default:w(()=>[R(f,null,{default:w(()=>[L("Select Status")]),_:1}),R(o,null,{default:w(()=>[R(_,null,{default:w(()=>[(de(!0),Oe(Le,null,Ae(k.statuses,D=>(de(),ye(y,{key:D,onClick:U=>l.updateStatus(k.selectedItem,D)},{default:w(()=>[L(ne(D),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),R(T,null,{default:w(()=>[R(u,{color:"primary",text:"",onClick:I[7]||(I[7]=D=>k.statusModal=!1)},{default:w(()=>[L("Close")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),R(x,{modelValue:k.queueDialog,"onUpdate:modelValue":I[10]||(I[10]=D=>k.queueDialog=D),"max-width":"600"},{default:w(()=>[R(e,null,{default:w(()=>[R(f,null,{default:w(()=>[L(" Queued Calls "),R(G),R(u,{icon:"",onClick:I[9]||(I[9]=D=>k.queueDialog=!1)},{default:w(()=>[R(r,null,{default:w(()=>[L("mdi-close")]),_:1})]),_:1})]),_:1}),R(o,null,{default:w(()=>[R(t,{headers:k.queuedCallsheaders,items:k.queuedCalls,"item-value":"id",class:"elevation-1"},{"item.actions":w(({item:D})=>[R(u,{color:"green",onClick:U=>k.dequeueCall(D.id)},{default:w(()=>[L(" Dequeue ")]),_:2},1032,["onClick"])]),_:1},8,["headers","items"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),R(x,{modelValue:k.newCall,"onUpdate:modelValue":I[14]||(I[14]=D=>k.newCall=D),"max-width":"600"},{default:w(()=>[R(e,null,{default:w(()=>[R(f,null,{default:w(()=>[L(" Client Details "),R(G),R(u,{icon:"",onClick:I[11]||(I[11]=D=>k.newCall=!1)},{default:w(()=>[R(r,null,{default:w(()=>[L("mdi-close")]),_:1})]),_:1})]),_:1}),R(o,null,{default:w(()=>[R(h,{modelValue:k.phone,"onUpdate:modelValue":I[12]||(I[12]=D=>k.phone=D),label:"Phone Number",type:"text",required:""},null,8,["modelValue"])]),_:1}),R(T,null,{default:w(()=>[F("div",null,[k.isCalling?Re("",!0):(de(),ye(u,{key:0,color:"success",onClick:I[13]||(I[13]=D=>l.callClient(k.phone))},{default:w(()=>[R(r,{left:""},{default:w(()=>[L("mdi-phone")]),_:1}),L(" Call Client ")]),_:1})),k.isCalling?(de(),ye(u,{key:1,color:"red",onClick:l.hangupCall},{default:w(()=>[R(r,{left:""},{default:w(()=>[L("mdi-phone-off")]),_:1}),L(" Hangup ")]),_:1},8,["onClick"])):Re("",!0),k.isCalling?(de(),ye(u,{key:2,color:"warning",onClick:l.handleMute},{default:w(()=>[R(r,{left:""},{default:w(()=>[L(ne(z.isMuted?"mdi-microphone-off":"mdi-microphone"),1)]),_:1}),L(" "+ne(z.isMuted?"Unmute":"Mute"),1)]),_:1},8,["onClick"])):Re("",!0),k.isCalling?(de(),ye(u,{key:3,color:"primary",onClick:l.handleHoldToggle},{default:w(()=>[R(r,{left:""},{default:w(()=>[L(ne(z.isOnHold?"mdi-phone-transfer":"mdi-pause"),1)]),_:1}),L(" "+ne(z.isOnHold?"Unhold":"Hold"),1)]),_:1},8,["onClick"])):Re("",!0),k.isCalling?(de(),ye(u,{key:4,color:"blue",onClick:l.openTransferDialog},{default:w(()=>[R(r,{left:""},{default:w(()=>[L("mdi-phone-transfer")]),_:1}),L(" Transfer ")]),_:1},8,["onClick"])):Re("",!0)])]),_:1})]),_:1})]),_:1},8,["modelValue"]),R(x,{modelValue:k.incomingCallDialog,"onUpdate:modelValue":I[16]||(I[16]=D=>k.incomingCallDialog=D),"max-width":"600"},{default:w(()=>[R(e,null,{default:w(()=>[R(f,null,{default:w(()=>[L(" Incoming Call "),R(G),R(u,{icon:"",onClick:I[15]||(I[15]=D=>k.incomingCallDialog=!1)},{default:w(()=>[R(r,null,{default:w(()=>[L("mdi-close")]),_:1})]),_:1})]),_:1}),R(o,null,{default:w(()=>[F("p",null,"Call from: "+ne(k.incomingCall.from),1),F("p",null,"Duration: "+ne(k.incomingCall.duration),1)]),_:1}),R(T,null,{default:w(()=>[R(u,{color:"success",onClick:l.answerCall},{default:w(()=>[L(" Answer ")]),_:1},8,["onClick"]),R(u,{color:"red",onClick:l.hangupCall},{default:w(()=>[L(" Reject ")]),_:1},8,["onClick"]),R(u,{color:"primary",onClick:l.transferCall},{default:w(()=>[L(" Transfer ")]),_:1},8,["onClick"]),k.isCalling?(de(),ye(u,{key:0,color:"warning",onClick:l.handleMute},{default:w(()=>[R(r,{left:""},{default:w(()=>[L(ne(z.isMuted?"mdi-microphone-off":"mdi-microphone"),1)]),_:1}),L(" "+ne(z.isMuted?"Unmute":"Mute"),1)]),_:1},8,["onClick"])):Re("",!0),k.isCalling?(de(),ye(u,{key:1,color:"primary",onClick:l.handleHoldToggle},{default:w(()=>[R(r,{left:""},{default:w(()=>[L(ne(z.isOnHold?"mdi-phone-transfer":"mdi-pause"),1)]),_:1}),L(" "+ne(z.isOnHold?"Unhold":"Hold"),1)]),_:1},8,["onClick"])):Re("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),R(x,{modelValue:k.transferDialog,"onUpdate:modelValue":I[18]||(I[18]=D=>k.transferDialog=D),"max-width":"600"},{default:w(()=>[R(e,null,{default:w(()=>[R(f,null,{default:w(()=>[L(" Transfer Call "),R(G),R(u,{icon:"",onClick:I[17]||(I[17]=D=>k.transferDialog=!1)},{default:w(()=>[R(r,null,{default:w(()=>[L("mdi-close")]),_:1})]),_:1})]),_:1}),R(o,null,{default:w(()=>[R(_,null,{default:w(()=>[(de(!0),Oe(Le,null,Ae(k.agents,D=>(de(),ye(y,{onClick:U=>k.handleTransfer(D),key:D.name,class:"agent-item"},{default:w(()=>[F("div",null,[F("strong",null,ne(D.name),1),F("span",{class:Ge({"text-success":D.status==="available","text-warning":D.status==="engaged","text-grey":D.status==="offline"})}," - "+ne(D.status),3)])]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),R(T)]),_:1})]),_:1},8,["modelValue"]),R(x,{modelValue:k.phonePopup,"onUpdate:modelValue":I[25]||(I[25]=D=>k.phonePopup=D),"max-width":"800"},{default:w(()=>[R(e,null,{default:w(()=>[R(f,null,{default:w(()=>[L(" Client Details "),R(G),R(u,{icon:"",onClick:I[19]||(I[19]=D=>k.phonePopup=!1)},{default:w(()=>[R(r,null,{default:w(()=>[L("mdi-close")]),_:1})]),_:1})]),_:1}),R(o,null,{default:w(()=>{var D,U,Q,P,E;return[F("div",null,[ht,L(" "+ne((D=k.selectedItem)==null?void 0:D.client),1)]),F("div",null,[yt,L(" "+ne((U=k.selectedItem)==null?void 0:U.email),1)]),F("div",null,[Ct,L(" "+ne((Q=k.selectedItem)==null?void 0:Q.phone),1)]),F("div",null,[St,L(" "+ne(((P=k.selectedItem)==null?void 0:P.altPhone)||"N/A"),1)]),F("div",null,[Tt,L(" "+ne(((E=k.selectedItem)==null?void 0:E.location)||"N/A"),1)])]}),_:1}),R(T,null,{default:w(()=>[R(u,{color:"primary",onClick:I[20]||(I[20]=D=>{var U;return l.callClient((U=k.selectedItem)==null?void 0:U.phone)})},{default:w(()=>[R(r,{left:""},{default:w(()=>[L("mdi-phone")]),_:1}),L(" Call Client ")]),_:1}),R(u,{color:"primary",onClick:I[21]||(I[21]=D=>{var U;return k.sendSms((U=k.selectedItem)==null?void 0:U.phone)})},{default:w(()=>[R(r,{left:""},{default:w(()=>[L("mdi-message")]),_:1}),L(" Send SMS ")]),_:1}),R(u,{color:"success",onClick:I[22]||(I[22]=D=>{var U;return k.sendWhatsAppMessage((U=k.selectedItem)==null?void 0:U.phone)})},{default:w(()=>[R(r,{left:""},{default:w(()=>[L("mdi-whatsapp")]),_:1}),L(" Send WhatsApp Message ")]),_:1}),R(u,{color:"primary",onClick:I[23]||(I[23]=D=>{var U;return k.sendEmail((U=k.selectedItem)==null?void 0:U.email)})},{default:w(()=>[R(r,{left:""},{default:w(()=>[L("mdi-email")]),_:1}),L(" Send Email ")]),_:1}),R(u,{color:"info",onClick:I[24]||(I[24]=D=>{var U;return k.sendTelegramMessage((U=k.selectedItem)==null?void 0:U.phone)})},{default:w(()=>[R(r,{left:""},{default:w(()=>[L("mdi-telegram")]),_:1}),L(" Send Telegram Message ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})])]),_:1})}const Pt=Ke(tt,[["render",bt]]);export{Pt as default};

import{A as $}from"./AppLayout-FN8FwcqY.js";import{_ as z}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{i,o as f,c as C,w as l,a as o,b as t,f as s,d as k,g as I,F as T,e as h,t as m,n as R}from"./app-DSLLHZcg.js";const K=[{product:"Phone",status:"Shipped",COD:500,client:"John Doe",phone:"123-456-7890",email:"john@example.com",altPhone:"111-222-3333",location:"Portland, Oregon",orders:[{product:"Tablet",status:"Delivered"},{product:"Laptop",status:"Pending"}]}],G={async fetch({page:e,itemsPerPage:a,sortBy:w,search:S}){return new Promise(D=>{setTimeout(()=>{const u=(e-1)*a,d=u+a,p=K.filter(V=>!0),g=p.slice(u,d);D({items:g,total:p.length})},500)})}},X={components:{AppLayout:$},data:()=>({itemsPerPage:5,tab:"calls",isCalling:!1,queueDialog:!1,transferDialog:!1,callAgentDialog:!1,queuedCalls:[],selectedAgent:null,agents:[{name:"Mark D",status:"available"},{name:"Pippa M",status:"engaged"},{name:"Russ N",status:"engaged"},{name:"Elif T",status:"engaged"}],queuedCalls:[{call_id:1,phone_number:"+254711123456",status:"queued"},{call_id:2,phone_number:"+254712345678",status:"queued"},{call_id:3,phone_number:"+254713456789",status:"queued"},{call_id:4,phone_number:"+254714567890",status:"queued"}],queuedCallsheaders:[{title:"Call ID",value:"call_id"},{title:"Phone Number",value:"phone_number"},{title:"Status",value:"status"},{title:"Actions",value:"actions",sortable:!1}],headers:[{title:"Product",align:"start",key:"product"},{title:"Status",key:"status",align:"start"},{title:"COD",key:"COD",align:"end"},{title:"Client",key:"client",align:"start"},{title:"Phone",key:"phone",align:"start"}],callsheaders:[{title:"Created At",value:"createdAt"},{title:"Caller No.",value:"callerNo"},{title:"Phone",value:"phone"},{title:"Call Session State",value:"callSessionState"},{title:"Duration In Seconds",value:"duration"},{title:"Amount",value:"amount"},{title:"Caller Carrier",value:"callerCarrier"},{title:"Call Status",value:"callStatus"},{title:"Actions",value:"actions",sortable:!1}],calls:[{id:1,createdAt:"2025-01-26 10:00",callerNo:"254712345678",phone:"254723456789",callSessionState:"Completed",duration:120,amount:"KES 30",callerCarrier:"Safaricom",callStatus:"Success"},{id:2,createdAt:"2025-01-26 10:30",callerNo:"254723456789",phone:"254734567890",callSessionState:"Missed",duration:0,amount:"KES 0",callerCarrier:"Airtel",callStatus:"Missed"}],serverItems:[{product:"Phone",status:"Shipped",COD:500,client:"John Doe",phone:"123-456-7890"},{product:"Tablet",status:"Pending",COD:700,client:"Jane Doe",phone:"234-567-8901"}],loading:!1,totalItems:2,statuses:["Pending","Shipped","Delivered","Cancelled"],statusModal:!1,phonePopup:!1,newCall:!1,selectedItem:null,selectedItem:{phone:""}}),methods:{async callClient(e){try{if(console.log("Starting callClient function..."),!window.ATWebRTC){console.error("ATWebRTC object is not defined."),this.$toastr.error("WebRTC client is unavailable.");return}if(console.log("ATWebRTC object detected:",window.ATWebRTC),typeof window.ATWebRTC.call!="function"){console.error("Call method not found on ATWebRTC:",Object.keys(window.ATWebRTC)),this.$toastr.error("Call method is unavailable.");return}console.log("Initiating call to:",e),await window.ATWebRTC.call({callFrom:"+254711082021",callTo:e,clientRequestId:"call_12345"}),console.log("Call initiated successfully."),this.$toastr.success("Call initiated successfully."),this.isCalling=!0}catch(a){console.error("Error initiating call:",a),this.$toastr.error("Error initiating call: "+a.message)}},closeDialog(){this.callAgentDialog=!1},openCallAgent(){this.callAgentDialog=!0},openTransferDialog(){this.transferDialog=!0},handleTransfer(){this.selectedAgent?axios.post("/api/v1/transfer-call",{agentId:this.selectedAgent}).then(e=>{console.log("Call transferred successfully"),this.transferDialog=!1}).catch(e=>{console.error("Error transferring call:",e)}):console.log("No agent selected")},openQueueDialog(){this.fetchQueuedCalls(),this.queueDialog=!0},fetchQueuedCalls(){axios.get("/api/v1/queued-calls").then(e=>{this.queuedCalls=e.data}).catch(e=>{console.error("Error fetching queued calls:",e)})},dequeueCall(e){axios.post("/api/v1/dequeue-call",{callId:e}).then(a=>{console.log("Call dequeued:",a.data),this.fetchQueuedCalls()}).catch(a=>{console.error("Error dequeuing call:",a)})},handleHangup(){this.callId?axios.post("/api/v1/hangup-call",{callId:this.callId}).then(e=>{this.isCalling=!1,console.log("Call ended",e.data)}).catch(e=>{console.error("Error ending the call",e)}):console.log("Call ID not available")},handleHold(){this.callId?axios.post("/api/v1/hold-call",{callId:this.callId}).then(e=>{console.log("Call on hold",e.data)}).catch(e=>{console.error("Error putting the call on hold",e)}):console.log("Call ID not available")},handleTransfer(){this.callId?axios.post("/api/v1/transfer-call",{callId:this.callId,destination:"254700000000"}).then(a=>{console.log("Call transferred",a.data)}).catch(a=>{console.error("Error transferring the call",a)}):console.log("Call ID not available")},loadItems({page:e,itemsPerPage:a,sortBy:w}){this.loading=!0,G.fetch({page:e,itemsPerPage:a,sortBy:w,search:{}}).then(({items:S,total:D})=>{this.serverItems=S,this.totalItems=D,this.loading=!1})},openStatusModal(e){this.selectedItem=e,this.statusModal=!0},updateStatus(e,a){e.status=a,this.statusModal=!1},openPhonePopup(e){this.selectedItem=e,this.phonePopup=!0},handleCall(e){this.selectedAgent=e,this.callAgentDialog=!1,console.log("Calling agent:",e)},formatPhoneNumber(e){if(!e)return"";if(e=e.replace(/\D/g,""),e.startsWith("0"))e="+254"+e.substring(1);else if(e.startsWith("254"))e="+254"+e.substring(3);else return e.startsWith("+254")?e:(this.$toastr.error("Invalid phone number format"),"");return e},watch:{availableAgents(e){this.availableAgents=e.filter(a=>!a.isInCall)}}}},Y={class:"p-4"},Z=o("span",{class:"ml-3"},"Make a new Call",-1),x=o("span",{class:"ml-3"},"Call an agent",-1),ee={class:"d-flex align-center mt-2"},le=o("span",{class:"ml-3"},"Missed Calls",-1),te=o("span",{class:"ml-auto"},"60,400",-1),ae=o("span",{class:"ml-3"},"Check Queue",-1),ne=o("span",{class:"ml-auto"},"...",-1),oe={class:"d-flex align-center"},se=o("span",null,"AM",-1),ue=o("div",null,[o("p",{class:"mb-0"},"John Mwacahro"),o("small",null,"john.boxleo@gmail.com")],-1),ie=o("div",{class:"mt-4"},[o("p",null,[s("Calls connected: "),o("strong",null,"0")]),o("p",null,[s("Calls made: "),o("strong",null,"0")]),o("p",null,[s("Calls rejected: "),o("strong",null,"0")]),o("p",null,[s("Incoming Calls: "),o("strong",null,"0")])],-1),de=["onClick"],re=["onClick"],ce=o("p",null,"Select an agent to call:",-1),fe=o("strong",null,"Name:",-1),me=o("strong",null,"Email:",-1),pe=o("strong",null,"Phone:",-1),ge=o("strong",null,"Alternative Phone:",-1),Ce=o("strong",null,"Location:",-1);function he(e,a,w,S,D,u){const d=i("v-icon"),p=i("v-card-text"),g=i("v-card"),V=i("v-col"),H=i("v-avatar"),U=i("v-chip"),Q=i("v-row"),N=i("v-tab"),j=i("v-tabs"),c=i("v-btn"),P=i("v-data-table"),E=i("v-tab-item"),L=i("v-tabs-items"),_=i("v-card-title"),q=i("v-list-item"),M=i("v-list"),b=i("v-card-actions"),v=i("v-dialog"),A=i("v-spacer"),B=i("v-text-field"),F=i("v-container"),J=i("AppLayout");return f(),C(J,null,{default:l(()=>[o("div",Y,[t(F,null,{default:l(()=>[t(Q,null,{default:l(()=>[t(V,{cols:"12",md:"6"},{default:l(()=>[t(g,null,{default:l(()=>[t(p,null,{default:l(()=>[o("div",{class:"d-flex align-center",onClick:a[0]||(a[0]=n=>e.newCall=!0)},[t(d,{color:"green"},{default:l(()=>[s("mdi-phone")]),_:1}),Z]),o("div",{class:"d-flex align-center mt-2",onClick:a[1]||(a[1]=(...n)=>u.openCallAgent&&u.openCallAgent(...n))},[t(d,{color:"blue"},{default:l(()=>[s("mdi-account")]),_:1}),x]),o("div",ee,[t(d,{color:"red"},{default:l(()=>[s("mdi-phone-missed")]),_:1}),le,te]),o("div",{class:"d-flex align-center mt-2",onClick:a[2]||(a[2]=(...n)=>u.openQueueDialog&&u.openQueueDialog(...n))},[t(d,{color:"orange"},{default:l(()=>[s("mdi-check-decagram")]),_:1}),ae,ne])]),_:1})]),_:1})]),_:1}),t(V,{cols:"12",md:"6"},{default:l(()=>[t(g,null,{default:l(()=>[t(p,null,{default:l(()=>[o("div",oe,[t(H,{class:"mr-3",color:"blue",size:"40"},{default:l(()=>[se]),_:1}),ue,t(U,{class:"ml-auto",color:"green","text-color":"white"},{default:l(()=>[s("Online")]),_:1})]),ie]),_:1})]),_:1})]),_:1})]),_:1}),t(g,null,{default:l(()=>[t(j,{modelValue:e.tab,"onUpdate:modelValue":a[3]||(a[3]=n=>e.tab=n),color:"primary"},{default:l(()=>[t(N,{value:"calls"},{default:l(()=>[s("Calls")]),_:1}),t(N,{value:"orders"},{default:l(()=>[s("Orders")]),_:1})]),_:1},8,["modelValue"]),t(L,{modelValue:e.tab,"onUpdate:modelValue":a[4]||(a[4]=n=>e.tab=n)},{default:l(()=>[t(E,{value:"calls"},{default:l(()=>[t(P,{headers:e.callsheaders,items:e.calls,"item-value":"id",class:"elevation-1 mt-4","items-per-page":10},{"item.actions":l(({item:n})=>[t(c,{icon:"",color:"red"},{default:l(()=>[t(d,null,{default:l(()=>[s("mdi-record-circle")]),_:1})]),_:1})]),_:1},8,["headers","items"])]),_:1}),t(E,{value:"orders"},{default:l(()=>[t(P,{headers:e.headers,items:e.serverItems,loading:e.loading,class:"elevation-1 mt-4"},{body:l(({items:n})=>[(f(!0),k(T,null,I(n,r=>(f(),k("tr",{key:r.product},[o("td",null,m(r.product),1),o("td",null,[o("span",{class:"clickable",onClick:y=>u.openStatusModal(r)},m(r.status),9,de)]),o("td",null,m(r.COD),1),o("td",null,m(r.client),1),o("td",null,[o("span",{class:"clickable",onClick:y=>u.openPhonePopup(r)},m(r.phone),9,re)])]))),128))]),_:1},8,["headers","items","loading"])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(v,{modelValue:e.callAgentDialog,"onUpdate:modelValue":a[5]||(a[5]=n=>e.callAgentDialog=n),"max-width":"400"},{default:l(()=>[t(g,null,{default:l(()=>[t(_,{class:"headline"},{default:l(()=>[s("Call an Agent")]),_:1}),t(p,null,{default:l(()=>[ce,t(M,null,{default:l(()=>[(f(!0),k(T,null,I(e.agents,n=>(f(),C(q,{key:n.name,onClick:r=>u.handleCall(n),class:"agent-item"},{default:l(()=>[o("div",null,[o("strong",null,m(n.name),1),o("span",{class:R({"text-success":n.status==="available","text-warning":n.status==="engaged","text-grey":n.status==="offline"})}," - "+m(n.status),3)])]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),t(b,null,{default:l(()=>[t(c,{color:"blue darken-1",text:"",onClick:u.closeDialog},{default:l(()=>[s("Cancel")]),_:1},8,["onClick"]),e.isCalling?(f(),C(c,{key:0,color:"red",onClick:u.handleHangup},{default:l(()=>[t(d,{left:""},{default:l(()=>[s("mdi-phone-off")]),_:1}),s(" Hangup ")]),_:1},8,["onClick"])):h("",!0),e.isCalling?(f(),C(c,{key:1,color:"grey",onClick:u.handleHold},{default:l(()=>[t(d,{left:""},{default:l(()=>[s("mdi-pause")]),_:1}),s(" Hold ")]),_:1},8,["onClick"])):h("",!0),e.isCalling?(f(),C(c,{key:2,color:"blue",onClick:u.openTransferDialog},{default:l(()=>[t(d,{left:""},{default:l(()=>[s("mdi-phone-transfer")]),_:1}),s(" Transfer ")]),_:1},8,["onClick"])):h("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(v,{modelValue:e.statusModal,"onUpdate:modelValue":a[7]||(a[7]=n=>e.statusModal=n),"max-width":"400"},{default:l(()=>[t(g,null,{default:l(()=>[t(_,null,{default:l(()=>[s("Select Status")]),_:1}),t(p,null,{default:l(()=>[t(M,null,{default:l(()=>[(f(!0),k(T,null,I(e.statuses,n=>(f(),C(q,{key:n,onClick:r=>u.updateStatus(e.selectedItem,n)},{default:l(()=>[s(m(n),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),t(b,null,{default:l(()=>[t(c,{color:"primary",text:"",onClick:a[6]||(a[6]=n=>e.statusModal=!1)},{default:l(()=>[s("Close")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(v,{modelValue:e.queueDialog,"onUpdate:modelValue":a[9]||(a[9]=n=>e.queueDialog=n),"max-width":"600"},{default:l(()=>[t(g,null,{default:l(()=>[t(_,null,{default:l(()=>[s(" Queued Calls "),t(A),t(c,{icon:"",onClick:a[8]||(a[8]=n=>e.queueDialog=!1)},{default:l(()=>[t(d,null,{default:l(()=>[s("mdi-close")]),_:1})]),_:1})]),_:1}),t(p,null,{default:l(()=>[t(P,{headers:e.queuedCallsheaders,items:e.queuedCalls,"item-value":"id",class:"elevation-1"},{"item.actions":l(({item:n})=>[t(c,{color:"green",onClick:r=>u.dequeueCall(n.id)},{default:l(()=>[s(" Dequeue ")]),_:2},1032,["onClick"])]),_:1},8,["headers","items"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(v,{modelValue:e.newCall,"onUpdate:modelValue":a[13]||(a[13]=n=>e.newCall=n),"max-width":"600"},{default:l(()=>[t(g,null,{default:l(()=>[t(_,null,{default:l(()=>[s(" Client Details "),t(A),t(c,{icon:"",onClick:a[10]||(a[10]=n=>e.newCall=!1)},{default:l(()=>[t(d,null,{default:l(()=>[s("mdi-close")]),_:1})]),_:1})]),_:1}),t(p,null,{default:l(()=>[t(B,{modelValue:e.phone,"onUpdate:modelValue":a[11]||(a[11]=n=>e.phone=n),label:"Phone Number",type:"text",required:""},null,8,["modelValue"])]),_:1}),t(b,null,{default:l(()=>[o("div",null,[e.isCalling?h("",!0):(f(),C(c,{key:0,color:"success",onClick:a[12]||(a[12]=n=>u.callClient(e.phone))},{default:l(()=>[t(d,{left:""},{default:l(()=>[s("mdi-phone")]),_:1}),s(" Call Client ")]),_:1})),e.isCalling?(f(),C(c,{key:1,color:"red",onClick:u.handleHangup},{default:l(()=>[t(d,{left:""},{default:l(()=>[s("mdi-phone-off")]),_:1}),s(" Hangup ")]),_:1},8,["onClick"])):h("",!0),e.isCalling?(f(),C(c,{key:2,color:"grey",onClick:u.handleHold},{default:l(()=>[t(d,{left:""},{default:l(()=>[s("mdi-pause")]),_:1}),s(" Hold ")]),_:1},8,["onClick"])):h("",!0),e.isCalling?(f(),C(c,{key:3,color:"blue",onClick:u.openTransferDialog},{default:l(()=>[t(d,{left:""},{default:l(()=>[s("mdi-phone-transfer")]),_:1}),s(" Transfer ")]),_:1},8,["onClick"])):h("",!0)])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(v,{modelValue:e.transferDialog,"onUpdate:modelValue":a[15]||(a[15]=n=>e.transferDialog=n),"max-width":"600"},{default:l(()=>[t(g,null,{default:l(()=>[t(_,null,{default:l(()=>[s(" Transfer Call "),t(A),t(c,{icon:"",onClick:a[14]||(a[14]=n=>e.transferDialog=!1)},{default:l(()=>[t(d,null,{default:l(()=>[s("mdi-close")]),_:1})]),_:1})]),_:1}),t(p,null,{default:l(()=>[t(M,null,{default:l(()=>[(f(!0),k(T,null,I(e.agents,n=>(f(),C(q,{onClick:r=>u.handleTransfer(n),key:n.name,class:"agent-item"},{default:l(()=>[o("div",null,[o("strong",null,m(n.name),1),o("span",{class:R({"text-success":n.status==="available","text-warning":n.status==="engaged","text-grey":n.status==="offline"})}," - "+m(n.status),3)])]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),t(b)]),_:1})]),_:1},8,["modelValue"]),t(v,{modelValue:e.phonePopup,"onUpdate:modelValue":a[18]||(a[18]=n=>e.phonePopup=n),"max-width":"600"},{default:l(()=>[t(g,null,{default:l(()=>[t(_,null,{default:l(()=>[s(" Client Details "),t(A),t(c,{icon:"",onClick:a[16]||(a[16]=n=>e.phonePopup=!1)},{default:l(()=>[t(d,null,{default:l(()=>[s("mdi-close")]),_:1})]),_:1})]),_:1}),t(p,null,{default:l(()=>{var n,r,y,W,O;return[o("div",null,[fe,s(" "+m((n=e.selectedItem)==null?void 0:n.client),1)]),o("div",null,[me,s(" "+m((r=e.selectedItem)==null?void 0:r.email),1)]),o("div",null,[pe,s(" "+m((y=e.selectedItem)==null?void 0:y.phone),1)]),o("div",null,[ge,s(" "+m(((W=e.selectedItem)==null?void 0:W.altPhone)||"N/A"),1)]),o("div",null,[Ce,s(" "+m(((O=e.selectedItem)==null?void 0:O.location)||"N/A"),1)])]}),_:1}),t(b,null,{default:l(()=>[t(c,{color:"primary",onClick:a[17]||(a[17]=n=>{var r;return u.callClient((r=e.selectedItem)==null?void 0:r.phone)})},{default:l(()=>[t(d,{left:""},{default:l(()=>[s("mdi-phone")]),_:1}),s(" Call Client ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})])]),_:1})}const ke=z(X,[["render",he]]);export{ke as default};

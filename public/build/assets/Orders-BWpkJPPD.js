import{A as Tr}from"./AppLayout-DJtW2mHQ.js";import{y as Bt,i as we,o as Ce,c as De,w as x,a as K,b as L,f as G,d as tt,g as st,F as ct,e as je,t as Ae,n as Ht}from"./app-NdoRmzif.js";import{_ as wr}from"./_plugin-vue_export-helper-DlAUqK2U.js";var Jt={exports:{}};(function(M,q){(function(W,$){M.exports=$()})(window,function(){return function(W){var $={};function O(p){if($[p])return $[p].exports;var a=$[p]={i:p,l:!1,exports:{}};return W[p].call(a.exports,a,a.exports,O),a.l=!0,a.exports}return O.m=W,O.c=$,O.d=function(p,a,d){O.o(p,a)||Object.defineProperty(p,a,{enumerable:!0,get:d})},O.r=function(p){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(p,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(p,"__esModule",{value:!0})},O.t=function(p,a){if(1&a&&(p=O(p)),8&a||4&a&&typeof p=="object"&&p&&p.__esModule)return p;var d=Object.create(null);if(O.r(d),Object.defineProperty(d,"default",{enumerable:!0,value:p}),2&a&&typeof p!="string")for(var n in p)O.d(d,n,(function(f){return p[f]}).bind(null,n));return d},O.n=function(p){var a=p&&p.__esModule?function(){return p.default}:function(){return p};return O.d(a,"a",a),a},O.o=function(p,a){return Object.prototype.hasOwnProperty.call(p,a)},O.p="",O(O.s=3)}([function(W,$,O){(function(p){var a=O(6);W.exports=a({window:p.window})}).call(this,O(5))},function(W,$,O){var p=!0,a=!0;function d(n,f,h){var o=n.match(f);return o&&o.length>=h&&parseInt(o[h],10)}W.exports={extractVersion:d,wrapPeerConnectionEvent:function(n,f,h){if(n.RTCPeerConnection){var o=n.RTCPeerConnection.prototype,C=o.addEventListener;o.addEventListener=function(b,c){if(b!==f)return C.apply(this,arguments);var m=function(r){var s=h(r);s&&c(s)};return this._eventMap=this._eventMap||{},this._eventMap[c]=m,C.apply(this,[b,m])};var S=o.removeEventListener;o.removeEventListener=function(b,c){if(b!==f||!this._eventMap||!this._eventMap[c])return S.apply(this,arguments);var m=this._eventMap[c];return delete this._eventMap[c],S.apply(this,[b,m])},Object.defineProperty(o,"on"+f,{get:function(){return this["_on"+f]},set:function(b){this["_on"+f]&&(this.removeEventListener(f,this["_on"+f]),delete this["_on"+f]),b&&this.addEventListener(f,this["_on"+f]=b)},enumerable:!0,configurable:!0})}},disableLog:function(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(p=n,n?"adapter.js logging disabled":"adapter.js logging enabled")},disableWarnings:function(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(a=!n,"adapter.js deprecation warnings "+(n?"disabled":"enabled"))},log:function(){if(typeof window=="object"){if(p)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}},deprecated:function(n,f){a&&console.warn(n+" is deprecated, please use "+f+" instead.")},detectBrowser:function(n){var f=n&&n.navigator,h={browser:null,version:null};if(n===void 0||!n.navigator)return h.browser="Not a browser.",h;if(f.mozGetUserMedia)h.browser="firefox",h.version=d(f.userAgent,/Firefox\/(\d+)\./,1);else if(f.webkitGetUserMedia)h.browser="chrome",h.version=d(f.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(f.mediaDevices&&f.userAgent.match(/Edge\/(\d+).(\d+)$/))h.browser="edge",h.version=d(f.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!n.RTCPeerConnection||!f.userAgent.match(/AppleWebKit\/(\d+)\./))return h.browser="Not a supported browser.",h;h.browser="safari",h.version=d(f.userAgent,/AppleWebKit\/(\d+)\./,1)}return h}}},function(W,$,O){var p={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};p.localCName=p.generateIdentifier(),p.splitLines=function(a){return a.trim().split(`
`).map(function(d){return d.trim()})},p.splitSections=function(a){return a.split(`
m=`).map(function(d,n){return(n>0?"m="+d:d).trim()+`\r
`})},p.getDescription=function(a){var d=p.splitSections(a);return d&&d[0]},p.getMediaSections=function(a){var d=p.splitSections(a);return d.shift(),d},p.matchPrefix=function(a,d){return p.splitLines(a).filter(function(n){return n.indexOf(d)===0})},p.parseCandidate=function(a){for(var d,n={foundation:(d=a.indexOf("a=candidate:")===0?a.substring(12).split(" "):a.substring(10).split(" "))[0],component:parseInt(d[1],10),protocol:d[2].toLowerCase(),priority:parseInt(d[3],10),ip:d[4],address:d[4],port:parseInt(d[5],10),type:d[7]},f=8;f<d.length;f+=2)switch(d[f]){case"raddr":n.relatedAddress=d[f+1];break;case"rport":n.relatedPort=parseInt(d[f+1],10);break;case"tcptype":n.tcpType=d[f+1];break;case"ufrag":n.ufrag=d[f+1],n.usernameFragment=d[f+1];break;default:n[d[f]]=d[f+1]}return n},p.writeCandidate=function(a){var d=[];d.push(a.foundation),d.push(a.component),d.push(a.protocol.toUpperCase()),d.push(a.priority),d.push(a.address||a.ip),d.push(a.port);var n=a.type;return d.push("typ"),d.push(n),n!=="host"&&a.relatedAddress&&a.relatedPort&&(d.push("raddr"),d.push(a.relatedAddress),d.push("rport"),d.push(a.relatedPort)),a.tcpType&&a.protocol.toLowerCase()==="tcp"&&(d.push("tcptype"),d.push(a.tcpType)),(a.usernameFragment||a.ufrag)&&(d.push("ufrag"),d.push(a.usernameFragment||a.ufrag)),"candidate:"+d.join(" ")},p.parseIceOptions=function(a){return a.substr(14).split(" ")},p.parseRtpMap=function(a){var d=a.substr(9).split(" "),n={payloadType:parseInt(d.shift(),10)};return d=d[0].split("/"),n.name=d[0],n.clockRate=parseInt(d[1],10),n.channels=d.length===3?parseInt(d[2],10):1,n.numChannels=n.channels,n},p.writeRtpMap=function(a){var d=a.payloadType;a.preferredPayloadType!==void 0&&(d=a.preferredPayloadType);var n=a.channels||a.numChannels||1;return"a=rtpmap:"+d+" "+a.name+"/"+a.clockRate+(n!==1?"/"+n:"")+`\r
`},p.parseExtmap=function(a){var d=a.substr(9).split(" ");return{id:parseInt(d[0],10),direction:d[0].indexOf("/")>0?d[0].split("/")[1]:"sendrecv",uri:d[1]}},p.writeExtmap=function(a){return"a=extmap:"+(a.id||a.preferredId)+(a.direction&&a.direction!=="sendrecv"?"/"+a.direction:"")+" "+a.uri+`\r
`},p.parseFmtp=function(a){for(var d,n={},f=a.substr(a.indexOf(" ")+1).split(";"),h=0;h<f.length;h++)n[(d=f[h].trim().split("="))[0].trim()]=d[1];return n},p.writeFmtp=function(a){var d="",n=a.payloadType;if(a.preferredPayloadType!==void 0&&(n=a.preferredPayloadType),a.parameters&&Object.keys(a.parameters).length){var f=[];Object.keys(a.parameters).forEach(function(h){a.parameters[h]?f.push(h+"="+a.parameters[h]):f.push(h)}),d+="a=fmtp:"+n+" "+f.join(";")+`\r
`}return d},p.parseRtcpFb=function(a){var d=a.substr(a.indexOf(" ")+1).split(" ");return{type:d.shift(),parameter:d.join(" ")}},p.writeRtcpFb=function(a){var d="",n=a.payloadType;return a.preferredPayloadType!==void 0&&(n=a.preferredPayloadType),a.rtcpFeedback&&a.rtcpFeedback.length&&a.rtcpFeedback.forEach(function(f){d+="a=rtcp-fb:"+n+" "+f.type+(f.parameter&&f.parameter.length?" "+f.parameter:"")+`\r
`}),d},p.parseSsrcMedia=function(a){var d=a.indexOf(" "),n={ssrc:parseInt(a.substr(7,d-7),10)},f=a.indexOf(":",d);return f>-1?(n.attribute=a.substr(d+1,f-d-1),n.value=a.substr(f+1)):n.attribute=a.substr(d+1),n},p.parseSsrcGroup=function(a){var d=a.substr(13).split(" ");return{semantics:d.shift(),ssrcs:d.map(function(n){return parseInt(n,10)})}},p.getMid=function(a){var d=p.matchPrefix(a,"a=mid:")[0];if(d)return d.substr(6)},p.parseFingerprint=function(a){var d=a.substr(14).split(" ");return{algorithm:d[0].toLowerCase(),value:d[1]}},p.getDtlsParameters=function(a,d){return{role:"auto",fingerprints:p.matchPrefix(a+d,"a=fingerprint:").map(p.parseFingerprint)}},p.writeDtlsParameters=function(a,d){var n="a=setup:"+d+`\r
`;return a.fingerprints.forEach(function(f){n+="a=fingerprint:"+f.algorithm+" "+f.value+`\r
`}),n},p.getIceParameters=function(a,d){var n=p.splitLines(a);return{usernameFragment:(n=n.concat(p.splitLines(d))).filter(function(f){return f.indexOf("a=ice-ufrag:")===0})[0].substr(12),password:n.filter(function(f){return f.indexOf("a=ice-pwd:")===0})[0].substr(10)}},p.writeIceParameters=function(a){return"a=ice-ufrag:"+a.usernameFragment+`\r
a=ice-pwd:`+a.password+`\r
`},p.parseRtpParameters=function(a){for(var d={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=p.splitLines(a)[0].split(" "),f=3;f<n.length;f++){var h=n[f],o=p.matchPrefix(a,"a=rtpmap:"+h+" ")[0];if(o){var C=p.parseRtpMap(o),S=p.matchPrefix(a,"a=fmtp:"+h+" ");switch(C.parameters=S.length?p.parseFmtp(S[0]):{},C.rtcpFeedback=p.matchPrefix(a,"a=rtcp-fb:"+h+" ").map(p.parseRtcpFb),d.codecs.push(C),C.name.toUpperCase()){case"RED":case"ULPFEC":d.fecMechanisms.push(C.name.toUpperCase())}}}return p.matchPrefix(a,"a=extmap:").forEach(function(b){d.headerExtensions.push(p.parseExtmap(b))}),d},p.writeRtpDescription=function(a,d){var n="";n+="m="+a+" ",n+=d.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=d.codecs.map(function(h){return h.preferredPayloadType!==void 0?h.preferredPayloadType:h.payloadType}).join(" ")+`\r
`,n+=`c=IN IP4 0.0.0.0\r
`,n+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,d.codecs.forEach(function(h){n+=p.writeRtpMap(h),n+=p.writeFmtp(h),n+=p.writeRtcpFb(h)});var f=0;return d.codecs.forEach(function(h){h.maxptime>f&&(f=h.maxptime)}),f>0&&(n+="a=maxptime:"+f+`\r
`),n+=`a=rtcp-mux\r
`,d.headerExtensions&&d.headerExtensions.forEach(function(h){n+=p.writeExtmap(h)}),n},p.parseRtpEncodingParameters=function(a){var d,n=[],f=p.parseRtpParameters(a),h=f.fecMechanisms.indexOf("RED")!==-1,o=f.fecMechanisms.indexOf("ULPFEC")!==-1,C=p.matchPrefix(a,"a=ssrc:").map(function(m){return p.parseSsrcMedia(m)}).filter(function(m){return m.attribute==="cname"}),S=C.length>0&&C[0].ssrc,b=p.matchPrefix(a,"a=ssrc-group:FID").map(function(m){return m.substr(17).split(" ").map(function(r){return parseInt(r,10)})});b.length>0&&b[0].length>1&&b[0][0]===S&&(d=b[0][1]),f.codecs.forEach(function(m){if(m.name.toUpperCase()==="RTX"&&m.parameters.apt){var r={ssrc:S,codecPayloadType:parseInt(m.parameters.apt,10)};S&&d&&(r.rtx={ssrc:d}),n.push(r),h&&((r=JSON.parse(JSON.stringify(r))).fec={ssrc:S,mechanism:o?"red+ulpfec":"red"},n.push(r))}}),n.length===0&&S&&n.push({ssrc:S});var c=p.matchPrefix(a,"b=");return c.length&&(c=c[0].indexOf("b=TIAS:")===0?parseInt(c[0].substr(7),10):c[0].indexOf("b=AS:")===0?1e3*parseInt(c[0].substr(5),10)*.95-16e3:void 0,n.forEach(function(m){m.maxBitrate=c})),n},p.parseRtcpParameters=function(a){var d={},n=p.matchPrefix(a,"a=ssrc:").map(function(o){return p.parseSsrcMedia(o)}).filter(function(o){return o.attribute==="cname"})[0];n&&(d.cname=n.value,d.ssrc=n.ssrc);var f=p.matchPrefix(a,"a=rtcp-rsize");d.reducedSize=f.length>0,d.compound=f.length===0;var h=p.matchPrefix(a,"a=rtcp-mux");return d.mux=h.length>0,d},p.parseMsid=function(a){var d,n=p.matchPrefix(a,"a=msid:");if(n.length===1)return{stream:(d=n[0].substr(7).split(" "))[0],track:d[1]};var f=p.matchPrefix(a,"a=ssrc:").map(function(h){return p.parseSsrcMedia(h)}).filter(function(h){return h.attribute==="msid"});return f.length>0?{stream:(d=f[0].value.split(" "))[0],track:d[1]}:void 0},p.generateSessionId=function(){return Math.random().toString().substr(2,21)},p.writeSessionBoilerplate=function(a,d,n){var f=d!==void 0?d:2;return`v=0\r
o=`+(n||"thisisadapterortc")+" "+(a||p.generateSessionId())+" "+f+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},p.writeMediaSection=function(a,d,n,f){var h=p.writeRtpDescription(a.kind,d);if(h+=p.writeIceParameters(a.iceGatherer.getLocalParameters()),h+=p.writeDtlsParameters(a.dtlsTransport.getLocalParameters(),n==="offer"?"actpass":"active"),h+="a=mid:"+a.mid+`\r
`,a.direction?h+="a="+a.direction+`\r
`:a.rtpSender&&a.rtpReceiver?h+=`a=sendrecv\r
`:a.rtpSender?h+=`a=sendonly\r
`:a.rtpReceiver?h+=`a=recvonly\r
`:h+=`a=inactive\r
`,a.rtpSender){var o="msid:"+f.id+" "+a.rtpSender.track.id+`\r
`;h+="a="+o,h+="a=ssrc:"+a.sendEncodingParameters[0].ssrc+" "+o,a.sendEncodingParameters[0].rtx&&(h+="a=ssrc:"+a.sendEncodingParameters[0].rtx.ssrc+" "+o,h+="a=ssrc-group:FID "+a.sendEncodingParameters[0].ssrc+" "+a.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return h+="a=ssrc:"+a.sendEncodingParameters[0].ssrc+" cname:"+p.localCName+`\r
`,a.rtpSender&&a.sendEncodingParameters[0].rtx&&(h+="a=ssrc:"+a.sendEncodingParameters[0].rtx.ssrc+" cname:"+p.localCName+`\r
`),h},p.getDirection=function(a,d){for(var n=p.splitLines(a),f=0;f<n.length;f++)switch(n[f]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[f].substr(2)}return d?p.getDirection(d):"sendrecv"},p.getKind=function(a){return p.splitLines(a)[0].split(" ")[0].substr(2)},p.isRejected=function(a){return a.split(" ",2)[1]==="0"},p.parseMLine=function(a){var d=p.splitLines(a)[0].substr(2).split(" ");return{kind:d[0],port:parseInt(d[1],10),protocol:d[2],fmt:d.slice(3).join(" ")}},p.parseOLine=function(a){var d=p.matchPrefix(a,"o=")[0].substr(2).split(" ");return{username:d[0],sessionId:d[1],sessionVersion:parseInt(d[2],10),netType:d[3],addressType:d[4],address:d[5]}},p.isValidSDP=function(a){if(typeof a!="string"||a.length===0)return!1;for(var d=p.splitLines(a),n=0;n<d.length;n++)if(d[n].length<2||d[n].charAt(1)!=="=")return!1;return!0},W.exports=p},function(W,$,O){O(4),W.exports=O(17)},function(W,$,O){var p=function(a){var d=Object.prototype,n=d.hasOwnProperty,f=typeof Symbol=="function"?Symbol:{},h=f.iterator||"@@iterator",o=f.asyncIterator||"@@asyncIterator",C=f.toStringTag||"@@toStringTag";function S(A,I,J,ie){var j=I&&I.prototype instanceof m?I:m,me=Object.create(j.prototype),Ee=new U(ie||[]);return me._invoke=function(Te,ke,X){var Z="suspendedStart";return function(de,pe){if(Z==="executing")throw new Error("Generator is already running");if(Z==="completed"){if(de==="throw")throw pe;return se()}for(X.method=de,X.arg=pe;;){var Ie=X.delegate;if(Ie){var be=B(Ie,X);if(be){if(be===c)continue;return be}}if(X.method==="next")X.sent=X._sent=X.arg;else if(X.method==="throw"){if(Z==="suspendedStart")throw Z="completed",X.arg;X.dispatchException(X.arg)}else X.method==="return"&&X.abrupt("return",X.arg);Z="executing";var _e=b(Te,ke,X);if(_e.type==="normal"){if(Z=X.done?"completed":"suspendedYield",_e.arg===c)continue;return{value:_e.arg,done:X.done}}_e.type==="throw"&&(Z="completed",X.method="throw",X.arg=_e.arg)}}}(A,J,Ee),me}function b(A,I,J){try{return{type:"normal",arg:A.call(I,J)}}catch(ie){return{type:"throw",arg:ie}}}a.wrap=S;var c={};function m(){}function r(){}function s(){}var l={};l[h]=function(){return this};var g=Object.getPrototypeOf,T=g&&g(g(Q([])));T&&T!==d&&n.call(T,h)&&(l=T);var D=s.prototype=m.prototype=Object.create(l);function P(A){["next","throw","return"].forEach(function(I){A[I]=function(J){return this._invoke(I,J)}})}function N(A,I){var J;this._invoke=function(ie,j){function me(){return new I(function(Ee,Te){(function ke(X,Z,de,pe){var Ie=b(A[X],A,Z);if(Ie.type!=="throw"){var be=Ie.arg,_e=be.value;return _e&&typeof _e=="object"&&n.call(_e,"__await")?I.resolve(_e.__await).then(function(Le){ke("next",Le,de,pe)},function(Le){ke("throw",Le,de,pe)}):I.resolve(_e).then(function(Le){be.value=Le,de(be)},function(Le){return ke("throw",Le,de,pe)})}pe(Ie.arg)})(ie,j,Ee,Te)})}return J=J?J.then(me,me):me()}}function B(A,I){var J=A.iterator[I.method];if(J===void 0){if(I.delegate=null,I.method==="throw"){if(A.iterator.return&&(I.method="return",I.arg=void 0,B(A,I),I.method==="throw"))return c;I.method="throw",I.arg=new TypeError("The iterator does not provide a 'throw' method")}return c}var ie=b(J,A.iterator,I.arg);if(ie.type==="throw")return I.method="throw",I.arg=ie.arg,I.delegate=null,c;var j=ie.arg;return j?j.done?(I[A.resultName]=j.value,I.next=A.nextLoc,I.method!=="return"&&(I.method="next",I.arg=void 0),I.delegate=null,c):j:(I.method="throw",I.arg=new TypeError("iterator result is not an object"),I.delegate=null,c)}function z(A){var I={tryLoc:A[0]};1 in A&&(I.catchLoc=A[1]),2 in A&&(I.finallyLoc=A[2],I.afterLoc=A[3]),this.tryEntries.push(I)}function H(A){var I=A.completion||{};I.type="normal",delete I.arg,A.completion=I}function U(A){this.tryEntries=[{tryLoc:"root"}],A.forEach(z,this),this.reset(!0)}function Q(A){if(A){var I=A[h];if(I)return I.call(A);if(typeof A.next=="function")return A;if(!isNaN(A.length)){var J=-1,ie=function j(){for(;++J<A.length;)if(n.call(A,J))return j.value=A[J],j.done=!1,j;return j.value=void 0,j.done=!0,j};return ie.next=ie}}return{next:se}}function se(){return{value:void 0,done:!0}}return r.prototype=D.constructor=s,s.constructor=r,s[C]=r.displayName="GeneratorFunction",a.isGeneratorFunction=function(A){var I=typeof A=="function"&&A.constructor;return!!I&&(I===r||(I.displayName||I.name)==="GeneratorFunction")},a.mark=function(A){return Object.setPrototypeOf?Object.setPrototypeOf(A,s):(A.__proto__=s,C in A||(A[C]="GeneratorFunction")),A.prototype=Object.create(D),A},a.awrap=function(A){return{__await:A}},P(N.prototype),N.prototype[o]=function(){return this},a.AsyncIterator=N,a.async=function(A,I,J,ie,j){j===void 0&&(j=Promise);var me=new N(S(A,I,J,ie),j);return a.isGeneratorFunction(I)?me:me.next().then(function(Ee){return Ee.done?Ee.value:me.next()})},P(D),D[C]="Generator",D[h]=function(){return this},D.toString=function(){return"[object Generator]"},a.keys=function(A){var I=[];for(var J in A)I.push(J);return I.reverse(),function ie(){for(;I.length;){var j=I.pop();if(j in A)return ie.value=j,ie.done=!1,ie}return ie.done=!0,ie}},a.values=Q,U.prototype={constructor:U,reset:function(A){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(H),!A)for(var I in this)I.charAt(0)==="t"&&n.call(this,I)&&!isNaN(+I.slice(1))&&(this[I]=void 0)},stop:function(){this.done=!0;var A=this.tryEntries[0].completion;if(A.type==="throw")throw A.arg;return this.rval},dispatchException:function(A){if(this.done)throw A;var I=this;function J(ke,X){return me.type="throw",me.arg=A,I.next=ke,X&&(I.method="next",I.arg=void 0),!!X}for(var ie=this.tryEntries.length-1;ie>=0;--ie){var j=this.tryEntries[ie],me=j.completion;if(j.tryLoc==="root")return J("end");if(j.tryLoc<=this.prev){var Ee=n.call(j,"catchLoc"),Te=n.call(j,"finallyLoc");if(Ee&&Te){if(this.prev<j.catchLoc)return J(j.catchLoc,!0);if(this.prev<j.finallyLoc)return J(j.finallyLoc)}else if(Ee){if(this.prev<j.catchLoc)return J(j.catchLoc,!0)}else{if(!Te)throw new Error("try statement without catch or finally");if(this.prev<j.finallyLoc)return J(j.finallyLoc)}}}},abrupt:function(A,I){for(var J=this.tryEntries.length-1;J>=0;--J){var ie=this.tryEntries[J];if(ie.tryLoc<=this.prev&&n.call(ie,"finallyLoc")&&this.prev<ie.finallyLoc){var j=ie;break}}j&&(A==="break"||A==="continue")&&j.tryLoc<=I&&I<=j.finallyLoc&&(j=null);var me=j?j.completion:{};return me.type=A,me.arg=I,j?(this.method="next",this.next=j.finallyLoc,c):this.complete(me)},complete:function(A,I){if(A.type==="throw")throw A.arg;return A.type==="break"||A.type==="continue"?this.next=A.arg:A.type==="return"?(this.rval=this.arg=A.arg,this.method="return",this.next="end"):A.type==="normal"&&I&&(this.next=I),c},finish:function(A){for(var I=this.tryEntries.length-1;I>=0;--I){var J=this.tryEntries[I];if(J.finallyLoc===A)return this.complete(J.completion,J.afterLoc),H(J),c}},catch:function(A){for(var I=this.tryEntries.length-1;I>=0;--I){var J=this.tryEntries[I];if(J.tryLoc===A){var ie=J.completion;if(ie.type==="throw"){var j=ie.arg;H(J)}return j}}throw new Error("illegal catch attempt")},delegateYield:function(A,I,J){return this.delegate={iterator:Q(A),resultName:I,nextLoc:J},this.method==="next"&&(this.arg=void 0),c}},a}(W.exports);try{regeneratorRuntime=p}catch{Function("r","regeneratorRuntime = r")(p)}},function(W,$){var O;O=function(){return this}();try{O=O||new Function("return this")()}catch{typeof window=="object"&&(O=window)}W.exports=O},function(W,$,O){var p=O(1);W.exports=function(a,d){var n=a&&a.window,f={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0};for(var h in d)hasOwnProperty.call(d,h)&&(f[h]=d[h]);var o=p.log,C=p.detectBrowser(n),S=O(7)||null,b=O(9)||null,c=O(13)||null,m=O(15)||null,r=O(16)||null,s={browserDetails:C,commonShim:r,extractVersion:p.extractVersion,disableLog:p.disableLog,disableWarnings:p.disableWarnings};switch(C.browser){case"chrome":if(!S||!S.shimPeerConnection||!f.shimChrome)return o("Chrome shim is not included in this adapter release."),s;o("adapter.js shimming chrome."),s.browserShim=S,r.shimCreateObjectURL(n),S.shimGetUserMedia(n),S.shimMediaStream(n),S.shimSourceObject(n),S.shimPeerConnection(n),S.shimOnTrack(n),S.shimAddTrackRemoveTrack(n),S.shimGetSendersWithDtmf(n),S.shimSenderReceiverGetStats(n),S.fixNegotiationNeeded(n),r.shimRTCIceCandidate(n),r.shimMaxMessageSize(n),r.shimSendThrowTypeError(n);break;case"firefox":if(!c||!c.shimPeerConnection||!f.shimFirefox)return o("Firefox shim is not included in this adapter release."),s;o("adapter.js shimming firefox."),s.browserShim=c,r.shimCreateObjectURL(n),c.shimGetUserMedia(n),c.shimSourceObject(n),c.shimPeerConnection(n),c.shimOnTrack(n),c.shimRemoveStream(n),c.shimSenderGetStats(n),c.shimReceiverGetStats(n),c.shimRTCDataChannel(n),r.shimRTCIceCandidate(n),r.shimMaxMessageSize(n),r.shimSendThrowTypeError(n);break;case"edge":if(!b||!b.shimPeerConnection||!f.shimEdge)return o("MS edge shim is not included in this adapter release."),s;o("adapter.js shimming edge."),s.browserShim=b,r.shimCreateObjectURL(n),b.shimGetUserMedia(n),b.shimPeerConnection(n),b.shimReplaceTrack(n),b.shimGetDisplayMedia(n),r.shimMaxMessageSize(n),r.shimSendThrowTypeError(n);break;case"safari":if(!m||!f.shimSafari)return o("Safari shim is not included in this adapter release."),s;o("adapter.js shimming safari."),s.browserShim=m,r.shimCreateObjectURL(n),m.shimRTCIceServerUrls(n),m.shimCreateOfferLegacy(n),m.shimCallbacksAPI(n),m.shimLocalStreamsAPI(n),m.shimRemoteStreamsAPI(n),m.shimTrackEventTransceiver(n),m.shimGetUserMedia(n),r.shimRTCIceCandidate(n),r.shimMaxMessageSize(n),r.shimSendThrowTypeError(n);break;default:o("Unsupported browser!")}return s}},function(W,$,O){var p=O(1),a=p.log;function d(n,f,h){var o=h?"outbound-rtp":"inbound-rtp",C=new Map;if(f===null)return C;var S=[];return n.forEach(function(b){b.type==="track"&&b.trackIdentifier===f.id&&S.push(b)}),S.forEach(function(b){n.forEach(function(c){c.type===o&&c.trackId===b.id&&function m(r,s,l){s&&!l.has(s.id)&&(l.set(s.id,s),Object.keys(s).forEach(function(g){g.endsWith("Id")?m(r,r.get(s[g]),l):g.endsWith("Ids")&&s[g].forEach(function(T){m(r,r.get(T),l)})}))}(n,c,C)})}),C}W.exports={shimGetUserMedia:O(8),shimMediaStream:function(n){n.MediaStream=n.MediaStream||n.webkitMediaStream},shimOnTrack:function(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("ontrack"in n.RTCPeerConnection.prototype)){Object.defineProperty(n.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(h){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=h)},enumerable:!0,configurable:!0});var f=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){var h=this;return h._ontrackpoly||(h._ontrackpoly=function(o){o.stream.addEventListener("addtrack",function(C){var S;S=n.RTCPeerConnection.prototype.getReceivers?h.getReceivers().find(function(c){return c.track&&c.track.id===C.track.id}):{track:C.track};var b=new Event("track");b.track=C.track,b.receiver=S,b.transceiver={receiver:S},b.streams=[o.stream],h.dispatchEvent(b)}),o.stream.getTracks().forEach(function(C){var S;S=n.RTCPeerConnection.prototype.getReceivers?h.getReceivers().find(function(c){return c.track&&c.track.id===C.id}):{track:C};var b=new Event("track");b.track=C,b.receiver=S,b.transceiver={receiver:S},b.streams=[o.stream],h.dispatchEvent(b)})},h.addEventListener("addstream",h._ontrackpoly)),f.apply(h,arguments)}}else p.wrapPeerConnectionEvent(n,"track",function(h){return h.transceiver||Object.defineProperty(h,"transceiver",{value:{receiver:h.receiver}}),h})},shimGetSendersWithDtmf:function(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("getSenders"in n.RTCPeerConnection.prototype)&&"createDTMFSender"in n.RTCPeerConnection.prototype){var f=function(c,m){return{track:m,get dtmf(){return this._dtmf===void 0&&(m.kind==="audio"?this._dtmf=c.createDTMFSender(m):this._dtmf=null),this._dtmf},_pc:c}};if(!n.RTCPeerConnection.prototype.getSenders){n.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var h=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(c,m){var r=this,s=h.apply(r,arguments);return s||(s=f(r,c),r._senders.push(s)),s};var o=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(c){var m=this;o.apply(m,arguments);var r=m._senders.indexOf(c);r!==-1&&m._senders.splice(r,1)}}var C=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(c){var m=this;m._senders=m._senders||[],C.apply(m,[c]),c.getTracks().forEach(function(r){m._senders.push(f(m,r))})};var S=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(c){var m=this;m._senders=m._senders||[],S.apply(m,[c]),c.getTracks().forEach(function(r){var s=m._senders.find(function(l){return l.track===r});s&&m._senders.splice(m._senders.indexOf(s),1)})}}else if(typeof n=="object"&&n.RTCPeerConnection&&"getSenders"in n.RTCPeerConnection.prototype&&"createDTMFSender"in n.RTCPeerConnection.prototype&&n.RTCRtpSender&&!("dtmf"in n.RTCRtpSender.prototype)){var b=n.RTCPeerConnection.prototype.getSenders;n.RTCPeerConnection.prototype.getSenders=function(){var c=this,m=b.apply(c,[]);return m.forEach(function(r){r._pc=c}),m},Object.defineProperty(n.RTCRtpSender.prototype,"dtmf",{get:function(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},shimSenderReceiverGetStats:function(n){if(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender&&n.RTCRtpReceiver){if(!("getStats"in n.RTCRtpSender.prototype)){var f=n.RTCPeerConnection.prototype.getSenders;f&&(n.RTCPeerConnection.prototype.getSenders=function(){var S=this,b=f.apply(S,[]);return b.forEach(function(c){c._pc=S}),b});var h=n.RTCPeerConnection.prototype.addTrack;h&&(n.RTCPeerConnection.prototype.addTrack=function(){var S=h.apply(this,arguments);return S._pc=this,S}),n.RTCRtpSender.prototype.getStats=function(){var S=this;return this._pc.getStats().then(function(b){return d(b,S.track,!0)})}}if(!("getStats"in n.RTCRtpReceiver.prototype)){var o=n.RTCPeerConnection.prototype.getReceivers;o&&(n.RTCPeerConnection.prototype.getReceivers=function(){var S=this,b=o.apply(S,[]);return b.forEach(function(c){c._pc=S}),b}),p.wrapPeerConnectionEvent(n,"track",function(S){return S.receiver._pc=S.srcElement,S}),n.RTCRtpReceiver.prototype.getStats=function(){var S=this;return this._pc.getStats().then(function(b){return d(b,S.track,!1)})}}if("getStats"in n.RTCRtpSender.prototype&&"getStats"in n.RTCRtpReceiver.prototype){var C=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){var S=this;if(arguments.length>0&&arguments[0]instanceof n.MediaStreamTrack){var b,c,m,r=arguments[0];return S.getSenders().forEach(function(s){s.track===r&&(b?m=!0:b=s)}),S.getReceivers().forEach(function(s){return s.track===r&&(c?m=!0:c=s),s.track===r}),m||b&&c?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):b?b.getStats():c?c.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return C.apply(S,arguments)}}}},shimSourceObject:function(n){var f=n&&n.URL;typeof n=="object"&&n.HTMLMediaElement&&!("srcObject"in n.HTMLMediaElement.prototype)&&Object.defineProperty(n.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(h){var o=this;this._srcObject=h,this.src&&f.revokeObjectURL(this.src),h?(this.src=f.createObjectURL(h),h.addEventListener("addtrack",function(){o.src&&f.revokeObjectURL(o.src),o.src=f.createObjectURL(h)}),h.addEventListener("removetrack",function(){o.src&&f.revokeObjectURL(o.src),o.src=f.createObjectURL(h)})):this.src=""}})},shimAddTrackRemoveTrackWithNative:function(n){n.RTCPeerConnection.prototype.getLocalStreams=function(){var S=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(b){return S._shimmedLocalStreams[b][0]})};var f=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(S,b){if(!b)return f.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var c=f.apply(this,arguments);return this._shimmedLocalStreams[b.id]?this._shimmedLocalStreams[b.id].indexOf(c)===-1&&this._shimmedLocalStreams[b.id].push(c):this._shimmedLocalStreams[b.id]=[b,c],c};var h=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(S){var b=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},S.getTracks().forEach(function(r){if(b.getSenders().find(function(s){return s.track===r}))throw new DOMException("Track already exists.","InvalidAccessError")});var c=b.getSenders();h.apply(this,arguments);var m=b.getSenders().filter(function(r){return c.indexOf(r)===-1});this._shimmedLocalStreams[S.id]=[S].concat(m)};var o=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(S){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[S.id],o.apply(this,arguments)};var C=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(S){var b=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},S&&Object.keys(this._shimmedLocalStreams).forEach(function(c){var m=b._shimmedLocalStreams[c].indexOf(S);m!==-1&&b._shimmedLocalStreams[c].splice(m,1),b._shimmedLocalStreams[c].length===1&&delete b._shimmedLocalStreams[c]}),C.apply(this,arguments)}},shimAddTrackRemoveTrack:function(n){if(n.RTCPeerConnection){var f=p.detectBrowser(n);if(n.RTCPeerConnection.prototype.addTrack&&f.version>=65)return this.shimAddTrackRemoveTrackWithNative(n);var h=n.RTCPeerConnection.prototype.getLocalStreams;n.RTCPeerConnection.prototype.getLocalStreams=function(){var r=this,s=h.apply(this);return r._reverseStreams=r._reverseStreams||{},s.map(function(l){return r._reverseStreams[l.id]})};var o=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(r){var s=this;if(s._streams=s._streams||{},s._reverseStreams=s._reverseStreams||{},r.getTracks().forEach(function(g){if(s.getSenders().find(function(T){return T.track===g}))throw new DOMException("Track already exists.","InvalidAccessError")}),!s._reverseStreams[r.id]){var l=new n.MediaStream(r.getTracks());s._streams[r.id]=l,s._reverseStreams[l.id]=r,r=l}o.apply(s,[r])};var C=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(r){var s=this;s._streams=s._streams||{},s._reverseStreams=s._reverseStreams||{},C.apply(s,[s._streams[r.id]||r]),delete s._reverseStreams[s._streams[r.id]?s._streams[r.id].id:r.id],delete s._streams[r.id]},n.RTCPeerConnection.prototype.addTrack=function(r,s){var l=this;if(l.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var g=[].slice.call(arguments,1);if(g.length!==1||!g[0].getTracks().find(function(N){return N===r}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");var T=l.getSenders().find(function(N){return N.track===r});if(T)throw new DOMException("Track already exists.","InvalidAccessError");l._streams=l._streams||{},l._reverseStreams=l._reverseStreams||{};var D=l._streams[s.id];if(D)D.addTrack(r),Promise.resolve().then(function(){l.dispatchEvent(new Event("negotiationneeded"))});else{var P=new n.MediaStream([r]);l._streams[s.id]=P,l._reverseStreams[P.id]=s,l.addStream(P)}return l.getSenders().find(function(N){return N.track===r})},["createOffer","createAnswer"].forEach(function(r){var s=n.RTCPeerConnection.prototype[r];n.RTCPeerConnection.prototype[r]=function(){var l=this,g=arguments,T=arguments.length&&typeof arguments[0]=="function";return T?s.apply(l,[function(D){var P=c(l,D);g[0].apply(null,[P])},function(D){g[1]&&g[1].apply(null,D)},arguments[2]]):s.apply(l,arguments).then(function(D){return c(l,D)})}});var S=n.RTCPeerConnection.prototype.setLocalDescription;n.RTCPeerConnection.prototype.setLocalDescription=function(){var r=this;return arguments.length&&arguments[0].type&&(arguments[0]=m(r,arguments[0])),S.apply(r,arguments)};var b=Object.getOwnPropertyDescriptor(n.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(n.RTCPeerConnection.prototype,"localDescription",{get:function(){var r=b.get.apply(this);return r.type===""?r:c(this,r)}}),n.RTCPeerConnection.prototype.removeTrack=function(r){var s,l=this;if(l.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!r._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(r._pc!==l)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");l._streams=l._streams||{},Object.keys(l._streams).forEach(function(g){l._streams[g].getTracks().find(function(T){return r.track===T})&&(s=l._streams[g])}),s&&(s.getTracks().length===1?l.removeStream(l._reverseStreams[s.id]):s.removeTrack(r.track),l.dispatchEvent(new Event("negotiationneeded")))}}function c(r,s){var l=s.sdp;return Object.keys(r._reverseStreams||[]).forEach(function(g){var T=r._reverseStreams[g],D=r._streams[T.id];l=l.replace(new RegExp(D.id,"g"),T.id)}),new RTCSessionDescription({type:s.type,sdp:l})}function m(r,s){var l=s.sdp;return Object.keys(r._reverseStreams||[]).forEach(function(g){var T=r._reverseStreams[g],D=r._streams[T.id];l=l.replace(new RegExp(T.id,"g"),D.id)}),new RTCSessionDescription({type:s.type,sdp:l})}},shimPeerConnection:function(n){var f=p.detectBrowser(n);if(!n.RTCPeerConnection&&n.webkitRTCPeerConnection&&(n.RTCPeerConnection=function(C,S){return a("PeerConnection"),C&&C.iceTransportPolicy&&(C.iceTransports=C.iceTransportPolicy),new n.webkitRTCPeerConnection(C,S)},n.RTCPeerConnection.prototype=n.webkitRTCPeerConnection.prototype,n.webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(n.RTCPeerConnection,"generateCertificate",{get:function(){return n.webkitRTCPeerConnection.generateCertificate}})),n.RTCPeerConnection){var h=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(C,S,b){var c=this,m=arguments;if(arguments.length>0&&typeof C=="function")return h.apply(this,arguments);if(h.length===0&&(arguments.length===0||typeof arguments[0]!="function"))return h.apply(this,[]);var r=function(g){var T={};return g.result().forEach(function(D){var P={id:D.id,timestamp:D.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[D.type]||D.type};D.names().forEach(function(N){P[N]=D.stat(N)}),T[P.id]=P}),T},s=function(g){return new Map(Object.keys(g).map(function(T){return[T,g[T]]}))};if(arguments.length>=2){var l=function(g){m[1](s(r(g)))};return h.apply(this,[l,arguments[0]])}return new Promise(function(g,T){h.apply(c,[function(D){g(s(r(D)))},T])}).then(S,b)},f.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(C){var S=n.RTCPeerConnection.prototype[C];n.RTCPeerConnection.prototype[C]=function(){var b=arguments,c=this,m=new Promise(function(r,s){S.apply(c,[b[0],r,s])});return b.length<2?m:m.then(function(){b[1].apply(null,[])},function(r){b.length>=3&&b[2].apply(null,[r])})}}),f.version<52&&["createOffer","createAnswer"].forEach(function(C){var S=n.RTCPeerConnection.prototype[C];n.RTCPeerConnection.prototype[C]=function(){var b=this;if(arguments.length<1||arguments.length===1&&typeof arguments[0]=="object"){var c=arguments.length===1?arguments[0]:void 0;return new Promise(function(m,r){S.apply(b,[m,r,c])})}return S.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(C){var S=n.RTCPeerConnection.prototype[C];n.RTCPeerConnection.prototype[C]=function(){return arguments[0]=new(C==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),S.apply(this,arguments)}});var o=n.RTCPeerConnection.prototype.addIceCandidate;n.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?o.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}},fixNegotiationNeeded:function(n){p.wrapPeerConnectionEvent(n,"negotiationneeded",function(f){if(f.target.signalingState==="stable")return f})},shimGetDisplayMedia:function(n,f){n.navigator&&n.navigator.mediaDevices&&!("getDisplayMedia"in n.navigator.mediaDevices)&&(typeof f=="function"?(n.navigator.mediaDevices.getDisplayMedia=function(h){return f(h).then(function(o){var C=h.video&&h.video.width,S=h.video&&h.video.height,b=h.video&&h.video.frameRate;return h.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:o,maxFrameRate:b||3}},C&&(h.video.mandatory.maxWidth=C),S&&(h.video.mandatory.maxHeight=S),n.navigator.mediaDevices.getUserMedia(h)})},n.navigator.getDisplayMedia=function(h){return p.deprecated("navigator.getDisplayMedia","navigator.mediaDevices.getDisplayMedia"),n.navigator.mediaDevices.getDisplayMedia(h)}):console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}}},function(W,$,O){var p=O(1),a=p.log;W.exports=function(d){var n=p.detectBrowser(d),f=d&&d.navigator,h=function(c){if(typeof c!="object"||c.mandatory||c.optional)return c;var m={};return Object.keys(c).forEach(function(r){if(r!=="require"&&r!=="advanced"&&r!=="mediaSource"){var s=typeof c[r]=="object"?c[r]:{ideal:c[r]};s.exact!==void 0&&typeof s.exact=="number"&&(s.min=s.max=s.exact);var l=function(T,D){return T?T+D.charAt(0).toUpperCase()+D.slice(1):D==="deviceId"?"sourceId":D};if(s.ideal!==void 0){m.optional=m.optional||[];var g={};typeof s.ideal=="number"?(g[l("min",r)]=s.ideal,m.optional.push(g),(g={})[l("max",r)]=s.ideal,m.optional.push(g)):(g[l("",r)]=s.ideal,m.optional.push(g))}s.exact!==void 0&&typeof s.exact!="number"?(m.mandatory=m.mandatory||{},m.mandatory[l("",r)]=s.exact):["min","max"].forEach(function(T){s[T]!==void 0&&(m.mandatory=m.mandatory||{},m.mandatory[l(T,r)]=s[T])})}}),c.advanced&&(m.optional=(m.optional||[]).concat(c.advanced)),m},o=function(c,m){if(n.version>=61)return m(c);if((c=JSON.parse(JSON.stringify(c)))&&typeof c.audio=="object"){var r=function(T,D,P){D in T&&!(P in T)&&(T[P]=T[D],delete T[D])};r((c=JSON.parse(JSON.stringify(c))).audio,"autoGainControl","googAutoGainControl"),r(c.audio,"noiseSuppression","googNoiseSuppression"),c.audio=h(c.audio)}if(c&&typeof c.video=="object"){var s=c.video.facingMode;s=s&&(typeof s=="object"?s:{ideal:s});var l,g=n.version<66;if(s&&(s.exact==="user"||s.exact==="environment"||s.ideal==="user"||s.ideal==="environment")&&(!f.mediaDevices.getSupportedConstraints||!f.mediaDevices.getSupportedConstraints().facingMode||g)&&(delete c.video.facingMode,s.exact==="environment"||s.ideal==="environment"?l=["back","rear"]:s.exact!=="user"&&s.ideal!=="user"||(l=["front"]),l))return f.mediaDevices.enumerateDevices().then(function(T){var D=(T=T.filter(function(P){return P.kind==="videoinput"})).find(function(P){return l.some(function(N){return P.label.toLowerCase().indexOf(N)!==-1})});return!D&&T.length&&l.indexOf("back")!==-1&&(D=T[T.length-1]),D&&(c.video.deviceId=s.exact?{exact:D.deviceId}:{ideal:D.deviceId}),c.video=h(c.video),a("chrome: "+JSON.stringify(c)),m(c)});c.video=h(c.video)}return a("chrome: "+JSON.stringify(c)),m(c)},C=function(c){return n.version>=64?c:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[c.name]||c.name,message:c.message,constraint:c.constraint||c.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};f.getUserMedia=function(c,m,r){o(c,function(s){f.webkitGetUserMedia(s,m,function(l){r&&r(C(l))})})};var S=function(c){return new Promise(function(m,r){f.getUserMedia(c,m,r)})};if(f.mediaDevices||(f.mediaDevices={getUserMedia:S,enumerateDevices:function(){return new Promise(function(c){var m={audio:"audioinput",video:"videoinput"};return d.MediaStreamTrack.getSources(function(r){c(r.map(function(s){return{label:s.label,kind:m[s.kind],deviceId:s.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),f.mediaDevices.getUserMedia){var b=f.mediaDevices.getUserMedia.bind(f.mediaDevices);f.mediaDevices.getUserMedia=function(c){return o(c,function(m){return b(m).then(function(r){if(m.audio&&!r.getAudioTracks().length||m.video&&!r.getVideoTracks().length)throw r.getTracks().forEach(function(s){s.stop()}),new DOMException("","NotFoundError");return r},function(r){return Promise.reject(C(r))})})}}else f.mediaDevices.getUserMedia=function(c){return S(c)};f.mediaDevices.addEventListener===void 0&&(f.mediaDevices.addEventListener=function(){a("Dummy mediaDevices.addEventListener called.")}),f.mediaDevices.removeEventListener===void 0&&(f.mediaDevices.removeEventListener=function(){a("Dummy mediaDevices.removeEventListener called.")})}},function(W,$,O){var p=O(1),a=O(10),d=O(11);W.exports={shimGetUserMedia:O(12),shimPeerConnection:function(n){var f=p.detectBrowser(n);if(n.RTCIceGatherer&&(n.RTCIceCandidate||(n.RTCIceCandidate=function(C){return C}),n.RTCSessionDescription||(n.RTCSessionDescription=function(C){return C}),f.version<15025)){var h=Object.getOwnPropertyDescriptor(n.MediaStreamTrack.prototype,"enabled");Object.defineProperty(n.MediaStreamTrack.prototype,"enabled",{set:function(C){h.set.call(this,C);var S=new Event("enabled");S.enabled=C,this.dispatchEvent(S)}})}n.RTCRtpSender&&!("dtmf"in n.RTCRtpSender.prototype)&&Object.defineProperty(n.RTCRtpSender.prototype,"dtmf",{get:function(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=new n.RTCDtmfSender(this):this.track.kind==="video"&&(this._dtmf=null)),this._dtmf}}),n.RTCDtmfSender&&!n.RTCDTMFSender&&(n.RTCDTMFSender=n.RTCDtmfSender);var o=d(n,f.version);n.RTCPeerConnection=function(C){return C&&C.iceServers&&(C.iceServers=a(C.iceServers)),new o(C)},n.RTCPeerConnection.prototype=o.prototype},shimReplaceTrack:function(n){n.RTCRtpSender&&!("replaceTrack"in n.RTCRtpSender.prototype)&&(n.RTCRtpSender.prototype.replaceTrack=n.RTCRtpSender.prototype.setTrack)},shimGetDisplayMedia:function(n,f){if("getDisplayMedia"in n.navigator&&n.navigator.mediaDevices&&!("getDisplayMedia"in n.navigator.mediaDevices)){var h=n.navigator.getDisplayMedia;n.navigator.mediaDevices.getDisplayMedia=function(o){return h.call(n.navigator,o)},n.navigator.getDisplayMedia=function(o){return p.deprecated("navigator.getDisplayMedia","navigator.mediaDevices.getDisplayMedia"),h.call(n.navigator,o)}}}}},function(W,$,O){var p=O(1);W.exports=function(a,d){var n=!1;return(a=JSON.parse(JSON.stringify(a))).filter(function(f){if(f&&(f.urls||f.url)){var h=f.urls||f.url;f.url&&!f.urls&&p.deprecated("RTCIceServer.url","RTCIceServer.urls");var o=typeof h=="string";return o&&(h=[h]),h=h.filter(function(C){return C.indexOf("turn:")===0&&C.indexOf("transport=udp")!==-1&&C.indexOf("turn:[")===-1&&!n?(n=!0,!0):C.indexOf("stun:")===0&&d>=14393&&C.indexOf("?transport=udp")===-1}),delete f.url,f.urls=o?h[0]:h,!!h.length}})}},function(W,$,O){var p=O(2);function a(o,C,S,b,c){var m=p.writeRtpDescription(o.kind,C);if(m+=p.writeIceParameters(o.iceGatherer.getLocalParameters()),m+=p.writeDtlsParameters(o.dtlsTransport.getLocalParameters(),S==="offer"?"actpass":c||"active"),m+="a=mid:"+o.mid+`\r
`,o.rtpSender&&o.rtpReceiver?m+=`a=sendrecv\r
`:o.rtpSender?m+=`a=sendonly\r
`:o.rtpReceiver?m+=`a=recvonly\r
`:m+=`a=inactive\r
`,o.rtpSender){var r=o.rtpSender._initialTrackId||o.rtpSender.track.id;o.rtpSender._initialTrackId=r;var s="msid:"+(b?b.id:"-")+" "+r+`\r
`;m+="a="+s,m+="a=ssrc:"+o.sendEncodingParameters[0].ssrc+" "+s,o.sendEncodingParameters[0].rtx&&(m+="a=ssrc:"+o.sendEncodingParameters[0].rtx.ssrc+" "+s,m+="a=ssrc-group:FID "+o.sendEncodingParameters[0].ssrc+" "+o.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return m+="a=ssrc:"+o.sendEncodingParameters[0].ssrc+" cname:"+p.localCName+`\r
`,o.rtpSender&&o.sendEncodingParameters[0].rtx&&(m+="a=ssrc:"+o.sendEncodingParameters[0].rtx.ssrc+" cname:"+p.localCName+`\r
`),m}function d(o,C){var S={codecs:[],headerExtensions:[],fecMechanisms:[]},b=function(m,r){m=parseInt(m,10);for(var s=0;s<r.length;s++)if(r[s].payloadType===m||r[s].preferredPayloadType===m)return r[s]},c=function(m,r,s,l){var g=b(m.parameters.apt,s),T=b(r.parameters.apt,l);return g&&T&&g.name.toLowerCase()===T.name.toLowerCase()};return o.codecs.forEach(function(m){for(var r=0;r<C.codecs.length;r++){var s=C.codecs[r];if(m.name.toLowerCase()===s.name.toLowerCase()&&m.clockRate===s.clockRate){if(m.name.toLowerCase()==="rtx"&&m.parameters&&s.parameters.apt&&!c(m,s,o.codecs,C.codecs))continue;(s=JSON.parse(JSON.stringify(s))).numChannels=Math.min(m.numChannels,s.numChannels),S.codecs.push(s),s.rtcpFeedback=s.rtcpFeedback.filter(function(l){for(var g=0;g<m.rtcpFeedback.length;g++)if(m.rtcpFeedback[g].type===l.type&&m.rtcpFeedback[g].parameter===l.parameter)return!0;return!1});break}}}),o.headerExtensions.forEach(function(m){for(var r=0;r<C.headerExtensions.length;r++){var s=C.headerExtensions[r];if(m.uri===s.uri){S.headerExtensions.push(s);break}}}),S}function n(o,C,S){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[C][o].indexOf(S)!==-1}function f(o,C){var S=o.getRemoteCandidates().find(function(b){return C.foundation===b.foundation&&C.ip===b.ip&&C.port===b.port&&C.priority===b.priority&&C.protocol===b.protocol&&C.type===b.type});return S||o.addRemoteCandidate(C),!S}function h(o,C){var S=new Error(C);return S.name=o,S.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[o],S}W.exports=function(o,C){function S(r,s){s.addTrack(r),s.dispatchEvent(new o.MediaStreamTrackEvent("addtrack",{track:r}))}function b(r,s,l,g){var T=new Event("track");T.track=s,T.receiver=l,T.transceiver={receiver:l},T.streams=g,o.setTimeout(function(){r._dispatchEvent("track",T)})}var c=function(r){var s=this,l=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(T){s[T]=l[T].bind(l)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",r=JSON.parse(JSON.stringify(r||{})),this.usingBundle=r.bundlePolicy==="max-bundle",r.rtcpMuxPolicy==="negotiate")throw h("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(r.rtcpMuxPolicy||(r.rtcpMuxPolicy="require"),r.iceTransportPolicy){case"all":case"relay":break;default:r.iceTransportPolicy="all"}switch(r.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:r.bundlePolicy="balanced"}if(r.iceServers=function(T,D){var P=!1;return(T=JSON.parse(JSON.stringify(T))).filter(function(N){if(N&&(N.urls||N.url)){var B=N.urls||N.url;N.url&&!N.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var z=typeof B=="string";return z&&(B=[B]),B=B.filter(function(H){return H.indexOf("turn:")===0&&H.indexOf("transport=udp")!==-1&&H.indexOf("turn:[")===-1&&!P?(P=!0,!0):H.indexOf("stun:")===0&&D>=14393&&H.indexOf("?transport=udp")===-1}),delete N.url,N.urls=z?B[0]:B,!!B.length}})}(r.iceServers||[],C),this._iceGatherers=[],r.iceCandidatePoolSize)for(var g=r.iceCandidatePoolSize;g>0;g--)this._iceGatherers.push(new o.RTCIceGatherer({iceServers:r.iceServers,gatherPolicy:r.iceTransportPolicy}));else r.iceCandidatePoolSize=0;this._config=r,this.transceivers=[],this._sdpSessionId=p.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(c.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(c.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),c.prototype.onicecandidate=null,c.prototype.onaddstream=null,c.prototype.ontrack=null,c.prototype.onremovestream=null,c.prototype.onsignalingstatechange=null,c.prototype.oniceconnectionstatechange=null,c.prototype.onconnectionstatechange=null,c.prototype.onicegatheringstatechange=null,c.prototype.onnegotiationneeded=null,c.prototype.ondatachannel=null,c.prototype._dispatchEvent=function(r,s){this._isClosed||(this.dispatchEvent(s),typeof this["on"+r]=="function"&&this["on"+r](s))},c.prototype._emitGatheringStateChange=function(){var r=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",r)},c.prototype.getConfiguration=function(){return this._config},c.prototype.getLocalStreams=function(){return this.localStreams},c.prototype.getRemoteStreams=function(){return this.remoteStreams},c.prototype._createTransceiver=function(r,s){var l=this.transceivers.length>0,g={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:r,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&l)g.iceTransport=this.transceivers[0].iceTransport,g.dtlsTransport=this.transceivers[0].dtlsTransport;else{var T=this._createIceAndDtlsTransports();g.iceTransport=T.iceTransport,g.dtlsTransport=T.dtlsTransport}return s||this.transceivers.push(g),g},c.prototype.addTrack=function(r,s){if(this._isClosed)throw h("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var l;if(this.transceivers.find(function(T){return T.track===r}))throw h("InvalidAccessError","Track already exists.");for(var g=0;g<this.transceivers.length;g++)this.transceivers[g].track||this.transceivers[g].kind!==r.kind||(l=this.transceivers[g]);return l||(l=this._createTransceiver(r.kind)),this._maybeFireNegotiationNeeded(),this.localStreams.indexOf(s)===-1&&this.localStreams.push(s),l.track=r,l.stream=s,l.rtpSender=new o.RTCRtpSender(r,l.dtlsTransport),l.rtpSender},c.prototype.addStream=function(r){var s=this;if(C>=15025)r.getTracks().forEach(function(g){s.addTrack(g,r)});else{var l=r.clone();r.getTracks().forEach(function(g,T){var D=l.getTracks()[T];g.addEventListener("enabled",function(P){D.enabled=P.enabled})}),l.getTracks().forEach(function(g){s.addTrack(g,l)})}},c.prototype.removeTrack=function(r){if(this._isClosed)throw h("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(r instanceof o.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var s=this.transceivers.find(function(g){return g.rtpSender===r});if(!s)throw h("InvalidAccessError","Sender was not created by this connection.");var l=s.stream;s.rtpSender.stop(),s.rtpSender=null,s.track=null,s.stream=null,this.transceivers.map(function(g){return g.stream}).indexOf(l)===-1&&this.localStreams.indexOf(l)>-1&&this.localStreams.splice(this.localStreams.indexOf(l),1),this._maybeFireNegotiationNeeded()},c.prototype.removeStream=function(r){var s=this;r.getTracks().forEach(function(l){var g=s.getSenders().find(function(T){return T.track===l});g&&s.removeTrack(g)})},c.prototype.getSenders=function(){return this.transceivers.filter(function(r){return!!r.rtpSender}).map(function(r){return r.rtpSender})},c.prototype.getReceivers=function(){return this.transceivers.filter(function(r){return!!r.rtpReceiver}).map(function(r){return r.rtpReceiver})},c.prototype._createIceGatherer=function(r,s){var l=this;if(s&&r>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var g=new o.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(g,"state",{value:"new",writable:!0}),this.transceivers[r].bufferedCandidateEvents=[],this.transceivers[r].bufferCandidates=function(T){var D=!T.candidate||Object.keys(T.candidate).length===0;g.state=D?"completed":"gathering",l.transceivers[r].bufferedCandidateEvents!==null&&l.transceivers[r].bufferedCandidateEvents.push(T)},g.addEventListener("localcandidate",this.transceivers[r].bufferCandidates),g},c.prototype._gather=function(r,s){var l=this,g=this.transceivers[s].iceGatherer;if(!g.onlocalcandidate){var T=this.transceivers[s].bufferedCandidateEvents;this.transceivers[s].bufferedCandidateEvents=null,g.removeEventListener("localcandidate",this.transceivers[s].bufferCandidates),g.onlocalcandidate=function(D){if(!(l.usingBundle&&s>0)){var P=new Event("icecandidate");P.candidate={sdpMid:r,sdpMLineIndex:s};var N=D.candidate,B=!N||Object.keys(N).length===0;if(B)g.state!=="new"&&g.state!=="gathering"||(g.state="completed");else{g.state==="new"&&(g.state="gathering"),N.component=1,N.ufrag=g.getLocalParameters().usernameFragment;var z=p.writeCandidate(N);P.candidate=Object.assign(P.candidate,p.parseCandidate(z)),P.candidate.candidate=z,P.candidate.toJSON=function(){return{candidate:P.candidate.candidate,sdpMid:P.candidate.sdpMid,sdpMLineIndex:P.candidate.sdpMLineIndex,usernameFragment:P.candidate.usernameFragment}}}var H=p.getMediaSections(l._localDescription.sdp);H[P.candidate.sdpMLineIndex]+=B?`a=end-of-candidates\r
`:"a="+P.candidate.candidate+`\r
`,l._localDescription.sdp=p.getDescription(l._localDescription.sdp)+H.join("");var U=l.transceivers.every(function(Q){return Q.iceGatherer&&Q.iceGatherer.state==="completed"});l.iceGatheringState!=="gathering"&&(l.iceGatheringState="gathering",l._emitGatheringStateChange()),B||l._dispatchEvent("icecandidate",P),U&&(l._dispatchEvent("icecandidate",new Event("icecandidate")),l.iceGatheringState="complete",l._emitGatheringStateChange())}},o.setTimeout(function(){T.forEach(function(D){g.onlocalcandidate(D)})},0)}},c.prototype._createIceAndDtlsTransports=function(){var r=this,s=new o.RTCIceTransport(null);s.onicestatechange=function(){r._updateIceConnectionState(),r._updateConnectionState()};var l=new o.RTCDtlsTransport(s);return l.ondtlsstatechange=function(){r._updateConnectionState()},l.onerror=function(){Object.defineProperty(l,"state",{value:"failed",writable:!0}),r._updateConnectionState()},{iceTransport:s,dtlsTransport:l}},c.prototype._disposeIceAndDtlsTransports=function(r){var s=this.transceivers[r].iceGatherer;s&&(delete s.onlocalcandidate,delete this.transceivers[r].iceGatherer);var l=this.transceivers[r].iceTransport;l&&(delete l.onicestatechange,delete this.transceivers[r].iceTransport);var g=this.transceivers[r].dtlsTransport;g&&(delete g.ondtlsstatechange,delete g.onerror,delete this.transceivers[r].dtlsTransport)},c.prototype._transceive=function(r,s,l){var g=d(r.localCapabilities,r.remoteCapabilities);s&&r.rtpSender&&(g.encodings=r.sendEncodingParameters,g.rtcp={cname:p.localCName,compound:r.rtcpParameters.compound},r.recvEncodingParameters.length&&(g.rtcp.ssrc=r.recvEncodingParameters[0].ssrc),r.rtpSender.send(g)),l&&r.rtpReceiver&&g.codecs.length>0&&(r.kind==="video"&&r.recvEncodingParameters&&C<15019&&r.recvEncodingParameters.forEach(function(T){delete T.rtx}),r.recvEncodingParameters.length?g.encodings=r.recvEncodingParameters:g.encodings=[{}],g.rtcp={compound:r.rtcpParameters.compound},r.rtcpParameters.cname&&(g.rtcp.cname=r.rtcpParameters.cname),r.sendEncodingParameters.length&&(g.rtcp.ssrc=r.sendEncodingParameters[0].ssrc),r.rtpReceiver.receive(g))},c.prototype.setLocalDescription=function(r){var s,l,g=this;if(["offer","answer"].indexOf(r.type)===-1)return Promise.reject(h("TypeError",'Unsupported type "'+r.type+'"'));if(!n("setLocalDescription",r.type,g.signalingState)||g._isClosed)return Promise.reject(h("InvalidStateError","Can not set local "+r.type+" in state "+g.signalingState));if(r.type==="offer")s=p.splitSections(r.sdp),l=s.shift(),s.forEach(function(D,P){var N=p.parseRtpParameters(D);g.transceivers[P].localCapabilities=N}),g.transceivers.forEach(function(D,P){g._gather(D.mid,P)});else if(r.type==="answer"){s=p.splitSections(g._remoteDescription.sdp),l=s.shift();var T=p.matchPrefix(l,"a=ice-lite").length>0;s.forEach(function(D,P){var N=g.transceivers[P],B=N.iceGatherer,z=N.iceTransport,H=N.dtlsTransport,U=N.localCapabilities,Q=N.remoteCapabilities;if(!(p.isRejected(D)&&p.matchPrefix(D,"a=bundle-only").length===0)&&!N.rejected){var se=p.getIceParameters(D,l),A=p.getDtlsParameters(D,l);T&&(A.role="server"),g.usingBundle&&P!==0||(g._gather(N.mid,P),z.state==="new"&&z.start(B,se,T?"controlling":"controlled"),H.state==="new"&&H.start(A));var I=d(U,Q);g._transceive(N,I.codecs.length>0,!1)}})}return g._localDescription={type:r.type,sdp:r.sdp},r.type==="offer"?g._updateSignalingState("have-local-offer"):g._updateSignalingState("stable"),Promise.resolve()},c.prototype.setRemoteDescription=function(r){var s=this;if(["offer","answer"].indexOf(r.type)===-1)return Promise.reject(h("TypeError",'Unsupported type "'+r.type+'"'));if(!n("setRemoteDescription",r.type,s.signalingState)||s._isClosed)return Promise.reject(h("InvalidStateError","Can not set remote "+r.type+" in state "+s.signalingState));var l={};s.remoteStreams.forEach(function(z){l[z.id]=z});var g=[],T=p.splitSections(r.sdp),D=T.shift(),P=p.matchPrefix(D,"a=ice-lite").length>0,N=p.matchPrefix(D,"a=group:BUNDLE ").length>0;s.usingBundle=N;var B=p.matchPrefix(D,"a=ice-options:")[0];return s.canTrickleIceCandidates=!!B&&B.substr(14).split(" ").indexOf("trickle")>=0,T.forEach(function(z,H){var U=p.splitLines(z),Q=p.getKind(z),se=p.isRejected(z)&&p.matchPrefix(z,"a=bundle-only").length===0,A=U[0].substr(2).split(" ")[2],I=p.getDirection(z,D),J=p.parseMsid(z),ie=p.getMid(z)||p.generateIdentifier();if(se||Q==="application"&&(A==="DTLS/SCTP"||A==="UDP/DTLS/SCTP"))s.transceivers[H]={mid:ie,kind:Q,protocol:A,rejected:!0};else{var j,me,Ee,Te,ke,X,Z,de,pe;!se&&s.transceivers[H]&&s.transceivers[H].rejected&&(s.transceivers[H]=s._createTransceiver(Q,!0));var Ie,be,_e=p.parseRtpParameters(z);se||(Ie=p.getIceParameters(z,D),(be=p.getDtlsParameters(z,D)).role="client"),Z=p.parseRtpEncodingParameters(z);var Le=p.parseRtcpParameters(z),He=p.matchPrefix(z,"a=end-of-candidates",D).length>0,Ge=p.matchPrefix(z,"a=candidate:").map(function(ye){return p.parseCandidate(ye)}).filter(function(ye){return ye.component===1});if((r.type==="offer"||r.type==="answer")&&!se&&N&&H>0&&s.transceivers[H]&&(s._disposeIceAndDtlsTransports(H),s.transceivers[H].iceGatherer=s.transceivers[0].iceGatherer,s.transceivers[H].iceTransport=s.transceivers[0].iceTransport,s.transceivers[H].dtlsTransport=s.transceivers[0].dtlsTransport,s.transceivers[H].rtpSender&&s.transceivers[H].rtpSender.setTransport(s.transceivers[0].dtlsTransport),s.transceivers[H].rtpReceiver&&s.transceivers[H].rtpReceiver.setTransport(s.transceivers[0].dtlsTransport)),r.type!=="offer"||se)r.type==="answer"&&!se&&(me=(j=s.transceivers[H]).iceGatherer,Ee=j.iceTransport,Te=j.dtlsTransport,ke=j.rtpReceiver,X=j.sendEncodingParameters,de=j.localCapabilities,s.transceivers[H].recvEncodingParameters=Z,s.transceivers[H].remoteCapabilities=_e,s.transceivers[H].rtcpParameters=Le,Ge.length&&Ee.state==="new"&&(!P&&!He||N&&H!==0?Ge.forEach(function(ye){f(j.iceTransport,ye)}):Ee.setRemoteCandidates(Ge)),N&&H!==0||(Ee.state==="new"&&Ee.start(me,Ie,"controlling"),Te.state==="new"&&Te.start(be)),!d(j.localCapabilities,j.remoteCapabilities).codecs.filter(function(ye){return ye.name.toLowerCase()==="rtx"}).length&&j.sendEncodingParameters[0].rtx&&delete j.sendEncodingParameters[0].rtx,s._transceive(j,I==="sendrecv"||I==="recvonly",I==="sendrecv"||I==="sendonly"),!ke||I!=="sendrecv"&&I!=="sendonly"?delete j.rtpReceiver:(pe=ke.track,J?(l[J.stream]||(l[J.stream]=new o.MediaStream),S(pe,l[J.stream]),g.push([pe,ke,l[J.stream]])):(l.default||(l.default=new o.MediaStream),S(pe,l.default),g.push([pe,ke,l.default]))));else{(j=s.transceivers[H]||s._createTransceiver(Q)).mid=ie,j.iceGatherer||(j.iceGatherer=s._createIceGatherer(H,N)),Ge.length&&j.iceTransport.state==="new"&&(!He||N&&H!==0?Ge.forEach(function(ye){f(j.iceTransport,ye)}):j.iceTransport.setRemoteCandidates(Ge)),de=o.RTCRtpReceiver.getCapabilities(Q),C<15019&&(de.codecs=de.codecs.filter(function(ye){return ye.name!=="rtx"})),X=j.sendEncodingParameters||[{ssrc:1001*(2*H+2)}];var Be,oe=!1;I==="sendrecv"||I==="sendonly"?(oe=!j.rtpReceiver,ke=j.rtpReceiver||new o.RTCRtpReceiver(j.dtlsTransport,Q),oe&&(pe=ke.track,J&&J.stream==="-"||(J?(l[J.stream]||(l[J.stream]=new o.MediaStream,Object.defineProperty(l[J.stream],"id",{get:function(){return J.stream}})),Object.defineProperty(pe,"id",{get:function(){return J.track}}),Be=l[J.stream]):(l.default||(l.default=new o.MediaStream),Be=l.default)),Be&&(S(pe,Be),j.associatedRemoteMediaStreams.push(Be)),g.push([pe,ke,Be]))):j.rtpReceiver&&j.rtpReceiver.track&&(j.associatedRemoteMediaStreams.forEach(function(ye){var $e=ye.getTracks().find(function(Ne){return Ne.id===j.rtpReceiver.track.id});$e&&function(Ne,Ue){Ue.removeTrack(Ne),Ue.dispatchEvent(new o.MediaStreamTrackEvent("removetrack",{track:Ne}))}($e,ye)}),j.associatedRemoteMediaStreams=[]),j.localCapabilities=de,j.remoteCapabilities=_e,j.rtpReceiver=ke,j.rtcpParameters=Le,j.sendEncodingParameters=X,j.recvEncodingParameters=Z,s._transceive(s.transceivers[H],!1,oe)}}}),s._dtlsRole===void 0&&(s._dtlsRole=r.type==="offer"?"active":"passive"),s._remoteDescription={type:r.type,sdp:r.sdp},r.type==="offer"?s._updateSignalingState("have-remote-offer"):s._updateSignalingState("stable"),Object.keys(l).forEach(function(z){var H=l[z];if(H.getTracks().length){if(s.remoteStreams.indexOf(H)===-1){s.remoteStreams.push(H);var U=new Event("addstream");U.stream=H,o.setTimeout(function(){s._dispatchEvent("addstream",U)})}g.forEach(function(Q){var se=Q[0],A=Q[1];H.id===Q[2].id&&b(s,se,A,[H])})}}),g.forEach(function(z){z[2]||b(s,z[0],z[1],[])}),o.setTimeout(function(){s&&s.transceivers&&s.transceivers.forEach(function(z){z.iceTransport&&z.iceTransport.state==="new"&&z.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),z.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},c.prototype.close=function(){this.transceivers.forEach(function(r){r.iceTransport&&r.iceTransport.stop(),r.dtlsTransport&&r.dtlsTransport.stop(),r.rtpSender&&r.rtpSender.stop(),r.rtpReceiver&&r.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},c.prototype._updateSignalingState=function(r){this.signalingState=r;var s=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",s)},c.prototype._maybeFireNegotiationNeeded=function(){var r=this;this.signalingState==="stable"&&this.needNegotiation!==!0&&(this.needNegotiation=!0,o.setTimeout(function(){if(r.needNegotiation){r.needNegotiation=!1;var s=new Event("negotiationneeded");r._dispatchEvent("negotiationneeded",s)}},0))},c.prototype._updateIceConnectionState=function(){var r,s={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(g){g.iceTransport&&!g.rejected&&s[g.iceTransport.state]++}),r="new",s.failed>0?r="failed":s.checking>0?r="checking":s.disconnected>0?r="disconnected":s.new>0?r="new":s.connected>0?r="connected":s.completed>0&&(r="completed"),r!==this.iceConnectionState){this.iceConnectionState=r;var l=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",l)}},c.prototype._updateConnectionState=function(){var r,s={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(g){g.iceTransport&&g.dtlsTransport&&!g.rejected&&(s[g.iceTransport.state]++,s[g.dtlsTransport.state]++)}),s.connected+=s.completed,r="new",s.failed>0?r="failed":s.connecting>0?r="connecting":s.disconnected>0?r="disconnected":s.new>0?r="new":s.connected>0&&(r="connected"),r!==this.connectionState){this.connectionState=r;var l=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",l)}},c.prototype.createOffer=function(){var r=this;if(r._isClosed)return Promise.reject(h("InvalidStateError","Can not call createOffer after close"));var s=r.transceivers.filter(function(P){return P.kind==="audio"}).length,l=r.transceivers.filter(function(P){return P.kind==="video"}).length,g=arguments[0];if(g){if(g.mandatory||g.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");g.offerToReceiveAudio!==void 0&&(s=g.offerToReceiveAudio===!0?1:g.offerToReceiveAudio===!1?0:g.offerToReceiveAudio),g.offerToReceiveVideo!==void 0&&(l=g.offerToReceiveVideo===!0?1:g.offerToReceiveVideo===!1?0:g.offerToReceiveVideo)}for(r.transceivers.forEach(function(P){P.kind==="audio"?--s<0&&(P.wantReceive=!1):P.kind==="video"&&--l<0&&(P.wantReceive=!1)});s>0||l>0;)s>0&&(r._createTransceiver("audio"),s--),l>0&&(r._createTransceiver("video"),l--);var T=p.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.transceivers.forEach(function(P,N){var B=P.track,z=P.kind,H=P.mid||p.generateIdentifier();P.mid=H,P.iceGatherer||(P.iceGatherer=r._createIceGatherer(N,r.usingBundle));var U=o.RTCRtpSender.getCapabilities(z);C<15019&&(U.codecs=U.codecs.filter(function(se){return se.name!=="rtx"})),U.codecs.forEach(function(se){se.name==="H264"&&se.parameters["level-asymmetry-allowed"]===void 0&&(se.parameters["level-asymmetry-allowed"]="1"),P.remoteCapabilities&&P.remoteCapabilities.codecs&&P.remoteCapabilities.codecs.forEach(function(A){se.name.toLowerCase()===A.name.toLowerCase()&&se.clockRate===A.clockRate&&(se.preferredPayloadType=A.payloadType)})}),U.headerExtensions.forEach(function(se){(P.remoteCapabilities&&P.remoteCapabilities.headerExtensions||[]).forEach(function(A){se.uri===A.uri&&(se.id=A.id)})});var Q=P.sendEncodingParameters||[{ssrc:1001*(2*N+1)}];B&&C>=15019&&z==="video"&&!Q[0].rtx&&(Q[0].rtx={ssrc:Q[0].ssrc+1}),P.wantReceive&&(P.rtpReceiver=new o.RTCRtpReceiver(P.dtlsTransport,z)),P.localCapabilities=U,P.sendEncodingParameters=Q}),r._config.bundlePolicy!=="max-compat"&&(T+="a=group:BUNDLE "+r.transceivers.map(function(P){return P.mid}).join(" ")+`\r
`),T+=`a=ice-options:trickle\r
`,r.transceivers.forEach(function(P,N){T+=a(P,P.localCapabilities,"offer",P.stream,r._dtlsRole),T+=`a=rtcp-rsize\r
`,!P.iceGatherer||r.iceGatheringState==="new"||N!==0&&r.usingBundle||(P.iceGatherer.getLocalCandidates().forEach(function(B){B.component=1,T+="a="+p.writeCandidate(B)+`\r
`}),P.iceGatherer.state==="completed"&&(T+=`a=end-of-candidates\r
`))});var D=new o.RTCSessionDescription({type:"offer",sdp:T});return Promise.resolve(D)},c.prototype.createAnswer=function(){var r=this;if(r._isClosed)return Promise.reject(h("InvalidStateError","Can not call createAnswer after close"));if(r.signalingState!=="have-remote-offer"&&r.signalingState!=="have-local-pranswer")return Promise.reject(h("InvalidStateError","Can not call createAnswer in signalingState "+r.signalingState));var s=p.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.usingBundle&&(s+="a=group:BUNDLE "+r.transceivers.map(function(T){return T.mid}).join(" ")+`\r
`),s+=`a=ice-options:trickle\r
`;var l=p.getMediaSections(r._remoteDescription.sdp).length;r.transceivers.forEach(function(T,D){if(!(D+1>l)){if(T.rejected)return T.kind==="application"?T.protocol==="DTLS/SCTP"?s+=`m=application 0 DTLS/SCTP 5000\r
`:s+="m=application 0 "+T.protocol+` webrtc-datachannel\r
`:T.kind==="audio"?s+=`m=audio 0 UDP/TLS/RTP/SAVPF 0\r
a=rtpmap:0 PCMU/8000\r
`:T.kind==="video"&&(s+=`m=video 0 UDP/TLS/RTP/SAVPF 120\r
a=rtpmap:120 VP8/90000\r
`),void(s+=`c=IN IP4 0.0.0.0\r
a=inactive\r
a=mid:`+T.mid+`\r
`);var P;T.stream&&(T.kind==="audio"?P=T.stream.getAudioTracks()[0]:T.kind==="video"&&(P=T.stream.getVideoTracks()[0]),P&&C>=15019&&T.kind==="video"&&!T.sendEncodingParameters[0].rtx&&(T.sendEncodingParameters[0].rtx={ssrc:T.sendEncodingParameters[0].ssrc+1}));var N=d(T.localCapabilities,T.remoteCapabilities);!N.codecs.filter(function(B){return B.name.toLowerCase()==="rtx"}).length&&T.sendEncodingParameters[0].rtx&&delete T.sendEncodingParameters[0].rtx,s+=a(T,N,"answer",T.stream,r._dtlsRole),T.rtcpParameters&&T.rtcpParameters.reducedSize&&(s+=`a=rtcp-rsize\r
`)}});var g=new o.RTCSessionDescription({type:"answer",sdp:s});return Promise.resolve(g)},c.prototype.addIceCandidate=function(r){var s,l=this;return r&&r.sdpMLineIndex===void 0&&!r.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(g,T){if(!l._remoteDescription)return T(h("InvalidStateError","Can not add ICE candidate without a remote description"));if(r&&r.candidate!==""){var D=r.sdpMLineIndex;if(r.sdpMid){for(var P=0;P<l.transceivers.length;P++)if(l.transceivers[P].mid===r.sdpMid){D=P;break}}var N=l.transceivers[D];if(!N)return T(h("OperationError","Can not add ICE candidate"));if(N.rejected)return g();var B=Object.keys(r.candidate).length>0?p.parseCandidate(r.candidate):{};if(B.protocol==="tcp"&&(B.port===0||B.port===9)||B.component&&B.component!==1)return g();if((D===0||D>0&&N.iceTransport!==l.transceivers[0].iceTransport)&&!f(N.iceTransport,B))return T(h("OperationError","Can not add ICE candidate"));var z=r.candidate.trim();z.indexOf("a=")===0&&(z=z.substr(2)),(s=p.getMediaSections(l._remoteDescription.sdp))[D]+="a="+(B.type?z:"end-of-candidates")+`\r
`,l._remoteDescription.sdp=p.getDescription(l._remoteDescription.sdp)+s.join("")}else for(var H=0;H<l.transceivers.length&&(l.transceivers[H].rejected||(l.transceivers[H].iceTransport.addRemoteCandidate({}),(s=p.getMediaSections(l._remoteDescription.sdp))[H]+=`a=end-of-candidates\r
`,l._remoteDescription.sdp=p.getDescription(l._remoteDescription.sdp)+s.join(""),!l.usingBundle));H++);g()})},c.prototype.getStats=function(r){if(r&&r instanceof o.MediaStreamTrack){var s=null;if(this.transceivers.forEach(function(g){g.rtpSender&&g.rtpSender.track===r?s=g.rtpSender:g.rtpReceiver&&g.rtpReceiver.track===r&&(s=g.rtpReceiver)}),!s)throw h("InvalidAccessError","Invalid selector.");return s.getStats()}var l=[];return this.transceivers.forEach(function(g){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(T){g[T]&&l.push(g[T].getStats())})}),Promise.all(l).then(function(g){var T=new Map;return g.forEach(function(D){D.forEach(function(P){T.set(P.id,P)})}),T})},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(r){var s=o[r];if(s&&s.prototype&&s.prototype.getStats){var l=s.prototype.getStats;s.prototype.getStats=function(){return l.apply(this).then(function(g){var T=new Map;return Object.keys(g).forEach(function(D){var P;g[D].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(P=g[D]).type]||P.type,T.set(D,g[D])}),T})}}});var m=["createOffer","createAnswer"];return m.forEach(function(r){var s=c.prototype[r];c.prototype[r]=function(){var l=arguments;return typeof l[0]=="function"||typeof l[1]=="function"?s.apply(this,[arguments[2]]).then(function(g){typeof l[0]=="function"&&l[0].apply(null,[g])},function(g){typeof l[1]=="function"&&l[1].apply(null,[g])}):s.apply(this,arguments)}}),(m=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(r){var s=c.prototype[r];c.prototype[r]=function(){var l=arguments;return typeof l[1]=="function"||typeof l[2]=="function"?s.apply(this,arguments).then(function(){typeof l[1]=="function"&&l[1].apply(null)},function(g){typeof l[2]=="function"&&l[2].apply(null,[g])}):s.apply(this,arguments)}}),["getStats"].forEach(function(r){var s=c.prototype[r];c.prototype[r]=function(){var l=arguments;return typeof l[1]=="function"?s.apply(this,arguments).then(function(){typeof l[1]=="function"&&l[1].apply(null)}):s.apply(this,arguments)}}),c}},function(W,$,O){W.exports=function(p){var a=p&&p.navigator,d=a.mediaDevices.getUserMedia.bind(a.mediaDevices);a.mediaDevices.getUserMedia=function(n){return d(n).catch(function(f){return Promise.reject(function(h){return{name:{PermissionDeniedError:"NotAllowedError"}[h.name]||h.name,message:h.message,constraint:h.constraint,toString:function(){return this.name}}}(f))})}}},function(W,$,O){var p=O(1);W.exports={shimGetUserMedia:O(14),shimOnTrack:function(a){typeof a=="object"&&a.RTCPeerConnection&&!("ontrack"in a.RTCPeerConnection.prototype)&&Object.defineProperty(a.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(d){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=d),this.addEventListener("addstream",this._ontrackpoly=(function(n){n.stream.getTracks().forEach((function(f){var h=new Event("track");h.track=f,h.receiver={track:f},h.transceiver={receiver:h.receiver},h.streams=[n.stream],this.dispatchEvent(h)}).bind(this))}).bind(this))},enumerable:!0,configurable:!0}),typeof a=="object"&&a.RTCTrackEvent&&"receiver"in a.RTCTrackEvent.prototype&&!("transceiver"in a.RTCTrackEvent.prototype)&&Object.defineProperty(a.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimSourceObject:function(a){typeof a=="object"&&a.HTMLMediaElement&&!("srcObject"in a.HTMLMediaElement.prototype)&&Object.defineProperty(a.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(d){this.mozSrcObject=d}})},shimPeerConnection:function(a){var d=p.detectBrowser(a);if(typeof a=="object"&&(a.RTCPeerConnection||a.mozRTCPeerConnection)){a.RTCPeerConnection||(a.RTCPeerConnection=function(o,C){if(d.version<38&&o&&o.iceServers){for(var S=[],b=0;b<o.iceServers.length;b++){var c=o.iceServers[b];if(c.hasOwnProperty("urls"))for(var m=0;m<c.urls.length;m++){var r={url:c.urls[m]};c.urls[m].indexOf("turn")===0&&(r.username=c.username,r.credential=c.credential),S.push(r)}else S.push(o.iceServers[b])}o.iceServers=S}return new a.mozRTCPeerConnection(o,C)},a.RTCPeerConnection.prototype=a.mozRTCPeerConnection.prototype,a.mozRTCPeerConnection.generateCertificate&&Object.defineProperty(a.RTCPeerConnection,"generateCertificate",{get:function(){return a.mozRTCPeerConnection.generateCertificate}}),a.RTCSessionDescription=a.mozRTCSessionDescription,a.RTCIceCandidate=a.mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(o){var C=a.RTCPeerConnection.prototype[o];a.RTCPeerConnection.prototype[o]=function(){return arguments[0]=new(o==="addIceCandidate"?a.RTCIceCandidate:a.RTCSessionDescription)(arguments[0]),C.apply(this,arguments)}});var n=a.RTCPeerConnection.prototype.addIceCandidate;a.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var f={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},h=a.RTCPeerConnection.prototype.getStats;a.RTCPeerConnection.prototype.getStats=function(o,C,S){return h.apply(this,[o||null]).then(function(b){if(d.version<48&&(b=function(c){var m=new Map;return Object.keys(c).forEach(function(r){m.set(r,c[r]),m[r]=c[r]}),m}(b)),d.version<53&&!C)try{b.forEach(function(c){c.type=f[c.type]||c.type})}catch(c){if(c.name!=="TypeError")throw c;b.forEach(function(m,r){b.set(r,Object.assign({},m,{type:f[m.type]||m.type}))})}return b}).then(C,S)}}},shimSenderGetStats:function(a){if(typeof a=="object"&&a.RTCPeerConnection&&a.RTCRtpSender&&(!a.RTCRtpSender||!("getStats"in a.RTCRtpSender.prototype))){var d=a.RTCPeerConnection.prototype.getSenders;d&&(a.RTCPeerConnection.prototype.getSenders=function(){var f=this,h=d.apply(f,[]);return h.forEach(function(o){o._pc=f}),h});var n=a.RTCPeerConnection.prototype.addTrack;n&&(a.RTCPeerConnection.prototype.addTrack=function(){var f=n.apply(this,arguments);return f._pc=this,f}),a.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}},shimReceiverGetStats:function(a){if(typeof a=="object"&&a.RTCPeerConnection&&a.RTCRtpSender&&(!a.RTCRtpSender||!("getStats"in a.RTCRtpReceiver.prototype))){var d=a.RTCPeerConnection.prototype.getReceivers;d&&(a.RTCPeerConnection.prototype.getReceivers=function(){var n=this,f=d.apply(n,[]);return f.forEach(function(h){h._pc=n}),f}),p.wrapPeerConnectionEvent(a,"track",function(n){return n.receiver._pc=n.srcElement,n}),a.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}},shimRemoveStream:function(a){a.RTCPeerConnection&&!("removeStream"in a.RTCPeerConnection.prototype)&&(a.RTCPeerConnection.prototype.removeStream=function(d){var n=this;p.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(f){f.track&&d.getTracks().indexOf(f.track)!==-1&&n.removeTrack(f)})})},shimRTCDataChannel:function(a){a.DataChannel&&!a.RTCDataChannel&&(a.RTCDataChannel=a.DataChannel)},shimGetDisplayMedia:function(a,d){a.navigator&&a.navigator.mediaDevices&&!("getDisplayMedia"in a.navigator.mediaDevices)&&(a.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){var f=new DOMException("getDisplayMedia without video constraints is undefined");return f.name="NotFoundError",f.code=8,Promise.reject(f)}return n.video===!0?n.video={mediaSource:d}:n.video.mediaSource=d,a.navigator.mediaDevices.getUserMedia(n)},a.navigator.getDisplayMedia=function(n){return p.deprecated("navigator.getDisplayMedia","navigator.mediaDevices.getDisplayMedia"),a.navigator.mediaDevices.getDisplayMedia(n)})}}},function(W,$,O){var p=O(1),a=p.log;W.exports=function(d){var n=p.detectBrowser(d),f=d&&d.navigator,h=d&&d.MediaStreamTrack,o=function(l){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[l.name]||l.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[l.message]||l.message,constraint:l.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},C=function(l,g,T){var D=function(P){if(typeof P!="object"||P.require)return P;var N=[];return Object.keys(P).forEach(function(B){if(B!=="require"&&B!=="advanced"&&B!=="mediaSource"){var z=P[B]=typeof P[B]=="object"?P[B]:{ideal:P[B]};if(z.min===void 0&&z.max===void 0&&z.exact===void 0||N.push(B),z.exact!==void 0&&(typeof z.exact=="number"?z.min=z.max=z.exact:P[B]=z.exact,delete z.exact),z.ideal!==void 0){P.advanced=P.advanced||[];var H={};typeof z.ideal=="number"?H[B]={min:z.ideal,max:z.ideal}:H[B]=z.ideal,P.advanced.push(H),delete z.ideal,Object.keys(z).length||delete P[B]}}}),N.length&&(P.require=N),P};return l=JSON.parse(JSON.stringify(l)),n.version<38&&(a("spec: "+JSON.stringify(l)),l.audio&&(l.audio=D(l.audio)),l.video&&(l.video=D(l.video)),a("ff37: "+JSON.stringify(l))),f.mozGetUserMedia(l,g,function(P){T(o(P))})};if(f.mediaDevices||(f.mediaDevices={getUserMedia:function(l){return new Promise(function(g,T){C(l,g,T)})},addEventListener:function(){},removeEventListener:function(){}}),f.mediaDevices.enumerateDevices=f.mediaDevices.enumerateDevices||function(){return new Promise(function(l){l([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},n.version<41){var S=f.mediaDevices.enumerateDevices.bind(f.mediaDevices);f.mediaDevices.enumerateDevices=function(){return S().then(void 0,function(l){if(l.name==="NotFoundError")return[];throw l})}}if(n.version<49){var b=f.mediaDevices.getUserMedia.bind(f.mediaDevices);f.mediaDevices.getUserMedia=function(l){return b(l).then(function(g){if(l.audio&&!g.getAudioTracks().length||l.video&&!g.getVideoTracks().length)throw g.getTracks().forEach(function(T){T.stop()}),new DOMException("The object can not be found here.","NotFoundError");return g},function(g){return Promise.reject(o(g))})}}if(!(n.version>55&&"autoGainControl"in f.mediaDevices.getSupportedConstraints())){var c=function(l,g,T){g in l&&!(T in l)&&(l[T]=l[g],delete l[g])},m=f.mediaDevices.getUserMedia.bind(f.mediaDevices);if(f.mediaDevices.getUserMedia=function(l){return typeof l=="object"&&typeof l.audio=="object"&&(l=JSON.parse(JSON.stringify(l)),c(l.audio,"autoGainControl","mozAutoGainControl"),c(l.audio,"noiseSuppression","mozNoiseSuppression")),m(l)},h&&h.prototype.getSettings){var r=h.prototype.getSettings;h.prototype.getSettings=function(){var l=r.apply(this,arguments);return c(l,"mozAutoGainControl","autoGainControl"),c(l,"mozNoiseSuppression","noiseSuppression"),l}}if(h&&h.prototype.applyConstraints){var s=h.prototype.applyConstraints;h.prototype.applyConstraints=function(l){return this.kind==="audio"&&typeof l=="object"&&(l=JSON.parse(JSON.stringify(l)),c(l,"autoGainControl","mozAutoGainControl"),c(l,"noiseSuppression","mozNoiseSuppression")),s.apply(this,[l])}}}f.getUserMedia=function(l,g,T){if(n.version<44)return C(l,g,T);p.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),f.mediaDevices.getUserMedia(l).then(g,T)}}},function(W,$,O){var p=O(1);W.exports={shimLocalStreamsAPI:function(a){if(typeof a=="object"&&a.RTCPeerConnection){if("getLocalStreams"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),"getStreamById"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.getStreamById=function(n){var f=null;return this._localStreams&&this._localStreams.forEach(function(h){h.id===n&&(f=h)}),this._remoteStreams&&this._remoteStreams.forEach(function(h){h.id===n&&(f=h)}),f}),!("addStream"in a.RTCPeerConnection.prototype)){var d=a.RTCPeerConnection.prototype.addTrack;a.RTCPeerConnection.prototype.addStream=function(n){this._localStreams||(this._localStreams=[]),this._localStreams.indexOf(n)===-1&&this._localStreams.push(n);var f=this;n.getTracks().forEach(function(h){d.call(f,h,n)})},a.RTCPeerConnection.prototype.addTrack=function(n,f){return f&&(this._localStreams?this._localStreams.indexOf(f)===-1&&this._localStreams.push(f):this._localStreams=[f]),d.call(this,n,f)}}"removeStream"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);var f=this._localStreams.indexOf(n);if(f!==-1){this._localStreams.splice(f,1);var h=this,o=n.getTracks();this.getSenders().forEach(function(C){o.indexOf(C.track)!==-1&&h.removeTrack(C)})}})}},shimRemoteStreamsAPI:function(a){if(typeof a=="object"&&a.RTCPeerConnection&&("getRemoteStreams"in a.RTCPeerConnection.prototype||(a.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in a.RTCPeerConnection.prototype))){Object.defineProperty(a.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(n){this._onaddstream&&this.removeEventListener("addstream",this._onaddstream),this.addEventListener("addstream",this._onaddstream=n)}});var d=a.RTCPeerConnection.prototype.setRemoteDescription;a.RTCPeerConnection.prototype.setRemoteDescription=function(){var n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(f){f.streams.forEach(function(h){if(n._remoteStreams||(n._remoteStreams=[]),!(n._remoteStreams.indexOf(h)>=0)){n._remoteStreams.push(h);var o=new Event("addstream");o.stream=h,n.dispatchEvent(o)}})}),d.apply(n,arguments)}}},shimCallbacksAPI:function(a){if(typeof a=="object"&&a.RTCPeerConnection){var d=a.RTCPeerConnection.prototype,n=d.createOffer,f=d.createAnswer,h=d.setLocalDescription,o=d.setRemoteDescription,C=d.addIceCandidate;d.createOffer=function(b,c){var m=arguments.length>=2?arguments[2]:arguments[0],r=n.apply(this,[m]);return c?(r.then(b,c),Promise.resolve()):r},d.createAnswer=function(b,c){var m=arguments.length>=2?arguments[2]:arguments[0],r=f.apply(this,[m]);return c?(r.then(b,c),Promise.resolve()):r};var S=function(b,c,m){var r=h.apply(this,[b]);return m?(r.then(c,m),Promise.resolve()):r};d.setLocalDescription=S,S=function(b,c,m){var r=o.apply(this,[b]);return m?(r.then(c,m),Promise.resolve()):r},d.setRemoteDescription=S,S=function(b,c,m){var r=C.apply(this,[b]);return m?(r.then(c,m),Promise.resolve()):r},d.addIceCandidate=S}},shimGetUserMedia:function(a){var d=a&&a.navigator;d.getUserMedia||(d.webkitGetUserMedia?d.getUserMedia=d.webkitGetUserMedia.bind(d):d.mediaDevices&&d.mediaDevices.getUserMedia&&(d.getUserMedia=(function(n,f,h){d.mediaDevices.getUserMedia(n).then(f,h)}).bind(d)))},shimRTCIceServerUrls:function(a){var d=a.RTCPeerConnection;a.RTCPeerConnection=function(n,f){if(n&&n.iceServers){for(var h=[],o=0;o<n.iceServers.length;o++){var C=n.iceServers[o];!C.hasOwnProperty("urls")&&C.hasOwnProperty("url")?(p.deprecated("RTCIceServer.url","RTCIceServer.urls"),(C=JSON.parse(JSON.stringify(C))).urls=C.url,delete C.url,h.push(C)):h.push(n.iceServers[o])}n.iceServers=h}return new d(n,f)},a.RTCPeerConnection.prototype=d.prototype,"generateCertificate"in a.RTCPeerConnection&&Object.defineProperty(a.RTCPeerConnection,"generateCertificate",{get:function(){return d.generateCertificate}})},shimTrackEventTransceiver:function(a){typeof a=="object"&&a.RTCPeerConnection&&"receiver"in a.RTCTrackEvent.prototype&&!a.RTCTransceiver&&Object.defineProperty(a.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimCreateOfferLegacy:function(a){var d=a.RTCPeerConnection.prototype.createOffer;a.RTCPeerConnection.prototype.createOffer=function(n){var f=this;if(n){n.offerToReceiveAudio!==void 0&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);var h=f.getTransceivers().find(function(C){return C.sender.track&&C.sender.track.kind==="audio"});n.offerToReceiveAudio===!1&&h?h.direction==="sendrecv"?h.setDirection?h.setDirection("sendonly"):h.direction="sendonly":h.direction==="recvonly"&&(h.setDirection?h.setDirection("inactive"):h.direction="inactive"):n.offerToReceiveAudio!==!0||h||f.addTransceiver("audio"),n.offerToReceiveVideo!==void 0&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);var o=f.getTransceivers().find(function(C){return C.sender.track&&C.sender.track.kind==="video"});n.offerToReceiveVideo===!1&&o?o.direction==="sendrecv"?o.setDirection("sendonly"):o.direction==="recvonly"&&o.setDirection("inactive"):n.offerToReceiveVideo!==!0||o||f.addTransceiver("video")}return d.apply(f,arguments)}}}},function(W,$,O){var p=O(2),a=O(1);W.exports={shimRTCIceCandidate:function(d){if(!(!d.RTCIceCandidate||d.RTCIceCandidate&&"foundation"in d.RTCIceCandidate.prototype)){var n=d.RTCIceCandidate;d.RTCIceCandidate=function(f){if(typeof f=="object"&&f.candidate&&f.candidate.indexOf("a=")===0&&((f=JSON.parse(JSON.stringify(f))).candidate=f.candidate.substr(2)),f.candidate&&f.candidate.length){var h=new n(f),o=p.parseCandidate(f.candidate),C=Object.assign(h,o);return C.toJSON=function(){return{candidate:C.candidate,sdpMid:C.sdpMid,sdpMLineIndex:C.sdpMLineIndex,usernameFragment:C.usernameFragment}},C}return new n(f)},d.RTCIceCandidate.prototype=n.prototype,a.wrapPeerConnectionEvent(d,"icecandidate",function(f){return f.candidate&&Object.defineProperty(f,"candidate",{value:new d.RTCIceCandidate(f.candidate),writable:"false"}),f})}},shimCreateObjectURL:function(d){var n=d&&d.URL;if(typeof d=="object"&&d.HTMLMediaElement&&"srcObject"in d.HTMLMediaElement.prototype&&n.createObjectURL&&n.revokeObjectURL){var f=n.createObjectURL.bind(n),h=n.revokeObjectURL.bind(n),o=new Map,C=0;n.createObjectURL=function(c){if("getTracks"in c){var m="polyblob:"+ ++C;return o.set(m,c),a.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream"),m}return f(c)},n.revokeObjectURL=function(c){h(c),o.delete(c)};var S=Object.getOwnPropertyDescriptor(d.HTMLMediaElement.prototype,"src");Object.defineProperty(d.HTMLMediaElement.prototype,"src",{get:function(){return S.get.apply(this)},set:function(c){return this.srcObject=o.get(c)||null,S.set.apply(this,[c])}});var b=d.HTMLMediaElement.prototype.setAttribute;d.HTMLMediaElement.prototype.setAttribute=function(){return arguments.length===2&&(""+arguments[0]).toLowerCase()==="src"&&(this.srcObject=o.get(arguments[1])||null),b.apply(this,arguments)}}},shimMaxMessageSize:function(d){if(!d.RTCSctpTransport&&d.RTCPeerConnection){var n=a.detectBrowser(d);"sctp"in d.RTCPeerConnection.prototype||Object.defineProperty(d.RTCPeerConnection.prototype,"sctp",{get:function(){return this._sctp===void 0?null:this._sctp}});var f=function(b){var c=p.splitSections(b.sdp);return c.shift(),c.some(function(m){var r=p.parseMLine(m);return r&&r.kind==="application"&&r.protocol.indexOf("SCTP")!==-1})},h=function(b){var c=b.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;var m=parseInt(c[1],10);return m!=m?-1:m},o=function(b){var c=65536;return n.browser==="firefox"&&(c=n.version<57?b===-1?16384:2147483637:n.version<60?n.version===57?65535:65536:2147483637),c},C=function(b,c){var m=65536;n.browser==="firefox"&&n.version===57&&(m=65535);var r=p.matchPrefix(b.sdp,"a=max-message-size:");return r.length>0?m=parseInt(r[0].substr(19),10):n.browser==="firefox"&&c!==-1&&(m=2147483637),m},S=d.RTCPeerConnection.prototype.setRemoteDescription;d.RTCPeerConnection.prototype.setRemoteDescription=function(){var b=this;if(b._sctp=null,f(arguments[0])){var c,m=h(arguments[0]),r=o(m),s=C(arguments[0],m);c=r===0&&s===0?Number.POSITIVE_INFINITY:r===0||s===0?Math.max(r,s):Math.min(r,s);var l={};Object.defineProperty(l,"maxMessageSize",{get:function(){return c}}),b._sctp=l}return S.apply(b,arguments)}}},shimSendThrowTypeError:function(d){if(d.RTCPeerConnection&&"createDataChannel"in d.RTCPeerConnection.prototype){var n=d.RTCPeerConnection.prototype.createDataChannel;d.RTCPeerConnection.prototype.createDataChannel=function(){var h=this,o=n.apply(h,arguments);return f(o,h),o},a.wrapPeerConnectionEvent(d,"datachannel",function(h){return f(h.channel,h.target),h})}function f(h,o){var C=h.send;h.send=function(){var S=arguments[0],b=S.length||S.size||S.byteLength;if(h.readyState==="open"&&o.sctp&&b>o.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+o.sctp.maxMessageSize+" bytes)");return C.apply(h,arguments)}}}}},function(W,$,O){O.r($),typeof console<"u"&&console.log!==void 0||(console={log:function(){}});var p=function(){},a=function(){},d=function(){},n=function(){},f=function(){},h=function(){};h=console.error.bind(console);var o={trace:p,debug:a,vdebug:d,log:n,warn:f,error:h},C=O(0),S=O.n(C);function b(y){return(b=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(k){return typeof k}:function(k){return k&&typeof Symbol=="function"&&k.constructor===Symbol&&k!==Symbol.prototype?"symbol":typeof k})(y)}var c=null,m=null,r=null,s=!1,l=null,g=null,T=null,D=function(y){switch(y.response){case"keepalive":o.vdebug("Got a keepalive");break;case"ack":o.debug("Got an ack"),o.debug(y);break;case"success":o.debug("Got a success"),o.debug(y),g(y);break;case"closed":o.debug("Got a closed connection"),o.debug(y),T();break;case"offline":o.debug("Connection is offline, token expired"),o.debug(y),m("offline");break;case"trickle":if(!X()&&!Z())return void o.debug("This handle is not attached to this session");var k=y.candidate,w=l.webrtcConfig;o.debug("Got a trickled candidate"),o.debug(k),w.pc&&w.remoteSdp?(o.debug("Adding remote candidate:",k),k&&k.completed!==!0?w.pc.addIceCandidate(new RTCIceCandidate(k)):w.pc.addIceCandidate()):(o.debug("We didn't do setRemoteDescription (trickle got here before the offer?), caching candidate"),w.candidates||(w.candidates=[]),w.candidates.push(k),o.debug(w.candidates));break;case"webrtcup":if(!X())return void o.debug("This handle is not attached");l.webrtcState(!0);break;case"hangup":if(o.debug("Got a hangup event"),o.debug(y),!X())return void o.debug("This handle is not attached");l.webrtcState(!1,y.reason),l.hangup();break;case"media":if(o.debug("Got a media event"),o.debug(y),!X())return void o.debug("This handle is not attached");l.mediaState(y.type,y.receiving);break;case"slowlink":if(o.debug("Got a slowlink event"),o.debug(y),!X())return void o.debug("This handle is not attached");l.slowLink(y.uplink,y.nacks);break;case"error":o.error("AfricasTalking Client Error: "+y.error.code+" "+y.error.reason),o.debug(y);break;case"event":if(o.log("Got an event"),o.log(y),y.eventdata===void 0||y.eventdata===null)return void o.warn("Missing eventdata...");if(o.log(y.eventdata),!X())return void o.warn("This handle is not attachedddd");y.jsep!==void 0&&y.jsep!==null&&(o.log("Handling SDP as well..."),o.log(y.jsep)),l.onmessage!==null&&l.onmessage!==void 0?(o.log("Notifying application..."),l.onmessage(y.eventdata,y.jsep)):o.debug("No provided notification callback");break;default:o.warn("Unknown message/event  "+y),o.debug(y)}},P=function(y){if(!s)return o.warn("Is the gateway down? (connected=false)"),void y.error("Is the gateway down? (connected=false)");if(!X()&&!Z())return o.warn("Invalid handle"),void y.error("Invalid handle");var k=y.message,w=y.jsep,_={command:"message",body:k};w!=null&&(_.jsep=w),o.debug("Sending message to web socket"),o.debug(_),o.debug("Sending a request to Africa's Talking"+_),c.send(JSON.stringify(_))},N=function(y){if(!X()&&!Z())return o.warn("Invalid handle"),void y.error("Invalid handle");var k=l.webrtcConfig,w=y.text;if(w==null)return o.warn("Invalid text"),void y.error("Invalid text");o.log("Sending string on data channel: "+w),k.dataChannel.send(w),y.success()},B=function(y){var k=y.jsep;y.media=y.media||{audio:!0};var w=y.media;if(!X()&&!Z())return o.warn("Invalid handle"),void y.error("Invalid handle");var _=l.webrtcConfig;if(_.pc===void 0||_.pc===null)o.log("Creating a new media session"),w.update=!1;else if(_.pc!==void 0&&_.pc!==null)if(o.log("Updating existing media session"),w.update=!0,y.stream!==null&&y.stream!==void 0)y.stream!==_.myStream&&o.log("Renegotiation involves a new external stream");else{if(w.addAudio){if(w.replaceAudio=!1,w.removeAudio=!1,w.audioSend=!0,_.myStream&&_.myStream.getAudioTracks()&&_.myStream.getAudioTracks().length)return o.error("AfricasTalking Client Error: Can't add audio stream, there already is one"),void y.error("AfricasTalking Client Error: Can't add audio stream, there already is one")}else w.removeAudio?(w.replaceAudio=!1,w.addAudio=!1,w.audioSend=!1):w.replaceAudio&&(w.addAudio=!1,w.removeAudio=!1,w.audioSend=!0);_.myStream===null||_.myStream===void 0?(w.replaceAudio&&(w.replaceAudio=!1,w.addAudio=!0,w.audioSend=!0),me(w)&&(w.addAudio=!0)):_.myStream.getAudioTracks()!==null&&_.myStream.getAudioTracks()!==void 0&&_.myStream.getAudioTracks().length!==0||(w.replaceAudio&&(w.replaceAudio=!1,w.addAudio=!0,w.audioSend=!0),me(w)&&(w.addAudio=!0))}if(w.update&&!_.streamExternal&&(w.removeAudio||w.replaceAudio)){if(_.myStream&&_.myStream.getAudioTracks()&&_.myStream.getAudioTracks().length){var R=_.myStream.getAudioTracks()[0];o.log("Removing audio track:",R),_.myStream.removeTrack(R);try{R.stop()}catch(ne){o.log("Error removing audio track:",ne)}}if(_.pc.getSenders()&&_.pc.getSenders().length&&!w.replaceAudio&&S.a.browserDetails.browser==="firefox")for(var Y in _.pc.getSenders()){var ae=_.pc.getSenders()[Y];ae&&ae.track&&ae.track.kind==="audio"&&(o.log("Removing audio sender:",ae),_.pc.removeTrack(ae))}}if(y.stream!==null&&y.stream!==void 0){var he=y.stream;if(o.log("MediaStream provided by the application"),o.debug(he),w.update&&_.myStream&&_.myStream!==y.stream&&!_.streamExternal){try{var ee=_.myStream.getTracks();for(var ue in ee){var fe=ee[ue];o.log(fe),fe!=null&&fe.stop()}}catch{}_.myStream=null}return _.streamExternal=!0,void se(k,w,y,he)}if(o.log("Executing isAudioSendEnabled"),me(w)){l.consentDialog(!0);var ce=me(w);ce===!0&&w!=null&&w!=null&&b(w.audio)==="object"&&(ce=w.audio),w!=null&&w.video==="screen"||navigator.mediaDevices.enumerateDevices().then(function(ne){var Pe=ne.some(function(Me){return Me.kind==="audioinput"}),Se=me(w),xe=Ee(w);if((Se||xe)&&!(Se&&Pe)&&xe)return l.consentDialog(!1),y.error("Audio capture is required, but no capture device found"),!1;var ze={audio:!!Pe&&ce,video:!1};o.debug("getUserMedia constraints",ze),navigator.mediaDevices.getUserMedia(ze).then(function(Me){l.consentDialog(!1),se(k,w,y,Me)}).catch(function(Me){l.consentDialog(!1),y.error({code:Me.code,name:Me.name,message:Me.message})})}).catch(function(ne){l.consentDialog(!1),y.error("enumerateDevices error",ne)})}else se(k,w,y)},z=function(y){var k=y.jsep;if(!X()&&!Z())return o.warn("Invalid handle"),void y.error("Invalid handle");var w=l.webrtcConfig;if(k!=null){if(w.pc===null)return o.warn("Wait, no PeerConnection?? if this is an answer, use createAnswer and not handleRemoteJsep"),void y.error("No PeerConnection: if this is an answer, use createAnswer and not handleRemoteJsep");w.pc.setRemoteDescription(new RTCSessionDescription(k),function(){if(o.log("Remote description accepted!"),w.remoteSdp=k.sdp,w.candidates&&w.candidates.length>0){for(var _ in w.candidates){var R=w.candidates[_];o.debug("Adding remote candidate:",R),R&&R.completed!==!0?w.pc.addIceCandidate(new RTCIceCandidate(R)):w.pc.addIceCandidate()}w.candidates=[]}},y.error)}else y.error("Invalid JSEP")},H=function(){if(!X()&&!Z())return o.warn("Invalid handle"),"Invalid handle";var y=l.webrtcConfig;return y.pc===null||y.pc===void 0?"Invalid PeerConnection":y.pc.getStats?y.bitrate.timer===null||y.bitrate.timer===void 0?(o.log("Starting bitrate timer (via getStats)"),y.bitrate.timer=setInterval(function(){y.pc.getStats().then(function(k){k.forEach(function(w){if(w){var _=!1;if((w.mediaType==="video"||w.id.toLowerCase().indexOf("video")>-1)&&w.type==="inbound-rtp"&&w.id.indexOf("rtcp")<0?_=!0:w.type!="ssrc"||!w.bytesReceived||w.googCodecName!=="VP8"&&w.googCodecName!==""||(_=!0),_)if(y.bitrate.bsnow=w.bytesReceived,y.bitrate.tsnow=w.timestamp,y.bitrate.bsbefore===null||y.bitrate.tsbefore===null)y.bitrate.bsbefore=y.bitrate.bsnow,y.bitrate.tsbefore=y.bitrate.tsnow;else{var R=y.bitrate.tsnow-y.bitrate.tsbefore;S.a.browserDetails.browser=="safari"&&(R/=1e3);var Y=Math.round(8*(y.bitrate.bsnow-y.bitrate.bsbefore)/R);y.bitrate.value=Y+" kbits/sec",y.bitrate.bsbefore=y.bitrate.bsnow,y.bitrate.tsbefore=y.bitrate.tsnow}}})})},1e3),"0 kbits/sec"):y.bitrate.value:(o.warn("Getting the video bitrate unsupported by browser"),"Feature unsupported by browser")},U=function(y){if(!X()&&!Z())return o.warn("Invalid handle"),void y.error("Invalid handle");var k=l.webrtcConfig;if(k.dtmfSender===null||k.dtmfSender===void 0){if(k.pc!==void 0&&k.pc!==null){var w=k.pc.getSenders().find(function(he){return he.track&&he.track.kind==="audio"});if(!w)return o.warn("Invalid DTMF configuration (no audio track)"),void y.error("Invalid DTMF configuration (no audio track)");k.dtmfSender=w.dtmf,k.dtmfSender&&(o.log("Created DTMF Sender"),k.dtmfSender.ontonechange=function(he){o.debug("Sent DTMF tone: "+he.tone)}),o.log({"config.dtmfSender":k.dtmfSender})}if(k.dtmfSender===null||k.dtmfSender===void 0)return o.warn("Invalid DTMF configuration"),void y.error("Invalid DTMF configuration")}var _=y.dtmf;if(_==null)return o.warn("Invalid DTMF parameters"),void y.error("Invalid DTMF parameters");var R=_.tones;if(R==null)return o.warn("Invalid DTMF string"),void y.error("Invalid DTMF string");var Y=_.duration;Y==null&&(Y=500);var ae=_.gap;ae==null&&(ae=50),o.debug("Sending DTMF string "+R+" (duration "+Y+"ms, gap "+ae+"ms)"),k.dtmfSender.insertDTMF(R,Y,ae)},Q=function(y){if(o.log("Cleaning WebRTC stuff"),X()){var k=l.webrtcConfig;if(k!=null){if(y===!0){var w={command:"hangup"};o.debug("Sending hangup request"),o.debug(w),c.send(JSON.stringify(w))}k.remoteStream=null,k.volume.timer&&clearInterval(k.volume.timer),k.volume.value=null,k.bitrate.timer&&clearInterval(k.bitrate.timer),k.bitrate.timer=null,k.bitrate.bsnow=null,k.bitrate.bsbefore=null,k.bitrate.tsnow=null,k.bitrate.tsbefore=null,k.bitrate.value=null;try{if(!k.streamExternal&&k.myStream!==null&&k.myStream!==void 0){o.log("Stopping local stream tracks");var _=k.myStream.getTracks();for(var R in _){var Y=_[R];o.log(Y),Y!=null&&Y.stop()}}}catch{}k.streamExternal=!1,k.myStream=null;try{k.pc.close()}catch{}k.pc=null,k.candidates=null,k.mySdp=null,k.remoteSdp=null,k.iceDone=!1,k.dataChannel=null,k.dtmfSender=null}l.oncleanup()}},se=function(y,k,w,_){if(!X()&&!Z())return o.warn("Invalid handle"),void w.error("Invalid handle");var R=l.webrtcConfig;o.log("streamsDone:",_),_&&(o.debug("  -- Audio tracks:",_.getAudioTracks()),o.debug("  -- Video tracks:",_.getVideoTracks()));var Y=!1;if(R.myStream&&k.update&&!R.streamExternal){if((!k.update&&me(k)||k.update&&(k.addAudio||k.replaceAudio))&&_.getAudioTracks()&&_.getAudioTracks().length)if(R.myStream.addTrack(_.getAudioTracks()[0]),k.replaceAudio&&S.a.browserDetails.browser==="firefox")for(var ae in o.log("Adding audio track:",_.getAudioTracks()[0]),R.pc.getSenders()){var he=R.pc.getSenders()[ae];he&&he.track&&he.track.kind==="audio"&&he.replaceTrack(_.getAudioTracks()[0])}else o.log((k.replaceAudio?"Replacing":"Adding")+" audio track:",_.getAudioTracks()[0]),R.pc.addTrack(_.getAudioTracks()[0],_)}else R.myStream=_,Y=!0;if(!R.pc){var ee={iceServers:w.iceServers,iceTransportPolicy:void 0,bundlePolicy:"balanced"},ue={optional:[{DtlsSrtpKeyAgreement:!0}]};if(w.rtcConstraints&&b(w.rtcConstraints)==="object")for(var fe in o.debug("Adding custom PeerConnection constraints:",w.rtcConstraints),w.rtcConstraints)ue.optional.push(w.rtcConstraints[fe]);S.a.browserDetails.browser==="edge"&&(ee.bundlePolicy="max-bundle"),o.log("Creating PeerConnection"),o.debug(ue),o.log("new RTCPeerConnection"+JSON.stringify({iceServers:ee.iceServers,pc_constraints:ue})),R.pc=new RTCPeerConnection(ee,ue),o.log("This is the peer connection created "+JSON.stringify(R.pc)),R.pc.getStats&&(R.volume.value=0,R.bitrate.value="0 kbits/sec"),o.log("Preparing local SDP and gathering candidates (trickle="+R.trickle+")"),R.pc.oniceconnectionstatechange=function(){R.pc&&l.iceState(R.pc.iceConnectionState)},R.pc.onicecandidate=function(ce){if(ce.candidate==null||S.a.browserDetails.browser==="edge"&&ce.candidate.candidate.indexOf("endOfCandidates")>0)o.log("End of candidates."),R.iceDone=!0,R.trickle===!0?A(w,{completed:!0}):function(Pe){if(X()||Z()){var Se=l.webrtcConfig;o.log("Sending offer/answer SDP..."),Se.mySdp!==null&&Se.mySdp!==void 0?(Se.mySdp={type:Se.pc.localDescription.type,sdp:Se.pc.localDescription.sdp},Se.trickle===!1&&(Se.mySdp.trickle=!1),o.debug(Pe),Se.sdpSent=!0,Pe.success(Se.mySdp)):o.warn("Local SDP instance is invalid, not sending anything...")}else o.warn("Invalid handle, not sending anything")}(w);else{var ne={candidate:ce.candidate.candidate,sdpMid:ce.candidate.sdpMid,sdpMLineIndex:ce.candidate.sdpMLineIndex};R.trickle===!0&&A(w,ne)}},R.pc.ontrack=function(ce){o.log("Handling Remote Track"),o.debug(ce),ce.streams&&(R.remoteStream=ce.streams[0],l.onremotestream(R.remoteStream),ce.track&&!ce.track.onended&&(o.log("Adding onended callback to track:",ce.track),ce.track.onended=function(ne){o.log("Remote track removed:",ne),R.remoteStream&&(R.remoteStream.removeTrack(ne.target),l.onremotestream(R.remoteStream))}))}}Y&&_!=null&&(o.log("Adding local stream"),_.getTracks().forEach(function(ce){R.pc.addTrack(ce,_)})),R.myStream&&l.onlocalstream(R.myStream),y==null?function(ce,ne){if(!X()&&!Z())return o.warn("Invalid handle"),void ne.error("Invalid handle");var Pe=l.webrtcConfig,Se=ne.simulcast===!0;Se?o.log("Creating offer (iceDone="+Pe.iceDone+", simulcast="+Se+")"):o.log("Creating offer (iceDone="+Pe.iceDone+")");var xe={offerToReceiveAudio:Te(ce)};ne.iceRestart===!0&&(xe.iceRestart=!0),o.log(xe),Pe.pc.createOffer(function(ze){if(o.debug(ze),o.log("Setting local description"),Pe.mySdp=ze.sdp,Pe.pc.setLocalDescription(ze),Pe.mediaConstraints=xe,Pe.iceDone||Pe.trickle){o.log("Offer ready"),o.debug(ne);var Me={type:ze.type,sdp:ze.sdp};ne.success(Me)}else o.log("Waiting for all candidates...")},ne.error,xe)}(k,w):R.pc.setRemoteDescription(new RTCSessionDescription(y),function(){if(o.log("Remote description accepted!"),R.remoteSdp=y.sdp,R.candidates&&R.candidates.length>0){for(var ce in R.candidates){var ne=R.candidates[ce];o.debug("Adding remote candidate:",ne),ne&&ne.completed!==!0?R.pc.addIceCandidate(new RTCIceCandidate(ne)):R.pc.addIceCandidate()}R.candidates=[]}(function(Pe,Se){if(!X()&&!Z())return o.warn("Invalid handle"),void Se.error("Invalid handle");var xe=l.webrtcConfig,ze=Se.simulcast===!0;ze?o.log("Creating answer (iceDone="+xe.iceDone+", simulcast="+ze+")"):o.log("Creating answer (iceDone="+xe.iceDone+")");var Me=null;Me=S.a.browserDetails.browser=="firefox"||S.a.browserDetails.browser=="edge"?{offerToReceiveAudio:Te(Pe)}:{mandatory:{OfferToReceiveAudio:Te(Pe)}},o.debug(Me),xe.pc.createAnswer(function(We){if(o.debug(We),o.log("Setting local description"),xe.mySdp=We.sdp,xe.pc.setLocalDescription(We),xe.mediaConstraints=Me,xe.iceDone||xe.trickle){var ft={type:We.type,sdp:We.sdp};Se.success(ft)}else o.log("Waiting for all candidates...")},Se.error,Me)})(k,w)},w.error)},A=function(y,k){if(s){if(!X()&&!Z())return o.warn("Invalid handle"),void y.error("Invalid handle");var w={command:"trickle",candidate:k};o.vdebug("Sending trickle candidate"),o.vdebug(w),c.send(JSON.stringify(w))}else o.warn("Is the gateway down? (connected=false)")},I=function(){if(!X()&&!Z())return o.warn("Invalid handle"),!0;var y=l.webrtcConfig;return y.pc===null||y.pc===void 0?(o.warn("Invalid PeerConnection"),!0):y.myStream===void 0||y.myStream===null?(o.warn("Invalid local MediaStream"),!0):y.myStream.getAudioTracks()===null||y.myStream.getAudioTracks()===void 0||y.myStream.getAudioTracks().length===0?(o.warn("No audio track"),!0):!y.myStream.getAudioTracks()[0].enabled},J=function(y){if(!X()&&!Z())return o.warn("Invalid handle"),!1;var k=l.webrtcConfig;return k.pc===null||k.pc===void 0?(o.warn("Invalid PeerConnection"),!1):k.myStream===void 0||k.myStream===null?(o.warn("Invalid local MediaStream"),!1):k.myStream.getAudioTracks()===null||k.myStream.getAudioTracks()===void 0||k.myStream.getAudioTracks().length===0?(o.warn("No audio track"),!1):(o.log({"config.myStream.getAudioTracks()[0].enabled":k.myStream.getAudioTracks()[0].enabled}),k.myStream.getAudioTracks()[0].enabled=!y,!0)},ie=function(){if(!X()&&!Z())return o.warn("Invalid handle"),!1;var y=l.webrtcConfig;return y.pc.getStats&&S.a.browserDetails.browser=="chrome"?y.remoteStream===null||y.remoteStream===void 0?(o.warn("Remote stream unavailable"),0):y.volume.timer===null||y.volume.timer===void 0?(o.log("Starting volume monitor"),y.volume.timer=setInterval(function(){y.pc.getStats(function(k){for(var w=k.result(),_=0;_<w.length;_++){var R=w[_];R.type=="ssrc"&&R.stat("audioOutputLevel")&&(y.volume.value=R.stat("audioOutputLevel"))}})},200),0):y.volume.value:(o.log("Getting the remote volume unsupported by browser"),0)},j=function(){var y=function(){c.removeEventListener("message",k),c.removeEventListener("error",w),r&&clearTimeout(r),c.close()},k=function(){o.log("websocket closed successfully"),y()},w=function(){o.log("closing websocket on error"),y()};m("closed"),c.readyState==1?(c.addEventListener("message",k),c.addEventListener("error",w),c.send(JSON.stringify({command:"destroy"}))):w()},me=function(y){return o.debug("isAudioSendEnabled:",y),y==null||y.audio!==!1&&(y.audioSend===void 0||y.audioSend===null||y.audioSend===!0)},Ee=function(y){return o.debug("isAudioSendRequired:",y),y!=null&&y.audio!==!1&&y.audioSend!==!1&&y.failIfNoAudio!==void 0&&y.failIfNoAudio!==null&&y.failIfNoAudio===!0},Te=function(y){return o.debug("isAudioRecvEnabled:",y),y==null||y.audio!==!1&&(y.audioRecv===void 0||y.audioRecv===null||y.audioRecv===!0)},ke=function y(){s&&(r=setTimeout(y,3e4),o.log("keepalive"),c.send(JSON.stringify({command:"keepalive"})))},X=function(){var y=!1;return l&&(y=!0),y},Z=function(){var y=!1;return l.webrtcConfig&&(y=!0),y};function de(y,k,w,_,R,Y,ae){try{var he=y[Y](ae),ee=he.value}catch(ue){return void w(ue)}he.done?k(ee):Promise.resolve(ee).then(_,R)}var pe=function(){var y,k=(y=regeneratorRuntime.mark(function w(_,R){return regeneratorRuntime.wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:return Y.abrupt("return",new Promise(function(ae,he){pe.server=new WebSocket(_.server,["at-protocol",_.capabilityToken]),pe.server.onopen=function(){var ee,ue;o.log("Sending initial request to Africa's Talking APIs "),ee=R,ue=pe.server,c=ue,m=ee.emitEvent,T=function(){o.error("AfricasTalking Client Error: error occured on session creation"),j()},g=function(){o.log("Creating Session... ");var fe={webrtcConfig:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannel:null,dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},consentDialog:ee.consentDialog,iceState:ee.iceState,mediaState:ee.mediaState,webrtcState:ee.webrtcState,slowLink:ee.slowLink,onmessage:ee.onmessage,onlocalstream:ee.onlocalstream,onremotestream:ee.onremotestream,ondata:ee.ondata,ondataopen:ee.ondataopen,oncleanup:ee.oncleanup,getVolume:function(){return ie()},isAudioMuted:function(){return I()},muteAudio:function(){return J(!0)},unmuteAudio:function(){return J(!1)},getBitrate:function(){return H()},send:function(ne){P(ne)},data:function(ne){N(ne)},dtmf:function(ne){U(ne)},createOffer:function(ne){B(ne)},createAnswer:function(ne){B(ne)},handleRemoteJsep:function(ne){z(ne)},hangup:function(ne){Q(ne===!0)}};o.log({"my handle is":fe}),r=setTimeout(ke,3e4),s=!0,l=fe,ee.setHandle(fe);var ce=["iPad","iPhone","iPod"].indexOf(navigator.platform)>=0;window.addEventListener(ce?"pagehide":"unload",function(){c.close()})},ae(pe.server)},pe.server.onmessage=function(ee){o.log("Got this message from the websocket: "+ee.data),D(JSON.parse(ee.data)),ae(pe.server)},pe.server.onclose=function(ee){o.log("Lost connection to the gateway (is it down?)"+JSON.stringify(ee)),j(),ae(pe.server)},pe.server.onerror=function(ee){o.error("AfricasTalking Client Error: Error connecting to the Africastalking WebSockets server... "+JSON.stringify(ee)),he(ee)}}));case 1:case"end":return Y.stop()}},w)}),function(){var w=this,_=arguments;return new Promise(function(R,Y){var ae=y.apply(w,_);function he(ue){de(ae,R,Y,he,ee,"next",ue)}function ee(ue){de(ae,R,Y,he,ee,"throw",ue)}he(void 0)})});return function(w,_){return k.apply(this,arguments)}}();function Ie(y){if(o.log("Library initialized: "+y),o.log("Using WebSockets to contact Africastalking: "+y.server),y.capabilityToken===null||y.capabilityToken===void 0)return y.error("No capability token specified"),{};o.log({gatewayCallbacks:y});var k={server:y.server,capabilityToken:y.capabilityToken},w={setHandle:y.setHandle,emitEvent:y.emitEvent,destroyed:y.destroyed,error:y.error,oncleanup:y.oncleanup,onlocalstream:y.onlocalstream,onmessage:y.onmessage,onremotestream:y.onremotestream,consentDialog:function(){},mediaState:function(){},webrtcState:function(){},slowLink:function(){},iceState:function(){}};pe(k,w).then(function(_){_.send(JSON.stringify({command:"create"}))}).catch(function(_){o.log("websocket Error: "+JSON.stringify(_))})}Ie.noop=function(){},Ie.isWebrtcSupported=function(){return window.RTCPeerConnection!==void 0&&window.RTCPeerConnection!==null&&navigator.getUserMedia!==void 0&&navigator.getUserMedia!==null};var be=Ie,_e={},Le=function(y){navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&(navigator.enumerateDevices=function(he){navigator.mediaDevices.enumerateDevices().then(he)});var k=[],w=location.protocol==="https:",_=!1;(typeof MediaStreamTrack<"u"&&"getSources"in MediaStreamTrack||navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices)&&(_=!0);var R,Y=!1,ae=!1;R=function(){_e={audio:Y,audioCap:ae},o.log({supportedDevices:_e}),y()},o.log({"finding supported devices":navigator.enumerateDevices,"some if statememt":navigator.mediaDevices,navigator}),_?(!navigator.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(navigator.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!navigator.enumerateDevices&&navigator.enumerateDevices&&(navigator.enumerateDevices=navigator.enumerateDevices.bind(navigator)),navigator.enumerateDevices?(k=[],navigator.enumerateDevices(function(he){he.forEach(function(ee){var ue,fe={};for(var ce in ee)fe[ce]=ee[ce];fe.kind==="audio"&&(fe.kind="audioinput"),k.forEach(function(ne){ne.id===fe.id&&ne.kind===fe.kind&&(ue=!0)}),ue||(fe.deviceId||(fe.deviceId=fe.id),fe.id||(fe.id=fe.deviceId),fe.label?fe.kind!=="audioinput"||ae||(ae=!0):(fe.label="Please invoke getUserMedia once.",w||(fe.label="HTTPs is required to get label of this "+fe.kind+" device.")),fe.kind==="audioinput"&&(Y=!0),k.push(fe))}),R&&R()})):R&&R()):o.log("cant enumerate devices")};function He(y,k){for(var w=0;w<k.length;w++){var _=k[w];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(y,_.key,_)}}function Ge(y,k){if(!(y instanceof k))throw new TypeError("Cannot call a class as a function")}function Be(y,k){for(var w=0;w<k.length;w++){var _=k[w];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(y,_.key,_)}}var oe,ye,$e,Ne,Ue,qe,Fe=new(function(){function y(){(function(_,R){if(!(_ instanceof R))throw new TypeError("Cannot call a class as a function")})(this,y),this.events={}}var k,w;return k=y,(w=[{key:"subscribe",value:function(_,R){var Y=this;return this.events[_]||(this.events[_]=[]),this.events[_].push(R),function(){Y.events[_]=Y.events[_].filter(function(ae){return R!==ae})}}},{key:"emit",value:function(_,R){var Y=this.events[_];Y&&Y.forEach(function(ae){ae.call(null,R)})}},{key:"unsubscribe",value:function(_){var R=this.events[_];return this.events[_]||(this.events[_]=[]),R&&this.events.splice(R),this}},{key:"unsubscribeAll",value:function(){return this.events={},this}}])&&He(k.prototype,w),y}()),Je=!1,Ye=function(){function y(_){var R=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Ge(this,y);var Y=R.iceServers,ae=Y===void 0?[]:Y,he=R.sounds,ee=he===void 0?{}:he;this.token=_,this.initDone=!1,this.iceServers,this.atwebsocketUrl="wss://webrtc.africastalking.com/connect",Array.isArray(ae)&&ae.length>0&&(this.iceServers=pt(ae));var ue=ut(ee);Ue=new Audio(ue.ringing),qe=new Audio(ue.dialing),o.log({ringing:Ue,dialing:qe}),o.log({iceServers:this.iceServers}),lt.bind(this)()}var k,w;return k=y,(w=[{key:"on",value:function(_,R){Fe.subscribe(_,R)}},{key:"logout",value:function(){oe&&oe.send({message:{request:"unregister"}})}},{key:"hold",value:function(){oe&&oe.send({message:{request:"hold"}})}},{key:"unhold",value:function(){oe&&oe.send({message:{request:"unhold"}})}},{key:"call",value:function(_){qe.play();var R=this.iceServers;Le(function(){oe.createOffer({iceServers:R,media:{audioSend:!0,audioRecv:!0},success:function(Y){o.debug("Got SDP!"),o.debug(Y),o.log({to:_,jsep:Y});var ae={request:"call",to:_};oe.send({message:ae,jsep:Y}),Ne=_},error:function(Y){o.error("AfricasTalking Client Error: ",Y)}})})}},{key:"answer",value:function(){var _=this.iceServers;ye=null,Le(function(){oe.createAnswer({jsep:$e,iceServers:_,media:{audio:!0},success:function(R){o.debug("Got SDP! audio=true, video=true"),o.debug(R),oe.send({message:{request:"accept"},jsep:R})},error:function(R){o.error("AfricasTalking Client Error: ",R),oe.send({message:{request:"decline",code:480}})}})})}},{key:"dtmf",value:function(_){oe.dtmf({dtmf:{tones:_}})}},{key:"muteAudio",value:function(){return oe.muteAudio()}},{key:"unmuteAudio",value:function(){return oe.unmuteAudio()}},{key:"getVolume",value:function(){return oe.getVolume()}},{key:"isAudioMuted",value:function(){return oe.isMuted()}},{key:"hangup",value:function(){ye?dt():(oe.send({message:{request:"hangup"}}),oe.hangup())}},{key:"getCounterpartNum",value:function(){return Ne}}])&&Be(k.prototype,w),y}();function lt(){var y=document.getElementById("remote-stream-audio");oe?ge():this.initDone!==!0&&(o.log("creating remoteStreamAudio",y,Ue,qe),y||((y=document.createElement("audio")).id="remote-stream-audio",y.autoplay=!0,document.body.appendChild(y)),Ue.loop=!0,qe.loop=!0,this.initDone=!0,be.isWebrtcSupported()?new be({server:this.atwebsocketUrl,capabilityToken:this.token,setHandle:function(k){oe=k,Le(function(){ge()})},onmessage:function(k,w){o.log(" ::: Got a message :::"),o.log(JSON.stringify(k));var _=k.error;if(_==null||_==null){var R=k.result;if(o.log("This is the result "+R.toString),R!=null&&R.event!==void 0&&R.event!==null){var Y=R.event;switch(Y){case"registration_failed":return o.log("Registration failed: "+R.code+" "+R.reason),void ge();case"registered":o.log("Successfully registered as "+R.username+"!"),Je||(Je=!0,Fe.emit("ready"));break;case"unregistered":o.log("Successfully unregistered as "+R.username+"!"),Je&&(Je=!1,Fe.emit("notready"));break;case"calling":o.log("Waiting for the peer to answer..."),Fe.emit("calling");break;case"incomingcall":Ne=k.result.username.split("@")[0].split(":")[1],ye=!0,Ue.play(),o.log("Incoming call from "+R.username+"!"),$e=w,Fe.emit("incomingcall",{from:Ne});break;case"progress":o.log("There's early media from "+R.username+", wairing for the call!"),w!=null&&nt(w);break;case"missed_call":Ne=k.result.caller.split("@")[0].split(":")[1],o.log("Missed call from "+R.caller+"!"),Fe.emit("missedcall",{from:Ne});break;case"accepted":qe.pause(),Ue.pause(),o.log(R.username+" accepted the call!"),w!=null&&nt(w),Fe.emit("callaccepted");break;case"hangup":ye=null,qe.pause(),Ue.pause(),o.log("Call hung up ("+R.code+" "+R.reason+")!"),oe.hangup(),Fe.emit("hangup",{code:R.code,reason:R.reason});break;case"decline":ye=null,qe.pause(),Ue.pause(),o.log("Call declined!"),oe.hangup(),Fe.emit("hangup");break;default:o.log("Received random json request "+Y.toString)}}}else Je?(qe.pause(),Ue.pause(),oe.hangup()):o.log("User is not registered"+_)},emitEvent:function(k){Fe.emit(k)},onlocalstream:function(k){o.log(" ::: Got a local stream :::"),o.log(JSON.stringify(k))},onremotestream:function(k){o.debug(" ::: Got a remote stream :::"),o.debug(JSON.stringify(k));var w=k.getAudioTracks();(function(_,R){S.a.browserDetails.browser==="chrome"?S.a.browserDetails.version>=43?_.srcObject=R:_.src!==void 0?_.src=URL.createObjectURL(R):o.error("AfricasTalking Client Error: Error attaching media stream to element"):_.srcObject=R})(y,new MediaStream(w))},oncleanup:function(){o.log(" ::: Got a cleanup notification :::")},error:function(k){Je=!1,o.error("Africastalking Client Error: "+k),Fe.unsubscribeAll()},destroyed:function(){Je=!1,Fe.unsubscribeAll()}}):o.error("AfricasTalking Client Error: No WebRTC support"))}var ge=function(){oe?(o.log({"loggin in with handle in client":oe}),oe.send({message:{request:"register"}})):o.error("Africastalking error: Unable to initialize")},dt=function(){ye=null,oe.send({message:{request:"decline"}})},nt=function(y){oe.handleRemoteJsep({jsep:y,error:function(){oe.send({message:{request:"hangup"}}),oe.hangup()}})},ut=function(y){return{dialing:y.dialing?y.dialing:"https://res.cloudinary.com/at-voice/video/upload/v1558426588/AT-voice-client-sdk/dialing_g4tn6r.mp3",ringing:y.ringing?y.ringing:"https://res.cloudinary.com/at-voice/video/upload/v1558426103/AT-voice-client-sdk/ringing_au0d1x.mp3"}},pt=function(y){var k=[];return y.forEach(function(w){if(typeof w.urls=="string"&&w.urls.startsWith("stun:"))k.push({urls:w.urls});else if(typeof w.urls=="string"&&(w.urls.startsWith("turn:")||w.urls.startsWith("turns:")))k.push({urls:w.urls,username:w.username,credential:w.credential});else if(Array.isArray(w.urls)){var _=w.urls.filter(function(R){return typeof R=="string"&&(R.startsWith("turn:")||R.startsWith("turns:"))});_.length===w.urls.length?k.push({urls:_,username:w.username,credential:w.credential}):o.error("AfricasTalking Client Error: Invalid iceServer param ".concat(JSON.stringify(w)))}else o.error("AfricasTalking Client Error: Invalid iceServer param ".concat(JSON.stringify(w)))}),k},ht=Ye;$.default={Client:ht}}]).default})})(Jt);var kr=Jt.exports;const _r=Bt(kr);var Vt={exports:{}};/*!
 * Pusher JavaScript Library v8.4.0-rc2
 * https://pusher.com/
 *
 * Copyright 2020, Pusher
 * Released under the MIT licence.
 */(function(M,q){(function($,O){M.exports=O()})(window,function(){return function(W){var $={};function O(p){if($[p])return $[p].exports;var a=$[p]={i:p,l:!1,exports:{}};return W[p].call(a.exports,a,a.exports,O),a.l=!0,a.exports}return O.m=W,O.c=$,O.d=function(p,a,d){O.o(p,a)||Object.defineProperty(p,a,{enumerable:!0,get:d})},O.r=function(p){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(p,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(p,"__esModule",{value:!0})},O.t=function(p,a){if(a&1&&(p=O(p)),a&8||a&4&&typeof p=="object"&&p&&p.__esModule)return p;var d=Object.create(null);if(O.r(d),Object.defineProperty(d,"default",{enumerable:!0,value:p}),a&2&&typeof p!="string")for(var n in p)O.d(d,n,(function(f){return p[f]}).bind(null,n));return d},O.n=function(p){var a=p&&p.__esModule?function(){return p.default}:function(){return p};return O.d(a,"a",a),a},O.o=function(p,a){return Object.prototype.hasOwnProperty.call(p,a)},O.p="",O(O.s=2)}([function(W,$,O){var p=this&&this.__extends||function(){var c=function(m,r){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,l){s.__proto__=l}||function(s,l){for(var g in l)l.hasOwnProperty(g)&&(s[g]=l[g])},c(m,r)};return function(m,r){c(m,r);function s(){this.constructor=m}m.prototype=r===null?Object.create(r):(s.prototype=r.prototype,new s)}}();Object.defineProperty($,"__esModule",{value:!0});var a=256,d=function(){function c(m){m===void 0&&(m="="),this._paddingCharacter=m}return c.prototype.encodedLength=function(m){return this._paddingCharacter?(m+2)/3*4|0:(m*8+5)/6|0},c.prototype.encode=function(m){for(var r="",s=0;s<m.length-2;s+=3){var l=m[s]<<16|m[s+1]<<8|m[s+2];r+=this._encodeByte(l>>>3*6&63),r+=this._encodeByte(l>>>2*6&63),r+=this._encodeByte(l>>>1*6&63),r+=this._encodeByte(l>>>0*6&63)}var g=m.length-s;if(g>0){var l=m[s]<<16|(g===2?m[s+1]<<8:0);r+=this._encodeByte(l>>>3*6&63),r+=this._encodeByte(l>>>2*6&63),g===2?r+=this._encodeByte(l>>>1*6&63):r+=this._paddingCharacter||"",r+=this._paddingCharacter||""}return r},c.prototype.maxDecodedLength=function(m){return this._paddingCharacter?m/4*3|0:(m*6+7)/8|0},c.prototype.decodedLength=function(m){return this.maxDecodedLength(m.length-this._getPaddingLength(m))},c.prototype.decode=function(m){if(m.length===0)return new Uint8Array(0);for(var r=this._getPaddingLength(m),s=m.length-r,l=new Uint8Array(this.maxDecodedLength(s)),g=0,T=0,D=0,P=0,N=0,B=0,z=0;T<s-4;T+=4)P=this._decodeChar(m.charCodeAt(T+0)),N=this._decodeChar(m.charCodeAt(T+1)),B=this._decodeChar(m.charCodeAt(T+2)),z=this._decodeChar(m.charCodeAt(T+3)),l[g++]=P<<2|N>>>4,l[g++]=N<<4|B>>>2,l[g++]=B<<6|z,D|=P&a,D|=N&a,D|=B&a,D|=z&a;if(T<s-1&&(P=this._decodeChar(m.charCodeAt(T)),N=this._decodeChar(m.charCodeAt(T+1)),l[g++]=P<<2|N>>>4,D|=P&a,D|=N&a),T<s-2&&(B=this._decodeChar(m.charCodeAt(T+2)),l[g++]=N<<4|B>>>2,D|=B&a),T<s-3&&(z=this._decodeChar(m.charCodeAt(T+3)),l[g++]=B<<6|z,D|=z&a),D!==0)throw new Error("Base64Coder: incorrect characters for decoding");return l},c.prototype._encodeByte=function(m){var r=m;return r+=65,r+=25-m>>>8&6,r+=51-m>>>8&-75,r+=61-m>>>8&-15,r+=62-m>>>8&3,String.fromCharCode(r)},c.prototype._decodeChar=function(m){var r=a;return r+=(42-m&m-44)>>>8&-a+m-43+62,r+=(46-m&m-48)>>>8&-a+m-47+63,r+=(47-m&m-58)>>>8&-a+m-48+52,r+=(64-m&m-91)>>>8&-a+m-65+0,r+=(96-m&m-123)>>>8&-a+m-97+26,r},c.prototype._getPaddingLength=function(m){var r=0;if(this._paddingCharacter){for(var s=m.length-1;s>=0&&m[s]===this._paddingCharacter;s--)r++;if(m.length<4||r>2)throw new Error("Base64Coder: incorrect padding")}return r},c}();$.Coder=d;var n=new d;function f(c){return n.encode(c)}$.encode=f;function h(c){return n.decode(c)}$.decode=h;var o=function(c){p(m,c);function m(){return c!==null&&c.apply(this,arguments)||this}return m.prototype._encodeByte=function(r){var s=r;return s+=65,s+=25-r>>>8&6,s+=51-r>>>8&-75,s+=61-r>>>8&-13,s+=62-r>>>8&49,String.fromCharCode(s)},m.prototype._decodeChar=function(r){var s=a;return s+=(44-r&r-46)>>>8&-a+r-45+62,s+=(94-r&r-96)>>>8&-a+r-95+63,s+=(47-r&r-58)>>>8&-a+r-48+52,s+=(64-r&r-91)>>>8&-a+r-65+0,s+=(96-r&r-123)>>>8&-a+r-97+26,s},m}(d);$.URLSafeCoder=o;var C=new o;function S(c){return C.encode(c)}$.encodeURLSafe=S;function b(c){return C.decode(c)}$.decodeURLSafe=b,$.encodedLength=function(c){return n.encodedLength(c)},$.maxDecodedLength=function(c){return n.maxDecodedLength(c)},$.decodedLength=function(c){return n.decodedLength(c)}},function(W,$,O){Object.defineProperty($,"__esModule",{value:!0});var p="utf8: invalid string",a="utf8: invalid source encoding";function d(h){for(var o=new Uint8Array(n(h)),C=0,S=0;S<h.length;S++){var b=h.charCodeAt(S);b<128?o[C++]=b:b<2048?(o[C++]=192|b>>6,o[C++]=128|b&63):b<55296?(o[C++]=224|b>>12,o[C++]=128|b>>6&63,o[C++]=128|b&63):(S++,b=(b&1023)<<10,b|=h.charCodeAt(S)&1023,b+=65536,o[C++]=240|b>>18,o[C++]=128|b>>12&63,o[C++]=128|b>>6&63,o[C++]=128|b&63)}return o}$.encode=d;function n(h){for(var o=0,C=0;C<h.length;C++){var S=h.charCodeAt(C);if(S<128)o+=1;else if(S<2048)o+=2;else if(S<55296)o+=3;else if(S<=57343){if(C>=h.length-1)throw new Error(p);C++,o+=4}else throw new Error(p)}return o}$.encodedLength=n;function f(h){for(var o=[],C=0;C<h.length;C++){var S=h[C];if(S&128){var b=void 0;if(S<224){if(C>=h.length)throw new Error(a);var c=h[++C];if((c&192)!==128)throw new Error(a);S=(S&31)<<6|c&63,b=128}else if(S<240){if(C>=h.length-1)throw new Error(a);var c=h[++C],m=h[++C];if((c&192)!==128||(m&192)!==128)throw new Error(a);S=(S&15)<<12|(c&63)<<6|m&63,b=2048}else if(S<248){if(C>=h.length-2)throw new Error(a);var c=h[++C],m=h[++C],r=h[++C];if((c&192)!==128||(m&192)!==128||(r&192)!==128)throw new Error(a);S=(S&15)<<18|(c&63)<<12|(m&63)<<6|r&63,b=65536}else throw new Error(a);if(S<b||S>=55296&&S<=57343)throw new Error(a);if(S>=65536){if(S>1114111)throw new Error(a);S-=65536,o.push(String.fromCharCode(55296|S>>10)),S=56320|S&1023}}o.push(String.fromCharCode(S))}return o.join("")}$.decode=f},function(W,$,O){W.exports=O(3).default},function(W,$,O){O.r($);class p{constructor(e,t){this.lastId=0,this.prefix=e,this.name=t}create(e){this.lastId++;var t=this.lastId,u=this.prefix+t,v=this.name+"["+t+"]",E=!1,F=function(){E||(e.apply(null,arguments),E=!0)};return this[t]=F,{number:t,id:u,name:v,callback:F}}remove(e){delete this[e.number]}}var a=new p("_pusher_script_","Pusher.ScriptReceivers"),d={VERSION:"8.4.0-rc2",PROTOCOL:7,wsPort:80,wssPort:443,wsPath:"",httpHost:"sockjs.pusher.com",httpPort:80,httpsPort:443,httpPath:"/pusher",stats_host:"stats.pusher.com",authEndpoint:"/pusher/auth",authTransport:"ajax",activityTimeout:12e4,pongTimeout:3e4,unavailableTimeout:1e4,userAuthentication:{endpoint:"/pusher/user-auth",transport:"ajax"},channelAuthorization:{endpoint:"/pusher/auth",transport:"ajax"},cdn_http:"http://js.pusher.com",cdn_https:"https://js.pusher.com",dependency_suffix:""},n=d;class f{constructor(e){this.options=e,this.receivers=e.receivers||a,this.loading={}}load(e,t,u){var v=this;if(v.loading[e]&&v.loading[e].length>0)v.loading[e].push(u);else{v.loading[e]=[u];var E=re.createScriptRequest(v.getPath(e,t)),F=v.receivers.create(function(V){if(v.receivers.remove(F),v.loading[e]){var te=v.loading[e];delete v.loading[e];for(var le=function(Re){Re||E.cleanup()},ve=0;ve<te.length;ve++)te[ve](V,le)}});E.send(F)}}getRoot(e){var t,u=re.getDocument().location.protocol;return e&&e.useTLS||u==="https:"?t=this.options.cdn_https:t=this.options.cdn_http,t.replace(/\/*$/,"")+"/"+this.options.version}getPath(e,t){return this.getRoot(t)+"/"+e+this.options.suffix+".js"}}var h=new p("_pusher_dependencies","Pusher.DependenciesReceivers"),o=new f({cdn_http:n.cdn_http,cdn_https:n.cdn_https,version:n.VERSION,suffix:n.dependency_suffix,receivers:h});const C={baseUrl:"https://pusher.com",urls:{authenticationEndpoint:{path:"/docs/channels/server_api/authenticating_users"},authorizationEndpoint:{path:"/docs/channels/server_api/authorizing-users/"},javascriptQuickStart:{path:"/docs/javascript_quick_start"},triggeringClientEvents:{path:"/docs/client_api_guide/client_events#trigger-events"},encryptedChannelSupport:{fullUrl:"https://github.com/pusher/pusher-js/tree/cc491015371a4bde5743d1c87a0fbac0feb53195#encrypted-channel-support"}}};var b={buildLogSuffix:function(i){const e="See:",t=C.urls[i];if(!t)return"";let u;return t.fullUrl?u=t.fullUrl:t.path&&(u=C.baseUrl+t.path),u?`${e} ${u}`:""}},c;(function(i){i.UserAuthentication="user-authentication",i.ChannelAuthorization="channel-authorization"})(c||(c={}));class m extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}class r extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}class s extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}class l extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}class g extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}class T extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}class D extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}class P extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}class N extends Error{constructor(e,t){super(t),this.status=e,Object.setPrototypeOf(this,new.target.prototype)}}var z=function(i,e,t,u,v){const E=re.createXHR();E.open("POST",t.endpoint,!0),E.setRequestHeader("Content-Type","application/x-www-form-urlencoded");for(var F in t.headers)E.setRequestHeader(F,t.headers[F]);if(t.headersProvider!=null){let V=t.headersProvider();for(var F in V)E.setRequestHeader(F,V[F])}return E.onreadystatechange=function(){if(E.readyState===4)if(E.status===200){let V,te=!1;try{V=JSON.parse(E.responseText),te=!0}catch{v(new N(200,`JSON returned from ${u.toString()} endpoint was invalid, yet status code was 200. Data was: ${E.responseText}`),null)}te&&v(null,V)}else{let V="";switch(u){case c.UserAuthentication:V=b.buildLogSuffix("authenticationEndpoint");break;case c.ChannelAuthorization:V=`Clients must be authorized to join private or presence channels. ${b.buildLogSuffix("authorizationEndpoint")}`;break}v(new N(E.status,`Unable to retrieve auth string from ${u.toString()} endpoint - received status: ${E.status} from ${t.endpoint}. ${V}`),null)}},E.send(e),E};function H(i){return J(A(i))}var U=String.fromCharCode,Q="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",se=function(i){var e=i.charCodeAt(0);return e<128?i:e<2048?U(192|e>>>6)+U(128|e&63):U(224|e>>>12&15)+U(128|e>>>6&63)+U(128|e&63)},A=function(i){return i.replace(/[^\x00-\x7F]/g,se)},I=function(i){var e=[0,2,1][i.length%3],t=i.charCodeAt(0)<<16|(i.length>1?i.charCodeAt(1):0)<<8|(i.length>2?i.charCodeAt(2):0),u=[Q.charAt(t>>>18),Q.charAt(t>>>12&63),e>=2?"=":Q.charAt(t>>>6&63),e>=1?"=":Q.charAt(t&63)];return u.join("")},J=window.btoa||function(i){return i.replace(/[\s\S]{1,3}/g,I)};class ie{constructor(e,t,u,v){this.clear=t,this.timer=e(()=>{this.timer&&(this.timer=v(this.timer))},u)}isRunning(){return this.timer!==null}ensureAborted(){this.timer&&(this.clear(this.timer),this.timer=null)}}var j=ie;function me(i){window.clearTimeout(i)}function Ee(i){window.clearInterval(i)}class Te extends j{constructor(e,t){super(setTimeout,me,e,function(u){return t(),null})}}class ke extends j{constructor(e,t){super(setInterval,Ee,e,function(u){return t(),u})}}var X={now(){return Date.now?Date.now():new Date().valueOf()},defer(i){return new Te(0,i)},method(i,...e){var t=Array.prototype.slice.call(arguments,1);return function(u){return u[i].apply(u,t.concat(arguments))}}},Z=X;function de(i,...e){for(var t=0;t<e.length;t++){var u=e[t];for(var v in u)u[v]&&u[v].constructor&&u[v].constructor===Object?i[v]=de(i[v]||{},u[v]):i[v]=u[v]}return i}function pe(){for(var i=["Pusher"],e=0;e<arguments.length;e++)typeof arguments[e]=="string"?i.push(arguments[e]):i.push(Ye(arguments[e]));return i.join(" : ")}function Ie(i,e){var t=Array.prototype.indexOf;if(i===null)return-1;if(t&&i.indexOf===t)return i.indexOf(e);for(var u=0,v=i.length;u<v;u++)if(i[u]===e)return u;return-1}function be(i,e){for(var t in i)Object.prototype.hasOwnProperty.call(i,t)&&e(i[t],t,i)}function _e(i){var e=[];return be(i,function(t,u){e.push(u)}),e}function Le(i){var e=[];return be(i,function(t){e.push(t)}),e}function He(i,e,t){for(var u=0;u<i.length;u++)e.call(t||window,i[u],u,i)}function Ge(i,e){for(var t=[],u=0;u<i.length;u++)t.push(e(i[u],u,i,t));return t}function Be(i,e){var t={};return be(i,function(u,v){t[v]=e(u)}),t}function oe(i,e){e=e||function(v){return!!v};for(var t=[],u=0;u<i.length;u++)e(i[u],u,i,t)&&t.push(i[u]);return t}function ye(i,e){var t={};return be(i,function(u,v){(e&&e(u,v,i,t)||u)&&(t[v]=u)}),t}function $e(i){var e=[];return be(i,function(t,u){e.push([u,t])}),e}function Ne(i,e){for(var t=0;t<i.length;t++)if(e(i[t],t,i))return!0;return!1}function Ue(i,e){for(var t=0;t<i.length;t++)if(!e(i[t],t,i))return!1;return!0}function qe(i){return Be(i,function(e){return typeof e=="object"&&(e=Ye(e)),encodeURIComponent(H(e.toString()))})}function Fe(i){var e=ye(i,function(u){return u!==void 0}),t=Ge($e(qe(e)),Z.method("join","=")).join("&");return t}function Je(i){var e=[],t=[];return function u(v,E){var F,V,te;switch(typeof v){case"object":if(!v)return null;for(F=0;F<e.length;F+=1)if(e[F]===v)return{$ref:t[F]};if(e.push(v),t.push(E),Object.prototype.toString.apply(v)==="[object Array]")for(te=[],F=0;F<v.length;F+=1)te[F]=u(v[F],E+"["+F+"]");else{te={};for(V in v)Object.prototype.hasOwnProperty.call(v,V)&&(te[V]=u(v[V],E+"["+JSON.stringify(V)+"]"))}return te;case"number":case"string":case"boolean":return v}}(i,"$")}function Ye(i){try{return JSON.stringify(i)}catch{return JSON.stringify(Je(i))}}class lt{constructor(){this.globalLog=e=>{window.console&&window.console.log&&window.console.log(e)}}debug(...e){this.log(this.globalLog,e)}warn(...e){this.log(this.globalLogWarn,e)}error(...e){this.log(this.globalLogError,e)}globalLogWarn(e){window.console&&window.console.warn?window.console.warn(e):this.globalLog(e)}globalLogError(e){window.console&&window.console.error?window.console.error(e):this.globalLogWarn(e)}log(e,...t){var u=pe.apply(this,arguments);Tt.log?Tt.log(u):Tt.logToConsole&&e.bind(this)(u)}}var ge=new lt,dt=function(i,e,t,u,v){(t.headers!==void 0||t.headersProvider!=null)&&ge.warn(`To send headers with the ${u.toString()} request, you must use AJAX, rather than JSONP.`);var E=i.nextAuthCallbackID.toString();i.nextAuthCallbackID++;var F=i.getDocument(),V=F.createElement("script");i.auth_callbacks[E]=function(ve){v(null,ve)};var te="Pusher.auth_callbacks['"+E+"']";V.src=t.endpoint+"?callback="+encodeURIComponent(te)+"&"+e;var le=F.getElementsByTagName("head")[0]||F.documentElement;le.insertBefore(V,le.firstChild)},nt=dt;class ut{constructor(e){this.src=e}send(e){var t=this,u="Error loading "+t.src;t.script=document.createElement("script"),t.script.id=e.id,t.script.src=t.src,t.script.type="text/javascript",t.script.charset="UTF-8",t.script.addEventListener?(t.script.onerror=function(){e.callback(u)},t.script.onload=function(){e.callback(null)}):t.script.onreadystatechange=function(){(t.script.readyState==="loaded"||t.script.readyState==="complete")&&e.callback(null)},t.script.async===void 0&&document.attachEvent&&/opera/i.test(navigator.userAgent)?(t.errorScript=document.createElement("script"),t.errorScript.id=e.id+"_error",t.errorScript.text=e.name+"('"+u+"');",t.script.async=t.errorScript.async=!1):t.script.async=!0;var v=document.getElementsByTagName("head")[0];v.insertBefore(t.script,v.firstChild),t.errorScript&&v.insertBefore(t.errorScript,t.script.nextSibling)}cleanup(){this.script&&(this.script.onload=this.script.onerror=null,this.script.onreadystatechange=null),this.script&&this.script.parentNode&&this.script.parentNode.removeChild(this.script),this.errorScript&&this.errorScript.parentNode&&this.errorScript.parentNode.removeChild(this.errorScript),this.script=null,this.errorScript=null}}class pt{constructor(e,t){this.url=e,this.data=t}send(e){if(!this.request){var t=Fe(this.data),u=this.url+"/"+e.number+"?"+t;this.request=re.createScriptRequest(u),this.request.send(e)}}cleanup(){this.request&&this.request.cleanup()}}var ht=function(i,e){return function(t,u){var v="http"+(e?"s":"")+"://",E=v+(i.host||i.options.host)+i.options.path,F=re.createJSONPRequest(E,t),V=re.ScriptReceivers.create(function(te,le){a.remove(V),F.cleanup(),le&&le.host&&(i.host=le.host),u&&u(te,le)});F.send(V)}},y={name:"jsonp",getAgent:ht},k=y;function w(i,e,t){var u=i+(e.useTLS?"s":""),v=e.useTLS?e.hostTLS:e.hostNonTLS;return u+"://"+v+t}function _(i,e){var t="/app/"+i,u="?protocol="+n.PROTOCOL+"&client=js&version="+n.VERSION+(e?"&"+e:"");return t+u}var R={getInitial:function(i,e){var t=(e.httpPath||"")+_(i,"flash=false");return w("ws",e,t)}},Y={getInitial:function(i,e){var t=(e.httpPath||"/pusher")+_(i);return w("http",e,t)}},ae={getInitial:function(i,e){return w("http",e,e.httpPath||"/pusher")},getPath:function(i,e){return _(i)}};class he{constructor(){this._callbacks={}}get(e){return this._callbacks[ee(e)]}add(e,t,u){var v=ee(e);this._callbacks[v]=this._callbacks[v]||[],this._callbacks[v].push({fn:t,context:u})}remove(e,t,u){if(!e&&!t&&!u){this._callbacks={};return}var v=e?[ee(e)]:_e(this._callbacks);t||u?this.removeCallback(v,t,u):this.removeAllCallbacks(v)}removeCallback(e,t,u){He(e,function(v){this._callbacks[v]=oe(this._callbacks[v]||[],function(E){return t&&t!==E.fn||u&&u!==E.context}),this._callbacks[v].length===0&&delete this._callbacks[v]},this)}removeAllCallbacks(e){He(e,function(t){delete this._callbacks[t]},this)}}function ee(i){return"_"+i}class ue{constructor(e){this.callbacks=new he,this.global_callbacks=[],this.failThrough=e}bind(e,t,u){return this.callbacks.add(e,t,u),this}bind_global(e){return this.global_callbacks.push(e),this}unbind(e,t,u){return this.callbacks.remove(e,t,u),this}unbind_global(e){return e?(this.global_callbacks=oe(this.global_callbacks||[],t=>t!==e),this):(this.global_callbacks=[],this)}unbind_all(){return this.unbind(),this.unbind_global(),this}emit(e,t,u){for(var v=0;v<this.global_callbacks.length;v++)this.global_callbacks[v](e,t);var E=this.callbacks.get(e),F=[];if(u?F.push(t,u):t&&F.push(t),E&&E.length>0)for(var v=0;v<E.length;v++)E[v].fn.apply(E[v].context||window,F);else this.failThrough&&this.failThrough(e,t);return this}}class fe extends ue{constructor(e,t,u,v,E){super(),this.initialize=re.transportConnectionInitializer,this.hooks=e,this.name=t,this.priority=u,this.key=v,this.options=E,this.state="new",this.timeline=E.timeline,this.activityTimeout=E.activityTimeout,this.id=this.timeline.generateUniqueID()}handlesActivityChecks(){return!!this.hooks.handlesActivityChecks}supportsPing(){return!!this.hooks.supportsPing}connect(){if(this.socket||this.state!=="initialized")return!1;var e=this.hooks.urls.getInitial(this.key,this.options);try{this.socket=this.hooks.getSocket(e,this.options)}catch(t){return Z.defer(()=>{this.onError(t),this.changeState("closed")}),!1}return this.bindListeners(),ge.debug("Connecting",{transport:this.name,url:e}),this.changeState("connecting"),!0}close(){return this.socket?(this.socket.close(),!0):!1}send(e){return this.state==="open"?(Z.defer(()=>{this.socket&&this.socket.send(e)}),!0):!1}ping(){this.state==="open"&&this.supportsPing()&&this.socket.ping()}onOpen(){this.hooks.beforeOpen&&this.hooks.beforeOpen(this.socket,this.hooks.urls.getPath(this.key,this.options)),this.changeState("open"),this.socket.onopen=void 0}onError(e){this.emit("error",{type:"WebSocketError",error:e}),this.timeline.error(this.buildTimelineMessage({error:e.toString()}))}onClose(e){e?this.changeState("closed",{code:e.code,reason:e.reason,wasClean:e.wasClean}):this.changeState("closed"),this.unbindListeners(),this.socket=void 0}onMessage(e){this.emit("message",e)}onActivity(){this.emit("activity")}bindListeners(){this.socket.onopen=()=>{this.onOpen()},this.socket.onerror=e=>{this.onError(e)},this.socket.onclose=e=>{this.onClose(e)},this.socket.onmessage=e=>{this.onMessage(e)},this.supportsPing()&&(this.socket.onactivity=()=>{this.onActivity()})}unbindListeners(){this.socket&&(this.socket.onopen=void 0,this.socket.onerror=void 0,this.socket.onclose=void 0,this.socket.onmessage=void 0,this.supportsPing()&&(this.socket.onactivity=void 0))}changeState(e,t){this.state=e,this.timeline.info(this.buildTimelineMessage({state:e,params:t})),this.emit(e,t)}buildTimelineMessage(e){return de({cid:this.id},e)}}class ce{constructor(e){this.hooks=e}isSupported(e){return this.hooks.isSupported(e)}createConnection(e,t,u,v){return new fe(this.hooks,e,t,u,v)}}var ne=new ce({urls:R,handlesActivityChecks:!1,supportsPing:!1,isInitialized:function(){return!!re.getWebSocketAPI()},isSupported:function(){return!!re.getWebSocketAPI()},getSocket:function(i){return re.createWebSocket(i)}}),Pe={urls:Y,handlesActivityChecks:!1,supportsPing:!0,isInitialized:function(){return!0}},Se=de({getSocket:function(i){return re.HTTPFactory.createStreamingSocket(i)}},Pe),xe=de({getSocket:function(i){return re.HTTPFactory.createPollingSocket(i)}},Pe),ze={isSupported:function(){return re.isXHRSupported()}},Me=new ce(de({},Se,ze)),We=new ce(de({},xe,ze)),ft={ws:ne,xhr_streaming:Me,xhr_polling:We},rt=ft,$t=new ce({file:"sockjs",urls:ae,handlesActivityChecks:!0,supportsPing:!1,isSupported:function(){return!0},isInitialized:function(){return window.SockJS!==void 0},getSocket:function(i,e){return new window.SockJS(i,null,{js_path:o.getPath("sockjs",{useTLS:e.useTLS}),ignore_null_origin:e.ignoreNullOrigin})},beforeOpen:function(i,e){i.send(JSON.stringify({path:e}))}}),_t={isSupported:function(i){var e=re.isXDRSupported(i.useTLS);return e}},Wt=new ce(de({},Se,_t)),Xt=new ce(de({},xe,_t));rt.xdr_streaming=Wt,rt.xdr_polling=Xt,rt.sockjs=$t;var Kt=rt;class Qt extends ue{constructor(){super();var e=this;window.addEventListener!==void 0&&(window.addEventListener("online",function(){e.emit("online")},!1),window.addEventListener("offline",function(){e.emit("offline")},!1))}isOnline(){return window.navigator.onLine===void 0?!0:window.navigator.onLine}}var Yt=new Qt;class Zt{constructor(e,t,u){this.manager=e,this.transport=t,this.minPingDelay=u.minPingDelay,this.maxPingDelay=u.maxPingDelay,this.pingDelay=void 0}createConnection(e,t,u,v){v=de({},v,{activityTimeout:this.pingDelay});var E=this.transport.createConnection(e,t,u,v),F=null,V=function(){E.unbind("open",V),E.bind("closed",te),F=Z.now()},te=le=>{if(E.unbind("closed",te),le.code===1002||le.code===1003)this.manager.reportDeath();else if(!le.wasClean&&F){var ve=Z.now()-F;ve<2*this.maxPingDelay&&(this.manager.reportDeath(),this.pingDelay=Math.max(ve/2,this.minPingDelay))}};return E.bind("open",V),E}isSupported(e){return this.manager.isAlive()&&this.transport.isSupported(e)}}const Pt={decodeMessage:function(i){try{var e=JSON.parse(i.data),t=e.data;if(typeof t=="string")try{t=JSON.parse(e.data)}catch{}var u={event:e.event,channel:e.channel,data:t};return e.user_id&&(u.user_id=e.user_id),u}catch(v){throw{type:"MessageParseError",error:v,data:i.data}}},encodeMessage:function(i){return JSON.stringify(i)},processHandshake:function(i){var e=Pt.decodeMessage(i);if(e.event==="pusher:connection_established"){if(!e.data.activity_timeout)throw"No activity timeout specified in handshake";return{action:"connected",id:e.data.socket_id,activityTimeout:e.data.activity_timeout*1e3}}else{if(e.event==="pusher:error")return{action:this.getCloseAction(e.data),error:this.getCloseError(e.data)};throw"Invalid handshake"}},getCloseAction:function(i){return i.code<4e3?i.code>=1002&&i.code<=1004?"backoff":null:i.code===4e3?"tls_only":i.code<4100?"refused":i.code<4200?"backoff":i.code<4300?"retry":"refused"},getCloseError:function(i){return i.code!==1e3&&i.code!==1001?{type:"PusherError",data:{code:i.code,message:i.reason||i.message}}:null}};var Xe=Pt;class en extends ue{constructor(e,t){super(),this.id=e,this.transport=t,this.activityTimeout=t.activityTimeout,this.bindListeners()}handlesActivityChecks(){return this.transport.handlesActivityChecks()}send(e){return this.transport.send(e)}send_event(e,t,u){var v={event:e,data:t};return u&&(v.channel=u),ge.debug("Event sent",v),this.send(Xe.encodeMessage(v))}ping(){this.transport.supportsPing()?this.transport.ping():this.send_event("pusher:ping",{})}close(){this.transport.close()}bindListeners(){var e={message:u=>{var v;try{v=Xe.decodeMessage(u)}catch(E){this.emit("error",{type:"MessageParseError",error:E,data:u.data})}if(v!==void 0){switch(ge.debug("Event recd",v),v.event){case"pusher:error":this.emit("error",{type:"PusherError",data:v.data});break;case"pusher:ping":this.emit("ping");break;case"pusher:pong":this.emit("pong");break}this.emit("message",v)}},activity:()=>{this.emit("activity")},error:u=>{this.emit("error",u)},closed:u=>{t(),u&&u.code&&this.handleCloseEvent(u),this.transport=null,this.emit("closed")}},t=()=>{be(e,(u,v)=>{this.transport.unbind(v,u)})};be(e,(u,v)=>{this.transport.bind(v,u)})}handleCloseEvent(e){var t=Xe.getCloseAction(e),u=Xe.getCloseError(e);u&&this.emit("error",u),t&&this.emit(t,{action:t,error:u})}}class tn{constructor(e,t){this.transport=e,this.callback=t,this.bindListeners()}close(){this.unbindListeners(),this.transport.close()}bindListeners(){this.onMessage=e=>{this.unbindListeners();var t;try{t=Xe.processHandshake(e)}catch(u){this.finish("error",{error:u}),this.transport.close();return}t.action==="connected"?this.finish("connected",{connection:new en(t.id,this.transport),activityTimeout:t.activityTimeout}):(this.finish(t.action,{error:t.error}),this.transport.close())},this.onClosed=e=>{this.unbindListeners();var t=Xe.getCloseAction(e)||"backoff",u=Xe.getCloseError(e);this.finish(t,{error:u})},this.transport.bind("message",this.onMessage),this.transport.bind("closed",this.onClosed)}unbindListeners(){this.transport.unbind("message",this.onMessage),this.transport.unbind("closed",this.onClosed)}finish(e,t){this.callback(de({transport:this.transport,action:e},t))}}class nn{constructor(e,t){this.timeline=e,this.options=t||{}}send(e,t){this.timeline.isEmpty()||this.timeline.send(re.TimelineTransport.getAgent(this,e),t)}}class mt extends ue{constructor(e,t){super(function(u,v){ge.debug("No callbacks on "+e+" for "+u)}),this.name=e,this.pusher=t,this.subscribed=!1,this.subscriptionPending=!1,this.subscriptionCancelled=!1}authorize(e,t){return t(null,{auth:""})}trigger(e,t){if(e.indexOf("client-")!==0)throw new m("Event '"+e+"' does not start with 'client-'");if(!this.subscribed){var u=b.buildLogSuffix("triggeringClientEvents");ge.warn(`Client event triggered before channel 'subscription_succeeded' event . ${u}`)}return this.pusher.send_event(e,t,this.name)}disconnect(){this.subscribed=!1,this.subscriptionPending=!1}handleEvent(e){var t=e.event,u=e.data;if(t==="pusher_internal:subscription_succeeded")this.handleSubscriptionSucceededEvent(e);else if(t==="pusher_internal:subscription_count")this.handleSubscriptionCountEvent(e);else if(t.indexOf("pusher_internal:")!==0){var v={};this.emit(t,u,v)}}handleSubscriptionSucceededEvent(e){this.subscriptionPending=!1,this.subscribed=!0,this.subscriptionCancelled?this.pusher.unsubscribe(this.name):this.emit("pusher:subscription_succeeded",e.data)}handleSubscriptionCountEvent(e){e.data.subscription_count&&(this.subscriptionCount=e.data.subscription_count),this.emit("pusher:subscription_count",e.data)}subscribe(){this.subscribed||(this.subscriptionPending=!0,this.subscriptionCancelled=!1,this.authorize(this.pusher.connection.socket_id,(e,t)=>{e?(this.subscriptionPending=!1,ge.error(e.toString()),this.emit("pusher:subscription_error",Object.assign({},{type:"AuthError",error:e.message},e instanceof N?{status:e.status}:{}))):this.pusher.send_event("pusher:subscribe",{auth:t.auth,channel_data:t.channel_data,channel:this.name})}))}unsubscribe(){this.subscribed=!1,this.pusher.send_event("pusher:unsubscribe",{channel:this.name})}cancelSubscription(){this.subscriptionCancelled=!0}reinstateSubscription(){this.subscriptionCancelled=!1}}class vt extends mt{authorize(e,t){return this.pusher.config.channelAuthorizer({channelName:this.name,socketId:e},t)}}class rn{constructor(){this.reset()}get(e){return Object.prototype.hasOwnProperty.call(this.members,e)?{id:e,info:this.members[e]}:null}each(e){be(this.members,(t,u)=>{e(this.get(u))})}setMyID(e){this.myID=e}onSubscription(e){this.members=e.presence.hash,this.count=e.presence.count,this.me=this.get(this.myID)}addMember(e){return this.get(e.user_id)===null&&this.count++,this.members[e.user_id]=e.user_info,this.get(e.user_id)}removeMember(e){var t=this.get(e.user_id);return t&&(delete this.members[e.user_id],this.count--),t}reset(){this.members={},this.count=0,this.myID=null,this.me=null}}var an=function(i,e,t,u){function v(E){return E instanceof t?E:new t(function(F){F(E)})}return new(t||(t=Promise))(function(E,F){function V(ve){try{le(u.next(ve))}catch(Re){F(Re)}}function te(ve){try{le(u.throw(ve))}catch(Re){F(Re)}}function le(ve){ve.done?E(ve.value):v(ve.value).then(V,te)}le((u=u.apply(i,e||[])).next())})};class on extends vt{constructor(e,t){super(e,t),this.members=new rn}authorize(e,t){super.authorize(e,(u,v)=>an(this,void 0,void 0,function*(){if(!u)if(v=v,v.channel_data!=null){var E=JSON.parse(v.channel_data);this.members.setMyID(E.user_id)}else if(yield this.pusher.user.signinDonePromise,this.pusher.user.user_data!=null)this.members.setMyID(this.pusher.user.user_data.id);else{let F=b.buildLogSuffix("authorizationEndpoint");ge.error(`Invalid auth response for channel '${this.name}', expected 'channel_data' field. ${F}, or the user should be signed in.`),t("Invalid auth response");return}t(u,v)}))}handleEvent(e){var t=e.event;if(t.indexOf("pusher_internal:")===0)this.handleInternalEvent(e);else{var u=e.data,v={};e.user_id&&(v.user_id=e.user_id),this.emit(t,u,v)}}handleInternalEvent(e){var t=e.event,u=e.data;switch(t){case"pusher_internal:subscription_succeeded":this.handleSubscriptionSucceededEvent(e);break;case"pusher_internal:subscription_count":this.handleSubscriptionCountEvent(e);break;case"pusher_internal:member_added":var v=this.members.addMember(u);this.emit("pusher:member_added",v);break;case"pusher_internal:member_removed":var E=this.members.removeMember(u);E&&this.emit("pusher:member_removed",E);break}}handleSubscriptionSucceededEvent(e){this.subscriptionPending=!1,this.subscribed=!0,this.subscriptionCancelled?this.pusher.unsubscribe(this.name):(this.members.onSubscription(e.data),this.emit("pusher:subscription_succeeded",this.members))}disconnect(){this.members.reset(),super.disconnect()}}var sn=O(1),gt=O(0);class cn extends vt{constructor(e,t,u){super(e,t),this.key=null,this.nacl=u}authorize(e,t){super.authorize(e,(u,v)=>{if(u){t(u,v);return}let E=v.shared_secret;if(!E){t(new Error(`No shared_secret key in auth payload for encrypted channel: ${this.name}`),null);return}this.key=Object(gt.decode)(E),delete v.shared_secret,t(null,v)})}trigger(e,t){throw new T("Client events are not currently supported for encrypted channels")}handleEvent(e){var t=e.event,u=e.data;if(t.indexOf("pusher_internal:")===0||t.indexOf("pusher:")===0){super.handleEvent(e);return}this.handleEncryptedEvent(t,u)}handleEncryptedEvent(e,t){if(!this.key){ge.debug("Received encrypted event before key has been retrieved from the authEndpoint");return}if(!t.ciphertext||!t.nonce){ge.error("Unexpected format for encrypted event, expected object with `ciphertext` and `nonce` fields, got: "+t);return}let u=Object(gt.decode)(t.ciphertext);if(u.length<this.nacl.secretbox.overheadLength){ge.error(`Expected encrypted event ciphertext length to be ${this.nacl.secretbox.overheadLength}, got: ${u.length}`);return}let v=Object(gt.decode)(t.nonce);if(v.length<this.nacl.secretbox.nonceLength){ge.error(`Expected encrypted event nonce length to be ${this.nacl.secretbox.nonceLength}, got: ${v.length}`);return}let E=this.nacl.secretbox.open(u,v,this.key);if(E===null){ge.debug("Failed to decrypt an event, probably because it was encrypted with a different key. Fetching a new key from the authEndpoint..."),this.authorize(this.pusher.connection.socket_id,(F,V)=>{if(F){ge.error(`Failed to make a request to the authEndpoint: ${V}. Unable to fetch new key, so dropping encrypted event`);return}if(E=this.nacl.secretbox.open(u,v,this.key),E===null){ge.error("Failed to decrypt event with new key. Dropping encrypted event");return}this.emit(e,this.getDataToEmit(E))});return}this.emit(e,this.getDataToEmit(E))}getDataToEmit(e){let t=Object(sn.decode)(e);try{return JSON.parse(t)}catch{return t}}}class ln extends ue{constructor(e,t){super(),this.state="initialized",this.connection=null,this.key=e,this.options=t,this.timeline=this.options.timeline,this.usingTLS=this.options.useTLS,this.errorCallbacks=this.buildErrorCallbacks(),this.connectionCallbacks=this.buildConnectionCallbacks(this.errorCallbacks),this.handshakeCallbacks=this.buildHandshakeCallbacks(this.errorCallbacks);var u=re.getNetwork();u.bind("online",()=>{this.timeline.info({netinfo:"online"}),(this.state==="connecting"||this.state==="unavailable")&&this.retryIn(0)}),u.bind("offline",()=>{this.timeline.info({netinfo:"offline"}),this.connection&&this.sendActivityCheck()}),this.updateStrategy()}switchCluster(e){this.key=e,this.updateStrategy(),this.retryIn(0)}connect(){if(!(this.connection||this.runner)){if(!this.strategy.isSupported()){this.updateState("failed");return}this.updateState("connecting"),this.startConnecting(),this.setUnavailableTimer()}}send(e){return this.connection?this.connection.send(e):!1}send_event(e,t,u){return this.connection?this.connection.send_event(e,t,u):!1}disconnect(){this.disconnectInternally(),this.updateState("disconnected")}isUsingTLS(){return this.usingTLS}startConnecting(){var e=(t,u)=>{t?this.runner=this.strategy.connect(0,e):u.action==="error"?(this.emit("error",{type:"HandshakeError",error:u.error}),this.timeline.error({handshakeError:u.error})):(this.abortConnecting(),this.handshakeCallbacks[u.action](u))};this.runner=this.strategy.connect(0,e)}abortConnecting(){this.runner&&(this.runner.abort(),this.runner=null)}disconnectInternally(){if(this.abortConnecting(),this.clearRetryTimer(),this.clearUnavailableTimer(),this.connection){var e=this.abandonConnection();e.close()}}updateStrategy(){this.strategy=this.options.getStrategy({key:this.key,timeline:this.timeline,useTLS:this.usingTLS})}retryIn(e){this.timeline.info({action:"retry",delay:e}),e>0&&this.emit("connecting_in",Math.round(e/1e3)),this.retryTimer=new Te(e||0,()=>{this.disconnectInternally(),this.connect()})}clearRetryTimer(){this.retryTimer&&(this.retryTimer.ensureAborted(),this.retryTimer=null)}setUnavailableTimer(){this.unavailableTimer=new Te(this.options.unavailableTimeout,()=>{this.updateState("unavailable")})}clearUnavailableTimer(){this.unavailableTimer&&this.unavailableTimer.ensureAborted()}sendActivityCheck(){this.stopActivityCheck(),this.connection.ping(),this.activityTimer=new Te(this.options.pongTimeout,()=>{this.timeline.error({pong_timed_out:this.options.pongTimeout}),this.retryIn(0)})}resetActivityCheck(){this.stopActivityCheck(),this.connection&&!this.connection.handlesActivityChecks()&&(this.activityTimer=new Te(this.activityTimeout,()=>{this.sendActivityCheck()}))}stopActivityCheck(){this.activityTimer&&this.activityTimer.ensureAborted()}buildConnectionCallbacks(e){return de({},e,{message:t=>{this.resetActivityCheck(),this.emit("message",t)},ping:()=>{this.send_event("pusher:pong",{})},activity:()=>{this.resetActivityCheck()},error:t=>{this.emit("error",t)},closed:()=>{this.abandonConnection(),this.shouldRetry()&&this.retryIn(1e3)}})}buildHandshakeCallbacks(e){return de({},e,{connected:t=>{this.activityTimeout=Math.min(this.options.activityTimeout,t.activityTimeout,t.connection.activityTimeout||1/0),this.clearUnavailableTimer(),this.setConnection(t.connection),this.socket_id=this.connection.id,this.updateState("connected",{socket_id:this.socket_id})}})}buildErrorCallbacks(){let e=t=>u=>{u.error&&this.emit("error",{type:"WebSocketError",error:u.error}),t(u)};return{tls_only:e(()=>{this.usingTLS=!0,this.updateStrategy(),this.retryIn(0)}),refused:e(()=>{this.disconnect()}),backoff:e(()=>{this.retryIn(1e3)}),retry:e(()=>{this.retryIn(0)})}}setConnection(e){this.connection=e;for(var t in this.connectionCallbacks)this.connection.bind(t,this.connectionCallbacks[t]);this.resetActivityCheck()}abandonConnection(){if(this.connection){this.stopActivityCheck();for(var e in this.connectionCallbacks)this.connection.unbind(e,this.connectionCallbacks[e]);var t=this.connection;return this.connection=null,t}}updateState(e,t){var u=this.state;if(this.state=e,u!==e){var v=e;v==="connected"&&(v+=" with new socket ID "+t.socket_id),ge.debug("State changed",u+" -> "+v),this.timeline.info({state:e,params:t}),this.emit("state_change",{previous:u,current:e}),this.emit(e,t)}}shouldRetry(){return this.state==="connecting"||this.state==="connected"}}class dn{constructor(){this.channels={}}add(e,t){return this.channels[e]||(this.channels[e]=un(e,t)),this.channels[e]}all(){return Le(this.channels)}find(e){return this.channels[e]}remove(e){var t=this.channels[e];return delete this.channels[e],t}disconnect(){be(this.channels,function(e){e.disconnect()})}}function un(i,e){if(i.indexOf("private-encrypted-")===0){if(e.config.nacl)return Ve.createEncryptedChannel(i,e,e.config.nacl);let t="Tried to subscribe to a private-encrypted- channel but no nacl implementation available",u=b.buildLogSuffix("encryptedChannelSupport");throw new T(`${t}. ${u}`)}else{if(i.indexOf("private-")===0)return Ve.createPrivateChannel(i,e);if(i.indexOf("presence-")===0)return Ve.createPresenceChannel(i,e);if(i.indexOf("#")===0)throw new r('Cannot create a channel with name "'+i+'".');return Ve.createChannel(i,e)}}var pn={createChannels(){return new dn},createConnectionManager(i,e){return new ln(i,e)},createChannel(i,e){return new mt(i,e)},createPrivateChannel(i,e){return new vt(i,e)},createPresenceChannel(i,e){return new on(i,e)},createEncryptedChannel(i,e,t){return new cn(i,e,t)},createTimelineSender(i,e){return new nn(i,e)},createHandshake(i,e){return new tn(i,e)},createAssistantToTheTransportManager(i,e,t){return new Zt(i,e,t)}},Ve=pn;class Rt{constructor(e){this.options=e||{},this.livesLeft=this.options.lives||1/0}getAssistant(e){return Ve.createAssistantToTheTransportManager(this,e,{minPingDelay:this.options.minPingDelay,maxPingDelay:this.options.maxPingDelay})}isAlive(){return this.livesLeft>0}reportDeath(){this.livesLeft-=1}}class Ke{constructor(e,t){this.strategies=e,this.loop=!!t.loop,this.failFast=!!t.failFast,this.timeout=t.timeout,this.timeoutLimit=t.timeoutLimit}isSupported(){return Ne(this.strategies,Z.method("isSupported"))}connect(e,t){var u=this.strategies,v=0,E=this.timeout,F=null,V=(te,le)=>{le?t(null,le):(v=v+1,this.loop&&(v=v%u.length),v<u.length?(E&&(E=E*2,this.timeoutLimit&&(E=Math.min(E,this.timeoutLimit))),F=this.tryStrategy(u[v],e,{timeout:E,failFast:this.failFast},V)):t(!0))};return F=this.tryStrategy(u[v],e,{timeout:E,failFast:this.failFast},V),{abort:function(){F.abort()},forceMinPriority:function(te){e=te,F&&F.forceMinPriority(te)}}}tryStrategy(e,t,u,v){var E=null,F=null;return u.timeout>0&&(E=new Te(u.timeout,function(){F.abort(),v(!0)})),F=e.connect(t,function(V,te){V&&E&&E.isRunning()&&!u.failFast||(E&&E.ensureAborted(),v(V,te))}),{abort:function(){E&&E.ensureAborted(),F.abort()},forceMinPriority:function(V){F.forceMinPriority(V)}}}}class yt{constructor(e){this.strategies=e}isSupported(){return Ne(this.strategies,Z.method("isSupported"))}connect(e,t){return hn(this.strategies,e,function(u,v){return function(E,F){if(v[u].error=E,E){fn(v)&&t(!0);return}He(v,function(V){V.forceMinPriority(F.transport.priority)}),t(null,F)}})}}function hn(i,e,t){var u=Ge(i,function(v,E,F,V){return v.connect(e,t(E,V))});return{abort:function(){He(u,mn)},forceMinPriority:function(v){He(u,function(E){E.forceMinPriority(v)})}}}function fn(i){return Ue(i,function(e){return!!e.error})}function mn(i){!i.error&&!i.aborted&&(i.abort(),i.aborted=!0)}class vn{constructor(e,t,u){this.strategy=e,this.transports=t,this.ttl=u.ttl||1800*1e3,this.usingTLS=u.useTLS,this.timeline=u.timeline}isSupported(){return this.strategy.isSupported()}connect(e,t){var u=this.usingTLS,v=gn(u),E=v&&v.cacheSkipCount?v.cacheSkipCount:0,F=[this.strategy];if(v&&v.timestamp+this.ttl>=Z.now()){var V=this.transports[v.transport];V&&(["ws","wss"].includes(v.transport)||E>3?(this.timeline.info({cached:!0,transport:v.transport,latency:v.latency}),F.push(new Ke([V],{timeout:v.latency*2+1e3,failFast:!0}))):E++)}var te=Z.now(),le=F.pop().connect(e,function ve(Re,ot){Re?(Et(u),F.length>0?(te=Z.now(),le=F.pop().connect(e,ve)):t(Re)):(yn(u,ot.transport.name,Z.now()-te,E),t(null,ot))});return{abort:function(){le.abort()},forceMinPriority:function(ve){e=ve,le&&le.forceMinPriority(ve)}}}}function Ct(i){return"pusherTransport"+(i?"TLS":"NonTLS")}function gn(i){var e=re.getLocalStorage();if(e)try{var t=e[Ct(i)];if(t)return JSON.parse(t)}catch{Et(i)}return null}function yn(i,e,t,u){var v=re.getLocalStorage();if(v)try{v[Ct(i)]=Ye({timestamp:Z.now(),transport:e,latency:t,cacheSkipCount:u})}catch{}}function Et(i){var e=re.getLocalStorage();if(e)try{delete e[Ct(i)]}catch{}}class it{constructor(e,{delay:t}){this.strategy=e,this.options={delay:t}}isSupported(){return this.strategy.isSupported()}connect(e,t){var u=this.strategy,v,E=new Te(this.options.delay,function(){v=u.connect(e,t)});return{abort:function(){E.ensureAborted(),v&&v.abort()},forceMinPriority:function(F){e=F,v&&v.forceMinPriority(F)}}}}class Ze{constructor(e,t,u){this.test=e,this.trueBranch=t,this.falseBranch=u}isSupported(){var e=this.test()?this.trueBranch:this.falseBranch;return e.isSupported()}connect(e,t){var u=this.test()?this.trueBranch:this.falseBranch;return u.connect(e,t)}}class Cn{constructor(e){this.strategy=e}isSupported(){return this.strategy.isSupported()}connect(e,t){var u=this.strategy.connect(e,function(v,E){E&&u.abort(),t(v,E)});return u}}function et(i){return function(){return i.isSupported()}}var bn=function(i,e,t){var u={};function v(Gt,yr,Cr,br,Sr){var qt=t(i,Gt,yr,Cr,br,Sr);return u[Gt]=qt,qt}var E=Object.assign({},e,{hostNonTLS:i.wsHost+":"+i.wsPort,hostTLS:i.wsHost+":"+i.wssPort,httpPath:i.wsPath}),F=Object.assign({},E,{useTLS:!0}),V=Object.assign({},e,{hostNonTLS:i.httpHost+":"+i.httpPort,hostTLS:i.httpHost+":"+i.httpsPort,httpPath:i.httpPath}),te={loop:!0,timeout:15e3,timeoutLimit:6e4},le=new Rt({minPingDelay:1e4,maxPingDelay:i.activityTimeout}),ve=new Rt({lives:2,minPingDelay:1e4,maxPingDelay:i.activityTimeout}),Re=v("ws","ws",3,E,le),ot=v("wss","ws",3,F,le),hr=v("sockjs","sockjs",1,V),Mt=v("xhr_streaming","xhr_streaming",1,V,ve),fr=v("xdr_streaming","xdr_streaming",1,V,ve),jt=v("xhr_polling","xhr_polling",1,V),mr=v("xdr_polling","xdr_polling",1,V),Nt=new Ke([Re],te),vr=new Ke([ot],te),gr=new Ke([hr],te),Ut=new Ke([new Ze(et(Mt),Mt,fr)],te),Ft=new Ke([new Ze(et(jt),jt,mr)],te),zt=new Ke([new Ze(et(Ut),new yt([Ut,new it(Ft,{delay:4e3})]),Ft)],te),wt=new Ze(et(zt),zt,gr),kt;return e.useTLS?kt=new yt([Nt,new it(wt,{delay:2e3})]):kt=new yt([Nt,new it(vr,{delay:2e3}),new it(wt,{delay:5e3})]),new vn(new Cn(new Ze(et(Re),kt,wt)),u,{ttl:18e5,timeline:e.timeline,useTLS:e.useTLS})},Sn=bn,Tn=function(){var i=this;i.timeline.info(i.buildTimelineMessage({transport:i.name+(i.options.useTLS?"s":"")})),i.hooks.isInitialized()?i.changeState("initialized"):i.hooks.file?(i.changeState("initializing"),o.load(i.hooks.file,{useTLS:i.options.useTLS},function(e,t){i.hooks.isInitialized()?(i.changeState("initialized"),t(!0)):(e&&i.onError(e),i.onClose(),t(!1))})):i.onClose()},wn={getRequest:function(i){var e=new window.XDomainRequest;return e.ontimeout=function(){i.emit("error",new s),i.close()},e.onerror=function(t){i.emit("error",t),i.close()},e.onprogress=function(){e.responseText&&e.responseText.length>0&&i.onChunk(200,e.responseText)},e.onload=function(){e.responseText&&e.responseText.length>0&&i.onChunk(200,e.responseText),i.emit("finished",200),i.close()},e},abortRequest:function(i){i.ontimeout=i.onerror=i.onprogress=i.onload=null,i.abort()}},kn=wn;const _n=256*1024;class Pn extends ue{constructor(e,t,u){super(),this.hooks=e,this.method=t,this.url=u}start(e){this.position=0,this.xhr=this.hooks.getRequest(this),this.unloader=()=>{this.close()},re.addUnloadListener(this.unloader),this.xhr.open(this.method,this.url,!0),this.xhr.setRequestHeader&&this.xhr.setRequestHeader("Content-Type","application/json"),this.xhr.send(e)}close(){this.unloader&&(re.removeUnloadListener(this.unloader),this.unloader=null),this.xhr&&(this.hooks.abortRequest(this.xhr),this.xhr=null)}onChunk(e,t){for(;;){var u=this.advanceBuffer(t);if(u)this.emit("chunk",{status:e,data:u});else break}this.isBufferTooLong(t)&&this.emit("buffer_too_long")}advanceBuffer(e){var t=e.slice(this.position),u=t.indexOf(`
`);return u!==-1?(this.position+=u+1,t.slice(0,u)):null}isBufferTooLong(e){return this.position===e.length&&e.length>_n}}var bt;(function(i){i[i.CONNECTING=0]="CONNECTING",i[i.OPEN=1]="OPEN",i[i.CLOSED=3]="CLOSED"})(bt||(bt={}));var Qe=bt,Rn=1;class En{constructor(e,t){this.hooks=e,this.session=Dt(1e3)+"/"+An(8),this.location=xn(t),this.readyState=Qe.CONNECTING,this.openStream()}send(e){return this.sendRaw(JSON.stringify([e]))}ping(){this.hooks.sendHeartbeat(this)}close(e,t){this.onClose(e,t,!0)}sendRaw(e){if(this.readyState===Qe.OPEN)try{return re.createSocketRequest("POST",xt(Dn(this.location,this.session))).start(e),!0}catch{return!1}else return!1}reconnect(){this.closeStream(),this.openStream()}onClose(e,t,u){this.closeStream(),this.readyState=Qe.CLOSED,this.onclose&&this.onclose({code:e,reason:t,wasClean:u})}onChunk(e){if(e.status===200){this.readyState===Qe.OPEN&&this.onActivity();var t,u=e.data.slice(0,1);switch(u){case"o":t=JSON.parse(e.data.slice(1)||"{}"),this.onOpen(t);break;case"a":t=JSON.parse(e.data.slice(1)||"[]");for(var v=0;v<t.length;v++)this.onEvent(t[v]);break;case"m":t=JSON.parse(e.data.slice(1)||"null"),this.onEvent(t);break;case"h":this.hooks.onHeartbeat(this);break;case"c":t=JSON.parse(e.data.slice(1)||"[]"),this.onClose(t[0],t[1],!0);break}}}onOpen(e){this.readyState===Qe.CONNECTING?(e&&e.hostname&&(this.location.base=On(this.location.base,e.hostname)),this.readyState=Qe.OPEN,this.onopen&&this.onopen()):this.onClose(1006,"Server lost session",!0)}onEvent(e){this.readyState===Qe.OPEN&&this.onmessage&&this.onmessage({data:e})}onActivity(){this.onactivity&&this.onactivity()}onError(e){this.onerror&&this.onerror(e)}openStream(){this.stream=re.createSocketRequest("POST",xt(this.hooks.getReceiveURL(this.location,this.session))),this.stream.bind("chunk",e=>{this.onChunk(e)}),this.stream.bind("finished",e=>{this.hooks.onFinished(this,e)}),this.stream.bind("buffer_too_long",()=>{this.reconnect()});try{this.stream.start()}catch(e){Z.defer(()=>{this.onError(e),this.onClose(1006,"Could not start streaming",!1)})}}closeStream(){this.stream&&(this.stream.unbind_all(),this.stream.close(),this.stream=null)}}function xn(i){var e=/([^\?]*)\/*(\??.*)/.exec(i);return{base:e[1],queryString:e[2]}}function Dn(i,e){return i.base+"/"+e+"/xhr_send"}function xt(i){var e=i.indexOf("?")===-1?"?":"&";return i+e+"t="+ +new Date+"&n="+Rn++}function On(i,e){var t=/(https?:\/\/)([^\/:]+)((\/|:)?.*)/.exec(i);return t[1]+e+t[3]}function Dt(i){return re.randomInt(i)}function An(i){for(var e=[],t=0;t<i;t++)e.push(Dt(32).toString(32));return e.join("")}var In=En,Ln={getReceiveURL:function(i,e){return i.base+"/"+e+"/xhr_streaming"+i.queryString},onHeartbeat:function(i){i.sendRaw("[]")},sendHeartbeat:function(i){i.sendRaw("[]")},onFinished:function(i,e){i.onClose(1006,"Connection interrupted ("+e+")",!1)}},Mn=Ln,jn={getReceiveURL:function(i,e){return i.base+"/"+e+"/xhr"+i.queryString},onHeartbeat:function(){},sendHeartbeat:function(i){i.sendRaw("[]")},onFinished:function(i,e){e===200?i.reconnect():i.onClose(1006,"Connection interrupted ("+e+")",!1)}},Nn=jn,Un={getRequest:function(i){var e=re.getXHRAPI(),t=new e;return t.onreadystatechange=t.onprogress=function(){switch(t.readyState){case 3:t.responseText&&t.responseText.length>0&&i.onChunk(t.status,t.responseText);break;case 4:t.responseText&&t.responseText.length>0&&i.onChunk(t.status,t.responseText),i.emit("finished",t.status),i.close();break}},t},abortRequest:function(i){i.onreadystatechange=null,i.abort()}},Fn=Un,zn={createStreamingSocket(i){return this.createSocket(Mn,i)},createPollingSocket(i){return this.createSocket(Nn,i)},createSocket(i,e){return new In(i,e)},createXHR(i,e){return this.createRequest(Fn,i,e)},createRequest(i,e,t){return new Pn(i,e,t)}},Ot=zn;Ot.createXDR=function(i,e){return this.createRequest(kn,i,e)};var Gn=Ot,qn={nextAuthCallbackID:1,auth_callbacks:{},ScriptReceivers:a,DependenciesReceivers:h,getDefaultStrategy:Sn,Transports:Kt,transportConnectionInitializer:Tn,HTTPFactory:Gn,TimelineTransport:k,getXHRAPI(){return window.XMLHttpRequest},getWebSocketAPI(){return window.WebSocket||window.MozWebSocket},setup(i){window.Pusher=i;var e=()=>{this.onDocumentBody(i.ready)};window.JSON?e():o.load("json2",{},e)},getDocument(){return document},getProtocol(){return this.getDocument().location.protocol},getAuthorizers(){return{ajax:z,jsonp:nt}},onDocumentBody(i){document.body?i():setTimeout(()=>{this.onDocumentBody(i)},0)},createJSONPRequest(i,e){return new pt(i,e)},createScriptRequest(i){return new ut(i)},getLocalStorage(){try{return window.localStorage}catch{return}},createXHR(){return this.getXHRAPI()?this.createXMLHttpRequest():this.createMicrosoftXHR()},createXMLHttpRequest(){var i=this.getXHRAPI();return new i},createMicrosoftXHR(){return new ActiveXObject("Microsoft.XMLHTTP")},getNetwork(){return Yt},createWebSocket(i){var e=this.getWebSocketAPI();return new e(i)},createSocketRequest(i,e){if(this.isXHRSupported())return this.HTTPFactory.createXHR(i,e);if(this.isXDRSupported(e.indexOf("https:")===0))return this.HTTPFactory.createXDR(i,e);throw"Cross-origin HTTP requests are not supported"},isXHRSupported(){var i=this.getXHRAPI();return!!i&&new i().withCredentials!==void 0},isXDRSupported(i){var e=i?"https:":"http:",t=this.getProtocol();return!!window.XDomainRequest&&t===e},addUnloadListener(i){window.addEventListener!==void 0?window.addEventListener("unload",i,!1):window.attachEvent!==void 0&&window.attachEvent("onunload",i)},removeUnloadListener(i){window.addEventListener!==void 0?window.removeEventListener("unload",i,!1):window.detachEvent!==void 0&&window.detachEvent("onunload",i)},randomInt(i){return Math.floor(function(){return(window.crypto||window.msCrypto).getRandomValues(new Uint32Array(1))[0]/Math.pow(2,32)}()*i)}},re=qn,St;(function(i){i[i.ERROR=3]="ERROR",i[i.INFO=6]="INFO",i[i.DEBUG=7]="DEBUG"})(St||(St={}));var at=St;class Hn{constructor(e,t,u){this.key=e,this.session=t,this.events=[],this.options=u||{},this.sent=0,this.uniqueID=0}log(e,t){e<=this.options.level&&(this.events.push(de({},t,{timestamp:Z.now()})),this.options.limit&&this.events.length>this.options.limit&&this.events.shift())}error(e){this.log(at.ERROR,e)}info(e){this.log(at.INFO,e)}debug(e){this.log(at.DEBUG,e)}isEmpty(){return this.events.length===0}send(e,t){var u=de({session:this.session,bundle:this.sent+1,key:this.key,lib:"js",version:this.options.version,cluster:this.options.cluster,features:this.options.features,timeline:this.events},this.options.params);return this.events=[],e(u,(v,E)=>{v||this.sent++,t&&t(v,E)}),!0}generateUniqueID(){return this.uniqueID++,this.uniqueID}}class Bn{constructor(e,t,u,v){this.name=e,this.priority=t,this.transport=u,this.options=v||{}}isSupported(){return this.transport.isSupported({useTLS:this.options.useTLS})}connect(e,t){if(this.isSupported()){if(this.priority<e)return At(new l,t)}else return At(new P,t);var u=!1,v=this.transport.createConnection(this.name,this.priority,this.options.key,this.options),E=null,F=function(){v.unbind("initialized",F),v.connect()},V=function(){E=Ve.createHandshake(v,function(Re){u=!0,ve(),t(null,Re)})},te=function(Re){ve(),t(Re)},le=function(){ve();var Re;Re=Ye(v),t(new g(Re))},ve=function(){v.unbind("initialized",F),v.unbind("open",V),v.unbind("error",te),v.unbind("closed",le)};return v.bind("initialized",F),v.bind("open",V),v.bind("error",te),v.bind("closed",le),v.initialize(),{abort:()=>{u||(ve(),E?E.close():v.close())},forceMinPriority:Re=>{u||this.priority<Re&&(E?E.close():v.close())}}}}function At(i,e){return Z.defer(function(){e(i)}),{abort:function(){},forceMinPriority:function(){}}}const{Transports:Jn}=re;var Vn=function(i,e,t,u,v,E){var F=Jn[t];if(!F)throw new D(t);var V=(!i.enabledTransports||Ie(i.enabledTransports,e)!==-1)&&(!i.disabledTransports||Ie(i.disabledTransports,e)===-1),te;return V?(v=Object.assign({ignoreNullOrigin:i.ignoreNullOrigin},v),te=new Bn(e,u,E?E.getAssistant(F):F,v)):te=$n,te},$n={isSupported:function(){return!1},connect:function(i,e){var t=Z.defer(function(){e(new P)});return{abort:function(){t.ensureAborted()},forceMinPriority:function(){}}}};function Wn(i){if(i==null)throw"You must pass an options object";if(i.cluster==null)throw"Options object must provide a cluster";"disableStats"in i&&ge.warn("The disableStats option is deprecated in favor of enableStats")}const Xn=(i,e)=>{var t="socket_id="+encodeURIComponent(i.socketId);for(var u in e.params)t+="&"+encodeURIComponent(u)+"="+encodeURIComponent(e.params[u]);if(e.paramsProvider!=null){let v=e.paramsProvider();for(var u in v)t+="&"+encodeURIComponent(u)+"="+encodeURIComponent(v[u])}return t};var Kn=i=>{if(typeof re.getAuthorizers()[i.transport]>"u")throw`'${i.transport}' is not a recognized auth transport`;return(e,t)=>{const u=Xn(e,i);re.getAuthorizers()[i.transport](re,u,i,c.UserAuthentication,t)}};const Qn=(i,e)=>{var t="socket_id="+encodeURIComponent(i.socketId);t+="&channel_name="+encodeURIComponent(i.channelName);for(var u in e.params)t+="&"+encodeURIComponent(u)+"="+encodeURIComponent(e.params[u]);if(e.paramsProvider!=null){let v=e.paramsProvider();for(var u in v)t+="&"+encodeURIComponent(u)+"="+encodeURIComponent(v[u])}return t};var Yn=i=>{if(typeof re.getAuthorizers()[i.transport]>"u")throw`'${i.transport}' is not a recognized auth transport`;return(e,t)=>{const u=Qn(e,i);re.getAuthorizers()[i.transport](re,u,i,c.ChannelAuthorization,t)}};const Zn=(i,e,t)=>{const u={authTransport:e.transport,authEndpoint:e.endpoint,auth:{params:e.params,headers:e.headers}};return(v,E)=>{const F=i.channel(v.channelName);t(F,u).authorize(v.socketId,E)}};function It(i,e){let t={activityTimeout:i.activityTimeout||n.activityTimeout,cluster:i.cluster,httpPath:i.httpPath||n.httpPath,httpPort:i.httpPort||n.httpPort,httpsPort:i.httpsPort||n.httpsPort,pongTimeout:i.pongTimeout||n.pongTimeout,statsHost:i.statsHost||n.stats_host,unavailableTimeout:i.unavailableTimeout||n.unavailableTimeout,wsPath:i.wsPath||n.wsPath,wsPort:i.wsPort||n.wsPort,wssPort:i.wssPort||n.wssPort,enableStats:ir(i),httpHost:er(i),useTLS:rr(i),wsHost:tr(i),userAuthenticator:ar(i),channelAuthorizer:sr(i,e)};return"disabledTransports"in i&&(t.disabledTransports=i.disabledTransports),"enabledTransports"in i&&(t.enabledTransports=i.enabledTransports),"ignoreNullOrigin"in i&&(t.ignoreNullOrigin=i.ignoreNullOrigin),"timelineParams"in i&&(t.timelineParams=i.timelineParams),"nacl"in i&&(t.nacl=i.nacl),t}function er(i){return i.httpHost?i.httpHost:i.cluster?`sockjs-${i.cluster}.pusher.com`:n.httpHost}function tr(i){return i.wsHost?i.wsHost:nr(i.cluster)}function nr(i){return`ws-${i}.pusher.com`}function rr(i){return re.getProtocol()==="https:"?!0:i.forceTLS!==!1}function ir(i){return"enableStats"in i?i.enableStats:"disableStats"in i?!i.disableStats:!1}const Lt=i=>"customHandler"in i&&i.customHandler!=null;function ar(i){const e=Object.assign(Object.assign({},n.userAuthentication),i.userAuthentication);return Lt(e)?e.customHandler:Kn(e)}function or(i,e){let t;if("channelAuthorization"in i)t=Object.assign(Object.assign({},n.channelAuthorization),i.channelAuthorization);else if(t={transport:i.authTransport||n.authTransport,endpoint:i.authEndpoint||n.authEndpoint},"auth"in i&&("params"in i.auth&&(t.params=i.auth.params),"headers"in i.auth&&(t.headers=i.auth.headers)),"authorizer"in i)return{customHandler:Zn(e,t,i.authorizer)};return t}function sr(i,e){const t=or(i,e);return Lt(t)?t.customHandler:Yn(t)}class cr extends ue{constructor(e){super(function(t,u){ge.debug(`No callbacks on watchlist events for ${t}`)}),this.pusher=e,this.bindWatchlistInternalEvent()}handleEvent(e){e.data.events.forEach(t=>{this.emit(t.name,t)})}bindWatchlistInternalEvent(){this.pusher.connection.bind("message",e=>{var t=e.event;t==="pusher_internal:watchlist_events"&&this.handleEvent(e)})}}function lr(){let i,e;return{promise:new Promise((u,v)=>{i=u,e=v}),resolve:i,reject:e}}var dr=lr;class ur extends ue{constructor(e){super(function(t,u){ge.debug("No callbacks on user for "+t)}),this.signin_requested=!1,this.user_data=null,this.serverToUserChannel=null,this.signinDonePromise=null,this._signinDoneResolve=null,this._onAuthorize=(t,u)=>{if(t){ge.warn(`Error during signin: ${t}`),this._cleanup();return}this.pusher.send_event("pusher:signin",{auth:u.auth,user_data:u.user_data})},this.pusher=e,this.pusher.connection.bind("state_change",({previous:t,current:u})=>{t!=="connected"&&u==="connected"&&this._signin(),t==="connected"&&u!=="connected"&&(this._cleanup(),this._newSigninPromiseIfNeeded())}),this.watchlist=new cr(e),this.pusher.connection.bind("message",t=>{var u=t.event;u==="pusher:signin_success"&&this._onSigninSuccess(t.data),this.serverToUserChannel&&this.serverToUserChannel.name===t.channel&&this.serverToUserChannel.handleEvent(t)})}signin(){this.signin_requested||(this.signin_requested=!0,this._signin())}_signin(){this.signin_requested&&(this._newSigninPromiseIfNeeded(),this.pusher.connection.state==="connected"&&this.pusher.config.userAuthenticator({socketId:this.pusher.connection.socket_id},this._onAuthorize))}_onSigninSuccess(e){try{this.user_data=JSON.parse(e.user_data)}catch{ge.error(`Failed parsing user data after signin: ${e.user_data}`),this._cleanup();return}if(typeof this.user_data.id!="string"||this.user_data.id===""){ge.error(`user_data doesn't contain an id. user_data: ${this.user_data}`),this._cleanup();return}this._signinDoneResolve(),this._subscribeChannels()}_subscribeChannels(){const e=t=>{t.subscriptionPending&&t.subscriptionCancelled?t.reinstateSubscription():!t.subscriptionPending&&this.pusher.connection.state==="connected"&&t.subscribe()};this.serverToUserChannel=new mt(`#server-to-user-${this.user_data.id}`,this.pusher),this.serverToUserChannel.bind_global((t,u)=>{t.indexOf("pusher_internal:")===0||t.indexOf("pusher:")===0||this.emit(t,u)}),e(this.serverToUserChannel)}_cleanup(){this.user_data=null,this.serverToUserChannel&&(this.serverToUserChannel.unbind_all(),this.serverToUserChannel.disconnect(),this.serverToUserChannel=null),this.signin_requested&&this._signinDoneResolve()}_newSigninPromiseIfNeeded(){if(!this.signin_requested||this.signinDonePromise&&!this.signinDonePromise.done)return;const{promise:e,resolve:t,reject:u}=dr();e.done=!1;const v=()=>{e.done=!0};e.then(v).catch(v),this.signinDonePromise=e,this._signinDoneResolve=t}}class Oe{static ready(){Oe.isReady=!0;for(var e=0,t=Oe.instances.length;e<t;e++)Oe.instances[e].connect()}static getClientFeatures(){return _e(ye({ws:re.Transports.ws},function(e){return e.isSupported({})}))}constructor(e,t){pr(e),Wn(t),this.key=e,this.options=t,this.config=It(this.options,this),this.channels=Ve.createChannels(),this.global_emitter=new ue,this.sessionID=re.randomInt(1e9),this.timeline=new Hn(this.key,this.sessionID,{cluster:this.config.cluster,features:Oe.getClientFeatures(),params:this.config.timelineParams||{},limit:50,level:at.INFO,version:n.VERSION}),this.config.enableStats&&(this.timelineSender=Ve.createTimelineSender(this.timeline,{host:this.config.statsHost,path:"/timeline/v2/"+re.TimelineTransport.name}));var u=v=>re.getDefaultStrategy(this.config,v,Vn);this.connection=Ve.createConnectionManager(this.key,{getStrategy:u,timeline:this.timeline,activityTimeout:this.config.activityTimeout,pongTimeout:this.config.pongTimeout,unavailableTimeout:this.config.unavailableTimeout,useTLS:!!this.config.useTLS}),this.connection.bind("connected",()=>{this.subscribeAll(),this.timelineSender&&this.timelineSender.send(this.connection.isUsingTLS())}),this.connection.bind("message",v=>{var E=v.event,F=E.indexOf("pusher_internal:")===0;if(v.channel){var V=this.channel(v.channel);V&&V.handleEvent(v)}F||this.global_emitter.emit(v.event,v.data)}),this.connection.bind("connecting",()=>{this.channels.disconnect()}),this.connection.bind("disconnected",()=>{this.channels.disconnect()}),this.connection.bind("error",v=>{ge.warn(v)}),Oe.instances.push(this),this.timeline.info({instances:Oe.instances.length}),this.user=new ur(this),Oe.isReady&&this.connect()}switchCluster(e){const{appKey:t,cluster:u}=e;this.key=t,this.options=Object.assign(Object.assign({},this.options),{cluster:u}),this.config=It(this.options,this),this.connection.switchCluster(this.key)}channel(e){return this.channels.find(e)}allChannels(){return this.channels.all()}connect(){if(this.connection.connect(),this.timelineSender&&!this.timelineSenderTimer){var e=this.connection.isUsingTLS(),t=this.timelineSender;this.timelineSenderTimer=new ke(6e4,function(){t.send(e)})}}disconnect(){this.connection.disconnect(),this.timelineSenderTimer&&(this.timelineSenderTimer.ensureAborted(),this.timelineSenderTimer=null)}bind(e,t,u){return this.global_emitter.bind(e,t,u),this}unbind(e,t,u){return this.global_emitter.unbind(e,t,u),this}bind_global(e){return this.global_emitter.bind_global(e),this}unbind_global(e){return this.global_emitter.unbind_global(e),this}unbind_all(e){return this.global_emitter.unbind_all(),this}subscribeAll(){var e;for(e in this.channels.channels)this.channels.channels.hasOwnProperty(e)&&this.subscribe(e)}subscribe(e){var t=this.channels.add(e,this);return t.subscriptionPending&&t.subscriptionCancelled?t.reinstateSubscription():!t.subscriptionPending&&this.connection.state==="connected"&&t.subscribe(),t}unsubscribe(e){var t=this.channels.find(e);t&&t.subscriptionPending?t.cancelSubscription():(t=this.channels.remove(e),t&&t.subscribed&&t.unsubscribe())}send_event(e,t,u){return this.connection.send_event(e,t,u)}shouldUseTLS(){return this.config.useTLS}signin(){this.user.signin()}}Oe.instances=[],Oe.isReady=!1,Oe.logToConsole=!1,Oe.Runtime=re,Oe.ScriptReceivers=re.ScriptReceivers,Oe.DependenciesReceivers=re.DependenciesReceivers,Oe.auth_callbacks=re.auth_callbacks;var Tt=$.default=Oe;function pr(i){if(i==null)throw"You must pass your app key when you instantiate Pusher."}re.setup(Oe)}])})})(Vt);var Pr=Vt.exports;const Rr=Bt(Pr),Er=[{product:"Phone",status:"Shipped",COD:500,client:"John Doe",phone:"123-456-7890",email:"john@example.com",altPhone:"111-222-3333",location:"Portland, Oregon",orders:[{product:"Tablet",status:"Delivered"},{product:"Laptop",status:"Pending"}]}],xr={async fetch({page:M,itemsPerPage:q,sortBy:W,search:$}){return new Promise(O=>{setTimeout(()=>{const p=(M-1)*q,a=p+q,d=Er.filter(f=>!0),n=d.slice(p,a);O({items:n,total:d.length})},500)})}},Dr={mounted(){new Rr("your_app_key",{cluster:"your_cluster",encrypted:!0}).subscribe("call-updates").bind("call.status",W=>{console.log("Call status update:",W),this.$toastr.info(`Call status: ${W.status}`)})},components:{AppLayout:Tr},data:()=>({itemsPerPage:5,tab:"calls",isCalling:!1,connection_active:!1,queueDialog:!1,transferDialog:!1,callAgentDialog:!1,queuedCalls:[],selectedAgent:null,agents:[{name:"Mark D",status:"available"},{name:"Pippa M",status:"engaged"},{name:"Russ N",status:"engaged"},{name:"Elif T",status:"engaged"}],queuedCalls:[{call_id:1,phone_number:"+254711123456",status:"queued"},{call_id:2,phone_number:"+254712345678",status:"queued"},{call_id:3,phone_number:"+254713456789",status:"queued"},{call_id:4,phone_number:"+254714567890",status:"queued"}],queuedCallsheaders:[{title:"Call ID",value:"call_id"},{title:"Phone Number",value:"phone_number"},{title:"Status",value:"status"},{title:"Actions",value:"actions",sortable:!1}],headers:[{title:"Product",align:"start",key:"product"},{title:"Status",key:"status",align:"start"},{title:"COD",key:"COD",align:"end"},{title:"Client",key:"client",align:"start"},{title:"Phone",key:"phone",align:"start"}],callsheaders:[{title:"Created At",value:"createdAt"},{title:"Caller No.",value:"callerNo"},{title:"Phone",value:"phone"},{title:"Call Session State",value:"callSessionState"},{title:"Duration In Seconds",value:"duration"},{title:"Amount",value:"amount"},{title:"Caller Carrier",value:"callerCarrier"},{title:"Call Status",value:"callStatus"},{title:"Actions",value:"actions",sortable:!1}],calls:[{id:1,createdAt:"2025-01-26 10:00",callerNo:"254712345678",phone:"254723456789",callSessionState:"Completed",duration:120,amount:"KES 30",callerCarrier:"Safaricom",callStatus:"Success"},{id:2,createdAt:"2025-01-26 10:30",callerNo:"254723456789",phone:"254734567890",callSessionState:"Missed",duration:0,amount:"KES 0",callerCarrier:"Airtel",callStatus:"Missed"}],serverItems:[{product:"Phone",status:"Shipped",COD:500,client:"John Doe",phone:"123-456-7890"},{product:"Tablet",status:"Pending",COD:700,client:"Jane Doe",phone:"234-567-8901"}],loading:!1,totalItems:2,statuses:["Pending","Shipped","Delivered","Cancelled"],statusModal:!1,phonePopup:!1,newCall:!1,incomingCallDialog:!1,incomingCall:{},callId:null,afClient:null,session:null,selectedItem:{phone:""},eventLog:[]}),methods:{async initializeAfricastalking(){const M={sounds:{dialing:"https://support.solssa.com/storage/ringtones/office_phone.mp3",ringing:"https://support.solssa.com/storage/ringtones/office_phone.mp3"}};try{const q=await axios.get("/api/v1/voice-token");console.log("API Response:",q.data);const W=q.data.updatedTokens;if(!W||W.length===0){console.error("No tokens found in response."),this.$toastr.error("No tokens available.");return}const $=W[0].token;if(console.log("Using token:"),!$){console.error("Token is missing from response."),this.$toastr.error("Invalid token received.");return}const O=new _r.Client($,M);console.log("Africastalking client initialized."),this.afClient=O,O.on("ready",()=>{this.connection_active=!0,console.log("Africastalking WebRTC client is ready."),this.$toastr.success("WebRTC client is ready.")}),O.on("error",a=>{console.error("Africastalking Client Error:",a),this.$toastr.error("Client Error: "+a.message)}),O.on("closed",a=>{console.warn("Africastalking Client Connection Closed:",a),this.$toastr.warning("Connection closed.")}),O.on("incomingcall",a=>{console.log("Incoming call received."),console.log(`Incoming call from ${M.from}`),console.log("Event Data:",a),this.incomingCallDialog=!0,this.incomingCall={incomingCallFrom:a.from,duration:"Connecting..."}});let p=event.call;this.$webrtcClient=O}catch(q){console.error("Error initializing Africastalking WebRTC client:",q),this.$toastr.error("Failed to initialize WebRTC client: "+q.message)}},transferCall(){this.openTransferDialog()},async callClient(M){try{console.log(`Calling ${M} from +254711082159...`),this.afClient.call(M),console.log("Call initiated successfully."),this.$toastr.success("Call started."),this.isCalling=!0,this.afClient.on("afClienting",()=>{this.logEvent("afClient is in progress (calling)...")}),this.afClient.on("callaccepted",()=>{console.log("callaccepted"),this.$toastr.success("Call accepted!"),this.logEvent("Call accepted (bridged between caller and callee).")}),this.afClient.on("hangup",q=>{this.logEvent(`Call hung up (${q.code} - ${q.reason}).`),this.$toastr.error(`Call ended: ${q.reason}`),this.isCalling=!1,this.activeCall=null}),this.afClient.on("mute",()=>{this.logEvent("Call muted."),this.$toastr.info("Call muted.")}),this.afClient.on("unmute",()=>{this.logEvent("Call unmuted."),this.$toastr.info("Call unmuted.")}),this.afClient.on("hold",()=>{this.logEvent("Call on hold."),this.$toastr.info("Call on hold.")}),this.afClient.on("unhold",()=>{this.logEvent("Call resumed from hold."),this.$toastr.info("Call resumed from hold.")})}catch(q){console.error("Call initiation error:",q),this.$toastr.error("Call failed: "+q.message)}},answerCall(){this.incomingCall&&this.afClient.answer()},hangupCall(){this.incomingCall&&(this.afClient.hangup(),console.log("call rejected"),this.$toastr.error("Call rejected."),this.incomingCallDialog=!1,this.isCalling=!1)},logEvent(M){const q=new Date().toLocaleTimeString();this.eventLog.unshift(`${q}: ${M}`)},closeDialog(){this.callAgentDialog=!1},openCallAgent(){this.callAgentDialog=!0},openTransferDialog(){this.transferDialog=!0},openQueueDialog(){this.fetchQueuedCalls(),this.queueDialog=!0},loadItems({page:M,itemsPerPage:q,sortBy:W}){this.loading=!0,xr.fetch({page:M,itemsPerPage:q,sortBy:W,search:{}}).then(({items:$,total:O})=>{this.serverItems=$,this.totalItems=O,this.loading=!1})},openStatusModal(M){this.selectedItem=M,this.statusModal=!0},updateStatus(M,q){M.status=q,this.statusModal=!1},openPhonePopup(M){this.selectedItem=M,this.phonePopup=!0},handleCall(M){this.selectedAgent=M,this.callAgentDialog=!1,console.log("Calling agent:",M)}},async mounted(){await this.initializeAfricastalking()}},Or={class:"p-4"},Ar=K("span",{class:"ml-3"},"Make a new Call",-1),Ir=K("span",{class:"ml-3"},"Call an agent",-1),Lr={class:"d-flex align-center mt-2"},Mr=K("span",{class:"ml-3"},"Missed Calls",-1),jr=K("span",{class:"ml-auto"},"60,400",-1),Nr=K("span",{class:"ml-3"},"Check Queue",-1),Ur=K("span",{class:"ml-auto"},"...",-1),Fr={class:"d-flex align-center"},zr=K("span",null,"AM",-1),Gr=K("div",null,[K("p",{class:"mb-0"},"John Mwacahro"),K("small",null,"john.boxleo@gmail.com")],-1),qr=K("div",{class:"mt-4"},[K("p",null,[G("Calls connected: "),K("strong",null,"0")]),K("p",null,[G("Calls made: "),K("strong",null,"0")]),K("p",null,[G("Calls rejected: "),K("strong",null,"0")]),K("p",null,[G("Incoming Calls: "),K("strong",null,"0")])],-1),Hr=["onClick"],Br=["onClick"],Jr=K("p",null,"Select an agent to call:",-1),Vr=K("strong",null,"Name:",-1),$r=K("strong",null,"Email:",-1),Wr=K("strong",null,"Phone:",-1),Xr=K("strong",null,"Alternative Phone:",-1),Kr=K("strong",null,"Location:",-1);function Qr(M,q,W,$,O,p){const a=we("v-icon"),d=we("v-card-text"),n=we("v-card"),f=we("v-col"),h=we("v-avatar"),o=we("v-chip"),C=we("v-row"),S=we("v-tab"),b=we("v-tabs"),c=we("v-btn"),m=we("v-data-table"),r=we("v-tab-item"),s=we("v-tabs-items"),l=we("v-card-title"),g=we("v-list-item"),T=we("v-list"),D=we("v-card-actions"),P=we("v-dialog"),N=we("v-spacer"),B=we("v-text-field"),z=we("v-container"),H=we("AppLayout");return Ce(),De(H,null,{default:x(()=>[K("div",Or,[L(z,null,{default:x(()=>[L(C,null,{default:x(()=>[L(f,{cols:"12",md:"6"},{default:x(()=>[L(n,null,{default:x(()=>[L(d,null,{default:x(()=>[K("div",{class:"d-flex align-center",onClick:q[0]||(q[0]=U=>M.newCall=!0)},[L(a,{color:"green"},{default:x(()=>[G("mdi-phone")]),_:1}),Ar]),K("div",{class:"d-flex align-center mt-2",onClick:q[1]||(q[1]=(...U)=>p.openCallAgent&&p.openCallAgent(...U))},[L(a,{color:"blue"},{default:x(()=>[G("mdi-account")]),_:1}),Ir]),K("div",Lr,[L(a,{color:"red"},{default:x(()=>[G("mdi-phone-missed")]),_:1}),Mr,jr]),K("div",{class:"d-flex align-center mt-2",onClick:q[2]||(q[2]=(...U)=>p.openQueueDialog&&p.openQueueDialog(...U))},[L(a,{color:"orange"},{default:x(()=>[G("mdi-check-decagram")]),_:1}),Nr,Ur])]),_:1})]),_:1})]),_:1}),L(f,{cols:"12",md:"6"},{default:x(()=>[L(n,null,{default:x(()=>[L(d,null,{default:x(()=>[K("div",Fr,[L(h,{class:"mr-3",color:"blue",size:"40"},{default:x(()=>[zr]),_:1}),Gr,L(o,{class:"ml-auto",color:"green","text-color":"white"},{default:x(()=>[G("Online")]),_:1})]),qr]),_:1})]),_:1})]),_:1})]),_:1}),L(n,null,{default:x(()=>[L(b,{modelValue:M.tab,"onUpdate:modelValue":q[3]||(q[3]=U=>M.tab=U),color:"primary"},{default:x(()=>[L(S,{value:"calls"},{default:x(()=>[G("Calls")]),_:1}),L(S,{value:"orders"},{default:x(()=>[G("Orders")]),_:1})]),_:1},8,["modelValue"]),L(s,{modelValue:M.tab,"onUpdate:modelValue":q[4]||(q[4]=U=>M.tab=U)},{default:x(()=>[L(r,{value:"calls"},{default:x(()=>[L(m,{headers:M.callsheaders,items:M.calls,"item-value":"id",class:"elevation-1 mt-4","items-per-page":10},{"item.actions":x(({item:U})=>[L(c,{icon:"",color:"red"},{default:x(()=>[L(a,null,{default:x(()=>[G("mdi-record-circle")]),_:1})]),_:1})]),_:1},8,["headers","items"])]),_:1}),L(r,{value:"orders"},{default:x(()=>[L(m,{headers:M.headers,items:M.serverItems,loading:M.loading,class:"elevation-1 mt-4"},{body:x(({items:U})=>[(Ce(!0),tt(ct,null,st(U,Q=>(Ce(),tt("tr",{key:Q.product},[K("td",null,Ae(Q.product),1),K("td",null,[K("span",{class:"clickable",onClick:se=>p.openStatusModal(Q)},Ae(Q.status),9,Hr)]),K("td",null,Ae(Q.COD),1),K("td",null,Ae(Q.client),1),K("td",null,[K("span",{class:"clickable",onClick:se=>p.openPhonePopup(Q)},Ae(Q.phone),9,Br)])]))),128))]),_:1},8,["headers","items","loading"])]),_:1})]),_:1},8,["modelValue"])]),_:1}),L(P,{modelValue:M.callAgentDialog,"onUpdate:modelValue":q[5]||(q[5]=U=>M.callAgentDialog=U),"max-width":"400"},{default:x(()=>[L(n,null,{default:x(()=>[L(l,{class:"headline"},{default:x(()=>[G("Call an Agent")]),_:1}),L(d,null,{default:x(()=>[Jr,L(T,null,{default:x(()=>[(Ce(!0),tt(ct,null,st(M.agents,U=>(Ce(),De(g,{key:U.name,onClick:Q=>p.handleCall(U),class:"agent-item"},{default:x(()=>[K("div",null,[K("strong",null,Ae(U.name),1),K("span",{class:Ht({"text-success":U.status==="available","text-warning":U.status==="engaged","text-grey":U.status==="offline"})}," - "+Ae(U.status),3)])]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),L(D,null,{default:x(()=>[L(c,{color:"blue darken-1",text:"",onClick:p.closeDialog},{default:x(()=>[G("Cancel")]),_:1},8,["onClick"]),M.isCalling?(Ce(),De(c,{key:0,color:"red",onClick:p.hangupCall},{default:x(()=>[L(a,{left:""},{default:x(()=>[G("mdi-phone-off")]),_:1}),G(" Hangup ")]),_:1},8,["onClick"])):je("",!0),M.isCalling?(Ce(),De(c,{key:1,color:"grey",onClick:M.handleHold},{default:x(()=>[L(a,{left:""},{default:x(()=>[G("mdi-pause")]),_:1}),G(" Hold ")]),_:1},8,["onClick"])):je("",!0),M.isCalling?(Ce(),De(c,{key:2,color:"blue",onClick:p.openTransferDialog},{default:x(()=>[L(a,{left:""},{default:x(()=>[G("mdi-phone-transfer")]),_:1}),G(" Transfer ")]),_:1},8,["onClick"])):je("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),L(P,{modelValue:M.statusModal,"onUpdate:modelValue":q[7]||(q[7]=U=>M.statusModal=U),"max-width":"400"},{default:x(()=>[L(n,null,{default:x(()=>[L(l,null,{default:x(()=>[G("Select Status")]),_:1}),L(d,null,{default:x(()=>[L(T,null,{default:x(()=>[(Ce(!0),tt(ct,null,st(M.statuses,U=>(Ce(),De(g,{key:U,onClick:Q=>p.updateStatus(M.selectedItem,U)},{default:x(()=>[G(Ae(U),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),L(D,null,{default:x(()=>[L(c,{color:"primary",text:"",onClick:q[6]||(q[6]=U=>M.statusModal=!1)},{default:x(()=>[G("Close")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),L(P,{modelValue:M.queueDialog,"onUpdate:modelValue":q[9]||(q[9]=U=>M.queueDialog=U),"max-width":"600"},{default:x(()=>[L(n,null,{default:x(()=>[L(l,null,{default:x(()=>[G(" Queued Calls "),L(N),L(c,{icon:"",onClick:q[8]||(q[8]=U=>M.queueDialog=!1)},{default:x(()=>[L(a,null,{default:x(()=>[G("mdi-close")]),_:1})]),_:1})]),_:1}),L(d,null,{default:x(()=>[L(m,{headers:M.queuedCallsheaders,items:M.queuedCalls,"item-value":"id",class:"elevation-1"},{"item.actions":x(({item:U})=>[L(c,{color:"green",onClick:Q=>M.dequeueCall(U.id)},{default:x(()=>[G(" Dequeue ")]),_:2},1032,["onClick"])]),_:1},8,["headers","items"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),L(P,{modelValue:M.newCall,"onUpdate:modelValue":q[13]||(q[13]=U=>M.newCall=U),"max-width":"600"},{default:x(()=>[L(n,null,{default:x(()=>[L(l,null,{default:x(()=>[G(" Client Details "),L(N),L(c,{icon:"",onClick:q[10]||(q[10]=U=>M.newCall=!1)},{default:x(()=>[L(a,null,{default:x(()=>[G("mdi-close")]),_:1})]),_:1})]),_:1}),L(d,null,{default:x(()=>[L(B,{modelValue:M.phone,"onUpdate:modelValue":q[11]||(q[11]=U=>M.phone=U),label:"Phone Number",type:"text",required:""},null,8,["modelValue"])]),_:1}),L(D,null,{default:x(()=>[K("div",null,[M.isCalling?je("",!0):(Ce(),De(c,{key:0,color:"success",onClick:q[12]||(q[12]=U=>p.callClient(M.phone))},{default:x(()=>[L(a,{left:""},{default:x(()=>[G("mdi-phone")]),_:1}),G(" Call Client ")]),_:1})),M.isCalling?(Ce(),De(c,{key:1,color:"red",onClick:p.hangupCall},{default:x(()=>[L(a,{left:""},{default:x(()=>[G("mdi-phone-off")]),_:1}),G(" Hangup ")]),_:1},8,["onClick"])):je("",!0),M.isCalling?(Ce(),De(c,{key:2,color:"grey",onClick:M.handleHold},{default:x(()=>[L(a,{left:""},{default:x(()=>[G("mdi-pause")]),_:1}),G(" Hold ")]),_:1},8,["onClick"])):je("",!0),M.isCalling?(Ce(),De(c,{key:3,color:"grey",onClick:M.handleMute},{default:x(()=>[L(a,{left:""},{default:x(()=>[G("mdi-microphone-off")]),_:1}),G(" Mute ")]),_:1},8,["onClick"])):je("",!0),M.isCalling?(Ce(),De(c,{key:4,color:"grey",onClick:M.unmute},{default:x(()=>[L(a,{left:""},{default:x(()=>[G("mdi-microphone-on")]),_:1}),G(" Unmute ")]),_:1},8,["onClick"])):je("",!0),M.isCalling?(Ce(),De(c,{key:5,color:"grey",onClick:M.handleHold},{default:x(()=>[L(a,{left:""},{default:x(()=>[G("mdi-pause")]),_:1}),G(" Hold ")]),_:1},8,["onClick"])):je("",!0),M.isCalling?(Ce(),De(c,{key:6,color:"blue",onClick:M.unhold},{default:x(()=>[L(a,{left:""},{default:x(()=>[G("mdi-phone-transfer")]),_:1}),G(" Unhold ")]),_:1},8,["onClick"])):je("",!0),M.isCalling?(Ce(),De(c,{key:7,color:"blue",onClick:p.openTransferDialog},{default:x(()=>[L(a,{left:""},{default:x(()=>[G("mdi-phone-transfer")]),_:1}),G(" Transfer ")]),_:1},8,["onClick"])):je("",!0)])]),_:1})]),_:1})]),_:1},8,["modelValue"]),L(P,{modelValue:M.incomingCallDialog,"onUpdate:modelValue":q[15]||(q[15]=U=>M.incomingCallDialog=U),"max-width":"600"},{default:x(()=>[L(n,null,{default:x(()=>[L(l,null,{default:x(()=>[G(" Incoming Call "),L(N),L(c,{icon:"",onClick:q[14]||(q[14]=U=>M.incomingCallDialog=!1)},{default:x(()=>[L(a,null,{default:x(()=>[G("mdi-close")]),_:1})]),_:1})]),_:1}),L(d,null,{default:x(()=>[K("p",null,"Call from: "+Ae(M.incomingCall.from),1),K("p",null,"Duration: "+Ae(M.incomingCall.duration),1)]),_:1}),L(D,null,{default:x(()=>[L(c,{color:"success",onClick:p.answerCall},{default:x(()=>[G(" Answer ")]),_:1},8,["onClick"]),L(c,{color:"red",onClick:p.hangupCall},{default:x(()=>[G(" Reject ")]),_:1},8,["onClick"]),L(c,{color:"primary",onClick:p.transferCall},{default:x(()=>[G(" Transfer ")]),_:1},8,["onClick"]),M.isCalling?(Ce(),De(c,{key:0,color:"grey",onClick:M.handleMute},{default:x(()=>[L(a,{left:""},{default:x(()=>[G("mdi-microphone-off")]),_:1}),G(" Mute ")]),_:1},8,["onClick"])):je("",!0),M.isCalling?(Ce(),De(c,{key:1,color:"grey",onClick:M.unmute},{default:x(()=>[L(a,{left:""},{default:x(()=>[G("mdi-microphone-on")]),_:1}),G(" Unmute ")]),_:1},8,["onClick"])):je("",!0),M.isCalling?(Ce(),De(c,{key:2,color:"grey",onClick:M.handleHold},{default:x(()=>[L(a,{left:""},{default:x(()=>[G("mdi-pause")]),_:1}),G(" Hold ")]),_:1},8,["onClick"])):je("",!0),M.isCalling?(Ce(),De(c,{key:3,color:"blue",onClick:M.unhold},{default:x(()=>[L(a,{left:""},{default:x(()=>[G("mdi-phone-transfer")]),_:1}),G(" Unhold ")]),_:1},8,["onClick"])):je("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),L(P,{modelValue:M.transferDialog,"onUpdate:modelValue":q[17]||(q[17]=U=>M.transferDialog=U),"max-width":"600"},{default:x(()=>[L(n,null,{default:x(()=>[L(l,null,{default:x(()=>[G(" Transfer Call "),L(N),L(c,{icon:"",onClick:q[16]||(q[16]=U=>M.transferDialog=!1)},{default:x(()=>[L(a,null,{default:x(()=>[G("mdi-close")]),_:1})]),_:1})]),_:1}),L(d,null,{default:x(()=>[L(T,null,{default:x(()=>[(Ce(!0),tt(ct,null,st(M.agents,U=>(Ce(),De(g,{onClick:Q=>M.handleTransfer(U),key:U.name,class:"agent-item"},{default:x(()=>[K("div",null,[K("strong",null,Ae(U.name),1),K("span",{class:Ht({"text-success":U.status==="available","text-warning":U.status==="engaged","text-grey":U.status==="offline"})}," - "+Ae(U.status),3)])]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),L(D)]),_:1})]),_:1},8,["modelValue"]),L(P,{modelValue:M.phonePopup,"onUpdate:modelValue":q[20]||(q[20]=U=>M.phonePopup=U),"max-width":"600"},{default:x(()=>[L(n,null,{default:x(()=>[L(l,null,{default:x(()=>[G(" Client Details "),L(N),L(c,{icon:"",onClick:q[18]||(q[18]=U=>M.phonePopup=!1)},{default:x(()=>[L(a,null,{default:x(()=>[G("mdi-close")]),_:1})]),_:1})]),_:1}),L(d,null,{default:x(()=>{var U,Q,se,A,I;return[K("div",null,[Vr,G(" "+Ae((U=M.selectedItem)==null?void 0:U.client),1)]),K("div",null,[$r,G(" "+Ae((Q=M.selectedItem)==null?void 0:Q.email),1)]),K("div",null,[Wr,G(" "+Ae((se=M.selectedItem)==null?void 0:se.phone),1)]),K("div",null,[Xr,G(" "+Ae(((A=M.selectedItem)==null?void 0:A.altPhone)||"N/A"),1)]),K("div",null,[Kr,G(" "+Ae(((I=M.selectedItem)==null?void 0:I.location)||"N/A"),1)])]}),_:1}),L(D,null,{default:x(()=>[L(c,{color:"primary",onClick:q[19]||(q[19]=U=>{var Q;return p.callClient((Q=M.selectedItem)==null?void 0:Q.phone)})},{default:x(()=>[L(a,{left:""},{default:x(()=>[G("mdi-phone")]),_:1}),G(" Call Client ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})])]),_:1})}const ri=wr(Dr,[["render",Qr]]);export{ri as default};

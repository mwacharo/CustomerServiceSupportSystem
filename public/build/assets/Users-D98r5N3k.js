import{A as q}from"./AppLayout-BD4Swfdd.js";import{s as u,i as a,o as w,c as A,w as t,b as e,f as n,x as Q,t as g,a as p,z as y}from"./app-vhgUnBDt.js";import T from"./Permissions-g3JFqKTM.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";const O={components:{AppLayout:q,Permissions:T},data(){return{roles:[],branches:[],countries:[],dialog:!1,loading:!1,saving:!1,deleting:!1,isFormValid:!1,dialogDelete:!1,filterStatus:null,searchQuery:"",headers:[{title:"Administrator",align:"start",key:"name"},{title:"Email",key:"email"},{title:"Phone",key:"phone"},{title:"Agent SIP",key:"phone_number"},{title:"Role",key:"roles"},{title:"Status",key:"status"},{title:"Actions",key:"actions",sortable:!1,align:"end"}],users:[],originalUsers:[],editedIndex:-1,editedItem:{id:null,name:"",email:"",phone:"",address:"",selectedRole:null,phone_number:"",branch_id:null,country_id:null,status:"ready"},defaultItem:{id:null,name:"",email:"",phone:"",address:"",selectedRole:null,phone_number:"",branch_id:null,country_id:null,status:"ready"}}},computed:{formTitle(){return this.editedIndex===-1?"Create New Administrator":"Edit Administrator"},filteredUsers(){return!this.filterStatus||this.filterStatus==="All"?this.users:this.users.filter(l=>l.status&&l.status.toLowerCase()===this.filterStatus.toLowerCase())}},watch:{dialog(l){l?(this.fetchRoles(),this.fetchBranches(),this.fetchCountries()):this.close()},dialogDelete(l){!l&&this.closeDelete()}},created(){this.initialize()},methods:{getStatusColor(l){if(!l)return"grey";switch(l.toLowerCase()){case"ready":return"success";case"engaged":return"warning";case"offline":return"error";default:return"grey"}},getStatusVariant(l){return l?"flat":"outlined"},getStatusIcon(l){if(!l)return"mdi-help-circle";switch(l.toLowerCase()){case"ready":return"mdi-check-circle";case"engaged":return"mdi-clock";case"offline":return"mdi-power";default:return"mdi-help-circle"}},fetchRoles(){u.get("api/v1/roles").then(l=>{this.roles=l.data}).catch(l=>{console.error("API Error:",l),this.$toastr.error("Failed to load roles")})},fetchBranches(){u.get("api/v1/branches").then(l=>{this.branches=l.data}).catch(l=>{console.error("API Error:",l),this.$toastr.error("Failed to load branches")})},fetchCountries(){u.get("api/v1/countries").then(l=>{this.countries=l.data}).catch(l=>{console.error("API Error:",l),this.$toastr.error("Failed to load countries")})},initialize(){this.loading=!0,u.get("v1/users").then(l=>{this.users=l.data.map(i=>({...i,roles:i.roles&&i.roles.length?i.roles:[]})),this.originalUsers=[...this.users],this.loading=!1}).catch(l=>{console.error("API Error:",l),this.$toastr.error("Failed to load administrators"),this.loading=!1})},editItem(l){this.editedIndex=this.users.indexOf(l),this.editedItem={...l,selectedRole:l.roles.length?l.roles[0].name:null},this.dialog=!0},deleteItem(l){this.editedIndex=this.users.indexOf(l),this.editedItem={...l},this.dialogDelete=!0},deleteItemConfirm(){this.deleting=!0,u.delete(`/api/v1/user/${this.editedItem.id}`).then(()=>{this.users.splice(this.editedIndex,1),this.$toastr.success("Administrator deleted successfully"),this.closeDelete()}).catch(l=>{console.error("Deletion error:",l),this.$toastr.error("Failed to delete administrator")}).finally(()=>{this.deleting=!1})},close(){this.dialog=!1,this.resetForm()},closeDelete(){this.dialogDelete=!1,this.resetForm()},resetForm(){this.$nextTick(()=>{this.$refs.form&&this.$refs.form.reset(),this.editedItem={...this.defaultItem},this.editedIndex=-1})},managePermissions(l){this.$refs.PermissionsComponent.showDialog(l.id)},save(){if(!this.isFormValid)return;this.saving=!0;let l;const i={...this.editedItem,role:this.editedItem.selectedRole||""};this.editedIndex>-1?l=u.put(`/api/v1/user/${this.editedItem.id}`,i):l=u.post("/api/v1/user",i),l.then(()=>{this.initialize(),this.close(),this.$toastr.success(`Administrator ${this.editedIndex===-1?"created":"updated"} successfully`)}).catch(S=>{console.error("Save error:",S),this.$toastr.error(`Failed to ${this.editedIndex===-1?"create":"update"} administrator`)}).finally(()=>{this.saving=!1})},performSearch(){this.searchQuery.trim()===""?this.users=[...this.originalUsers]:(this.loading=!0,u.get("v1/users/search",{params:{query:this.searchQuery}}).then(l=>{this.users=l.data,this.loading=!1}).catch(l=>{console.error("Search error:",l),this.$toastr.error("Search failed"),this.loading=!1}))},filterByStatus(){},activateAccount(l){u.post(`v1/user/activate/${l.id}`).then(()=>{this.initialize(),this.$toastr.success("Account activated successfully")}).catch(i=>{console.error("Activation error:",i),this.$toastr.error("Failed to activate account")})},resetPassword(l){u.post(`v1/user/reset-password/${l.id}`).then(()=>{this.$toastr.success("Password reset email sent successfully")}).catch(i=>{console.error("Password reset error:",i),this.$toastr.error("Failed to reset password")})}}},j=p("span",{class:"text-h5 font-weight-bold"},"Admin Management",-1),M={class:"d-flex align-center"},G={class:"d-flex flex-column align-center py-6"},H=p("p",{class:"text-body-1 text-medium-emphasis mb-4"},"No administrators found",-1),J={class:"text-h5 font-weight-bold"};function W(l,i,S,X,o,r){const d=a("v-btn"),b=a("v-card-title"),h=a("v-text-field"),c=a("v-col"),_=a("v-select"),z=a("v-row"),V=a("v-card-text"),D=a("v-progress-linear"),I=a("v-chip"),f=a("v-icon"),v=a("v-tooltip"),R=a("v-data-table"),C=a("v-card"),E=a("v-container"),k=a("v-divider"),N=a("v-form"),P=a("v-spacer"),U=a("v-card-actions"),F=a("v-dialog"),B=a("Permissions"),L=a("AppLayout");return w(),A(L,null,{default:t(()=>[e(E,{fluid:"",class:"pa-0"},{default:t(()=>[e(C,{class:"rounded-lg elevation-2 mb-6"},{default:t(()=>[e(b,{class:"d-flex justify-space-between align-center py-4 px-6 bg-surface"},{default:t(()=>[j,e(d,{color:"primary","prepend-icon":"mdi-plus",onClick:i[0]||(i[0]=s=>o.dialog=!0),size:"large",variant:"elevated",rounded:"pill"},{default:t(()=>[n(" New Admin ")]),_:1})]),_:1}),e(V,{class:"pa-6"},{default:t(()=>[e(z,null,{default:t(()=>[e(c,{cols:"12",md:"6",lg:"4"},{default:t(()=>[e(h,{modelValue:o.searchQuery,"onUpdate:modelValue":i[1]||(i[1]=s=>o.searchQuery=s),label:"Search administrators","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"comfortable","hide-details":"",clearable:"",onKeyup:Q(r.performSearch,["enter"]),"onClick:clear":r.initialize,class:"rounded-lg"},null,8,["modelValue","onKeyup","onClick:clear"])]),_:1}),e(c,{cols:"12",md:"6",lg:"4"},{default:t(()=>[e(_,{modelValue:o.filterStatus,"onUpdate:modelValue":[i[2]||(i[2]=s=>o.filterStatus=s),r.filterByStatus],items:["All","Ready","Engaged","Offline"],label:"Filter by status",variant:"outlined",density:"comfortable","hide-details":"",clearable:"",class:"rounded-lg"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1})]),_:1}),e(R,{headers:o.headers,loading:o.loading,items:r.filteredUsers,"sort-by":[{key:"name",order:"asc"}],"items-per-page":10,"loading-text":"Loading administrators...",class:"rounded-b-lg"},{loader:t(()=>[e(D,{indeterminate:"",color:"primary",height:"2"})]),"item.roles":t(({item:s})=>[s.roles&&s.roles.length?(w(),A(I,{key:0,color:"primary",variant:"flat",size:"small",class:"font-weight-medium"},{default:t(()=>[n(g(s.roles[0].name),1)]),_:2},1024)):(w(),A(I,{key:1,color:"grey",variant:"outlined",size:"small"},{default:t(()=>[n(" No role ")]),_:1}))]),"item.status":t(({item:s})=>[e(I,{color:r.getStatusColor(s.status),variant:r.getStatusVariant(s.status),size:"small",class:"font-weight-medium"},{default:t(()=>[e(f,{start:"",size:"small",color:r.getStatusColor(s.status)},{default:t(()=>[n(g(r.getStatusIcon(s.status)),1)]),_:2},1032,["color"]),n(" "+g(s.status||"N/A"),1)]),_:2},1032,["color","variant"])]),"item.actions":t(({item:s})=>[p("div",M,[e(v,{location:"top",text:"Edit"},{activator:t(({props:m})=>[e(d,y(m,{icon:"",size:"small",color:"primary",class:"me-1",variant:"text",onClick:x=>r.editItem(s)}),{default:t(()=>[e(f,null,{default:t(()=>[n("mdi-pencil")]),_:1})]),_:2},1040,["onClick"])]),_:2},1024),e(v,{location:"top",text:"Delete"},{activator:t(({props:m})=>[e(d,y(m,{icon:"",size:"small",color:"error",class:"me-1",variant:"text",onClick:x=>r.deleteItem(s)}),{default:t(()=>[e(f,null,{default:t(()=>[n("mdi-delete")]),_:1})]),_:2},1040,["onClick"])]),_:2},1024),e(v,{location:"top",text:"Activate Account"},{activator:t(({props:m})=>[e(d,y(m,{icon:"",size:"small",color:"success",class:"me-1",variant:"text",onClick:x=>r.activateAccount(s)}),{default:t(()=>[e(f,null,{default:t(()=>[n("mdi-account-check")]),_:1})]),_:2},1040,["onClick"])]),_:2},1024),e(v,{location:"top",text:"Reset Password"},{activator:t(({props:m})=>[e(d,y(m,{icon:"",size:"small",color:"warning",class:"me-1",variant:"text",onClick:x=>r.resetPassword(s)}),{default:t(()=>[e(f,null,{default:t(()=>[n("mdi-lock-reset")]),_:1})]),_:2},1040,["onClick"])]),_:2},1024),e(v,{location:"top",text:"Manage Permissions"},{activator:t(({props:m})=>[e(d,y(m,{icon:"",size:"small",color:"info",variant:"text",onClick:x=>r.managePermissions(s)}),{default:t(()=>[e(f,null,{default:t(()=>[n("mdi-shield-account")]),_:1})]),_:2},1040,["onClick"])]),_:2},1024)])]),"no-data":t(()=>[p("div",G,[e(f,{size:"64",color:"grey-lighten-1",class:"mb-4"},{default:t(()=>[n("mdi-account-off")]),_:1}),H,e(d,{color:"primary",variant:"elevated",onClick:r.initialize},{default:t(()=>[n(" Refresh Data ")]),_:1},8,["onClick"])])]),_:1},8,["headers","loading","items","loading-text"])]),_:1})]),_:1}),e(F,{modelValue:o.dialog,"onUpdate:modelValue":i[13]||(i[13]=s=>o.dialog=s),"max-width":"800px",persistent:""},{default:t(()=>[e(C,{class:"rounded-lg"},{default:t(()=>[e(b,{class:"d-flex justify-space-between pa-6 bg-surface"},{default:t(()=>[p("span",J,g(r.formTitle),1),e(d,{icon:"",onClick:r.close,variant:"text"},{default:t(()=>[e(f,null,{default:t(()=>[n("mdi-close")]),_:1})]),_:1},8,["onClick"])]),_:1}),e(k),e(V,{class:"pa-6"},{default:t(()=>[e(N,{ref:"form",modelValue:o.isFormValid,"onUpdate:modelValue":i[12]||(i[12]=s=>o.isFormValid=s)},{default:t(()=>[e(z,null,{default:t(()=>[e(c,{cols:"12",md:"6"},{default:t(()=>[e(h,{modelValue:o.editedItem.name,"onUpdate:modelValue":i[3]||(i[3]=s=>o.editedItem.name=s),label:"Full Name",variant:"outlined","prepend-inner-icon":"mdi-account",rules:[s=>!!s||"Name is required"]},null,8,["modelValue","rules"])]),_:1}),e(c,{cols:"12",md:"6"},{default:t(()=>[e(h,{modelValue:o.editedItem.email,"onUpdate:modelValue":i[4]||(i[4]=s=>o.editedItem.email=s),label:"Email",variant:"outlined","prepend-inner-icon":"mdi-email",rules:[s=>!!s||"Email is required",s=>/.+@.+\..+/.test(s)||"Email must be valid"]},null,8,["modelValue","rules"])]),_:1}),e(c,{cols:"12",md:"6"},{default:t(()=>[e(h,{modelValue:o.editedItem.phone,"onUpdate:modelValue":i[5]||(i[5]=s=>o.editedItem.phone=s),label:"Phone Number",variant:"outlined","prepend-inner-icon":"mdi-phone"},null,8,["modelValue"])]),_:1}),e(c,{cols:"12",md:"6"},{default:t(()=>[e(h,{modelValue:o.editedItem.phone_number,"onUpdate:modelValue":i[6]||(i[6]=s=>o.editedItem.phone_number=s),label:"Agent SIP",variant:"outlined","prepend-inner-icon":"mdi-phone-voip"},null,8,["modelValue"])]),_:1}),e(c,{cols:"12",md:"6"},{default:t(()=>[e(_,{modelValue:o.editedItem.selectedRole,"onUpdate:modelValue":i[7]||(i[7]=s=>o.editedItem.selectedRole=s),items:o.roles,"item-title":"name","item-value":"name",label:"Role",variant:"outlined","prepend-inner-icon":"mdi-shield-account",rules:[s=>!!s||"Role is required"]},null,8,["modelValue","items","rules"])]),_:1}),e(c,{cols:"12",md:"6"},{default:t(()=>[e(_,{modelValue:o.editedItem.status,"onUpdate:modelValue":i[8]||(i[8]=s=>o.editedItem.status=s),items:["ready","engaged","offline"],label:"Status",variant:"outlined","prepend-inner-icon":"mdi-account-clock"},null,8,["modelValue"])]),_:1}),e(c,{cols:"12",md:"6"},{default:t(()=>[e(_,{modelValue:o.editedItem.branch_id,"onUpdate:modelValue":i[9]||(i[9]=s=>o.editedItem.branch_id=s),items:o.branches,"item-title":"name","item-value":"id",label:"Branch",variant:"outlined","prepend-inner-icon":"mdi-office-building"},null,8,["modelValue","items"])]),_:1}),e(c,{cols:"12",md:"6"},{default:t(()=>[e(_,{modelValue:o.editedItem.country_id,"onUpdate:modelValue":i[10]||(i[10]=s=>o.editedItem.country_id=s),items:o.countries,"item-title":"name","item-value":"id",label:"Country",variant:"outlined","prepend-inner-icon":"mdi-earth"},null,8,["modelValue","items"])]),_:1}),e(c,{cols:"12"},{default:t(()=>[e(h,{modelValue:o.editedItem.address,"onUpdate:modelValue":i[11]||(i[11]=s=>o.editedItem.address=s),label:"Address",variant:"outlined","prepend-inner-icon":"mdi-map-marker"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(k),e(U,{class:"pa-6"},{default:t(()=>[e(P),e(d,{color:"error",variant:"text",onClick:r.close,class:"text-capitalize"},{default:t(()=>[n(" Cancel ")]),_:1},8,["onClick"]),e(d,{color:"primary",variant:"elevated",onClick:r.save,loading:o.saving,disabled:!o.isFormValid||o.saving,class:"text-capitalize"},{default:t(()=>[n(" Save ")]),_:1},8,["onClick","loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(F,{modelValue:o.dialogDelete,"onUpdate:modelValue":i[14]||(i[14]=s=>o.dialogDelete=s),"max-width":"500px",persistent:""},{default:t(()=>[e(C,{class:"rounded-lg"},{default:t(()=>[e(b,{class:"text-h5 pa-6"},{default:t(()=>[n("Confirm Deletion")]),_:1}),e(V,{class:"pa-6"},{default:t(()=>[n(" Are you sure you want to delete "),p("strong",null,g(o.editedItem.name),1),n("? This action cannot be undone. ")]),_:1}),e(k),e(U,{class:"pa-6"},{default:t(()=>[e(P),e(d,{color:"grey",variant:"text",onClick:r.closeDelete,class:"text-capitalize"},{default:t(()=>[n(" Cancel ")]),_:1},8,["onClick"]),e(d,{color:"error",variant:"elevated",onClick:r.deleteItemConfirm,loading:o.deleting,class:"text-capitalize"},{default:t(()=>[n(" Delete ")]),_:1},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(B,{ref:"PermissionsComponent"},null,512)]),_:1})}const te=K(O,[["render",W]]);export{te as default};

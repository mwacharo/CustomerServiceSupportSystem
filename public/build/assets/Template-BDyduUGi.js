import{A as Q}from"./AppLayout-y0exyz6z.js";import{s as y,i as n,o as f,c as V,w as t,b as e,f as r,x as H,t as u,a as d,z as k,e as M,d as T,g as j,F as K}from"./app-B1glDZTM.js";import{_ as R}from"./_plugin-vue_export-helper-DlAUqK2U.js";const G={components:{AppLayout:Q},data(){return{branches:[],users:[],dialog:!1,dialogPreview:!1,loading:!1,saving:!1,deleting:!1,isFormValid:!1,dialogDelete:!1,filterChannel:null,filterModule:null,searchQuery:"",headers:[{title:"Template Name",align:"start",key:"name"},{title:"Channel",key:"channel"},{title:"Module",key:"module"},{title:"Content",key:"content"},{title:"Actions",key:"actions",sortable:!1,align:"end"}],templates:[],originalTemplates:[],placeholders:[],placeholderValues:{},editedIndex:-1,editedItem:{id:null,name:"",channel:"",module:"",content:"",placeholders:"",owner_type:"system",owner_id:null},previewItem:{id:null,name:"",channel:"",module:"",content:"",placeholders:""},defaultItem:{id:null,name:"",channel:"",module:"",content:"",placeholders:"",owner_type:"system",owner_id:null}}},computed:{formTitle(){return this.editedIndex===-1?"Create New Template":"Edit Template"},filteredTemplates(){let a=[...this.templates];return this.filterChannel&&this.filterChannel!=="All"&&(a=a.filter(i=>i.channel===this.filterChannel)),this.filterModule&&this.filterModule!=="All"&&(a=a.filter(i=>i.module===this.filterModule)),a},processedContent(){let a=this.previewItem.content;return this.previewItem.placeholders&&this.extractPlaceholders(this.previewItem.placeholders).forEach(p=>{const F=this.placeholderValues[p]||`[${p}]`;a=a.replace(new RegExp(`{${p}}`,"g"),F)}),a}},watch:{dialog(a){a?(this.fetchUsers(),this.fetchBranches()):this.close()},dialogDelete(a){!a&&this.closeDelete()},"editedItem.placeholders":{handler(a){if(typeof a=="string"&&a)try{this.placeholders=JSON.parse(a)}catch{}},immediate:!0}},created(){this.initialize()},methods:{getChannelColor(a){switch(a.toLowerCase()){case"email":return"primary";case"sms":return"success";case"push":return"warning";case"in-app":return"info";default:return"grey"}},fetchUsers(){y.get("api/v1/users").then(a=>{this.users=a.data}).catch(a=>{console.error("API Error:",a),this.$toastr.error("Failed to load users")})},fetchBranches(){y.get("api/v1/branches").then(a=>{this.branches=a.data}).catch(a=>{console.error("API Error:",a),this.$toastr.error("Failed to load branches")})},initialize(){this.loading=!0,y.get("/api/v1/templates").then(a=>{this.templates=a.data.data,this.originalTemplates=[...this.templates],this.loading=!1}).catch(a=>{console.error("API Error:",a),this.$toastr.error("Failed to load templates"),this.loading=!1})},editItem(a){if(this.editedIndex=this.templates.indexOf(a),this.editedItem={...a},typeof this.editedItem.placeholders=="string")try{this.placeholders=JSON.parse(this.editedItem.placeholders)}catch{this.placeholders=[]}else Array.isArray(this.editedItem.placeholders)?this.placeholders=[...this.editedItem.placeholders]:this.placeholders=[];this.dialog=!0},deleteItem(a){this.editedIndex=this.templates.indexOf(a),this.editedItem={...a},this.dialogDelete=!0},deleteItemConfirm(){this.deleting=!0,y.delete(`/api/v1/templates/${this.editedItem.id}`).then(()=>{this.templates.splice(this.editedIndex,1),this.$toastr.success("Template deleted successfully"),this.closeDelete()}).catch(a=>{console.error("Deletion error:",a),this.$toastr.error("Failed to delete template")}).finally(()=>{this.deleting=!1})},close(){this.dialog=!1,this.resetForm()},closeDelete(){this.dialogDelete=!1,this.resetForm()},resetForm(){this.$nextTick(()=>{this.$refs.form&&this.$refs.form.reset(),this.editedItem={...this.defaultItem},this.editedIndex=-1,this.placeholders=[]})},cloneTemplate(a){const i={...a};if(delete i.id,i.name=`${i.name} (Copy)`,this.editedItem=i,this.editedIndex=-1,typeof i.placeholders=="string")try{this.placeholders=JSON.parse(i.placeholders)}catch{this.placeholders=[]}else Array.isArray(i.placeholders)?this.placeholders=[...i.placeholders]:this.placeholders=[];this.dialog=!0},previewTemplate(a){this.previewItem={...a},this.placeholderValues={},this.previewItem.placeholders&&this.extractPlaceholders(this.previewItem.placeholders).forEach(p=>{this.placeholderValues[p]=""}),this.dialogPreview=!0},extractPlaceholders(a){if(typeof a=="string")try{return JSON.parse(a)}catch{return[]}else if(Array.isArray(a))return a;return[]},updatePreview(){},save(){if(!this.isFormValid)return;this.saving=!0;const a={...this.editedItem,placeholders:JSON.stringify(this.placeholders)};let i;this.editedIndex>-1?i=y.put(`/api/v1/templates/${this.editedItem.id}`,a):i=y.post("/api/v1/templates",a),i.then(()=>{this.initialize(),this.close(),this.$toastr.success(`Template ${this.editedIndex===-1?"created":"updated"} successfully`)}).catch(p=>{console.error("Save error:",p),this.$toastr.error(`Failed to ${this.editedIndex===-1?"create":"update"} template`)}).finally(()=>{this.saving=!1})},performSearch(){this.searchQuery.trim()===""?this.templates=[...this.originalTemplates]:(this.loading=!0,y.get("v1/templates",{params:{search:this.searchQuery}}).then(a=>{this.templates=a.data,this.loading=!1}).catch(a=>{console.error("Search error:",a),this.$toastr.error("Search failed"),this.loading=!1}))},filterByChannel(){},filterByModule(){}}},W=d("span",{class:"text-h5 font-weight-bold"},"Template Management",-1),X={class:"text-truncate d-inline-block",style:{"max-width":"200px"}},Y={class:"d-flex align-center"},Z={class:"d-flex flex-column align-center py-6"},$=d("p",{class:"text-body-1 text-medium-emphasis mb-4"},"No templates found",-1),ee={class:"text-h5 font-weight-bold"},te=d("div",{class:"text-caption text-grey mt-2"}," Add placeholders that can be used in this template (e.g., {name}, {order_id}) ",-1),le=["innerHTML"],ie=d("span",{class:"text-h5 font-weight-bold"},"Template Preview",-1),ae={key:0,class:"email-preview"},se={class:"email-header pa-4 rounded-t-lg bg-grey-lighten-4 border-b"},oe={class:"text-subtitle-1 font-weight-bold"},ne={class:"text-caption text-grey"},re=["innerHTML"],de={key:1,class:"sms-preview"},ce={class:"text-body-1"},me={key:2,class:"generic-preview"},ue={class:"text-subtitle-2 mb-2"},pe={class:"text-body-2"},he=d("div",{class:"text-subtitle-1 mb-3"},"Replace Placeholders:",-1);function fe(a,i,p,F,s,o){const c=n("v-btn"),b=n("v-card-title"),P=n("v-text-field"),m=n("v-col"),v=n("v-select"),S=n("v-row"),w=n("v-card-text"),N=n("v-progress-linear"),D=n("v-chip"),_=n("v-icon"),C=n("v-tooltip"),B=n("v-data-table"),g=n("v-card"),E=n("v-container"),x=n("v-divider"),O=n("v-textarea"),L=n("v-combobox"),q=n("v-form"),U=n("v-spacer"),A=n("v-card-actions"),z=n("v-dialog"),J=n("AppLayout");return f(),V(J,null,{default:t(()=>[e(E,{fluid:"",class:"pa-0"},{default:t(()=>[e(g,{class:"rounded-lg elevation-2 mb-6"},{default:t(()=>[e(b,{class:"d-flex justify-space-between align-center py-4 px-6 bg-surface"},{default:t(()=>[W,e(c,{color:"primary","prepend-icon":"mdi-plus",onClick:i[0]||(i[0]=l=>s.dialog=!0),size:"large",variant:"elevated",rounded:"pill"},{default:t(()=>[r(" New Template ")]),_:1})]),_:1}),e(w,{class:"pa-6"},{default:t(()=>[e(S,null,{default:t(()=>[e(m,{cols:"12",md:"6",lg:"4"},{default:t(()=>[e(P,{modelValue:s.searchQuery,"onUpdate:modelValue":i[1]||(i[1]=l=>s.searchQuery=l),label:"Search templates","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"comfortable","hide-details":"",clearable:"",onKeyup:H(o.performSearch,["enter"]),"onClick:clear":o.initialize,class:"rounded-lg"},null,8,["modelValue","onKeyup","onClick:clear"])]),_:1}),e(m,{cols:"12",md:"6",lg:"4"},{default:t(()=>[e(v,{modelValue:s.filterChannel,"onUpdate:modelValue":[i[2]||(i[2]=l=>s.filterChannel=l),o.filterByChannel],items:["All","Email","SMS","Push","In-app"],label:"Filter by channel",variant:"outlined",density:"comfortable","hide-details":"",clearable:"",class:"rounded-lg"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(m,{cols:"12",md:"6",lg:"4"},{default:t(()=>[e(v,{modelValue:s.filterModule,"onUpdate:modelValue":[i[3]||(i[3]=l=>s.filterModule=l),o.filterByModule],items:["All","Customer","Order","Payment","Shipping","Support"],label:"Filter by module",variant:"outlined",density:"comfortable","hide-details":"",clearable:"",class:"rounded-lg"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1})]),_:1}),e(B,{headers:s.headers,loading:s.loading,items:o.filteredTemplates,"sort-by":[{key:"name",order:"asc"}],"items-per-page":10,"loading-text":"Loading templates...",class:"rounded-b-lg"},{loader:t(()=>[e(N,{indeterminate:"",color:"primary",height:"2"})]),"item.channel":t(({item:l})=>[e(D,{color:o.getChannelColor(l.channel),variant:"flat",size:"small",class:"font-weight-medium"},{default:t(()=>[r(u(l.channel),1)]),_:2},1032,["color"])]),"item.module":t(({item:l})=>[e(D,{color:"info",variant:"flat",size:"small",class:"font-weight-medium"},{default:t(()=>[r(u(l.module),1)]),_:2},1024)]),"item.content":t(({item:l})=>[d("span",X,u(l.content),1)]),"item.actions":t(({item:l})=>[d("div",Y,[e(C,{location:"top",text:"Edit"},{activator:t(({props:h})=>[e(c,k(h,{icon:"",size:"small",color:"primary",class:"me-1",variant:"text",onClick:I=>o.editItem(l)}),{default:t(()=>[e(_,null,{default:t(()=>[r("mdi-pencil")]),_:1})]),_:2},1040,["onClick"])]),_:2},1024),e(C,{location:"top",text:"Delete"},{activator:t(({props:h})=>[e(c,k(h,{icon:"",size:"small",color:"error",class:"me-1",variant:"text",onClick:I=>o.deleteItem(l)}),{default:t(()=>[e(_,null,{default:t(()=>[r("mdi-delete")]),_:1})]),_:2},1040,["onClick"])]),_:2},1024),e(C,{location:"top",text:"Clone"},{activator:t(({props:h})=>[e(c,k(h,{icon:"",size:"small",color:"info",class:"me-1",variant:"text",onClick:I=>o.cloneTemplate(l)}),{default:t(()=>[e(_,null,{default:t(()=>[r("mdi-content-copy")]),_:1})]),_:2},1040,["onClick"])]),_:2},1024),e(C,{location:"top",text:"Preview"},{activator:t(({props:h})=>[e(c,k(h,{icon:"",size:"small",color:"success",variant:"text",onClick:I=>o.previewTemplate(l)}),{default:t(()=>[e(_,null,{default:t(()=>[r("mdi-eye")]),_:1})]),_:2},1040,["onClick"])]),_:2},1024)])]),"no-data":t(()=>[d("div",Z,[e(_,{size:"64",color:"grey-lighten-1",class:"mb-4"},{default:t(()=>[r("mdi-file-document-outline")]),_:1}),$,e(c,{color:"primary",variant:"elevated",onClick:o.initialize},{default:t(()=>[r(" Refresh Data ")]),_:1},8,["onClick"])])]),_:1},8,["headers","loading","items","loading-text"])]),_:1})]),_:1}),e(z,{modelValue:s.dialog,"onUpdate:modelValue":i[13]||(i[13]=l=>s.dialog=l),"max-width":"900px",persistent:""},{default:t(()=>[e(g,{class:"rounded-lg"},{default:t(()=>[e(b,{class:"d-flex justify-space-between pa-6 bg-surface"},{default:t(()=>[d("span",ee,u(o.formTitle),1),e(c,{icon:"",onClick:o.close,variant:"text"},{default:t(()=>[e(_,null,{default:t(()=>[r("mdi-close")]),_:1})]),_:1},8,["onClick"])]),_:1}),e(x),e(w,{class:"pa-6"},{default:t(()=>[e(q,{ref:"form",modelValue:s.isFormValid,"onUpdate:modelValue":i[12]||(i[12]=l=>s.isFormValid=l)},{default:t(()=>[e(S,null,{default:t(()=>[e(m,{cols:"12",md:"6"},{default:t(()=>[e(P,{modelValue:s.editedItem.name,"onUpdate:modelValue":i[4]||(i[4]=l=>s.editedItem.name=l),label:"Template Name",variant:"outlined","prepend-inner-icon":"mdi-file-document-outline",rules:[l=>!!l||"Template name is required"]},null,8,["modelValue","rules"])]),_:1}),e(m,{cols:"12",md:"6"},{default:t(()=>[e(v,{modelValue:s.editedItem.channel,"onUpdate:modelValue":i[5]||(i[5]=l=>s.editedItem.channel=l),items:["Email","SMS","Push","In-app"],label:"Channel",variant:"outlined","prepend-inner-icon":"mdi-broadcast",rules:[l=>!!l||"Channel is required"]},null,8,["modelValue","rules"])]),_:1}),e(m,{cols:"12",md:"6"},{default:t(()=>[e(v,{modelValue:s.editedItem.module,"onUpdate:modelValue":i[6]||(i[6]=l=>s.editedItem.module=l),items:["Customer","Order","Payment","Shipping","Support"],label:"Module",variant:"outlined","prepend-inner-icon":"mdi-apps",rules:[l=>!!l||"Module is required"]},null,8,["modelValue","rules"])]),_:1}),e(m,{cols:"12",md:"6"},{default:t(()=>[e(v,{modelValue:s.editedItem.owner_type,"onUpdate:modelValue":i[7]||(i[7]=l=>s.editedItem.owner_type=l),items:[{title:"System",value:"system"},{title:"User",value:"user"},{title:"Branch",value:"branch"}],"item-title":"title","item-value":"value",label:"Owner Type",variant:"outlined","prepend-inner-icon":"mdi-account-cog",rules:[l=>!!l||"Owner type is required"]},null,8,["modelValue","rules"])]),_:1}),s.editedItem.owner_type==="user"?(f(),V(m,{key:0,cols:"12",md:"6"},{default:t(()=>[e(v,{modelValue:s.editedItem.owner_id,"onUpdate:modelValue":i[8]||(i[8]=l=>s.editedItem.owner_id=l),items:s.users,"item-title":"name","item-value":"id",label:"Owner",variant:"outlined","prepend-inner-icon":"mdi-account",rules:[l=>!!l||"Owner is required"]},null,8,["modelValue","items","rules"])]),_:1})):M("",!0),s.editedItem.owner_type==="branch"?(f(),V(m,{key:1,cols:"12",md:"6"},{default:t(()=>[e(v,{modelValue:s.editedItem.owner_id,"onUpdate:modelValue":i[9]||(i[9]=l=>s.editedItem.owner_id=l),items:s.branches,"item-title":"name","item-value":"id",label:"Branch",variant:"outlined","prepend-inner-icon":"mdi-office-building",rules:[l=>!!l||"Branch is required"]},null,8,["modelValue","items","rules"])]),_:1})):M("",!0),e(m,{cols:"12"},{default:t(()=>[e(O,{modelValue:s.editedItem.content,"onUpdate:modelValue":i[10]||(i[10]=l=>s.editedItem.content=l),label:"Template Content",variant:"outlined","prepend-inner-icon":"mdi-card-text-outline","auto-grow":"",rows:"8",rules:[l=>!!l||"Content is required"]},null,8,["modelValue","rules"])]),_:1}),e(m,{cols:"12"},{default:t(()=>[e(L,{modelValue:s.placeholders,"onUpdate:modelValue":i[11]||(i[11]=l=>s.placeholders=l),label:"Available Placeholders",variant:"outlined","prepend-inner-icon":"mdi-code-braces",chips:"","closable-chips":"",multiple:"","small-chips":"","hide-details":""},null,8,["modelValue"]),te]),_:1}),s.editedItem.channel==="Email"?(f(),V(m,{key:2,cols:"12"},{default:t(()=>[e(g,{variant:"outlined",class:"mt-4"},{default:t(()=>[e(b,{class:"text-subtitle-1"},{default:t(()=>[e(_,{start:"",color:"info"},{default:t(()=>[r("mdi-information-outline")]),_:1}),r(" Template Preview ")]),_:1}),e(w,null,{default:t(()=>[d("div",{innerHTML:s.editedItem.content,class:"preview-area pa-4 rounded-lg"},null,8,le)]),_:1})]),_:1})]),_:1})):M("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(x),e(A,{class:"pa-6"},{default:t(()=>[e(U),e(c,{color:"error",variant:"text",onClick:o.close,class:"text-capitalize"},{default:t(()=>[r(" Cancel ")]),_:1},8,["onClick"]),e(c,{color:"primary",variant:"elevated",onClick:o.save,loading:s.saving,disabled:!s.isFormValid||s.saving,class:"text-capitalize"},{default:t(()=>[r(" Save ")]),_:1},8,["onClick","loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(z,{modelValue:s.dialogDelete,"onUpdate:modelValue":i[14]||(i[14]=l=>s.dialogDelete=l),"max-width":"500px",persistent:""},{default:t(()=>[e(g,{class:"rounded-lg"},{default:t(()=>[e(b,{class:"text-h5 pa-6"},{default:t(()=>[r("Confirm Deletion")]),_:1}),e(w,{class:"pa-6"},{default:t(()=>[r(" Are you sure you want to delete template "),d("strong",null,u(s.editedItem.name),1),r("? This action cannot be undone. ")]),_:1}),e(x),e(A,{class:"pa-6"},{default:t(()=>[e(U),e(c,{color:"grey",variant:"text",onClick:o.closeDelete,class:"text-capitalize"},{default:t(()=>[r(" Cancel ")]),_:1},8,["onClick"]),e(c,{color:"error",variant:"elevated",onClick:o.deleteItemConfirm,loading:s.deleting,class:"text-capitalize"},{default:t(()=>[r(" Delete ")]),_:1},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(z,{modelValue:s.dialogPreview,"onUpdate:modelValue":i[17]||(i[17]=l=>s.dialogPreview=l),"max-width":"800px"},{default:t(()=>[e(g,{class:"rounded-lg"},{default:t(()=>[e(b,{class:"d-flex justify-space-between pa-6 bg-surface"},{default:t(()=>[ie,e(c,{icon:"",onClick:i[15]||(i[15]=l=>s.dialogPreview=!1),variant:"text"},{default:t(()=>[e(_,null,{default:t(()=>[r("mdi-close")]),_:1})]),_:1})]),_:1}),e(x),e(w,{class:"pa-6"},{default:t(()=>[s.previewItem.channel==="Email"?(f(),T("div",ae,[d("div",se,[d("div",oe,u(s.previewItem.name),1),d("div",ne,u(s.previewItem.module)+" Template",1)]),d("div",{class:"email-body pa-6",innerHTML:o.processedContent},null,8,re)])):s.previewItem.channel==="SMS"?(f(),T("div",de,[e(g,{variant:"outlined",class:"pa-4 bg-grey-lighten-4"},{default:t(()=>[d("div",ce,u(o.processedContent),1)]),_:1})])):(f(),T("div",me,[e(g,{variant:"outlined",class:"pa-4"},{default:t(()=>[d("div",ue,u(s.previewItem.channel)+" Template: "+u(s.previewItem.name),1),d("div",pe,u(o.processedContent),1)]),_:1})])),e(x,{class:"my-6"}),d("div",null,[he,e(S,null,{default:t(()=>[(f(!0),T(K,null,j(o.extractPlaceholders(s.previewItem.placeholders),(l,h)=>(f(),V(m,{cols:"12",md:"6",key:h},{default:t(()=>[e(P,{modelValue:s.placeholderValues[l],"onUpdate:modelValue":I=>s.placeholderValues[l]=I,label:l,variant:"outlined",density:"comfortable",onInput:o.updatePreview},null,8,["modelValue","onUpdate:modelValue","label","onInput"])]),_:2},1024))),128))]),_:1})])]),_:1}),e(x),e(A,{class:"pa-6"},{default:t(()=>[e(U),e(c,{color:"primary",variant:"text",onClick:i[16]||(i[16]=l=>s.dialogPreview=!1),class:"text-capitalize"},{default:t(()=>[r(" Close ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const ye=R(G,[["render",fe]]);export{ye as default};

import{Z as Pe}from"./index.esm-DsrG5anJ.js";import{A as Ue}from"./AppLayout-pTM9Kh2c.js";import{k as R,r as f,B as De,y as Ie,i as m,o as h,c as M,w as a,J as Ne,b as e,u as We,f as u,t as _,e as W,a as r,d as V,g as pe,F as Z,K as Ee,L as Fe}from"./app-BeBq69_7.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ze=r("h2",{class:"text-h6"},"WhatsApp Business",-1),Le={class:"d-flex justify-center align-center mt-2"},qe=r("div",{class:"text-subtitle-2"},"Sent",-1),Re={class:"text-h6"},je=r("div",{class:"text-subtitle-2"},"Delivered",-1),Be={class:"text-h6"},Oe=r("div",{class:"text-subtitle-2"},"Read",-1),Ye={class:"text-h6"},Je=r("div",{class:"text-subtitle-2"},"Pending",-1),Ke={class:"text-h6"},Ze=r("div",{class:"text-subtitle-2"},"Failed",-1),Ge={class:"text-h6"},He=r("div",{class:"text-h6"},"Recent Messages",-1),Qe={key:1,class:"text-center pa-4"},Xe=r("p",{class:"text-body-1 mt-2"},"No messages found. Try sending one!",-1),ea=r("thead",null,[r("tr",null,[r("th",{class:"text-left"},"Content"),r("th",{class:"text-left"},"Recipient"),r("th",{class:"text-left"},"Status"),r("th",{class:"text-left"},"Sent Date"),r("th",{class:"text-center"},"Actions")])],-1),aa={class:"text-center"},ta={key:3,class:"d-flex justify-center mt-4"},la={class:"mt-4 text-caption"},sa=r("h3",null,"CSV File Requirements",-1),na=r("p",{class:"mb-2"},"Your CSV file should include the following columns:",-1),oa=r("ul",null,[r("li",null,"Name (required)"),r("li",null,"Phone Number (required, in international format)"),r("li",null,"WhatsApp Number (optional, in international format)"),r("li",null,"Alternative Phone (optional)"),r("li",null,"Email (optional)"),r("li",null,"Company (optional)"),r("li",null,"Status (optional)")],-1),ia=r("strong",null,"Important:",-1),ra={class:"mt-4"},ua={key:0,class:"text-center pa-4"},da=r("p",{class:"text-body-1 mt-2"},"No templates available",-1),ca={key:0},va={class:"d-flex flex-wrap justify-space-between align-center"},pa={class:"text-caption text-grey"},ma=r("br",null,null,-1),fa={class:"d-flex mt-2 mt-sm-0"},_a={key:1,class:"text-center pa-4"},ga=r("p",{class:"text-body-1 mt-2"},"Select a template to edit or create a new one",-1),Aa={__name:"WhatsApp",setup(ya){const G=R(()=>{var t;return(t=Ne().props.value.user)==null?void 0:t.id}),E=f(""),g=f([]),i=f({messages:!1,contacts:!1,templates:!1,sending:!1,importing:!1,savingTemplate:!1,deletingTemplate:!1}),A=f([]),x=f([]),k=f(""),p=f([]),F=f(!1),z=f(!1),j=f(!1),L=f(""),B=f(""),D=f(null),q=f(1),ne=f(20),oe=f(0),me=f({name:"",content:"",channel:"WhatsApp",module:"Message"}),d=f(null),$=f(!1),C=f("Connected"),T=f({sent:0,delivered:0,read:0,failed:0,pending:0}),H=R(()=>Math.ceil(oe.value/ne.value));R(()=>{const t=[],o=Math.floor(2.5);let n=Math.max(1,q.value-o),c=Math.min(H.value,n+5-1);c-n+1<5&&(n=Math.max(1,c-5+1));for(let v=n;v<=c;v++)t.push(v);return t});const Q=R(()=>{if(!E.value||!Array.isArray(g.value))return g.value;const t=E.value.toLowerCase();return g.value.filter(l=>{var o,n,c,v;return((o=l.content)==null?void 0:o.toLowerCase().includes(t))||((n=l.status)==null?void 0:n.toLowerCase().includes(t))||((c=l.recipient_name)==null?void 0:c.toLowerCase().includes(t))||((v=l.recipient_phone)==null?void 0:v.toLowerCase().includes(t))})}),ie=R(()=>Array.isArray(A.value)?A.value.filter(t=>t.whatsapp||t.alt_phone):[]),O=async(t=1)=>{var l,o,n,c;try{i.value.messages=!0,q.value=t;const v=await axios.get("/api/v1/whatsapp-messages",{params:{page:t,per_page:ne.value}});(o=(l=v.data)==null?void 0:l.data)!=null&&o.data&&Array.isArray(v.data.data.data)?(g.value=v.data.data.data,oe.value=v.data.data.total||g.value.length,re()):(console.error("Unexpected API response format:",v.data),Array.isArray(g.value)||(g.value=[]),y("Invalid data format received from server"))}catch(v){console.error("Error loading messages:",v),y(`Failed to load messages: ${((c=(n=v.response)==null?void 0:n.data)==null?void 0:c.message)||v.message}`),Array.isArray(g.value)||(g.value=[])}finally{i.value.messages=!1}};De(E,t=>{t===""&&O(q.value)});const re=()=>{if(!Array.isArray(g.value)){console.error("messages.value is not an array:",g.value);return}try{const t=g.value.reduce((l,o)=>{const n=o&&o.status&&typeof o.status=="string"?o.status.toLowerCase():"unknown";return l[n]=(l[n]||0)+1,l},{});T.value={sent:t.sent||0,delivered:t.delivered||0,read:t.read||0,failed:t.failed||0,pending:t.pending||0},g.value.forEach(l=>{if(l.message_status&&l.message_status!==l.status){const o=l.message_status.toLowerCase();T.value[o]=(T.value[o]||0)+1}})}catch(t){console.error("Error calculating stats:",t),T.value={sent:0,delivered:0,read:0,failed:0,pending:0}}},ue=async()=>{try{const t=await axios.get("/api/v1/whatsapp-status");t.data&&t.data.status?C.value=t.data.status:C.value="Unknown"}catch(t){console.error("Error checking WhatsApp status:",t),C.value="Disconnected"}},X=async()=>{var t,l,o,n;try{i.value.contacts=!0;const c=await axios.get("/api/v1/contacts");(l=(t=c.data)==null?void 0:t.data)!=null&&l.data&&Array.isArray(c.data.data.data)?(A.value=c.data.data.data,console.log("Contacts loaded:",A.value.length)):(console.error("Unexpected API response format:",c.data),(!Array.isArray(A.value)||A.value.length===0)&&(A.value=[]),y("Invalid contact data format received from server"))}catch(c){console.error("Error loading contacts:",c),y(`Failed to load contacts: ${((n=(o=c.response)==null?void 0:o.data)==null?void 0:n.message)||c.message}`),(!Array.isArray(A.value)||A.value.length===0)&&(A.value=[])}finally{i.value.contacts=!1}},de=async()=>{var t,l,o;try{i.value.templates=!0;const n=await axios.get("/api/v1/templates");(t=n.data)!=null&&t.data&&Array.isArray(n.data.data)?(p.value=n.data.data,console.log("Templates loaded:",p.value.length)):(console.error("Unexpected API response format:",n.data),(!Array.isArray(p.value)||p.value.length===0)&&(p.value=[]),y("Invalid template data format received from server"))}catch(n){console.error("Error loading templates:",n),y(`Failed to load templates: ${((o=(l=n.response)==null?void 0:l.data)==null?void 0:o.message)||n.message}`),(!Array.isArray(p.value)||p.value.length===0)&&(p.value=[])}finally{i.value.templates=!1}},fe=t=>{if(!t||!Array.isArray(p.value))return;const l=p.value.find(o=>o.id===t);l&&(k.value=l.content,d.value=l,console.log("Selected template:",l))},_e=async()=>{L.value="",k.value="",x.value=[],d.value=null,(!Array.isArray(A.value)||A.value.length===0)&&!i.value.contacts&&await X(),(!Array.isArray(p.value)||p.value.length===0)&&!i.value.templates&&await de(),z.value=!0},y=t=>{L.value=t,setTimeout(()=>{L.value=""},5e3)},P=t=>{B.value=t,setTimeout(()=>{B.value=""},5e3)},ge=async()=>{var t,l,o,n,c;if(!k.value.trim())return y("Please enter a message");if(!Array.isArray(x.value)||x.value.length===0)return y("Please select at least one recipient");try{i.value.sending=!0;const v=await axios.post("/api/v1/whatsapp-send",{user_id:G.value,contacts:x.value.map(w=>({id:w.id,name:w.name,chatId:w.whatsapp||w.alt_phone||w.phone})),message:k.value,template_id:((t=d.value)==null?void 0:t.id)||null}),b=new Date;Array.isArray(g.value)||(g.value=[]),g.value.unshift({id:((l=v.data)==null?void 0:l.id)||Date.now(),content:k.value,recipients:x.value.length,status:"sent",message_status:"sent",sent_at:b.toISOString().split("T")[0],created_at:b.toISOString(),recipient_name:x.value.map(w=>w.name).join(", "),recipient_phone:x.value.map(w=>w.whatsapp||w.alt_phone||w.phone).join(", "),results:((o=v.data)==null?void 0:o.results)||[]}),T.value.sent+=x.value.length,P(`Message successfully sent to ${x.value.length} recipients`),k.value="",x.value=[],d.value=null,z.value=!1,setTimeout(()=>{O(1)},1e3)}catch(v){console.error("Error sending message:",v),y(`Failed to send message: ${((c=(n=v.response)==null?void 0:n.data)==null?void 0:c.message)||v.message}`)}finally{i.value.sending=!1}},ye=t=>{console.log("Viewing message details:",t),alert(`Message ID: ${t.id}
Content: ${t.content}
Status: ${t.status||t.message_status||"Unknown"}
Sent At: ${t.sent_at||(t.created_at?t.created_at.split("T")[0]:"N/A")}
Recipient: ${t.recipient_name||"Unknown"} (${t.recipient_phone||"Unknown"})`)},he=async t=>{var l,o;if(!t)return y("Invalid message ID");if(confirm("Are you sure you want to delete this message?"))try{await axios.delete(`/api/v1/whatsapp-messages/${t}`),Array.isArray(g.value)&&(g.value=g.value.filter(n=>n.id!==t),re()),P("Message deleted successfully")}catch(n){console.error("Error deleting message:",n),y(`Failed to delete message: ${((o=(l=n.response)==null?void 0:l.data)==null?void 0:o.message)||n.message}`)}},be=async()=>{var t,l,o;if(!D.value)return y("Please select a CSV file to import");try{i.value.importing=!0;const n=new FormData;n.append("file",D.value),n.append("user_id",G.value);const c=await axios.post("/api/v1/contacts/import",n,{headers:{"Content-Type":"multipart/form-data"}});c.data&&c.data.success?(P(`Successfully imported ${c.data.imported||"multiple"} contacts`),await X(),F.value=!1,D.value=null):y(((t=c.data)==null?void 0:t.message)||"Import failed")}catch(n){console.error("Error importing contacts:",n),y(`Failed to import contacts: ${((o=(l=n.response)==null?void 0:l.data)==null?void 0:o.message)||n.message}`)}finally{i.value.importing=!1}},we=()=>{$.value=!0,d.value={...me.value}},xe=async()=>{var t,l;if(!d.value||!d.value.name||!d.value.content)return y("Template name and content are required");try{i.value.savingTemplate=!0;let o;const n={name:d.value.name,content:d.value.content,channel:d.value.channel||"WhatsApp",module:d.value.module||"Message",user_id:G.value};if($.value||!d.value.id)o=await axios.post("/api/v1/templates",n),o.data&&o.data.data&&(Array.isArray(p.value)||(p.value=[]),p.value.push(o.data.data),P("Template created successfully"));else if(o=await axios.put(`/api/v1/templates/${d.value.id}`,n),o.data&&o.data.data){const c=p.value.findIndex(v=>v.id===d.value.id);c!==-1&&(p.value[c]=o.data.data),P("Template updated successfully")}$.value=!1}catch(o){console.error("Error saving template:",o),y(`Failed to save template: ${((l=(t=o.response)==null?void 0:t.data)==null?void 0:l.message)||o.message}`)}finally{i.value.savingTemplate=!1}},Ae=async()=>{var t,l;if(!d.value||!d.value.id)return y("No template selected");if(confirm(`Are you sure you want to delete template "${d.value.name}"?`))try{i.value.deletingTemplate=!0,await axios.delete(`/api/v1/templates/${d.value.id}`),p.value=p.value.filter(o=>o.id!==d.value.id),d.value=null,P("Template deleted successfully")}catch(o){console.error("Error deleting template:",o),y(`Failed to delete template: ${((l=(t=o.response)==null?void 0:t.data)==null?void 0:l.message)||o.message}`)}finally{i.value.deletingTemplate=!1}},Ce=async()=>{var t,l,o;try{C.value="Connecting...";const n=await axios.post("/api/v1/whatsapp-reconnect");n.data&&n.data.success?(C.value="Connected",P("WhatsApp connection successful")):(C.value="Disconnected",y(((t=n.data)==null?void 0:t.message)||"Failed to connect to WhatsApp"))}catch(n){console.error("Error reconnecting WhatsApp:",n),C.value="Disconnected",y(`Failed to connect to WhatsApp: ${((o=(l=n.response)==null?void 0:l.data)==null?void 0:o.message)||n.message}`)}},Te=t=>t?t.replace(/@c\.us$/,""):"Unknown";return Ie(()=>{g.value=[],A.value=[],p.value=[],O(1),X(),de(),ue();const t=setInterval(()=>{ue()},3e4);return()=>{clearInterval(t)}}),(t,l)=>{const o=m("v-alert"),n=m("v-icon"),c=m("v-avatar"),v=m("v-chip"),b=m("v-btn"),w=m("v-divider"),S=m("v-col"),ee=m("v-row"),I=m("v-card-text"),U=m("v-card"),ce=m("v-text-field"),N=m("v-card-title"),ae=m("v-progress-linear"),Ve=m("v-table"),ke=m("v-pagination"),Se=m("v-container"),te=m("v-list-item"),Y=m("v-select"),ve=m("v-textarea"),le=m("v-spacer"),J=m("v-card-actions"),se=m("v-dialog"),Me=m("v-file-input"),$e=m("v-list");return h(),M(Ue,null,{default:a(()=>[e(We(Pe),{title:"WhatsApp Business"}),e(Se,null,{default:a(()=>[L.value?(h(),M(o,{key:0,type:"error",closable:"",class:"mb-4"},{default:a(()=>[u(_(L.value),1)]),_:1})):W("",!0),B.value?(h(),M(o,{key:1,type:"success",closable:"",class:"mb-4"},{default:a(()=>[u(_(B.value),1)]),_:1})):W("",!0),e(ee,null,{default:a(()=>[e(S,{cols:"12",md:"3"},{default:a(()=>[e(U,null,{default:a(()=>[e(I,{class:"text-center"},{default:a(()=>[e(c,{size:"80",color:C.value==="Connected"?"green":"grey",class:"mb-3"},{default:a(()=>[e(n,{size:"48",color:"white"},{default:a(()=>[u("mdi-whatsapp")]),_:1})]),_:1},8,["color"]),ze,r("div",Le,[e(v,{color:C.value==="Connected"?"success":C.value==="Connecting..."?"warning":"error",class:"mr-2"},{default:a(()=>[u(_(C.value),1)]),_:1},8,["color"]),C.value!=="Connected"&&C.value!=="Connecting..."?(h(),M(b,{key:0,size:"small",color:"primary",icon:"",onClick:Ce},{default:a(()=>[e(n,null,{default:a(()=>[u("mdi-refresh")]),_:1})]),_:1})):W("",!0)]),e(w,{class:"my-4"}),e(ee,null,{default:a(()=>[e(S,{cols:"6",class:"py-1"},{default:a(()=>[qe,r("div",Re,_(T.value.sent),1)]),_:1}),e(S,{cols:"6",class:"py-1"},{default:a(()=>[je,r("div",Be,_(T.value.delivered),1)]),_:1}),e(S,{cols:"6",class:"py-1"},{default:a(()=>[Oe,r("div",Ye,_(T.value.read),1)]),_:1}),e(S,{cols:"6",class:"py-1"},{default:a(()=>[Je,r("div",Ke,_(T.value.pending),1)]),_:1}),e(S,{cols:"12",class:"py-1"},{default:a(()=>[Ze,r("div",Ge,_(T.value.failed),1)]),_:1})]),_:1}),e(w,{class:"my-4"}),e(b,{color:"primary",block:"",class:"mb-2",onClick:_e},{default:a(()=>[e(n,{class:"mr-2"},{default:a(()=>[u("mdi-message-text")]),_:1}),u(" New Message ")]),_:1}),e(b,{color:"info",block:"",class:"mb-2",onClick:l[0]||(l[0]=s=>F.value=!0)},{default:a(()=>[e(n,{class:"mr-2"},{default:a(()=>[u("mdi-file-import")]),_:1}),u(" Import Contacts ")]),_:1}),e(b,{color:"secondary",block:"",onClick:l[1]||(l[1]=s=>j.value=!0)},{default:a(()=>[e(n,{class:"mr-2"},{default:a(()=>[u("mdi-file-document-edit")]),_:1}),u(" Manage Templates ")]),_:1})]),_:1})]),_:1})]),_:1}),e(S,{cols:"12",md:"9"},{default:a(()=>[e(U,null,{default:a(()=>[e(N,{class:"d-flex flex-wrap justify-space-between align-center"},{default:a(()=>[He,e(ce,{modelValue:E.value,"onUpdate:modelValue":l[2]||(l[2]=s=>E.value=s),"append-icon":"mdi-magnify",label:"Search messages","single-line":"","hide-details":"",density:"compact",class:"max-w-xs mt-2 mt-sm-0"},null,8,["modelValue"])]),_:1}),e(I,null,{default:a(()=>[i.value.messages?(h(),M(ae,{key:0,indeterminate:"",color:"primary"})):!Array.isArray(Q.value)||Q.value.length===0?(h(),V("div",Qe,[e(n,{size:"large",color:"grey"},{default:a(()=>[u("mdi-message-text-outline")]),_:1}),Xe])):(h(),M(Ve,{key:2},{default:a(()=>[ea,r("tbody",null,[(h(!0),V(Z,null,pe(Q.value,s=>(h(),V("tr",{key:s.id},[r("td",null,_(s.content),1),r("td",null,_(Te(s.recipient_phone)),1),r("td",null,[e(v,{color:s.status==="delivered"||s.message_status==="delivered"?"success":s.status==="read"||s.message_status==="read"?"info":s.status==="failed"||s.message_status==="failed"?"error":s.status==="sent"||s.message_status==="sent"?"primary":"warning",size:"small"},{default:a(()=>[u(_(s.message_status||s.status||"Unknown"),1)]),_:2},1032,["color"])]),r("td",null,_(s.sent_at||(s.created_at?s.created_at.split("T")[0]:"N/A")),1),r("td",aa,[e(b,{icon:"",size:"small",color:"info",variant:"text",onClick:K=>ye(s)},{default:a(()=>[e(n,null,{default:a(()=>[u("mdi-eye")]),_:1})]),_:2},1032,["onClick"]),e(b,{icon:"",size:"small",color:"error",variant:"text",onClick:K=>he(s.id)},{default:a(()=>[e(n,null,{default:a(()=>[u("mdi-delete")]),_:1})]),_:2},1032,["onClick"])])]))),128))])]),_:1})),H.value>1?(h(),V("div",ta,[e(ke,{modelValue:q.value,"onUpdate:modelValue":[l[3]||(l[3]=s=>q.value=s),O],length:H.value,"total-visible":5},null,8,["modelValue","length"])])):W("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(se,{modelValue:z.value,"onUpdate:modelValue":l[7]||(l[7]=s=>z.value=s),"max-width":"700px"},{default:a(()=>[e(U,null,{default:a(()=>[e(N,null,{default:a(()=>[e(n,{color:"primary",class:"mr-2"},{default:a(()=>[u("mdi-message-text")]),_:1}),u(" Send WhatsApp Message ")]),_:1}),e(I,null,{default:a(()=>[i.value.contacts||i.value.templates?(h(),M(ae,{key:0,indeterminate:"",color:"primary",class:"mb-4"})):W("",!0),e(Y,{modelValue:x.value,"onUpdate:modelValue":l[4]||(l[4]=s=>x.value=s),items:ie.value,"item-title":"name","item-value":"id",label:"Select Recipients",multiple:"",chips:"","return-object":"",hint:`${ie.value.length} contacts with WhatsApp numbers available`,"persistent-hint":"",loading:i.value.contacts,disabled:i.value.contacts,rules:[s=>Array.isArray(s)&&s.length>0||"At least one recipient is required"]},{"prepend-item":a(()=>[e(te,{title:"WhatsApp Recipients",disabled:""}),e(w)]),selection:a(({item:s})=>[e(v,null,{default:a(()=>[u(_(s.raw.name)+" ("+_(s.raw.whatsapp||s.raw.alt_phone||s.raw.phone)+") ",1)]),_:2},1024)]),item:a(({item:s,props:K})=>[e(te,Ee(Fe(K)),{prepend:a(()=>[e(c,{color:"grey-lighten-3",size:"36"},{default:a(()=>[e(n,{color:"grey-darken-2"},{default:a(()=>[u("mdi-account")]),_:1})]),_:1})]),title:a(()=>[u(_(s.raw.name),1)]),subtitle:a(()=>[u(_(s.raw.whatsapp||s.raw.alt_phone||s.raw.phone),1)]),_:2},1040)]),_:1},8,["modelValue","items","hint","loading","disabled","rules"]),e(Y,{label:"Select Template",items:p.value,"item-title":"name","item-value":"id","onUpdate:modelValue":fe,class:"mt-4",hint:d.value?`Channel: ${d.value.channel||"WhatsApp"} | Type: ${d.value.module||"Message"}`:"","persistent-hint":"",loading:i.value.templates,disabled:i.value.templates,clearable:""},null,8,["items","hint","loading","disabled"]),e(ve,{modelValue:k.value,"onUpdate:modelValue":l[5]||(l[5]=s=>k.value=s),label:"Message",rows:"5",class:"mt-4",hint:"Variables format: {{variable_name}}","persistent-hint":"",rules:[s=>!!s||"Message is required"],disabled:i.value.sending},null,8,["modelValue","rules","disabled"]),r("div",la,[e(n,{size:"small",color:"info",class:"mr-1"},{default:a(()=>[u("mdi-information-outline")]),_:1}),u(" Your message will be sent to "+_(x.value.length)+" recipient(s). ",1)])]),_:1}),e(J,null,{default:a(()=>[e(le),e(b,{color:"error",variant:"outlined",onClick:l[6]||(l[6]=s=>z.value=!1),disabled:i.value.sending},{default:a(()=>[u(" Cancel ")]),_:1},8,["disabled"]),e(b,{color:"primary",onClick:ge,loading:i.value.sending,disabled:!k.value||!Array.isArray(x.value)||x.value.length===0||i.value.sending},{default:a(()=>[u(" Send Message ")]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(se,{modelValue:F.value,"onUpdate:modelValue":l[10]||(l[10]=s=>F.value=s),"max-width":"500px"},{default:a(()=>[e(U,null,{default:a(()=>[e(N,null,{default:a(()=>[e(n,{color:"primary",class:"mr-2"},{default:a(()=>[u("mdi-file-import")]),_:1}),u(" Import Contacts ")]),_:1}),e(I,null,{default:a(()=>[e(Me,{modelValue:D.value,"onUpdate:modelValue":l[8]||(l[8]=s=>D.value=s),label:"Upload CSV File",accept:".csv","prepend-icon":"mdi-file-upload","show-size":"","truncate-length":"25",loading:i.value.importing,disabled:i.value.importing,rules:[s=>!!s||"CSV file is required"]},null,8,["modelValue","loading","disabled","rules"]),e(o,{type:"info",class:"mt-4",variant:"tonal"},{default:a(()=>[sa,na,oa]),_:1}),e(o,{type:"warning",class:"mt-2",variant:"tonal"},{default:a(()=>[ia,u(" Phone numbers should be in international format (e.g., +1234567890) ")]),_:1}),r("div",ra,[e(b,{color:"secondary",variant:"outlined","prepend-icon":"mdi-download",block:""},{default:a(()=>[u(" Download Sample CSV ")]),_:1})])]),_:1}),e(J,null,{default:a(()=>[e(le),e(b,{color:"error",variant:"outlined",onClick:l[9]||(l[9]=s=>F.value=!1),disabled:i.value.importing},{default:a(()=>[u(" Cancel ")]),_:1},8,["disabled"]),e(b,{color:"primary",onClick:be,loading:i.value.importing,disabled:!D.value||i.value.importing},{default:a(()=>[u(" Import Contacts ")]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(se,{modelValue:j.value,"onUpdate:modelValue":l[16]||(l[16]=s=>j.value=s),"max-width":"700px"},{default:a(()=>[e(U,null,{default:a(()=>[e(N,null,{default:a(()=>[e(n,{color:"primary",class:"mr-2"},{default:a(()=>[u("mdi-file-document-edit")]),_:1}),u(" Manage Templates ")]),_:1}),e(I,null,{default:a(()=>[i.value.templates?(h(),M(ae,{key:0,indeterminate:"",color:"primary",class:"mb-4"})):W("",!0),e(ee,null,{default:a(()=>[e(S,{cols:"12",md:"4"},{default:a(()=>[e(U,{variant:"outlined"},{default:a(()=>[e(N,{class:"text-subtitle-1"},{default:a(()=>[u("Available Templates")]),_:1}),e($e,null,{default:a(()=>[!Array.isArray(p.value)||p.value.length===0?(h(),V("div",ua,[e(n,{size:"large",color:"grey"},{default:a(()=>[u("mdi-file-document-outline")]),_:1}),da])):(h(!0),V(Z,{key:1},pe(p.value,s=>(h(),M(te,{key:s.id,title:s.name,subtitle:s.channel||"WhatsApp",onClick:K=>{d.value={...s},$.value=!1},active:d.value&&d.value.id===s.id},{prepend:a(()=>[e(n,{color:"primary"},{default:a(()=>[u("mdi-file-document-outline")]),_:1})]),_:2},1032,["title","subtitle","onClick","active"]))),128))]),_:1}),e(J,null,{default:a(()=>[e(b,{color:"success",block:"",onClick:we,"prepend-icon":"mdi-plus"},{default:a(()=>[u(" New Template ")]),_:1})]),_:1})]),_:1})]),_:1}),e(S,{cols:"12",md:"8"},{default:a(()=>[e(U,{variant:"outlined",class:"h-100"},{default:a(()=>[e(N,{class:"text-subtitle-1"},{default:a(()=>[u(_($.value?"Create New Template":d.value?"Edit Template":"Template Details"),1)]),_:1}),e(I,null,{default:a(()=>[d.value?(h(),V("div",ca,[e(ce,{modelValue:d.value.name,"onUpdate:modelValue":l[11]||(l[11]=s=>d.value.name=s),label:"Template Name",rules:[s=>!!s||"Template name is required"],disabled:i.value.savingTemplate||i.value.deletingTemplate},null,8,["modelValue","rules","disabled"]),e(Y,{modelValue:d.value.channel,"onUpdate:modelValue":l[12]||(l[12]=s=>d.value.channel=s),label:"Channel",items:["WhatsApp","SMS","Email"],disabled:i.value.savingTemplate||i.value.deletingTemplate,class:"mt-4"},null,8,["modelValue","disabled"]),e(Y,{modelValue:d.value.module,"onUpdate:modelValue":l[13]||(l[13]=s=>d.value.module=s),label:"Template Type",items:["Message","Notification","Marketing","Reminder"],disabled:i.value.savingTemplate||i.value.deletingTemplate,class:"mt-4"},null,8,["modelValue","disabled"]),e(ve,{modelValue:d.value.content,"onUpdate:modelValue":l[14]||(l[14]=s=>d.value.content=s),label:"Template Content",rows:"8",hint:"Variables format: {{variable_name}}","persistent-hint":"",rules:[s=>!!s||"Template content is required"],disabled:i.value.savingTemplate||i.value.deletingTemplate,class:"mt-4"},null,8,["modelValue","rules","disabled"]),e(w,{class:"my-4"}),r("div",va,[r("div",pa,[d.value.id&&!$.value?(h(),V(Z,{key:0},[u(" Template ID: "+_(d.value.id)+" ",1),ma,u(" Last Updated: "+_(d.value.updated_at?new Date(d.value.updated_at).toLocaleString():"N/A"),1)],64)):(h(),V(Z,{key:1},[u(" Creating new template ")],64))]),r("div",fa,[e(b,{color:"error",class:"mr-2",disabled:$.value||i.value.savingTemplate||i.value.deletingTemplate||!d.value.id,loading:i.value.deletingTemplate,onClick:Ae},{default:a(()=>[u(" Delete ")]),_:1},8,["disabled","loading"]),e(b,{color:"primary",loading:i.value.savingTemplate,disabled:i.value.savingTemplate||i.value.deletingTemplate||!d.value.name||!d.value.content,onClick:xe},{default:a(()=>[u(_($.value?"Create":"Save Changes"),1)]),_:1},8,["loading","disabled"])])])])):(h(),V("div",_a,[e(n,{size:"large",color:"grey"},{default:a(()=>[u("mdi-file-document-outline")]),_:1}),ga]))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(J,null,{default:a(()=>[e(le),e(b,{color:"primary",onClick:l[15]||(l[15]=s=>j.value=!1)},{default:a(()=>[u("Close")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}};export{Aa as default};

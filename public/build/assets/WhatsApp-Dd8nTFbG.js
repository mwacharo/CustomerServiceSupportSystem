import{Z as Q}from"./index.esm-BbxnZPtm.js";import{A as X}from"./AppLayout-DKpm-HdM.js";import{k as Y,r as c,y as ee,i as s,o as M,c as te,w as t,J as le,b as e,u as ae,f as o,t as u,a as n,d as P,g as ne,F as oe}from"./app-BnugLxPA.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const se=n("h2",{class:"text-h6"},"WhatsApp Business",-1),ue=n("div",{class:"text-subtitle-2"},"Sent",-1),de={class:"text-h6"},ie=n("div",{class:"text-subtitle-2"},"Delivered",-1),ce={class:"text-h6"},re=n("div",{class:"text-subtitle-2"},"Read",-1),me={class:"text-h6"},ve=n("div",{class:"text-subtitle-2"},"Failed",-1),pe={class:"text-h6"},_e=n("div",null,"Recent Messages",-1),fe=n("thead",null,[n("tr",null,[n("th",null,"Content"),n("th",null,"Recipients"),n("th",null,"Status"),n("th",null,"Sent Date"),n("th",null,"Actions")])],-1),Ve={__name:"WhatsApp",setup(he){const U=Y(()=>{var d;return(d=le().props.value.user)==null?void 0:d.id}),D=c(""),y=c([]),R=c([]),p=c([]),v=c(""),f=c([]),V=c(!1),h=c(!1),b=c(!1),r=c({name:"",content:""}),N=c("Connected"),x=c({sent:156,delivered:145,read:98,failed:11}),J=()=>{R.value=[{id:1,name:"John Mwacharo",phone:"254799806098@c.us",status:"Active"},{id:2,name:"Jane Smith",phone:"+254723456789",status:"Active"},{id:3,name:"Robert Brown",phone:"+254734567890",status:"Inactive"},{id:4,name:"Sarah Wilson",phone:"+254745678901",status:"Active"}]},j=()=>{f.value=[{id:1,name:"Welcome Message",content:"Hello {{name}}, welcome to our service!"},{id:2,name:"Payment Reminder",content:"Dear {{name}}, this is a reminder about your payment of KES {{amount}} due on {{date}}."},{id:3,name:"Support Response",content:"Hello {{name}}, thank you for contacting our support. Regarding your issue with {{topic}}, we recommend..."}]},q=d=>{v.value=d.content},E=()=>{f.value.push({id:f.value.length+1,...r.value}),r.value={name:"",content:""},b.value=!1},H=async()=>{try{const d=await axios.post("/api/v1/whatsapp-send",{user_id:U.value,contacts:p.value.map(m=>({id:m.id,name:m.name,phone:m.phone})),message:v.value}),a=new Date;y.value.unshift({id:y.value.length+1,content:v.value,recipients:p.value.length,status:"Sent",sent_at:a.toISOString().slice(0,10),results:d.data.results}),v.value="",p.value=[],h.value=!1}catch(d){alert("Message failed to send. Check console."),console.error(d)}};return ee(()=>{y.value=[{id:1,content:"Payment reminder for April invoice",recipients:25,status:"Delivered",sent_at:"2025-04-19"},{id:2,content:"System maintenance notification",recipients:120,status:"Sent",sent_at:"2025-04-18"},{id:3,content:"New feature announcement",recipients:50,status:"Delivered",sent_at:"2025-04-17"},{id:4,content:"Urgent: Account verification required",recipients:5,status:"Read",sent_at:"2025-04-16"}],J(),j(),console.log("user_id",U.value)}),(d,a)=>{const m=s("v-icon"),L=s("v-avatar"),S=s("v-chip"),z=s("v-divider"),_=s("v-col"),I=s("v-row"),i=s("v-btn"),w=s("v-card-text"),g=s("v-card"),B=s("v-text-field"),C=s("v-card-title"),K=s("v-table"),O=s("v-container"),W=s("v-select"),$=s("v-textarea"),k=s("v-spacer"),A=s("v-card-actions"),T=s("v-dialog"),Z=s("v-file-input"),F=s("v-alert");return M(),te(X,null,{default:t(()=>[e(ae(Q),{title:"WhatsApp"}),e(O,null,{default:t(()=>[e(I,null,{default:t(()=>[e(_,{cols:"12",md:"3"},{default:t(()=>[e(g,null,{default:t(()=>[e(w,{class:"text-center"},{default:t(()=>[e(L,{size:"80",color:"green",class:"mb-3"},{default:t(()=>[e(m,{size:"48",color:"white"},{default:t(()=>[o("mdi-whatsapp")]),_:1})]),_:1}),se,e(S,{color:N.value==="Connected"?"success":"error",class:"mt-2"},{default:t(()=>[o(u(N.value),1)]),_:1},8,["color"]),e(z,{class:"my-4"}),e(I,null,{default:t(()=>[e(_,{cols:"6",class:"py-1"},{default:t(()=>[ue,n("div",de,u(x.value.sent),1)]),_:1}),e(_,{cols:"6",class:"py-1"},{default:t(()=>[ie,n("div",ce,u(x.value.delivered),1)]),_:1}),e(_,{cols:"6",class:"py-1"},{default:t(()=>[re,n("div",me,u(x.value.read),1)]),_:1}),e(_,{cols:"6",class:"py-1"},{default:t(()=>[ve,n("div",pe,u(x.value.failed),1)]),_:1})]),_:1}),e(z,{class:"my-4"}),e(i,{color:"primary",block:"",onClick:a[0]||(a[0]=l=>h.value=!0)},{default:t(()=>[o(" New Message ")]),_:1}),e(i,{color:"secondary",block:"",class:"mt-2",onClick:a[1]||(a[1]=l=>b.value=!0)},{default:t(()=>[o(" Create Template ")]),_:1}),e(i,{color:"info",block:"",class:"mt-2",onClick:a[2]||(a[2]=l=>V.value=!0)},{default:t(()=>[o(" Import Contacts ")]),_:1})]),_:1})]),_:1})]),_:1}),e(_,{cols:"12",md:"9"},{default:t(()=>[e(g,null,{default:t(()=>[e(C,{class:"d-flex justify-space-between align-center"},{default:t(()=>[_e,e(B,{modelValue:D.value,"onUpdate:modelValue":a[3]||(a[3]=l=>D.value=l),"append-icon":"mdi-magnify",label:"Search messages","single-line":"","hide-details":"",density:"compact",class:"max-w-xs"},null,8,["modelValue"])]),_:1}),e(w,null,{default:t(()=>[e(K,null,{default:t(()=>[fe,n("tbody",null,[(M(!0),P(oe,null,ne(y.value,l=>(M(),P("tr",{key:l.id},[n("td",null,u(l.content),1),n("td",null,u(l.recipients),1),n("td",null,[e(S,{color:l.status==="Delivered"?"success":l.status==="Read"?"info":"warning",size:"small"},{default:t(()=>[o(u(l.status),1)]),_:2},1032,["color"])]),n("td",null,u(l.sent_at),1),n("td",null,[e(i,{icon:"",size:"small",color:"primary",variant:"text"},{default:t(()=>[e(m,null,{default:t(()=>[o("mdi-refresh")]),_:1})]),_:1}),e(i,{icon:"",size:"small",color:"info",variant:"text"},{default:t(()=>[e(m,null,{default:t(()=>[o("mdi-eye")]),_:1})]),_:1}),e(i,{icon:"",size:"small",color:"error",variant:"text"},{default:t(()=>[e(m,null,{default:t(()=>[o("mdi-delete")]),_:1})]),_:1})])]))),128))])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(T,{modelValue:h.value,"onUpdate:modelValue":a[8]||(a[8]=l=>h.value=l),"max-width":"700px"},{default:t(()=>[e(g,null,{default:t(()=>[e(C,null,{default:t(()=>[o("Send WhatsApp Message")]),_:1}),e(w,null,{default:t(()=>[e(W,{modelValue:p.value,"onUpdate:modelValue":a[4]||(a[4]=l=>p.value=l),items:R.value,"item-title":"name","item-value":"id",label:"Select Recipients",multiple:"",chips:"","return-object":""},{selection:t(({item:l})=>[e(S,null,{default:t(()=>[o(u(l.raw.name)+" ("+u(l.raw.phone)+")",1)]),_:2},1024)]),_:1},8,["modelValue","items"]),e(W,{label:"Select Template",items:f.value,"item-title":"name","item-value":"id","onUpdate:modelValue":a[5]||(a[5]=l=>q(f.value.find(G=>G.id===l))),class:"mt-4"},null,8,["items"]),e($,{modelValue:v.value,"onUpdate:modelValue":a[6]||(a[6]=l=>v.value=l),label:"Message",rows:"5",class:"mt-4",hint:"Variables format: {{variable_name}}","persistent-hint":""},null,8,["modelValue"])]),_:1}),e(A,null,{default:t(()=>[e(k),e(i,{color:"error",onClick:a[7]||(a[7]=l=>h.value=!1)},{default:t(()=>[o("Cancel")]),_:1}),e(i,{color:"primary",onClick:H,disabled:!v.value||p.value.length===0},{default:t(()=>[o(" Send Message ")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(T,{modelValue:V.value,"onUpdate:modelValue":a[10]||(a[10]=l=>V.value=l),"max-width":"500px"},{default:t(()=>[e(g,null,{default:t(()=>[e(C,null,{default:t(()=>[o("Import Contacts")]),_:1}),e(w,null,{default:t(()=>[e(Z,{label:"Upload CSV File",accept:".csv","prepend-icon":"mdi-file-upload","show-size":"","truncate-length":"25"}),e(F,{type:"info",class:"mt-4"},{default:t(()=>[o(" CSV file should have columns: Name, Phone Number, Status ")]),_:1})]),_:1}),e(A,null,{default:t(()=>[e(k),e(i,{color:"error",onClick:a[9]||(a[9]=l=>V.value=!1)},{default:t(()=>[o("Cancel")]),_:1}),e(i,{color:"primary"},{default:t(()=>[o("Import")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(T,{modelValue:b.value,"onUpdate:modelValue":a[14]||(a[14]=l=>b.value=l),"max-width":"600px"},{default:t(()=>[e(g,null,{default:t(()=>[e(C,null,{default:t(()=>[o("Create Message Template")]),_:1}),e(w,null,{default:t(()=>[e(B,{modelValue:r.value.name,"onUpdate:modelValue":a[11]||(a[11]=l=>r.value.name=l),label:"Template Name",required:""},null,8,["modelValue"]),e($,{modelValue:r.value.content,"onUpdate:modelValue":a[12]||(a[12]=l=>r.value.content=l),label:"Template Content",rows:"5",hint:"Use {{variable_name}} for dynamic content","persistent-hint":"",class:"mt-4"},null,8,["modelValue"]),e(F,{type:"info",class:"mt-4"},{default:t(()=>[o(" Available variables: "+u(d.name)+", "+u(d.phone)+", "+u(d.amount)+", "+u(d.date)+", "+u(d.topic),1)]),_:1})]),_:1}),e(A,null,{default:t(()=>[e(k),e(i,{color:"error",onClick:a[13]||(a[13]=l=>b.value=!1)},{default:t(()=>[o("Cancel")]),_:1}),e(i,{color:"primary",onClick:E,disabled:!r.value.name||!r.value.content},{default:t(()=>[o(" Save Template ")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}};export{Ve as default};

import{A as Q}from"./AppLayout-DrE014f7.js";import T from"./RolePermissions-D1bRu9M-.js";import{s as f,i,o as x,c as I,w as l,b as e,f as s,x as B,t as k,a as c,z as C}from"./app-BFWP9qR1.js";import{_ as j}from"./_plugin-vue_export-helper-DlAUqK2U.js";const q={components:{AppLayout:Q,RolesPermissions:T},data:()=>({dialog:!1,loading:!1,saving:!1,deleting:!1,isFormValid:!1,dialogDelete:!1,headers:[{title:"Role Name",align:"start",key:"name"},{title:"Permissions",key:"permissions",sortable:!1},{title:"Created Date",key:"created_at",formatter:t=>t?new Date(t).toLocaleDateString():"N/A"},{title:"Actions",key:"actions",sortable:!1,align:"end"}],roles:[],searchQuery:"",editedIndex:-1,editedItem:{name:"",description:""},defaultItem:{name:"",description:""}}),computed:{formTitle(){return this.editedIndex===-1?"Create New Role":"Edit Role"}},watch:{dialog(t){t||this.close()},dialogDelete(t){t||this.closeDelete()}},created(){this.initialize()},methods:{initialize(){this.loading=!0,f.get("api/v1/roles").then(o=>{this.roles=o.data,this.loading=!1}).catch(o=>{var n;console.error("API Error:",o),(n=this.$toastr)==null||n.error("Failed to load roles"),this.loading=!1})},managePermissions(t){this.$refs.RolesPermissionsComponent.showDialog(t.id)},editItem(t){this.editedIndex=this.roles.indexOf(t),this.editedItem={...t},this.dialog=!0},deleteItem(t){this.editedIndex=this.roles.indexOf(t),this.editedItem={...t},this.dialogDelete=!0},deleteItemConfirm(){this.deleting=!0,f.delete(`/api/v1/roles/${this.editedItem.id}`).then(()=>{var t;this.roles.splice(this.editedIndex,1),(t=this.$toastr)==null||t.success("Role deleted successfully"),this.closeDelete()}).catch(t=>{var o;console.error("Deletion error:",t),(o=this.$toastr)==null||o.error("Failed to delete role")}).finally(()=>{this.deleting=!1})},close(){this.dialog=!1,this.resetForm()},closeDelete(){this.dialogDelete=!1,this.resetForm()},resetForm(){this.$nextTick(()=>{this.$refs.form&&this.$refs.form.reset(),this.editedItem={...this.defaultItem},this.editedIndex=-1})},save(){if(!this.isFormValid)return;this.saving=!0;let t;this.editedIndex>-1?t=f.put(`/api/v1/roles/${this.editedItem.id}`,this.editedItem):t=f.post("/api/v1/roles",this.editedItem),t.then(o=>{var n;this.editedIndex>-1?Object.assign(this.roles[this.editedIndex],o.data.data||o.data):this.roles.push(o.data.data||o.data),(n=this.$toastr)==null||n.success(`Role ${this.editedIndex===-1?"created":"updated"} successfully`),this.close()}).catch(o=>{var n;console.error("Saving error:",o),(n=this.$toastr)==null||n.error(`Failed to ${this.editedIndex===-1?"create":"update"} role`)}).finally(()=>{this.saving=!1})},performSearch(){if(this.searchQuery.trim()===""){this.initialize();return}this.loading=!0;const t="/roles/search?query="+this.searchQuery;f.get(t).then(o=>{this.roles=o.data,this.loading=!1}).catch(o=>{var n;console.error("Search error:",o),(n=this.$toastr)==null||n.error("Search failed"),this.loading=!1})}}},E=c("span",{class:"text-h5 font-weight-bold"},"Role Management",-1),K={class:"d-flex align-center"},O={class:"d-flex flex-column align-center py-6"},M=c("p",{class:"text-body-1 text-medium-emphasis mb-4"},"No roles found",-1),G={class:"text-h5 font-weight-bold"};function H(t,o,n,J,W,r){const d=i("v-btn"),p=i("v-card-title"),b=i("v-text-field"),h=i("v-col"),V=i("v-row"),_=i("v-card-text"),A=i("v-progress-linear"),D=i("v-chip"),m=i("v-icon"),g=i("v-tooltip"),F=i("v-data-table"),v=i("v-card"),N=i("v-container"),y=i("v-divider"),U=i("v-textarea"),$=i("v-form"),R=i("v-spacer"),w=i("v-card-actions"),z=i("v-dialog"),S=i("RolesPermissions"),L=i("AppLayout");return x(),I(L,null,{default:l(()=>[e(N,{fluid:"",class:"pa-0"},{default:l(()=>[e(v,{class:"rounded-lg elevation-2 mb-6"},{default:l(()=>[e(p,{class:"d-flex justify-space-between align-center py-4 px-6 bg-surface"},{default:l(()=>[E,e(d,{color:"primary","prepend-icon":"mdi-plus",onClick:o[0]||(o[0]=a=>t.dialog=!0),size:"large",variant:"elevated",rounded:"pill"},{default:l(()=>[s(" New Role ")]),_:1})]),_:1}),e(_,{class:"pa-6"},{default:l(()=>[e(V,null,{default:l(()=>[e(h,{cols:"12",md:"6",lg:"4"},{default:l(()=>[e(b,{modelValue:t.searchQuery,"onUpdate:modelValue":o[1]||(o[1]=a=>t.searchQuery=a),label:"Search roles","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"comfortable","hide-details":"",clearable:"",onKeyup:B(r.performSearch,["enter"]),"onClick:clear":r.initialize,class:"rounded-lg"},null,8,["modelValue","onKeyup","onClick:clear"])]),_:1})]),_:1})]),_:1}),e(F,{headers:t.headers,loading:t.loading,items:t.roles,"sort-by":[{key:"name",order:"asc"}],"items-per-page":10,"loading-text":"Loading roles...",class:"rounded-b-lg"},{loader:l(()=>[e(A,{indeterminate:"",color:"primary",height:"2"})]),"item.permissions":l(({item:a})=>[a.permissions&&a.permissions.length?(x(),I(D,{key:0,color:"info",variant:"flat",size:"small",class:"font-weight-medium"},{default:l(()=>[s(k(a.permissions.length)+" permissions ",1)]),_:2},1024)):(x(),I(D,{key:1,color:"grey",variant:"outlined",size:"small"},{default:l(()=>[s(" No permissions ")]),_:1}))]),"item.actions":l(({item:a})=>[c("div",K,[e(g,{location:"top",text:"Manage Permissions"},{activator:l(({props:u})=>[e(d,C(u,{icon:"",size:"small",color:"info",class:"me-2",variant:"text",onClick:P=>r.managePermissions(a)}),{default:l(()=>[e(m,null,{default:l(()=>[s("mdi-shield-key")]),_:1})]),_:2},1040,["onClick"])]),_:2},1024),e(g,{location:"top",text:"Edit Role"},{activator:l(({props:u})=>[e(d,C(u,{icon:"",size:"small",color:"primary",class:"me-2",variant:"text",onClick:P=>r.editItem(a)}),{default:l(()=>[e(m,null,{default:l(()=>[s("mdi-pencil")]),_:1})]),_:2},1040,["onClick"])]),_:2},1024),e(g,{location:"top",text:"Delete Role"},{activator:l(({props:u})=>[e(d,C(u,{icon:"",size:"small",color:"error",variant:"text",onClick:P=>r.deleteItem(a)}),{default:l(()=>[e(m,null,{default:l(()=>[s("mdi-delete")]),_:1})]),_:2},1040,["onClick"])]),_:2},1024)])]),"no-data":l(()=>[c("div",O,[e(m,{size:"64",color:"grey-lighten-1",class:"mb-4"},{default:l(()=>[s("mdi-shield-off")]),_:1}),M,e(d,{color:"primary",variant:"elevated",onClick:r.initialize},{default:l(()=>[s(" Refresh Data ")]),_:1},8,["onClick"])])]),_:1},8,["headers","loading","items","loading-text"])]),_:1})]),_:1}),e(z,{modelValue:t.dialog,"onUpdate:modelValue":o[5]||(o[5]=a=>t.dialog=a),"max-width":"500px",persistent:""},{default:l(()=>[e(v,{class:"rounded-lg"},{default:l(()=>[e(p,{class:"d-flex justify-space-between pa-6 bg-surface"},{default:l(()=>[c("span",G,k(r.formTitle),1),e(d,{icon:"",onClick:r.close,variant:"text"},{default:l(()=>[e(m,null,{default:l(()=>[s("mdi-close")]),_:1})]),_:1},8,["onClick"])]),_:1}),e(y),e(_,{class:"pa-6"},{default:l(()=>[e($,{ref:"form",modelValue:t.isFormValid,"onUpdate:modelValue":o[4]||(o[4]=a=>t.isFormValid=a)},{default:l(()=>[e(V,null,{default:l(()=>[e(h,{cols:"12"},{default:l(()=>[e(b,{modelValue:t.editedItem.name,"onUpdate:modelValue":o[2]||(o[2]=a=>t.editedItem.name=a),label:"Role Name",variant:"outlined","prepend-inner-icon":"mdi-shield-account",rules:[a=>!!a||"Role name is required"],autofocus:""},null,8,["modelValue","rules"])]),_:1}),e(h,{cols:"12"},{default:l(()=>[e(U,{modelValue:t.editedItem.description,"onUpdate:modelValue":o[3]||(o[3]=a=>t.editedItem.description=a),label:"Description (optional)",variant:"outlined","prepend-inner-icon":"mdi-text-box",rows:"3","auto-grow":"",hint:"Briefly describe the purpose of this role","persistent-hint":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(y),e(w,{class:"pa-6"},{default:l(()=>[e(R),e(d,{color:"error",variant:"text",onClick:r.close,class:"text-capitalize"},{default:l(()=>[s(" Cancel ")]),_:1},8,["onClick"]),e(d,{color:"primary",variant:"elevated",onClick:r.save,loading:t.saving,disabled:!t.isFormValid||t.saving,class:"text-capitalize"},{default:l(()=>[s(" Save ")]),_:1},8,["onClick","loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(z,{modelValue:t.dialogDelete,"onUpdate:modelValue":o[6]||(o[6]=a=>t.dialogDelete=a),"max-width":"500px",persistent:""},{default:l(()=>[e(v,{class:"rounded-lg"},{default:l(()=>[e(p,{class:"text-h5 pa-6"},{default:l(()=>[s("Confirm Deletion")]),_:1}),e(_,{class:"pa-6"},{default:l(()=>[s(" Are you sure you want to delete the role "),c("strong",null,k(t.editedItem.name),1),s("? This action cannot be undone and may affect users assigned to this role. ")]),_:1}),e(y),e(w,{class:"pa-6"},{default:l(()=>[e(R),e(d,{color:"grey",variant:"text",onClick:r.closeDelete,class:"text-capitalize"},{default:l(()=>[s(" Cancel ")]),_:1},8,["onClick"]),e(d,{color:"error",variant:"elevated",onClick:r.deleteItemConfirm,loading:t.deleting,class:"text-capitalize"},{default:l(()=>[s(" Delete ")]),_:1},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(S,{ref:"RolesPermissionsComponent"},null,512)]),_:1})}const te=j(q,[["render",H]]);export{te as default};

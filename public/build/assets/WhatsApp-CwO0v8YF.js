import{Z as Be}from"./index.esm-Dl5mh26D.js";import{A as je}from"./AppLayout-BD4Swfdd.js";import{r as m,k as R,B as Oe,y as Ye,i as f,o as w,c as M,w as a,J as Je,b as e,u as Ke,f as i,t as _,e as q,a as u,d as S,g as ye,F as Q,K as Ze,L as Ge}from"./app-vhgUnBDt.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const He=u("h2",{class:"text-h6"},"WhatsApp Business",-1),Qe={class:"d-flex justify-center align-center mt-2"},Xe=u("div",{class:"text-subtitle-2"},"Sent",-1),ea={class:"text-h6"},aa=u("div",{class:"text-subtitle-2"},"Delivered",-1),ta={class:"text-h6"},la=u("div",{class:"text-subtitle-2"},"Read",-1),sa={class:"text-h6"},na=u("div",{class:"text-subtitle-2"},"Pending",-1),oa={class:"text-h6"},ia=u("div",{class:"text-subtitle-2"},"Failed",-1),ra={class:"text-h6"},ua=u("div",{class:"text-h6"},"Recent Messages",-1),da={key:1,class:"text-center pa-4"},ca=u("p",{class:"text-body-1 mt-2"},"No messages found. Try sending one!",-1),va=u("thead",null,[u("tr",null,[u("th",{class:"text-left"},"Content"),u("th",{class:"text-left"},"Recipient"),u("th",{class:"text-left"},"Status"),u("th",{class:"text-left"},"Sent Date"),u("th",{class:"text-center"},"Actions")])],-1),pa={class:"text-center"},ma={key:3,class:"d-flex justify-center mt-4"},fa=u("span",null,"WhatsApp Contacts",-1),_a={class:"mt-4 text-caption"},ga=u("h3",null,"CSV File Requirements",-1),ya=u("p",{class:"mb-2"},"Your CSV file should include the following columns:",-1),ha=u("ul",null,[u("li",null,"Name (required)"),u("li",null,"Phone Number (required, in international format)"),u("li",null,"WhatsApp Number (optional, in international format)"),u("li",null,"Alternative Phone (optional)"),u("li",null,"Email (optional)"),u("li",null,"Company (optional)"),u("li",null,"Status (optional)")],-1),ba=u("strong",null,"Important:",-1),wa={class:"mt-4"},Aa={key:0,class:"text-center pa-4"},xa=u("p",{class:"text-body-1 mt-2"},"No templates available",-1),Ca={key:0},Va={class:"d-flex flex-wrap justify-space-between align-center"},ka={class:"text-caption text-grey"},Ta=u("br",null,null,-1),Sa={class:"d-flex mt-2 mt-sm-0"},$a={key:1,class:"text-center pa-4"},Ma=u("p",{class:"text-body-1 mt-2"},"Select a template to edit or create a new one",-1),Wa={__name:"WhatsApp",setup(Pa){const he=s=>{if(!s)return"";const t={year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0};return new Date(s).toLocaleString("en-US",t)},B=m("all"),j=m("all"),be=m(10),we=[{title:"All Types",value:"all"},{title:"Customer",value:"customer"},{title:"Vendor",value:"vendor"},{title:"Partner",value:"partner"},{title:"Employee",value:"employee"}],Ae=[{title:"All Statuses",value:"all"},{title:"Active",value:1},{title:"Inactive",value:0}],ue=R(()=>{if(!Array.isArray(A.value))return[];let s=[...A.value];return B.value!=="all"&&(s=s.filter(t=>t.type===B.value)),j.value!=="all"&&(s=s.filter(t=>t.status===j.value)),s}),xe=s=>!!(s.whatsapp||s.alt_phone||s.phone),Ce=s=>{alert(`Contact: ${s.name}
Phone: ${s.phone||"N/A"}
WhatsApp: ${s.whatsapp||"N/A"}
Type: ${s.type||"N/A"}
Company: ${s.company_name||"N/A"}
Country: ${s.country_name||"N/A"}`)},de=(s=!1,t=null)=>{F.value="",V.value="",s?h.value=pe.value:t?h.value=[t]:h.value=[],(!Array.isArray(p.value)||p.value.length===0)&&!r.value.templates&&le(),W.value=!0},Ve=()=>{$.value="",B.value="all",j.value="all"},X=R(()=>{var s;return(s=Je().props.value.user)==null?void 0:s.id}),$=m(""),y=m([]),r=m({messages:!1,contacts:!1,templates:!1,sending:!1,importing:!1,savingTemplate:!1,deletingTemplate:!1}),A=m([]),h=m([]),V=m(""),p=m([]),O=m(!1),W=m(!1),K=m(!1),F=m(""),Z=m(""),z=m(null),Y=m(1),ce=m(20),ve=m(0),ke=m({name:"",content:"",channel:"WhatsApp",module:"Message"}),d=m(null),P=m(!1),k=m("Connected"),T=m({sent:0,delivered:0,read:0,failed:0,pending:0}),pe=m([]),ee=R(()=>Math.ceil(ve.value/ce.value));R(()=>{const s=[],o=Math.floor(2.5);let n=Math.max(1,Y.value-o),c=Math.min(ee.value,n+5-1);c-n+1<5&&(n=Math.max(1,c-5+1));for(let v=n;v<=c;v++)s.push(v);return s});const ae=R(()=>{if(!$.value||!Array.isArray(y.value))return y.value;const s=$.value.toLowerCase();return y.value.filter(t=>{var o,n,c,v;return((o=t.content)==null?void 0:o.toLowerCase().includes(s))||((n=t.status)==null?void 0:n.toLowerCase().includes(s))||((c=t.recipient_name)==null?void 0:c.toLowerCase().includes(s))||((v=t.recipient_phone)==null?void 0:v.toLowerCase().includes(s))})}),me=R(()=>Array.isArray(A.value)?A.value.filter(s=>s.whatsapp||s.alt_phone):[]),G=async(s=1)=>{var t,o,n,c;try{r.value.messages=!0,Y.value=s;const v=await axios.get("/api/v1/whatsapp-messages",{params:{page:s,per_page:ce.value}});(o=(t=v.data)==null?void 0:t.data)!=null&&o.data&&Array.isArray(v.data.data.data)?(y.value=v.data.data.data,ve.value=v.data.data.total||y.value.length,fe()):(console.error("Unexpected API response format:",v.data),Array.isArray(y.value)||(y.value=[]),b("Invalid data format received from server"))}catch(v){console.error("Error loading messages:",v),b(`Failed to load messages: ${((c=(n=v.response)==null?void 0:n.data)==null?void 0:c.message)||v.message}`),Array.isArray(y.value)||(y.value=[])}finally{r.value.messages=!1}};Oe($,s=>{s===""&&G(Y.value)});const fe=()=>{if(!Array.isArray(y.value)){console.error("messages.value is not an array:",y.value);return}try{const s=y.value.reduce((t,o)=>{const n=o&&o.status&&typeof o.status=="string"?o.status.toLowerCase():"unknown";return t[n]=(t[n]||0)+1,t},{});T.value={sent:s.sent||0,delivered:s.delivered||0,read:s.read||0,failed:s.failed||0,pending:s.pending||0},y.value.forEach(t=>{if(t.message_status&&t.message_status!==t.status){const o=t.message_status.toLowerCase();T.value[o]=(T.value[o]||0)+1}})}catch(s){console.error("Error calculating stats:",s),T.value={sent:0,delivered:0,read:0,failed:0,pending:0}}},te=async()=>{var s,t,o,n;try{r.value.contacts=!0;const c=await axios.get("/api/v1/contacts");(t=(s=c.data)==null?void 0:s.data)!=null&&t.data&&Array.isArray(c.data.data.data)?(A.value=c.data.data.data,ue=A,console.log("Contacts loaded:",A.value.length)):(console.error("Unexpected API response format:",c.data),(!Array.isArray(A.value)||A.value.length===0)&&(A.value=[]),b("Invalid contact data format received from server"))}catch(c){console.error("Error loading contacts:",c),b(`Failed to load contacts: ${((n=(o=c.response)==null?void 0:o.data)==null?void 0:n.message)||c.message}`),(!Array.isArray(A.value)||A.value.length===0)&&(A.value=[])}finally{r.value.contacts=!1}},le=async()=>{var s,t,o;try{r.value.templates=!0;const n=await axios.get("/api/v1/templates");(s=n.data)!=null&&s.data&&Array.isArray(n.data.data)?(p.value=n.data.data,console.log("Templates loaded:",p.value.length)):(console.error("Unexpected API response format:",n.data),(!Array.isArray(p.value)||p.value.length===0)&&(p.value=[]),b("Invalid template data format received from server"))}catch(n){console.error("Error loading templates:",n),b(`Failed to load templates: ${((o=(t=n.response)==null?void 0:t.data)==null?void 0:o.message)||n.message}`),(!Array.isArray(p.value)||p.value.length===0)&&(p.value=[])}finally{r.value.templates=!1}},Te=s=>{if(!s||!Array.isArray(p.value))return;const t=p.value.find(o=>o.id===s);t&&(V.value=t.content,d.value=t,console.log("Selected template:",t))},Se=async()=>{F.value="",V.value="",h.value=[],d.value=null,(!Array.isArray(A.value)||A.value.length===0)&&!r.value.contacts&&await te(),(!Array.isArray(p.value)||p.value.length===0)&&!r.value.templates&&await le(),W.value=!0},b=s=>{F.value=s,setTimeout(()=>{F.value=""},5e3)},U=s=>{Z.value=s,setTimeout(()=>{Z.value=""},5e3)},$e=async()=>{var s,t,o,n,c;if(!V.value.trim())return b("Please enter a message");if(!Array.isArray(h.value)||h.value.length===0)return b("Please select at least one recipient");try{r.value.sending=!0;const v=await axios.post("/api/v1/whatsapp-send",{user_id:X.value,contacts:h.value.map(x=>({id:x.id,name:x.name,chatId:x.whatsapp||x.alt_phone||x.phone})),message:V.value,template_id:((s=d.value)==null?void 0:s.id)||null}),g=new Date;Array.isArray(y.value)||(y.value=[]),y.value.unshift({id:((t=v.data)==null?void 0:t.id)||Date.now(),content:V.value,recipients:h.value.length,status:"sent",message_status:"sent",sent_at:g.toISOString().split("T")[0],created_at:g.toISOString(),recipient_name:h.value.map(x=>x.name).join(", "),recipient_phone:h.value.map(x=>x.whatsapp||x.alt_phone||x.phone).join(", "),results:((o=v.data)==null?void 0:o.results)||[]}),T.value.sent+=h.value.length,U(`Message successfully sent to ${h.value.length} recipients`),V.value="",h.value=[],d.value=null,W.value=!1,setTimeout(()=>{G(1)},1e3)}catch(v){console.error("Error sending message:",v),b(`Failed to send message: ${((c=(n=v.response)==null?void 0:n.data)==null?void 0:c.message)||v.message}`)}finally{r.value.sending=!1}},Me=s=>{console.log("Viewing message details:",s),alert(`Message ID: ${s.id}
Content: ${s.content}
Status: ${s.status||s.message_status||"Unknown"}
Sent At: ${s.sent_at||(s.created_at?s.created_at.split("T")[0]:"N/A")}
Recipient: ${s.recipient_name||"Unknown"} (${s.recipient_phone||"Unknown"})`)},Pe=async s=>{var t,o;if(!s)return b("Invalid message ID");if(confirm("Are you sure you want to delete this message?"))try{await axios.delete(`/api/v1/whatsapp-messages/${s}`),Array.isArray(y.value)&&(y.value=y.value.filter(n=>n.id!==s),fe()),U("Message deleted successfully")}catch(n){console.error("Error deleting message:",n),b(`Failed to delete message: ${((o=(t=n.response)==null?void 0:t.data)==null?void 0:o.message)||n.message}`)}},Ne=async()=>{var s,t,o;if(!z.value)return b("Please select a CSV file to import");try{r.value.importing=!0;const n=new FormData;n.append("file",z.value),n.append("user_id",X.value);const c=await axios.post("/api/v1/contacts/import",n,{headers:{"Content-Type":"multipart/form-data"}});c.data&&c.data.success?(U(`Successfully imported ${c.data.imported||"multiple"} contacts`),await te(),O.value=!1,z.value=null):b(((s=c.data)==null?void 0:s.message)||"Import failed")}catch(n){console.error("Error importing contacts:",n),b(`Failed to import contacts: ${((o=(t=n.response)==null?void 0:t.data)==null?void 0:o.message)||n.message}`)}finally{r.value.importing=!1}},Ue=()=>{P.value=!0,d.value={...ke.value}},De=async()=>{var s,t;if(!d.value||!d.value.name||!d.value.content)return b("Template name and content are required");try{r.value.savingTemplate=!0;let o;const n={name:d.value.name,content:d.value.content,channel:d.value.channel||"WhatsApp",module:d.value.module||"Message",user_id:X.value};if(P.value||!d.value.id)o=await axios.post("/api/v1/templates",n),o.data&&o.data.data&&(Array.isArray(p.value)||(p.value=[]),p.value.push(o.data.data),U("Template created successfully"));else if(o=await axios.put(`/api/v1/templates/${d.value.id}`,n),o.data&&o.data.data){const c=p.value.findIndex(v=>v.id===d.value.id);c!==-1&&(p.value[c]=o.data.data),U("Template updated successfully")}P.value=!1}catch(o){console.error("Error saving template:",o),b(`Failed to save template: ${((t=(s=o.response)==null?void 0:s.data)==null?void 0:t.message)||o.message}`)}finally{r.value.savingTemplate=!1}},Ie=async()=>{var s,t;if(!d.value||!d.value.id)return b("No template selected");if(confirm(`Are you sure you want to delete template "${d.value.name}"?`))try{r.value.deletingTemplate=!0,await axios.delete(`/api/v1/templates/${d.value.id}`),p.value=p.value.filter(o=>o.id!==d.value.id),d.value=null,U("Template deleted successfully")}catch(o){console.error("Error deleting template:",o),b(`Failed to delete template: ${((t=(s=o.response)==null?void 0:s.data)==null?void 0:t.message)||o.message}`)}finally{r.value.deletingTemplate=!1}},We=async()=>{var s,t,o;try{k.value="Connecting...";const n=await axios.post("/api/v1/whatsapp-reconnect");n.data&&n.data.success?(k.value="Connected",U("WhatsApp connection successful")):(k.value="Disconnected",b(((s=n.data)==null?void 0:s.message)||"Failed to connect to WhatsApp"))}catch(n){console.error("Error reconnecting WhatsApp:",n),k.value="Disconnected",b(`Failed to connect to WhatsApp: ${((o=(t=n.response)==null?void 0:t.data)==null?void 0:o.message)||n.message}`)}},Fe=s=>s?s.replace(/@c\.us$/,""):"Unknown";return Ye(()=>(y.value=[],A.value=[],p.value=[],G(1),te(),le(),()=>{clearInterval(statusInterval)})),(s,t)=>{const o=f("v-alert"),n=f("v-icon"),c=f("v-avatar"),v=f("v-chip"),g=f("v-btn"),x=f("v-divider"),C=f("v-col"),J=f("v-row"),D=f("v-card-text"),N=f("v-card"),se=f("v-text-field"),I=f("v-card-title"),ne=f("v-progress-linear"),ze=f("v-table"),Ee=f("v-pagination"),_e=f("v-container"),E=f("v-select"),Le=f("v-data-table"),oe=f("v-list-item"),ge=f("v-textarea"),ie=f("v-spacer"),H=f("v-card-actions"),re=f("v-dialog"),Re=f("v-file-input"),qe=f("v-list");return w(),M(je,null,{default:a(()=>[e(Ke(Be),{title:"WhatsApp Business"}),e(_e,null,{default:a(()=>[F.value?(w(),M(o,{key:0,type:"error",closable:"",class:"mb-4"},{default:a(()=>[i(_(F.value),1)]),_:1})):q("",!0),Z.value?(w(),M(o,{key:1,type:"success",closable:"",class:"mb-4"},{default:a(()=>[i(_(Z.value),1)]),_:1})):q("",!0),e(J,null,{default:a(()=>[e(C,{cols:"12",md:"3"},{default:a(()=>[e(N,null,{default:a(()=>[e(D,{class:"text-center"},{default:a(()=>[e(c,{size:"80",color:k.value==="Connected"?"green":"grey",class:"mb-3"},{default:a(()=>[e(n,{size:"48",color:"white"},{default:a(()=>[i("mdi-whatsapp")]),_:1})]),_:1},8,["color"]),He,u("div",Qe,[e(v,{color:k.value==="Connected"?"success":k.value==="Connecting..."?"warning":"error",class:"mr-2"},{default:a(()=>[i(_(k.value),1)]),_:1},8,["color"]),k.value!=="Connected"&&k.value!=="Connecting..."?(w(),M(g,{key:0,size:"small",color:"primary",icon:"",onClick:We},{default:a(()=>[e(n,null,{default:a(()=>[i("mdi-refresh")]),_:1})]),_:1})):q("",!0)]),e(x,{class:"my-4"}),e(J,null,{default:a(()=>[e(C,{cols:"6",class:"py-1"},{default:a(()=>[Xe,u("div",ea,_(T.value.sent),1)]),_:1}),e(C,{cols:"6",class:"py-1"},{default:a(()=>[aa,u("div",ta,_(T.value.delivered),1)]),_:1}),e(C,{cols:"6",class:"py-1"},{default:a(()=>[la,u("div",sa,_(T.value.read),1)]),_:1}),e(C,{cols:"6",class:"py-1"},{default:a(()=>[na,u("div",oa,_(T.value.pending),1)]),_:1}),e(C,{cols:"12",class:"py-1"},{default:a(()=>[ia,u("div",ra,_(T.value.failed),1)]),_:1})]),_:1}),e(x,{class:"my-4"}),e(g,{color:"primary",block:"",class:"mb-2",onClick:Se},{default:a(()=>[e(n,{class:"mr-2"},{default:a(()=>[i("mdi-message-text")]),_:1}),i(" New Message ")]),_:1}),e(g,{color:"info",block:"",class:"mb-2",onClick:t[0]||(t[0]=l=>O.value=!0)},{default:a(()=>[e(n,{class:"mr-2"},{default:a(()=>[i("mdi-file-import")]),_:1}),i(" Import Contacts ")]),_:1}),e(g,{color:"secondary",block:"",onClick:t[1]||(t[1]=l=>K.value=!0)},{default:a(()=>[e(n,{class:"mr-2"},{default:a(()=>[i("mdi-file-document-edit")]),_:1}),i(" Manage Templates ")]),_:1})]),_:1})]),_:1})]),_:1}),e(C,{cols:"12",md:"9"},{default:a(()=>[e(N,null,{default:a(()=>[e(I,{class:"d-flex flex-wrap justify-space-between align-center"},{default:a(()=>[ua,e(se,{modelValue:$.value,"onUpdate:modelValue":t[2]||(t[2]=l=>$.value=l),"append-icon":"mdi-magnify",label:"Search messages","single-line":"","hide-details":"",density:"compact",class:"max-w-xs mt-2 mt-sm-0"},null,8,["modelValue"])]),_:1}),e(D,null,{default:a(()=>[r.value.messages?(w(),M(ne,{key:0,indeterminate:"",color:"primary"})):!Array.isArray(ae.value)||ae.value.length===0?(w(),S("div",da,[e(n,{size:"large",color:"grey"},{default:a(()=>[i("mdi-message-text-outline")]),_:1}),ca])):(w(),M(ze,{key:2},{default:a(()=>[va,u("tbody",null,[(w(!0),S(Q,null,ye(ae.value,l=>(w(),S("tr",{key:l.id},[u("td",null,_(l.content),1),u("td",null,_(Fe(l.recipient_phone)),1),u("td",null,[e(v,{color:l.status==="delivered"||l.message_status==="delivered"?"success":l.status==="read"||l.message_status==="read"?"info":l.status==="failed"||l.message_status==="failed"?"error":l.status==="sent"||l.message_status==="sent"?"primary":"warning",size:"small"},{default:a(()=>[i(_(l.message_status||l.status||"Unknown"),1)]),_:2},1032,["color"])]),u("td",null,_(he(l.sent_at||l.created_at)),1),u("td",pa,[e(g,{icon:"",size:"small",color:"info",variant:"text",onClick:L=>Me(l)},{default:a(()=>[e(n,null,{default:a(()=>[i("mdi-eye")]),_:1})]),_:2},1032,["onClick"]),e(g,{icon:"",size:"small",color:"error",variant:"text",onClick:L=>Pe(l.id)},{default:a(()=>[e(n,null,{default:a(()=>[i("mdi-delete")]),_:1})]),_:2},1032,["onClick"])])]))),128))])]),_:1})),ee.value>1?(w(),S("div",ma,[e(Ee,{modelValue:Y.value,"onUpdate:modelValue":[t[3]||(t[3]=l=>Y.value=l),G],length:ee.value,"total-visible":5},null,8,["modelValue","length"])])):q("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(_e,null,{default:a(()=>[e(J,null,{default:a(()=>[e(C,{cols:"12"},{default:a(()=>[e(N,null,{default:a(()=>[e(I,{class:"d-flex align-center justify-space-between"},{default:a(()=>[fa,u("div",null,[e(g,{color:"success",onClick:t[4]||(t[4]=l=>de(!0)),disabled:!pe.value.length},{default:a(()=>[e(n,{start:""},{default:a(()=>[i("mdi-send")]),_:1}),i(" Bulk Message ")]),_:1},8,["disabled"])])]),_:1}),e(D,null,{default:a(()=>[e(J,null,{default:a(()=>[e(C,{cols:"12",sm:"6",md:"4"},{default:a(()=>[e(se,{modelValue:$.value,"onUpdate:modelValue":t[5]||(t[5]=l=>$.value=l),label:"Search Contacts","prepend-inner-icon":"mdi-magnify",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),e(C,{cols:"12",sm:"6",md:"3"},{default:a(()=>[e(E,{modelValue:B.value,"onUpdate:modelValue":t[6]||(t[6]=l=>B.value=l),items:we,label:"Contact Type",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),e(C,{cols:"12",sm:"6",md:"3"},{default:a(()=>[e(E,{modelValue:j.value,"onUpdate:modelValue":t[7]||(t[7]=l=>j.value=l),items:Ae,label:"Contact Status",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),e(C,{cols:"12",sm:"6",md:"2"},{default:a(()=>[e(g,{color:"info",variant:"text",onClick:Ve},{default:a(()=>[e(n,{start:""},{default:a(()=>[i("mdi-filter-off")]),_:1}),i(" Reset ")]),_:1})]),_:1})]),_:1}),e(Le,{modelValue:h.value,"onUpdate:modelValue":t[8]||(t[8]=l=>h.value=l),headers:[{title:"ID",key:"id",width:"5%"},{title:"Name",key:"name",width:"20%"},{title:"WhatsApp",key:"whatsapp",width:"15%"},{title:"Type",key:"type",width:"10%"},{title:"Company",key:"company_name",width:"15%"},{title:"Status",key:"status",width:"10%"},{title:"Country",key:"country_name",width:"15%"},{title:"Actions",key:"actions",sortable:!1,width:"10%"}],items:ue.value,search:$.value,"items-per-page":be.value,"item-value":"id","show-select":"",class:"mt-4"},{"item.whatsapp":a(({item:l})=>[i(_(l.whatsapp||l.alt_phone||l.phone||"N/A"),1)]),"item.type":a(({item:l})=>[e(v,{color:l.type==="customer"?"primary":l.type==="vendor"?"success":l.type==="partner"?"warning":l.type==="employee"?"info":"grey",size:"small"},{default:a(()=>[i(_(l.type),1)]),_:2},1032,["color"])]),"item.status":a(({item:l})=>[e(v,{color:l.status===1?"success":"grey",size:"small"},{default:a(()=>[i(_(l.status===1?"Active":"Inactive"),1)]),_:2},1032,["color"])]),"item.actions":a(({item:l})=>[e(g,{icon:"",size:"small",color:"primary",onClick:L=>Ce(l)},{default:a(()=>[e(n,null,{default:a(()=>[i("mdi-eye")]),_:1})]),_:2},1032,["onClick"]),e(g,{icon:"",size:"small",color:"success",onClick:L=>de(!1,l),disabled:!xe(l)},{default:a(()=>[e(n,null,{default:a(()=>[i("mdi-send")]),_:1})]),_:2},1032,["onClick","disabled"])]),_:1},8,["modelValue","items","search","items-per-page"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(re,{modelValue:W.value,"onUpdate:modelValue":t[12]||(t[12]=l=>W.value=l),"max-width":"700px"},{default:a(()=>[e(N,null,{default:a(()=>[e(I,null,{default:a(()=>[e(n,{color:"primary",class:"mr-2"},{default:a(()=>[i("mdi-message-text")]),_:1}),i(" Send WhatsApp Message ")]),_:1}),e(D,null,{default:a(()=>[r.value.contacts||r.value.templates?(w(),M(ne,{key:0,indeterminate:"",color:"primary",class:"mb-4"})):q("",!0),e(E,{modelValue:h.value,"onUpdate:modelValue":t[9]||(t[9]=l=>h.value=l),items:me.value,"item-title":"name","item-value":"id",label:"Select Recipients",multiple:"",chips:"","return-object":"",hint:`${me.value.length} contacts with WhatsApp numbers available`,"persistent-hint":"",loading:r.value.contacts,disabled:r.value.contacts,rules:[l=>Array.isArray(l)&&l.length>0||"At least one recipient is required"]},{"prepend-item":a(()=>[e(oe,{title:"WhatsApp Recipients",disabled:""}),e(x)]),selection:a(({item:l})=>[e(v,null,{default:a(()=>[i(_(l.raw.name)+" ("+_(l.raw.whatsapp||l.raw.alt_phone||l.raw.phone)+") ",1)]),_:2},1024)]),item:a(({item:l,props:L})=>[e(oe,Ze(Ge(L)),{prepend:a(()=>[e(c,{color:"grey-lighten-3",size:"36"},{default:a(()=>[e(n,{color:"grey-darken-2"},{default:a(()=>[i("mdi-account")]),_:1})]),_:1})]),title:a(()=>[i(_(l.raw.name),1)]),subtitle:a(()=>[i(_(l.raw.whatsapp||l.raw.alt_phone||l.raw.phone),1)]),_:2},1040)]),_:1},8,["modelValue","items","hint","loading","disabled","rules"]),e(E,{label:"Select Template",items:p.value,"item-title":"name","item-value":"id","onUpdate:modelValue":Te,class:"mt-4",hint:d.value?`Channel: ${d.value.channel||"WhatsApp"} | Type: ${d.value.module||"Message"}`:"","persistent-hint":"",loading:r.value.templates,disabled:r.value.templates,clearable:""},null,8,["items","hint","loading","disabled"]),e(ge,{modelValue:V.value,"onUpdate:modelValue":t[10]||(t[10]=l=>V.value=l),label:"Message",rows:"5",class:"mt-4",hint:"Variables format: {{variable_name}}","persistent-hint":"",rules:[l=>!!l||"Message is required"],disabled:r.value.sending},null,8,["modelValue","rules","disabled"]),u("div",_a,[e(n,{size:"small",color:"info",class:"mr-1"},{default:a(()=>[i("mdi-information-outline")]),_:1}),i(" Your message will be sent to "+_(h.value.length)+" recipient(s). ",1)])]),_:1}),e(H,null,{default:a(()=>[e(ie),e(g,{color:"error",variant:"outlined",onClick:t[11]||(t[11]=l=>W.value=!1),disabled:r.value.sending},{default:a(()=>[i(" Cancel ")]),_:1},8,["disabled"]),e(g,{color:"primary",onClick:$e,loading:r.value.sending,disabled:!V.value||!Array.isArray(h.value)||h.value.length===0||r.value.sending},{default:a(()=>[i(" Send Message ")]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(re,{modelValue:O.value,"onUpdate:modelValue":t[15]||(t[15]=l=>O.value=l),"max-width":"500px"},{default:a(()=>[e(N,null,{default:a(()=>[e(I,null,{default:a(()=>[e(n,{color:"primary",class:"mr-2"},{default:a(()=>[i("mdi-file-import")]),_:1}),i(" Import Contacts ")]),_:1}),e(D,null,{default:a(()=>[e(Re,{modelValue:z.value,"onUpdate:modelValue":t[13]||(t[13]=l=>z.value=l),label:"Upload CSV File",accept:".csv","prepend-icon":"mdi-file-upload","show-size":"","truncate-length":"25",loading:r.value.importing,disabled:r.value.importing,rules:[l=>!!l||"CSV file is required"]},null,8,["modelValue","loading","disabled","rules"]),e(o,{type:"info",class:"mt-4",variant:"tonal"},{default:a(()=>[ga,ya,ha]),_:1}),e(o,{type:"warning",class:"mt-2",variant:"tonal"},{default:a(()=>[ba,i(" Phone numbers should be in international format (e.g., +1234567890) ")]),_:1}),u("div",wa,[e(g,{color:"secondary",variant:"outlined","prepend-icon":"mdi-download",block:""},{default:a(()=>[i(" Download Sample CSV ")]),_:1})])]),_:1}),e(H,null,{default:a(()=>[e(ie),e(g,{color:"error",variant:"outlined",onClick:t[14]||(t[14]=l=>O.value=!1),disabled:r.value.importing},{default:a(()=>[i(" Cancel ")]),_:1},8,["disabled"]),e(g,{color:"primary",onClick:Ne,loading:r.value.importing,disabled:!z.value||r.value.importing},{default:a(()=>[i(" Import Contacts ")]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(re,{modelValue:K.value,"onUpdate:modelValue":t[21]||(t[21]=l=>K.value=l),"max-width":"700px"},{default:a(()=>[e(N,null,{default:a(()=>[e(I,null,{default:a(()=>[e(n,{color:"primary",class:"mr-2"},{default:a(()=>[i("mdi-file-document-edit")]),_:1}),i(" Manage Templates ")]),_:1}),e(D,null,{default:a(()=>[r.value.templates?(w(),M(ne,{key:0,indeterminate:"",color:"primary",class:"mb-4"})):q("",!0),e(J,null,{default:a(()=>[e(C,{cols:"12",md:"4"},{default:a(()=>[e(N,{variant:"outlined"},{default:a(()=>[e(I,{class:"text-subtitle-1"},{default:a(()=>[i("Available Templates")]),_:1}),e(qe,null,{default:a(()=>[!Array.isArray(p.value)||p.value.length===0?(w(),S("div",Aa,[e(n,{size:"large",color:"grey"},{default:a(()=>[i("mdi-file-document-outline")]),_:1}),xa])):(w(!0),S(Q,{key:1},ye(p.value,l=>(w(),M(oe,{key:l.id,title:l.name,subtitle:l.channel||"WhatsApp",onClick:L=>{d.value={...l},P.value=!1},active:d.value&&d.value.id===l.id},{prepend:a(()=>[e(n,{color:"primary"},{default:a(()=>[i("mdi-file-document-outline")]),_:1})]),_:2},1032,["title","subtitle","onClick","active"]))),128))]),_:1}),e(H,null,{default:a(()=>[e(g,{color:"success",block:"",onClick:Ue,"prepend-icon":"mdi-plus"},{default:a(()=>[i(" New Template ")]),_:1})]),_:1})]),_:1})]),_:1}),e(C,{cols:"12",md:"8"},{default:a(()=>[e(N,{variant:"outlined",class:"h-100"},{default:a(()=>[e(I,{class:"text-subtitle-1"},{default:a(()=>[i(_(P.value?"Create New Template":d.value?"Edit Template":"Template Details"),1)]),_:1}),e(D,null,{default:a(()=>[d.value?(w(),S("div",Ca,[e(se,{modelValue:d.value.name,"onUpdate:modelValue":t[16]||(t[16]=l=>d.value.name=l),label:"Template Name",rules:[l=>!!l||"Template name is required"],disabled:r.value.savingTemplate||r.value.deletingTemplate},null,8,["modelValue","rules","disabled"]),e(E,{modelValue:d.value.channel,"onUpdate:modelValue":t[17]||(t[17]=l=>d.value.channel=l),label:"Channel",items:["WhatsApp","SMS","Email"],disabled:r.value.savingTemplate||r.value.deletingTemplate,class:"mt-4"},null,8,["modelValue","disabled"]),e(E,{modelValue:d.value.module,"onUpdate:modelValue":t[18]||(t[18]=l=>d.value.module=l),label:"Template Type",items:["Message","Notification","Marketing","Reminder"],disabled:r.value.savingTemplate||r.value.deletingTemplate,class:"mt-4"},null,8,["modelValue","disabled"]),e(ge,{modelValue:d.value.content,"onUpdate:modelValue":t[19]||(t[19]=l=>d.value.content=l),label:"Template Content",rows:"8",hint:"Variables format: {{variable_name}}","persistent-hint":"",rules:[l=>!!l||"Template content is required"],disabled:r.value.savingTemplate||r.value.deletingTemplate,class:"mt-4"},null,8,["modelValue","rules","disabled"]),e(x,{class:"my-4"}),u("div",Va,[u("div",ka,[d.value.id&&!P.value?(w(),S(Q,{key:0},[i(" Template ID: "+_(d.value.id)+" ",1),Ta,i(" Last Updated: "+_(d.value.updated_at?new Date(d.value.updated_at).toLocaleString():"N/A"),1)],64)):(w(),S(Q,{key:1},[i(" Creating new template ")],64))]),u("div",Sa,[e(g,{color:"error",class:"mr-2",disabled:P.value||r.value.savingTemplate||r.value.deletingTemplate||!d.value.id,loading:r.value.deletingTemplate,onClick:Ie},{default:a(()=>[i(" Delete ")]),_:1},8,["disabled","loading"]),e(g,{color:"primary",loading:r.value.savingTemplate,disabled:r.value.savingTemplate||r.value.deletingTemplate||!d.value.name||!d.value.content,onClick:De},{default:a(()=>[i(_(P.value?"Create":"Save Changes"),1)]),_:1},8,["loading","disabled"])])])])):(w(),S("div",$a,[e(n,{size:"large",color:"grey"},{default:a(()=>[i("mdi-file-document-outline")]),_:1}),Ma]))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(H,null,{default:a(()=>[e(ie),e(g,{color:"primary",onClick:t[20]||(t[20]=l=>K.value=!1)},{default:a(()=>[i("Close")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}};export{Wa as default};

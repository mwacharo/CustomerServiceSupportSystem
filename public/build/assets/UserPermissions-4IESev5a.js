import{A as j}from"./AppLayout-CozrIZdZ.js";import{s as _,i as o,o as F,c as Q,w as s,a as d,b as t,f as i,x as q,t as u,z as S,p as E,j as $}from"./app-B1WkFlD3.js";import{_ as B}from"./_plugin-vue_export-helper-DlAUqK2U.js";const K={components:{AppLayout:j},data:()=>({dialog:!1,loading:!1,searching:!1,saving:!1,deleting:!1,formValid:!1,dialogDelete:!1,snackbar:{show:!1,text:"",color:"success"},headers:[{title:"Permission Name",align:"start",key:"name",width:"70%"},{title:"Actions",key:"actions",sortable:!1,align:"end",width:"30%"}],roles:[],searchQuery:"",editedIndex:-1,editedItem:{name:"",description:""},defaultItem:{name:"",description:""},nameRules:[e=>!!e||"Permission name is required",e=>e&&e.length>=3||"Name must be at least 3 characters"]}),computed:{formTitle(){return this.editedIndex===-1?"Create New Permission":"Edit Permission"}},watch:{dialog(e){e||this.close()},dialogDelete(e){e||this.closeDelete()}},created(){this.initialize()},methods:{initialize(){this.loading=!0,_.get("api/v1/permissions").then(a=>{this.roles=a.data,this.showSnackbar("Permissions loaded successfully","success")}).catch(a=>{console.error("API Error:",a),this.showSnackbar("Failed to load permissions","error")}).finally(()=>{this.loading=!1})},openNewPermissionDialog(){this.editedIndex=-1,this.editedItem=Object.assign({},this.defaultItem),this.dialog=!0,this.$nextTick(()=>{this.$refs.form&&this.$refs.form.resetValidation()})},editItem(e){this.editedIndex=this.roles.indexOf(e),this.editedItem=Object.assign({},e),this.dialog=!0,this.$nextTick(()=>{this.$refs.form&&this.$refs.form.resetValidation()})},deleteItem(e){this.editedIndex=this.roles.indexOf(e),this.editedItem=Object.assign({},e),this.dialogDelete=!0},deleteItemConfirm(){this.deleting=!0,_.delete(`/api/v1/permissions/${this.editedItem.id}`).then(()=>{this.roles.splice(this.editedIndex,1),this.showSnackbar("Permission deleted successfully","success"),this.closeDelete()}).catch(e=>{console.error("Deletion error:",e),this.showSnackbar("Failed to delete permission","error")}).finally(()=>{this.deleting=!1})},close(){this.dialog=!1,this.resetForm()},closeDelete(){this.dialogDelete=!1,this.resetForm()},resetForm(){this.$nextTick(()=>{this.$refs.form&&this.$refs.form.resetValidation(),this.editedItem=Object.assign({},this.defaultItem),this.editedIndex=-1})},save(){if(!this.$refs.form.validate())return;this.saving=!0;let e;this.editedIndex>-1?e=_.put(`/api/v1/permissions/${this.editedItem.id}`,this.editedItem):e=_.post("/api/v1/permissions",this.editedItem),e.then(a=>{const f=this.editedIndex===-1,m=a.data.data||a.data;f?(this.roles.push(m),this.showSnackbar("Permission created successfully","success")):(Object.assign(this.roles[this.editedIndex],m),this.showSnackbar("Permission updated successfully","success")),this.close()}).catch(a=>{var f,m;console.error("Saving error:",a),this.showSnackbar(((m=(f=a.response)==null?void 0:f.data)==null?void 0:m.message)||"Failed to save permission","error")}).finally(()=>{this.saving=!1})},performSearch(){if(!this.searchQuery.trim()){this.initialize();return}this.searching=!0,this.loading=!0;const e=`/api/v1/permissions/search?query=${encodeURIComponent(this.searchQuery)}`;_.get(e).then(a=>{this.roles=a.data}).catch(a=>{console.error("Search error:",a),this.showSnackbar("Error searching permissions","error")}).finally(()=>{this.searching=!1,this.loading=!1})},showSnackbar(e,a="success"){this.snackbar.text=e,this.snackbar.color=a,this.snackbar.show=!0}}},b=e=>(E("data-v-b7de2a8b"),e=e(),$(),e),G={class:"permissions-manager"},M={class:"d-flex align-center"},H=b(()=>d("h1",{class:"text-h4 font-weight-bold"},"Permissions Management",-1)),J={class:"d-flex align-center"},W={class:"font-weight-medium"},X={class:"d-flex"},Y=b(()=>d("h3",{class:"text-h6 text-grey-darken-1"},"No permissions found",-1)),Z={class:"text-body-2 text-grey"},ee={class:"text-body-1"},te=b(()=>d("p",{class:"text-body-2 mt-4 text-red"}," This action cannot be undone and may affect user roles that depend on this permission. ",-1));function se(e,a,f,m,ae,n){const h=o("v-spacer"),r=o("v-btn"),p=o("v-card"),k=o("v-text-field"),y=o("v-col"),D=o("v-row"),v=o("v-card-text"),P=o("v-chip"),z=o("v-toolbar-title"),c=o("v-icon"),N=o("v-toolbar"),w=o("v-tooltip"),U=o("v-data-table"),I=o("v-card-title"),A=o("v-textarea"),O=o("v-form"),C=o("v-divider"),x=o("v-card-actions"),V=o("v-dialog"),T=o("v-snackbar"),L=o("AppLayout");return F(),Q(L,null,{default:s(()=>[d("div",G,[t(p,{class:"mb-6 pa-4",flat:""},{default:s(()=>[d("div",M,[H,t(h),t(r,{color:"primary","prepend-icon":"mdi-plus",onClick:n.openNewPermissionDialog,elevation:"1"},{default:s(()=>[i(" New Permission ")]),_:1},8,["onClick"])])]),_:1}),t(p,{class:"mb-6",elevation:"1"},{default:s(()=>[t(v,null,{default:s(()=>[t(D,{align:"center"},{default:s(()=>[t(y,{cols:"12",sm:"8",md:"6"},{default:s(()=>[t(k,{modelValue:e.searchQuery,"onUpdate:modelValue":a[0]||(a[0]=l=>e.searchQuery=l),density:"comfortable",placeholder:"Search permissions...","prepend-inner-icon":"mdi-magnify",variant:"outlined","hide-details":"",clearable:"",onKeyup:q(n.performSearch,["enter"]),"onClick:clear":n.initialize},null,8,["modelValue","onKeyup","onClick:clear"])]),_:1}),t(y,{class:"d-flex"},{default:s(()=>[t(r,{color:"primary",variant:"tonal",class:"ml-auto",onClick:n.performSearch,loading:e.searching},{default:s(()=>[i(" Search ")]),_:1},8,["onClick","loading"])]),_:1})]),_:1})]),_:1})]),_:1}),t(p,{elevation:"1"},{default:s(()=>[t(U,{headers:e.headers,items:e.roles,loading:e.loading,"sort-by":[{key:"name",order:"asc"}],"items-per-page":10,"footer-props":{"items-per-page-options":[5,10,15,20],"show-current-page":!0,"show-first-last-page":!0},class:"permissions-table"},{top:s(()=>[t(N,{flat:"",color:"transparent"},{default:s(()=>[t(z,{class:"text-subtitle-1 font-weight-bold"},{default:s(()=>[i(" Permission List "),t(P,{class:"ml-2",color:"primary",size:"small",variant:"tonal"},{default:s(()=>[i(u(e.roles.length)+" total ",1)]),_:1})]),_:1}),t(h),t(r,{icon:"",variant:"text",color:"default",onClick:n.initialize,loading:e.loading,title:"Refresh"},{default:s(()=>[t(c,null,{default:s(()=>[i("mdi-refresh")]),_:1})]),_:1},8,["onClick","loading"])]),_:1})]),"item.name":s(({item:l})=>[d("div",J,[t(c,{size:"small",color:"primary",class:"mr-2"},{default:s(()=>[i("mdi-shield-key")]),_:1}),d("span",W,u(l.name),1)])]),"item.actions":s(({item:l})=>[d("div",X,[t(w,{location:"top",text:"Edit"},{activator:s(({props:g})=>[t(r,S({icon:"",size:"small",color:"primary",variant:"text"},g,{onClick:R=>n.editItem(l)}),{default:s(()=>[t(c,null,{default:s(()=>[i("mdi-pencil")]),_:1})]),_:2},1040,["onClick"])]),_:2},1024),t(w,{location:"top",text:"Delete"},{activator:s(({props:g})=>[t(r,S({icon:"",size:"small",color:"error",variant:"text"},g,{onClick:R=>n.deleteItem(l)}),{default:s(()=>[t(c,null,{default:s(()=>[i("mdi-delete")]),_:1})]),_:2},1040,["onClick"])]),_:2},1024)])]),"no-data":s(()=>[t(v,{class:"text-center pa-8"},{default:s(()=>[t(c,{size:"large",color:"grey-lighten-1",class:"mb-4"},{default:s(()=>[i("mdi-shield-off")]),_:1}),Y,d("p",Z,[i(u(e.searchQuery?"Try a different search term or":"Get started by creating your first permission or")+" ",1),t(r,{variant:"text",color:"primary",onClick:n.initialize},{default:s(()=>[i(" refresh the list ")]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["headers","items","loading"])]),_:1}),t(V,{modelValue:e.dialog,"onUpdate:modelValue":a[4]||(a[4]=l=>e.dialog=l),"max-width":"500",persistent:""},{default:s(()=>[t(p,null,{default:s(()=>[t(I,{class:"text-h5 bg-primary text-white pa-4"},{default:s(()=>[i(u(n.formTitle)+" ",1),t(h),t(r,{icon:"",variant:"text",color:"white",onClick:n.close},{default:s(()=>[t(c,null,{default:s(()=>[i("mdi-close")]),_:1})]),_:1},8,["onClick"])]),_:1}),t(v,{class:"pt-6"},{default:s(()=>[t(O,{ref:"form",modelValue:e.formValid,"onUpdate:modelValue":a[3]||(a[3]=l=>e.formValid=l)},{default:s(()=>[t(k,{modelValue:e.editedItem.name,"onUpdate:modelValue":a[1]||(a[1]=l=>e.editedItem.name=l),label:"Permission Name",variant:"outlined",rules:e.nameRules,required:"",autofocus:"",hint:"Enter a unique and descriptive permission name","persistent-hint":""},null,8,["modelValue","rules"]),t(A,{modelValue:e.editedItem.description,"onUpdate:modelValue":a[2]||(a[2]=l=>e.editedItem.description=l),label:"Description (Optional)",variant:"outlined",rows:"3",class:"mt-4",hint:"Briefly describe what this permission allows","persistent-hint":""},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),t(C),t(x,{class:"pa-4"},{default:s(()=>[t(h),t(r,{color:"grey-darken-1",variant:"text",onClick:n.close},{default:s(()=>[i(" Cancel ")]),_:1},8,["onClick"]),t(r,{color:"primary",variant:"elevated",onClick:n.save,loading:e.saving,disabled:!e.formValid||e.saving},{default:s(()=>[i(" Save ")]),_:1},8,["onClick","loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(V,{modelValue:e.dialogDelete,"onUpdate:modelValue":a[5]||(a[5]=l=>e.dialogDelete=l),"max-width":"500",persistent:""},{default:s(()=>[t(p,null,{default:s(()=>[t(I,{class:"text-h5 bg-error text-white pa-4"},{default:s(()=>[i(" Confirm Deletion "),t(h),t(r,{icon:"",variant:"text",color:"white",onClick:n.closeDelete},{default:s(()=>[t(c,null,{default:s(()=>[i("mdi-close")]),_:1})]),_:1},8,["onClick"])]),_:1}),t(v,{class:"pa-6"},{default:s(()=>[d("p",ee,[i(" Are you sure you want to delete the permission "),d("strong",null,'"'+u(e.editedItem.name)+'"',1),i("? ")]),te]),_:1}),t(C),t(x,{class:"pa-4"},{default:s(()=>[t(h),t(r,{color:"grey-darken-1",variant:"text",onClick:n.closeDelete},{default:s(()=>[i(" Cancel ")]),_:1},8,["onClick"]),t(r,{color:"error",variant:"elevated",onClick:n.deleteItemConfirm,loading:e.deleting},{default:s(()=>[i(" Delete ")]),_:1},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(T,{modelValue:e.snackbar.show,"onUpdate:modelValue":a[7]||(a[7]=l=>e.snackbar.show=l),color:e.snackbar.color,timeout:3e3,location:"top"},{actions:s(()=>[t(r,{variant:"text",onClick:a[6]||(a[6]=l=>e.snackbar.show=!1)},{default:s(()=>[i("Close")]),_:1})]),default:s(()=>[i(u(e.snackbar.text)+" ",1)]),_:1},8,["modelValue","color"])])]),_:1})}const ne=B(K,[["render",se],["__scopeId","data-v-b7de2a8b"]]);export{ne as default};

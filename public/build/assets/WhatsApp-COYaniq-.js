import{Z as G}from"./index.esm-DLkT7e1h.js";import{A as H}from"./AppLayout-DAhJxuLD.js";import{k as K,r as u,y as Q,i as s,o as k,c as X,w as t,J as Y,b as e,u as ee,f as c,t as i,a as n,d as $,g as te,F as le}from"./app-DnD9zmhZ.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ae=n("h2",{class:"text-h6"},"WhatsApp Business",-1),ne=n("div",{class:"text-subtitle-2"},"Sent",-1),se={class:"text-h6"},oe=n("div",{class:"text-subtitle-2"},"Delivered",-1),ce={class:"text-h6"},ue=n("div",{class:"text-subtitle-2"},"Read",-1),ie={class:"text-h6"},de=n("div",{class:"text-subtitle-2"},"Failed",-1),re={class:"text-h6"},_e=n("div",null,"Recent Messages",-1),ve=n("thead",null,[n("tr",null,[n("th",null,"Content"),n("th",null,"Recipients"),n("th",null,"Status"),n("th",null,"Sent Date"),n("th",null,"Actions")])],-1),ge={__name:"WhatsApp",setup(pe){const M=K(()=>{var o;return(o=Y().props.value.user)==null?void 0:o.id}),A=u(""),f=u([]),b=u([]),v=u([]),_=u(""),h=u([]),x=u(!1),m=u(!1);u(!1),u({name:"",content:""});const V=u(null),D=u("Connected"),g=u({sent:156,delivered:145,read:98,failed:11}),B=async()=>{try{const o=await axios.get("/api/v1/contacts");b.value=o.data.data,console.log("Contacts loaded:",b.value)}catch(o){console.error("Error loading contacts:",o)}},F=async()=>{try{const o=await axios.get("/api/v1/templates");h.value=o.data.data,console.log("Templates loaded:",h.value)}catch(o){console.error("Error loading templates:",o)}},W=o=>{if(!o)return;const l=h.value.find(d=>d.id===o);l&&(_.value=l.content,console.log("Selected template:",l))},E=async()=>{try{const o=await axios.post("/api/v1/whatsapp-send",{user_id:M.value,contacts:v.value.map(d=>({id:d.id,name:d.name,chatId:d.phone})),message:_.value}),l=new Date;f.value.unshift({id:f.value.length+1,content:_.value,recipients:v.value.length,status:"Sent",sent_at:l.toISOString().slice(0,10),results:o.data.results}),_.value="",v.value=[],m.value=!1}catch(o){alert("Message failed to send. Check console."),console.error(o)}};return Q(()=>{f.value=[{id:1,content:"Payment reminder for April invoice",recipients:25,status:"Delivered",sent_at:"2025-04-19"},{id:2,content:"System maintenance notification",recipients:120,status:"Sent",sent_at:"2025-04-18"},{id:3,content:"New feature announcement",recipients:50,status:"Delivered",sent_at:"2025-04-17"},{id:4,content:"Urgent: Account verification required",recipients:5,status:"Read",sent_at:"2025-04-16"}],B(),F(),console.log("user_id",M.value)}),(o,l)=>{const d=s("v-icon"),P=s("v-avatar"),C=s("v-chip"),N=s("v-divider"),p=s("v-col"),U=s("v-row"),r=s("v-btn"),y=s("v-card-text"),w=s("v-card"),j=s("v-text-field"),S=s("v-card-title"),L=s("v-table"),q=s("v-container"),z=s("v-select"),J=s("v-textarea"),T=s("v-spacer"),I=s("v-card-actions"),R=s("v-dialog"),O=s("v-file-input"),Z=s("v-alert");return k(),X(H,null,{default:t(()=>[e(ee(G),{title:"WhatsApp"}),e(q,null,{default:t(()=>[e(U,null,{default:t(()=>[e(p,{cols:"12",md:"3"},{default:t(()=>[e(w,null,{default:t(()=>[e(y,{class:"text-center"},{default:t(()=>[e(P,{size:"80",color:"green",class:"mb-3"},{default:t(()=>[e(d,{size:"48",color:"white"},{default:t(()=>[c("mdi-whatsapp")]),_:1})]),_:1}),ae,e(C,{color:D.value==="Connected"?"success":"error",class:"mt-2"},{default:t(()=>[c(i(D.value),1)]),_:1},8,["color"]),e(N,{class:"my-4"}),e(U,null,{default:t(()=>[e(p,{cols:"6",class:"py-1"},{default:t(()=>[ne,n("div",se,i(g.value.sent),1)]),_:1}),e(p,{cols:"6",class:"py-1"},{default:t(()=>[oe,n("div",ce,i(g.value.delivered),1)]),_:1}),e(p,{cols:"6",class:"py-1"},{default:t(()=>[ue,n("div",ie,i(g.value.read),1)]),_:1}),e(p,{cols:"6",class:"py-1"},{default:t(()=>[de,n("div",re,i(g.value.failed),1)]),_:1})]),_:1}),e(N,{class:"my-4"}),e(r,{color:"primary",block:"",onClick:l[0]||(l[0]=a=>m.value=!0)},{default:t(()=>[c(" New Message ")]),_:1}),e(r,{color:"info",block:"",class:"mt-2",onClick:l[1]||(l[1]=a=>x.value=!0)},{default:t(()=>[c(" Import Contacts ")]),_:1})]),_:1})]),_:1})]),_:1}),e(p,{cols:"12",md:"9"},{default:t(()=>[e(w,null,{default:t(()=>[e(S,{class:"d-flex justify-space-between align-center"},{default:t(()=>[_e,e(j,{modelValue:A.value,"onUpdate:modelValue":l[2]||(l[2]=a=>A.value=a),"append-icon":"mdi-magnify",label:"Search messages","single-line":"","hide-details":"",density:"compact",class:"max-w-xs"},null,8,["modelValue"])]),_:1}),e(y,null,{default:t(()=>[e(L,null,{default:t(()=>[ve,n("tbody",null,[(k(!0),$(le,null,te(f.value,a=>(k(),$("tr",{key:a.id},[n("td",null,i(a.content),1),n("td",null,i(a.recipients),1),n("td",null,[e(C,{color:a.status==="Delivered"?"success":a.status==="Read"?"info":"warning",size:"small"},{default:t(()=>[c(i(a.status),1)]),_:2},1032,["color"])]),n("td",null,i(a.sent_at),1),n("td",null,[e(r,{icon:"",size:"small",color:"primary",variant:"text"},{default:t(()=>[e(d,null,{default:t(()=>[c("mdi-refresh")]),_:1})]),_:1}),e(r,{icon:"",size:"small",color:"info",variant:"text"},{default:t(()=>[e(d,null,{default:t(()=>[c("mdi-eye")]),_:1})]),_:1}),e(r,{icon:"",size:"small",color:"error",variant:"text"},{default:t(()=>[e(d,null,{default:t(()=>[c("mdi-delete")]),_:1})]),_:1})])]))),128))])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(R,{modelValue:m.value,"onUpdate:modelValue":l[6]||(l[6]=a=>m.value=a),"max-width":"700px"},{default:t(()=>[e(w,null,{default:t(()=>[e(S,null,{default:t(()=>[c("Send WhatsApp Message")]),_:1}),e(y,null,{default:t(()=>[e(z,{modelValue:v.value,"onUpdate:modelValue":l[3]||(l[3]=a=>v.value=a),items:b.value,"item-title":"name","item-value":"id",label:"Select Recipients",multiple:"",chips:"","return-object":""},{selection:t(({item:a})=>[e(C,null,{default:t(()=>[c(i(a.raw.name)+" ("+i(a.raw.phone)+")",1)]),_:2},1024)]),_:1},8,["modelValue","items"]),e(z,{label:"Select Template",items:h.value,"item-title":"name","item-value":"id","onUpdate:modelValue":W,class:"mt-4",hint:V.value?`Channel: ${V.value.channel} | Module: ${V.value.module}`:"","persistent-hint":""},null,8,["items","hint"]),e(J,{modelValue:_.value,"onUpdate:modelValue":l[4]||(l[4]=a=>_.value=a),label:"Message",rows:"5",class:"mt-4",hint:"Variables format: {{variable_name}}","persistent-hint":""},null,8,["modelValue"])]),_:1}),e(I,null,{default:t(()=>[e(T),e(r,{color:"error",onClick:l[5]||(l[5]=a=>m.value=!1)},{default:t(()=>[c("Cancel")]),_:1}),e(r,{color:"primary",onClick:E,disabled:!_.value||v.value.length===0},{default:t(()=>[c(" Send Message ")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(R,{modelValue:x.value,"onUpdate:modelValue":l[8]||(l[8]=a=>x.value=a),"max-width":"500px"},{default:t(()=>[e(w,null,{default:t(()=>[e(S,null,{default:t(()=>[c("Import Contacts")]),_:1}),e(y,null,{default:t(()=>[e(O,{label:"Upload CSV File",accept:".csv","prepend-icon":"mdi-file-upload","show-size":"","truncate-length":"25"}),e(Z,{type:"info",class:"mt-4"},{default:t(()=>[c(" CSV file should have columns: Name, Phone Number, Status ")]),_:1})]),_:1}),e(I,null,{default:t(()=>[e(T),e(r,{color:"error",onClick:l[7]||(l[7]=a=>x.value=!1)},{default:t(()=>[c("Cancel")]),_:1}),e(r,{color:"primary"},{default:t(()=>[c("Import")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}};export{ge as default};

import{Z as Re}from"./index.esm-DafrvLCm.js";import{A as qe}from"./AppLayout-DrE014f7.js";import{r as v,k as D,B as Oe,y as Je,i as f,o as _,c as $,w as a,J as Ke,b as e,u as Ye,f as i,t as m,e as B,a as d,d as k,g as ie,F as J,K as Ze,L as Ge,n as He}from"./app-BFWP9qR1.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Qe=d("h2",{class:"text-h6"},"WhatsApp Business",-1),Xe={class:"d-flex justify-center align-center mt-2"},ea=d("div",{class:"text-subtitle-2"},"Sent",-1),aa={class:"text-h6"},ta=d("div",{class:"text-subtitle-2"},"Delivered",-1),la={class:"text-h6"},sa=d("div",{class:"text-subtitle-2"},"Read",-1),na={class:"text-h6"},oa=d("div",{class:"text-subtitle-2"},"Pending",-1),ia={class:"text-h6"},ua=d("div",{class:"text-subtitle-2"},"Failed",-1),ra={class:"text-h6"},da=d("div",{class:"text-h6"},"Recent Messages",-1),ca={key:1,class:"text-center pa-4"},va=d("p",{class:"text-body-1 mt-2"},"No messages found. Try sending one!",-1),pa=d("thead",null,[d("tr",null,[d("th",{class:"text-left"},"Content"),d("th",{class:"text-left"},"Recipient"),d("th",{class:"text-left"},"Status"),d("th",{class:"text-left"},"Sent Date"),d("th",{class:"text-center"},"Actions")])],-1),ma={class:"text-center"},fa={key:3,class:"d-flex justify-center mt-4"},_a=d("span",null,"WhatsApp Contacts",-1),ga={class:"mt-4 text-caption"},ya={key:1,class:"chat-window",style:{"max-height":"400px","overflow-y":"auto"}},ha={key:0,class:"text-center pa-4"},wa=d("p",{class:"text-body-1 mt-2"},"No templates available",-1),ba={key:0},Aa={class:"d-flex flex-wrap justify-space-between align-center"},xa={class:"text-caption text-grey"},Ca=d("br",null,null,-1),ka={class:"d-flex mt-2 mt-sm-0"},Ta={key:1,class:"text-center pa-4"},Va=d("p",{class:"text-body-1 mt-2"},"Select a template to edit or create a new one",-1),Ua={__name:"WhatsApp",props:{initialPhone:{type:String,default:""}},setup(Ma,{expose:be}){const ue=v(null),K=v(!1),X=v([]),j=v("all"),R=v("all"),Ae=v(10),xe=[{title:"All Types",value:"all"},{title:"Customer",value:"customer"},{title:"Vendor",value:"vendor"},{title:"Partner",value:"partner"},{title:"Employee",value:"employee"}],Ce=[{title:"All Statuses",value:"all"},{title:"Active",value:1},{title:"Inactive",value:0}],re=D(()=>{if(!Array.isArray(A.value))return[];let s=[...A.value];return j.value!=="all"&&(s=s.filter(t=>t.type===j.value)),R.value!=="all"&&(s=s.filter(t=>t.status===R.value)),s}),ke=s=>!!(s.whatsapp||s.alt_phone||s.phone),Te=s=>{alert(`Contact: ${s.name}
Phone: ${s.phone||"N/A"}
WhatsApp: ${s.whatsapp||"N/A"}
Type: ${s.type||"N/A"}
Company: ${s.company_name||"N/A"}
Country: ${s.country_name||"N/A"}`)},de=(s=!1,t=null)=>{z.value="",T.value="",s?h.value=me.value:t?h.value=[t]:h.value=[],(!Array.isArray(p.value)||p.value.length===0)&&!u.value.templates&&te(),I.value=!0},Ve=()=>{S.value="",j.value="all",R.value="all"},ce=D(()=>{var s;return(s=Ke().props.value.user)==null?void 0:s.id}),S=v(""),y=v([]),u=v({messages:!1,contacts:!1,templates:!1,sending:!1,importing:!1,savingTemplate:!1,deletingTemplate:!1}),A=v([]),h=v([]),T=v(""),p=v([]),Me=v(!1),I=v(!1),Y=v(!1),z=v(""),Z=v("");v(null);const q=v(1),ve=v(20),pe=v(0),$e=v({name:"",content:"",channel:"WhatsApp",module:"Message"}),r=v(null),P=v(!1),V=v("Connected"),M=v({sent:0,delivered:0,read:0,failed:0,pending:0}),me=v([]),ee=D(()=>Math.ceil(pe.value/ve.value));D(()=>{const s=[],o=Math.floor(2.5);let n=Math.max(1,q.value-o),c=Math.min(ee.value,n+5-1);c-n+1<5&&(n=Math.max(1,c-5+1));for(let g=n;g<=c;g++)s.push(g);return s});const ae=D(()=>{if(!S.value||!Array.isArray(y.value))return y.value;const s=S.value.toLowerCase();return y.value.filter(t=>{var o,n,c,g;return((o=t.content)==null?void 0:o.toLowerCase().includes(s))||((n=t.status)==null?void 0:n.toLowerCase().includes(s))||((c=t.recipient_name)==null?void 0:c.toLowerCase().includes(s))||((g=t.recipient_phone)==null?void 0:g.toLowerCase().includes(s))})}),fe=D(()=>Array.isArray(A.value)?A.value.filter(s=>s.whatsapp||s.alt_phone):[]),G=async(s=1)=>{var t,o,n;try{u.value.messages=!0,q.value=s;const c=await axios.get("/api/v1/whatsapp-messages",{params:{page:s,per_page:ve.value}});Array.isArray(c.data.data)?(y.value=c.data.data,pe.value=((t=c.data.meta)==null?void 0:t.total)||y.value.length,_e()):(console.error("Unexpected API response format:",c.data),Array.isArray(y.value)||(y.value=[]),b("Invalid data format received from server"))}catch(c){console.error("Error loading messages:",c),b(`Failed to load messages: ${((n=(o=c.response)==null?void 0:o.data)==null?void 0:n.message)||c.message}`),Array.isArray(y.value)||(y.value=[])}finally{u.value.messages=!1}};Oe(S,s=>{s===""&&G(q.value)});const _e=()=>{if(!Array.isArray(y.value)){console.error("messages.value is not an array:",y.value);return}try{const s=y.value.reduce((t,o)=>{const n=o&&o.status&&typeof o.status=="string"?o.status.toLowerCase():"unknown";return t[n]=(t[n]||0)+1,t},{});M.value={sent:s.sent||0,delivered:s.delivered||0,read:s.read||0,failed:s.failed||0,pending:s.pending||0},y.value.forEach(t=>{if(t.message_status&&t.message_status!==t.status){const o=t.message_status.toLowerCase();M.value[o]=(M.value[o]||0)+1}})}catch(s){console.error("Error calculating stats:",s),M.value={sent:0,delivered:0,read:0,failed:0,pending:0}}},ge=async()=>{var s,t,o,n;try{u.value.contacts=!0;const c=await axios.get("/api/v1/contacts");(t=(s=c.data)==null?void 0:s.data)!=null&&t.data&&Array.isArray(c.data.data.data)?(A.value=c.data.data.data,re=A,console.log("Contacts loaded:",A.value.length)):(console.error("Unexpected API response format:",c.data),(!Array.isArray(A.value)||A.value.length===0)&&(A.value=[]),b("Invalid contact data format received from server"))}catch(c){console.error("Error loading contacts:",c),b(`Failed to load contacts: ${((n=(o=c.response)==null?void 0:o.data)==null?void 0:n.message)||c.message}`),(!Array.isArray(A.value)||A.value.length===0)&&(A.value=[])}finally{u.value.contacts=!1}},te=async()=>{var s,t,o;try{u.value.templates=!0;const n=await axios.get("/api/v1/templates");(s=n.data)!=null&&s.data&&Array.isArray(n.data.data)?(p.value=n.data.data,console.log("Templates loaded:",p.value.length)):(console.error("Unexpected API response format:",n.data),(!Array.isArray(p.value)||p.value.length===0)&&(p.value=[]),b("Invalid template data format received from server"))}catch(n){console.error("Error loading templates:",n),b(`Failed to load templates: ${((o=(t=n.response)==null?void 0:t.data)==null?void 0:o.message)||n.message}`),(!Array.isArray(p.value)||p.value.length===0)&&(p.value=[])}finally{u.value.templates=!1}},Se=s=>{if(!s||!Array.isArray(p.value))return;const t=p.value.find(o=>o.id===s);t&&(T.value=t.content,r.value=t,console.log("Selected template:",t))},Pe=async()=>{z.value="",T.value="",h.value=[],r.value=null,(!Array.isArray(A.value)||A.value.length===0)&&!u.value.contacts&&await ge(),(!Array.isArray(p.value)||p.value.length===0)&&!u.value.templates&&await te(),I.value=!0},b=s=>{z.value=s,setTimeout(()=>{z.value=""},5e3)},E=s=>{Z.value=s,setTimeout(()=>{Z.value=""},5e3)},Ne=async()=>{var s,t,o,n,c;if(!T.value.trim())return b("Please enter a message");if(!Array.isArray(h.value)||h.value.length===0)return b("Please select at least one recipient");try{u.value.sending=!0;const g=await axios.post("/api/v1/whatsapp-send",{user_id:ce.value,contacts:h.value.map(x=>({id:x.id,name:x.name,chatId:x.whatsapp||x.alt_phone||x.phone})),message:T.value,template_id:((s=r.value)==null?void 0:s.id)||null}),w=new Date;Array.isArray(y.value)||(y.value=[]),y.value.unshift({id:((t=g.data)==null?void 0:t.id)||Date.now(),content:T.value,recipients:h.value.length,status:"sent",message_status:"sent",sent_at:w.toISOString().split("T")[0],created_at:w.toISOString(),recipient_name:h.value.map(x=>x.name).join(", "),recipient_phone:h.value.map(x=>x.whatsapp||x.alt_phone||x.phone).join(", "),results:((o=g.data)==null?void 0:o.results)||[]}),M.value.sent+=h.value.length,E(`Message successfully sent to ${h.value.length} recipients`),T.value="",h.value=[],r.value=null,I.value=!1,setTimeout(()=>{G(1)},1e3)}catch(g){console.error("Error sending message:",g),b(`Failed to send message: ${((c=(n=g.response)==null?void 0:n.data)==null?void 0:c.message)||g.message}`)}finally{u.value.sending=!1}},ye=s=>{ue.value=s.recipient_phone,K.value=!0,u.value=!0,axios.get(`/api/v1/messages/chat/${s.recipient_phone}`).then(t=>{X.value=t.data,u.value=!1}).catch(t=>{console.error("Error loading chat:",t),u.value=!1})},Ue=async s=>{var t,o;if(!s)return b("Invalid message ID");if(confirm("Are you sure you want to delete this message?"))try{await axios.delete(`/api/v1/whatsapp-messages/${s}`),Array.isArray(y.value)&&(y.value=y.value.filter(n=>n.id!==s),_e()),E("Message deleted successfully")}catch(n){console.error("Error deleting message:",n),b(`Failed to delete message: ${((o=(t=n.response)==null?void 0:t.data)==null?void 0:o.message)||n.message}`)}},We=()=>{P.value=!0,r.value={...$e.value}},De=async()=>{var s,t;if(!r.value||!r.value.name||!r.value.content)return b("Template name and content are required");try{u.value.savingTemplate=!0;let o;const n={name:r.value.name,content:r.value.content,channel:r.value.channel||"WhatsApp",module:r.value.module||"Message",user_id:ce.value};if(P.value||!r.value.id)o=await axios.post("/api/v1/templates",n),o.data&&o.data.data&&(Array.isArray(p.value)||(p.value=[]),p.value.push(o.data.data),E("Template created successfully"));else if(o=await axios.put(`/api/v1/templates/${r.value.id}`,n),o.data&&o.data.data){const c=p.value.findIndex(g=>g.id===r.value.id);c!==-1&&(p.value[c]=o.data.data),E("Template updated successfully")}P.value=!1}catch(o){console.error("Error saving template:",o),b(`Failed to save template: ${((t=(s=o.response)==null?void 0:s.data)==null?void 0:t.message)||o.message}`)}finally{u.value.savingTemplate=!1}},Ie=async()=>{var s,t;if(!r.value||!r.value.id)return b("No template selected");if(confirm(`Are you sure you want to delete template "${r.value.name}"?`))try{u.value.deletingTemplate=!0,await axios.delete(`/api/v1/templates/${r.value.id}`),p.value=p.value.filter(o=>o.id!==r.value.id),r.value=null,E("Template deleted successfully")}catch(o){console.error("Error deleting template:",o),b(`Failed to delete template: ${((t=(s=o.response)==null?void 0:s.data)==null?void 0:t.message)||o.message}`)}finally{u.value.deletingTemplate=!1}},ze=async()=>{var s,t,o;try{V.value="Connecting...";const n=await axios.post("/api/v1/whatsapp-reconnect");n.data&&n.data.success?(V.value="Connected",E("WhatsApp connection successful")):(V.value="Disconnected",b(((s=n.data)==null?void 0:s.message)||"Failed to connect to WhatsApp"))}catch(n){console.error("Error reconnecting WhatsApp:",n),V.value="Disconnected",b(`Failed to connect to WhatsApp: ${((o=(t=n.response)==null?void 0:t.data)==null?void 0:o.message)||n.message}`)}};v(""),v(!1),v(null),D(()=>X.value.reduce((s,t)=>{const o=t.timestamp.split("T")[0];return s[o]||(s[o]=[]),s[o].push(t),s},{})),be({viewMessageDetails:ye});const Ee=s=>s?s.replace(/@c\.us$/,""):"Unknown";return Je(()=>(y.value=[],A.value=[],p.value=[],G(1),ge(),te(),()=>{clearInterval(statusInterval)})),(s,t)=>{const o=f("v-alert"),n=f("v-icon"),c=f("v-avatar"),g=f("v-chip"),w=f("v-btn"),x=f("v-divider"),C=f("v-col"),O=f("v-row"),U=f("v-card-text"),N=f("v-card"),le=f("v-text-field"),W=f("v-card-title"),H=f("v-progress-linear"),Fe=f("v-table"),Le=f("v-pagination"),he=f("v-container"),F=f("v-select"),Be=f("v-data-table"),se=f("v-list-item"),we=f("v-textarea"),ne=f("v-spacer"),Q=f("v-card-actions"),oe=f("v-dialog"),je=f("v-list");return _(),$(qe,null,{default:a(()=>[e(Ye(Re),{title:"WhatsApp Business"}),e(he,null,{default:a(()=>[z.value?(_(),$(o,{key:0,type:"error",closable:"",class:"mb-4"},{default:a(()=>[i(m(z.value),1)]),_:1})):B("",!0),Z.value?(_(),$(o,{key:1,type:"success",closable:"",class:"mb-4"},{default:a(()=>[i(m(Z.value),1)]),_:1})):B("",!0),e(O,null,{default:a(()=>[e(C,{cols:"12",md:"3"},{default:a(()=>[e(N,null,{default:a(()=>[e(U,{class:"text-center"},{default:a(()=>[e(c,{size:"80",color:V.value==="Connected"?"green":"grey",class:"mb-3"},{default:a(()=>[e(n,{size:"48",color:"white"},{default:a(()=>[i("mdi-whatsapp")]),_:1})]),_:1},8,["color"]),Qe,d("div",Xe,[e(g,{color:V.value==="Connected"?"success":V.value==="Connecting..."?"warning":"error",class:"mr-2"},{default:a(()=>[i(m(V.value),1)]),_:1},8,["color"]),V.value!=="Connected"&&V.value!=="Connecting..."?(_(),$(w,{key:0,size:"small",color:"primary",icon:"",onClick:ze},{default:a(()=>[e(n,null,{default:a(()=>[i("mdi-refresh")]),_:1})]),_:1})):B("",!0)]),e(x,{class:"my-4"}),e(O,null,{default:a(()=>[e(C,{cols:"6",class:"py-1"},{default:a(()=>[ea,d("div",aa,m(M.value.sent),1)]),_:1}),e(C,{cols:"6",class:"py-1"},{default:a(()=>[ta,d("div",la,m(M.value.delivered),1)]),_:1}),e(C,{cols:"6",class:"py-1"},{default:a(()=>[sa,d("div",na,m(M.value.read),1)]),_:1}),e(C,{cols:"6",class:"py-1"},{default:a(()=>[oa,d("div",ia,m(M.value.pending),1)]),_:1}),e(C,{cols:"12",class:"py-1"},{default:a(()=>[ua,d("div",ra,m(M.value.failed),1)]),_:1})]),_:1}),e(x,{class:"my-4"}),e(w,{color:"primary",block:"",class:"mb-2",onClick:Pe},{default:a(()=>[e(n,{class:"mr-2"},{default:a(()=>[i("mdi-message-text")]),_:1}),i(" New Message ")]),_:1}),e(w,{color:"info",block:"",class:"mb-2",onClick:t[0]||(t[0]=l=>Me.value=!0)},{default:a(()=>[e(n,{class:"mr-2"},{default:a(()=>[i("mdi-file-import")]),_:1}),i(" Import Contacts ")]),_:1}),e(w,{color:"secondary",block:"",onClick:t[1]||(t[1]=l=>Y.value=!0)},{default:a(()=>[e(n,{class:"mr-2"},{default:a(()=>[i("mdi-file-document-edit")]),_:1}),i(" Manage Templates ")]),_:1})]),_:1})]),_:1})]),_:1}),e(C,{cols:"12",md:"9"},{default:a(()=>[e(N,null,{default:a(()=>[e(W,{class:"d-flex flex-wrap justify-space-between align-center"},{default:a(()=>[da,e(le,{modelValue:S.value,"onUpdate:modelValue":t[2]||(t[2]=l=>S.value=l),"append-icon":"mdi-magnify",label:"Search messages","single-line":"","hide-details":"",density:"compact",class:"max-w-xs mt-2 mt-sm-0"},null,8,["modelValue"])]),_:1}),e(U,null,{default:a(()=>[u.value.messages?(_(),$(H,{key:0,indeterminate:"",color:"primary"})):!Array.isArray(ae.value)||ae.value.length===0?(_(),k("div",ca,[e(n,{size:"large",color:"grey"},{default:a(()=>[i("mdi-message-text-outline")]),_:1}),va])):(_(),$(Fe,{key:2},{default:a(()=>[pa,d("tbody",null,[(_(!0),k(J,null,ie(ae.value,l=>(_(),k("tr",{key:l.id},[d("td",null,m(l.content),1),d("td",null,m(Ee(l.recipient_phone)),1),d("td",null,[e(g,{color:l.status==="delivered"||l.message_status==="delivered"?"success":l.status==="read"||l.message_status==="read"?"info":l.status==="failed"||l.message_status==="failed"?"error":l.status==="sent"||l.message_status==="sent"?"primary":"warning",size:"small"},{default:a(()=>[i(m(l.message_status||l.status||"Unknown"),1)]),_:2},1032,["color"])]),d("td",null,m(l.sent_at||l.created_at),1),d("td",ma,[e(w,{icon:"",size:"small",color:"info",variant:"text",onClick:L=>ye(l)},{default:a(()=>[e(n,null,{default:a(()=>[i("mdi-eye")]),_:1})]),_:2},1032,["onClick"]),e(w,{icon:"",size:"small",color:"error",variant:"text",onClick:L=>Ue(l.id)},{default:a(()=>[e(n,null,{default:a(()=>[i("mdi-delete")]),_:1})]),_:2},1032,["onClick"])])]))),128))])]),_:1})),ee.value>1?(_(),k("div",fa,[e(Le,{modelValue:q.value,"onUpdate:modelValue":[t[3]||(t[3]=l=>q.value=l),G],length:ee.value,"total-visible":5},null,8,["modelValue","length"])])):B("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(he,null,{default:a(()=>[e(O,null,{default:a(()=>[e(C,{cols:"12"},{default:a(()=>[e(N,null,{default:a(()=>[e(W,{class:"d-flex align-center justify-space-between"},{default:a(()=>[_a,d("div",null,[e(w,{color:"success",onClick:t[4]||(t[4]=l=>de(!0)),disabled:!me.value.length},{default:a(()=>[e(n,{start:""},{default:a(()=>[i("mdi-send")]),_:1}),i(" Bulk Message ")]),_:1},8,["disabled"])])]),_:1}),e(U,null,{default:a(()=>[e(O,null,{default:a(()=>[e(C,{cols:"12",sm:"6",md:"4"},{default:a(()=>[e(le,{modelValue:S.value,"onUpdate:modelValue":t[5]||(t[5]=l=>S.value=l),label:"Search Contacts","prepend-inner-icon":"mdi-magnify",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),e(C,{cols:"12",sm:"6",md:"3"},{default:a(()=>[e(F,{modelValue:j.value,"onUpdate:modelValue":t[6]||(t[6]=l=>j.value=l),items:xe,label:"Contact Type",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),e(C,{cols:"12",sm:"6",md:"3"},{default:a(()=>[e(F,{modelValue:R.value,"onUpdate:modelValue":t[7]||(t[7]=l=>R.value=l),items:Ce,label:"Contact Status",density:"compact",variant:"outlined","hide-details":""},null,8,["modelValue"])]),_:1}),e(C,{cols:"12",sm:"6",md:"2"},{default:a(()=>[e(w,{color:"info",variant:"text",onClick:Ve},{default:a(()=>[e(n,{start:""},{default:a(()=>[i("mdi-filter-off")]),_:1}),i(" Reset ")]),_:1})]),_:1})]),_:1}),e(Be,{modelValue:h.value,"onUpdate:modelValue":t[8]||(t[8]=l=>h.value=l),headers:[{title:"ID",key:"id",width:"5%"},{title:"Name",key:"name",width:"20%"},{title:"WhatsApp",key:"whatsapp",width:"15%"},{title:"Type",key:"type",width:"10%"},{title:"Company",key:"company_name",width:"15%"},{title:"Status",key:"status",width:"10%"},{title:"Country",key:"country_name",width:"15%"},{title:"Actions",key:"actions",sortable:!1,width:"10%"}],items:re.value,search:S.value,"items-per-page":Ae.value,"item-value":"id","show-select":"",class:"mt-4"},{"item.whatsapp":a(({item:l})=>[i(m(l.whatsapp||l.alt_phone||l.phone||"N/A"),1)]),"item.type":a(({item:l})=>[e(g,{color:l.type==="customer"?"primary":l.type==="vendor"?"success":l.type==="partner"?"warning":l.type==="employee"?"info":"grey",size:"small"},{default:a(()=>[i(m(l.type),1)]),_:2},1032,["color"])]),"item.status":a(({item:l})=>[e(g,{color:l.status===1?"success":"grey",size:"small"},{default:a(()=>[i(m(l.status===1?"Active":"Inactive"),1)]),_:2},1032,["color"])]),"item.actions":a(({item:l})=>[e(w,{icon:"",size:"small",color:"primary",onClick:L=>Te(l)},{default:a(()=>[e(n,null,{default:a(()=>[i("mdi-eye")]),_:1})]),_:2},1032,["onClick"]),e(w,{icon:"",size:"small",color:"success",onClick:L=>de(!1,l),disabled:!ke(l)},{default:a(()=>[e(n,null,{default:a(()=>[i("mdi-send")]),_:1})]),_:2},1032,["onClick","disabled"])]),_:1},8,["modelValue","items","search","items-per-page"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(oe,{modelValue:I.value,"onUpdate:modelValue":t[12]||(t[12]=l=>I.value=l),"max-width":"700px"},{default:a(()=>[e(N,null,{default:a(()=>[e(W,null,{default:a(()=>[e(n,{color:"primary",class:"mr-2"},{default:a(()=>[i("mdi-message-text")]),_:1}),i(" Send WhatsApp Message ")]),_:1}),e(U,null,{default:a(()=>[u.value.contacts||u.value.templates?(_(),$(H,{key:0,indeterminate:"",color:"primary",class:"mb-4"})):B("",!0),e(F,{modelValue:h.value,"onUpdate:modelValue":t[9]||(t[9]=l=>h.value=l),items:fe.value,"item-title":"name","item-value":"id",label:"Select Recipients",multiple:"",chips:"","return-object":"",hint:`${fe.value.length} contacts with WhatsApp numbers available`,"persistent-hint":"",loading:u.value.contacts,disabled:u.value.contacts,rules:[l=>Array.isArray(l)&&l.length>0||"At least one recipient is required"]},{"prepend-item":a(()=>[e(se,{title:"WhatsApp Recipients",disabled:""}),e(x)]),selection:a(({item:l})=>[e(g,null,{default:a(()=>[i(m(l.raw.name)+" ("+m(l.raw.whatsapp||l.raw.alt_phone||l.raw.phone)+") ",1)]),_:2},1024)]),item:a(({item:l,props:L})=>[e(se,Ze(Ge(L)),{prepend:a(()=>[e(c,{color:"grey-lighten-3",size:"36"},{default:a(()=>[e(n,{color:"grey-darken-2"},{default:a(()=>[i("mdi-account")]),_:1})]),_:1})]),title:a(()=>[i(m(l.raw.name),1)]),subtitle:a(()=>[i(m(l.raw.whatsapp||l.raw.alt_phone||l.raw.phone),1)]),_:2},1040)]),_:1},8,["modelValue","items","hint","loading","disabled","rules"]),e(F,{label:"Select Template",items:p.value,"item-title":"name","item-value":"id","onUpdate:modelValue":Se,class:"mt-4",hint:r.value?`Channel: ${r.value.channel||"WhatsApp"} | Type: ${r.value.module||"Message"}`:"","persistent-hint":"",loading:u.value.templates,disabled:u.value.templates,clearable:""},null,8,["items","hint","loading","disabled"]),e(we,{modelValue:T.value,"onUpdate:modelValue":t[10]||(t[10]=l=>T.value=l),label:"Message",rows:"5",class:"mt-4",hint:"Variables format: {{variable_name}}","persistent-hint":"",rules:[l=>!!l||"Message is required"],disabled:u.value.sending},null,8,["modelValue","rules","disabled"]),d("div",ga,[e(n,{size:"small",color:"info",class:"mr-1"},{default:a(()=>[i("mdi-information-outline")]),_:1}),i(" Your message will be sent to "+m(h.value.length)+" recipient(s). ",1)])]),_:1}),e(Q,null,{default:a(()=>[e(ne),e(w,{color:"error",variant:"outlined",onClick:t[11]||(t[11]=l=>I.value=!1),disabled:u.value.sending},{default:a(()=>[i(" Cancel ")]),_:1},8,["disabled"]),e(w,{color:"primary",onClick:Ne,loading:u.value.sending,disabled:!T.value||!Array.isArray(h.value)||h.value.length===0||u.value.sending},{default:a(()=>[i(" Send Message ")]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(oe,{modelValue:K.value,"onUpdate:modelValue":t[14]||(t[14]=l=>K.value=l),width:"800"},{default:a(()=>[e(N,null,{default:a(()=>[e(W,null,{default:a(()=>[i("Conversation with "+m(ue.value),1)]),_:1}),e(U,null,{default:a(()=>[u.value?(_(),$(H,{key:0,indeterminate:"",color:"primary"})):(_(),k("div",ya,[(_(!0),k(J,null,ie(X.value,l=>(_(),k("div",{key:l.id,class:"my-2"},[d("div",{class:He(l.direction==="outgoing"?"text-right":"text-left")},[e(g,{color:l.direction==="outgoing"?"blue lighten-4":"green lighten-4",label:""},{default:a(()=>[i(m(l.body),1)]),_:2},1032,["color"])],2)]))),128))]))]),_:1}),e(Q,null,{default:a(()=>[e(ne),e(w,{text:"",onClick:t[13]||(t[13]=l=>K.value=!1)},{default:a(()=>[i("Close")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),i(" - "),e(oe,{modelValue:Y.value,"onUpdate:modelValue":t[20]||(t[20]=l=>Y.value=l),"max-width":"700px"},{default:a(()=>[e(N,null,{default:a(()=>[e(W,null,{default:a(()=>[e(n,{color:"primary",class:"mr-2"},{default:a(()=>[i("mdi-file-document-edit")]),_:1}),i(" Manage Templates ")]),_:1}),e(U,null,{default:a(()=>[u.value.templates?(_(),$(H,{key:0,indeterminate:"",color:"primary",class:"mb-4"})):B("",!0),e(O,null,{default:a(()=>[e(C,{cols:"12",md:"4"},{default:a(()=>[e(N,{variant:"outlined"},{default:a(()=>[e(W,{class:"text-subtitle-1"},{default:a(()=>[i("Available Templates")]),_:1}),e(je,null,{default:a(()=>[!Array.isArray(p.value)||p.value.length===0?(_(),k("div",ha,[e(n,{size:"large",color:"grey"},{default:a(()=>[i("mdi-file-document-outline")]),_:1}),wa])):(_(!0),k(J,{key:1},ie(p.value,l=>(_(),$(se,{key:l.id,title:l.name,subtitle:l.channel||"WhatsApp",onClick:L=>{r.value={...l},P.value=!1},active:r.value&&r.value.id===l.id},{prepend:a(()=>[e(n,{color:"primary"},{default:a(()=>[i("mdi-file-document-outline")]),_:1})]),_:2},1032,["title","subtitle","onClick","active"]))),128))]),_:1}),e(Q,null,{default:a(()=>[e(w,{color:"success",block:"",onClick:We,"prepend-icon":"mdi-plus"},{default:a(()=>[i(" New Template ")]),_:1})]),_:1})]),_:1})]),_:1}),e(C,{cols:"12",md:"8"},{default:a(()=>[e(N,{variant:"outlined",class:"h-100"},{default:a(()=>[e(W,{class:"text-subtitle-1"},{default:a(()=>[i(m(P.value?"Create New Template":r.value?"Edit Template":"Template Details"),1)]),_:1}),e(U,null,{default:a(()=>[r.value?(_(),k("div",ba,[e(le,{modelValue:r.value.name,"onUpdate:modelValue":t[15]||(t[15]=l=>r.value.name=l),label:"Template Name",rules:[l=>!!l||"Template name is required"],disabled:u.value.savingTemplate||u.value.deletingTemplate},null,8,["modelValue","rules","disabled"]),e(F,{modelValue:r.value.channel,"onUpdate:modelValue":t[16]||(t[16]=l=>r.value.channel=l),label:"Channel",items:["WhatsApp","SMS","Email"],disabled:u.value.savingTemplate||u.value.deletingTemplate,class:"mt-4"},null,8,["modelValue","disabled"]),e(F,{modelValue:r.value.module,"onUpdate:modelValue":t[17]||(t[17]=l=>r.value.module=l),label:"Template Type",items:["Message","Notification","Marketing","Reminder"],disabled:u.value.savingTemplate||u.value.deletingTemplate,class:"mt-4"},null,8,["modelValue","disabled"]),e(we,{modelValue:r.value.content,"onUpdate:modelValue":t[18]||(t[18]=l=>r.value.content=l),label:"Template Content",rows:"8",hint:"Variables format: {{variable_name}}","persistent-hint":"",rules:[l=>!!l||"Template content is required"],disabled:u.value.savingTemplate||u.value.deletingTemplate,class:"mt-4"},null,8,["modelValue","rules","disabled"]),e(x,{class:"my-4"}),d("div",Aa,[d("div",xa,[r.value.id&&!P.value?(_(),k(J,{key:0},[i(" Template ID: "+m(r.value.id)+" ",1),Ca,i(" Last Updated: "+m(r.value.updated_at?new Date(r.value.updated_at).toLocaleString():"N/A"),1)],64)):(_(),k(J,{key:1},[i(" Creating new template ")],64))]),d("div",ka,[e(w,{color:"error",class:"mr-2",disabled:P.value||u.value.savingTemplate||u.value.deletingTemplate||!r.value.id,loading:u.value.deletingTemplate,onClick:Ie},{default:a(()=>[i(" Delete ")]),_:1},8,["disabled","loading"]),e(w,{color:"primary",loading:u.value.savingTemplate,disabled:u.value.savingTemplate||u.value.deletingTemplate||!r.value.name||!r.value.content,onClick:De},{default:a(()=>[i(m(P.value?"Create":"Save Changes"),1)]),_:1},8,["loading","disabled"])])])])):(_(),k("div",Ta,[e(n,{size:"large",color:"grey"},{default:a(()=>[i("mdi-file-document-outline")]),_:1}),Va]))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(Q,null,{default:a(()=>[e(ne),e(w,{color:"primary",onClick:t[19]||(t[19]=l=>Y.value=!1)},{default:a(()=>[i("Close")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}};export{Ua as default};

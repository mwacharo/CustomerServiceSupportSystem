import{A as N}from"./AppLayout-IcGO4QrE.js";import{s as u,i,o as Q,c as B,w as t,b as e,x as K,f as a,y as f,a as F,t as O,E as I}from"./app-CdIWppAE.js";import T from"./Permissions-9psfCiFr.js";import{_ as q}from"./_plugin-vue_export-helper-DlAUqK2U.js";const H={components:{AppLayout:N,Permissions:T},data(){return{roles:[],dialog:!1,loading:!1,dialogDelete:!1,headers:[{title:"Agent Name",align:"start",sortable:!1,key:"name"},{title:"Email",key:"email"},{title:"Phone",key:"phone"},{title:"Phone",key:"phone_number"},{title:"Role",key:"roles.name"},{title:"Actions",key:"actions",sortable:!1}],users:[],searchQuery:"",editedIndex:-1,editedItem:{id:null,name:"",email:"",phone:"",selectedRole:null,phone_number:"",branch_id:null,country_id:null},defaultItem:{id:null,name:"",email:"",phone:"",selectedRole:null,phone_number:"",branch_id:null,country_id:null}}},computed:{formTitle(){return this.editedIndex===-1?"New Admin":"Edit Admin"}},watch:{dialog(o){o?this.fetchRoles():this.close()},dialogDelete(o){!o&&this.closeDelete()}},created(){this.initialize()},methods:{fetchRoles(){u.get("api/v1/roles").then(l=>{this.roles=l.data}).catch(l=>{console.error("API Error:",l)})},initialize(){u.get("v1/users").then(l=>{this.users=l.data}).catch(l=>console.error("API Error:",l))},editItem(o){this.editedIndex=this.users.indexOf(o),this.editedItem={...o,selectedRole:o.roles.length?o.roles[0]:null},this.dialog=!0},deleteItem(o){this.editedIndex=this.users.indexOf(o),this.editedItem={...o},this.dialogDelete=!0},deleteItemConfirm(){u.delete(`v1/user/${this.editedItem.id}`).then(()=>{this.users.splice(this.editedIndex,1),this.$toastr.success("User deleted successfully"),this.closeDelete()}).catch(o=>console.error("Deletion error:",o))},close(){this.dialog=!1,this.resetForm()},closeDelete(){this.dialogDelete=!1,this.resetForm()},resetForm(){this.editedItem={...this.defaultItem},this.editedIndex=-1},managePermissions(o){this.$refs.PermissionsComponent.showDialog(o.id)},save(){let o;const l={...this.editedItem,role:this.editedItem.selectedRole.name};this.editedIndex>-1?o=u.put(`v1/user/${this.editedItem.id}`,l):o=u.post("v1/user",l),o.then(()=>{this.initialize(),this.close(),this.$toastr.success("User saved successfully")}).catch(V=>console.error("Save error:",V))},performSearch(){this.searchQuery.trim()===""?this.initialize():u.get("v1/users/search",{params:{query:this.searchQuery}}).then(o=>{this.users=o.data}).catch(o=>console.error("Search error:",o))},activateAccount(o){u.post(`v1/user/activate/${o.id}`).then(()=>{this.initialize(),this.$toastr.success("Account activated successfully")}).catch(l=>console.error("Activation error:",l))},resetPassword(o){u.post(`v1/user/reset-password/${o.id}`).then(()=>{this.$toastr.success("Password reset successfully")}).catch(l=>console.error("Password reset error:",l))}}},M={class:"text-h5"};function j(o,l,V,G,n,d){const _=i("v-text-field"),x=i("v-container"),w=i("v-toolbar-title"),U=i("v-divider"),b=i("v-spacer"),h=i("v-icon"),v=i("v-btn"),C=i("v-card-title"),m=i("v-col"),g=i("v-select"),R=i("v-row"),D=i("v-card-text"),A=i("v-card-actions"),y=i("v-card"),P=i("v-dialog"),z=i("v-toolbar"),p=i("v-tooltip"),S=i("v-data-table"),E=i("Permissions"),L=i("AppLayout");return Q(),B(L,null,{default:t(()=>[e(y,{class:"my-card"},{default:t(()=>[e(x,null,{default:t(()=>[e(_,{modelValue:n.searchQuery,"onUpdate:modelValue":l[0]||(l[0]=s=>n.searchQuery=s),label:"Search",onKeyup:K(d.performSearch,["enter"]),variant:"outlined"},null,8,["modelValue","onKeyup"])]),_:1}),e(S,{headers:n.headers,loading:n.loading,items:n.users,"sort-by":[{key:"name",order:"asc"}]},{top:t(()=>[e(z,{flat:""},{default:t(()=>[e(w,null,{default:t(()=>[a("Admin")]),_:1}),e(U,{class:"mx-4",inset:"",vertical:""}),e(b),e(P,{modelValue:n.dialog,"onUpdate:modelValue":l[10]||(l[10]=s=>n.dialog=s),"max-width":"800px"},{activator:t(({props:s})=>[e(v,f({color:"black",dark:"",class:"mb-2"},s,{elevation:"2",rounded:"",onClick:l[1]||(l[1]=r=>n.dialog=!0)}),{default:t(()=>[e(h,{left:""},{default:t(()=>[a("mdi-plus")]),_:1}),a(" New Admin ")]),_:2},1040)]),default:t(()=>[e(y,null,{default:t(()=>[e(C,null,{default:t(()=>[F("span",M,O(d.formTitle),1)]),_:1}),e(D,null,{default:t(()=>[e(x,null,{default:t(()=>[e(R,null,{default:t(()=>[e(m,{cols:"12",sm:"6"},{default:t(()=>[e(_,{modelValue:n.editedItem.name,"onUpdate:modelValue":l[2]||(l[2]=s=>n.editedItem.name=s),label:"Name"},null,8,["modelValue"])]),_:1}),e(m,{cols:"12",sm:"6"},{default:t(()=>[e(_,{modelValue:n.editedItem.email,"onUpdate:modelValue":l[3]||(l[3]=s=>n.editedItem.email=s),label:"Email"},null,8,["modelValue"])]),_:1}),e(m,{cols:"12",sm:"6"},{default:t(()=>[e(_,{modelValue:n.editedItem.address,"onUpdate:modelValue":l[4]||(l[4]=s=>n.editedItem.address=s),label:"Address"},null,8,["modelValue"])]),_:1}),e(m,{cols:"12",sm:"6"},{default:t(()=>[e(_,{modelValue:n.editedItem.phone,"onUpdate:modelValue":l[5]||(l[5]=s=>n.editedItem.phone=s),label:"Phone"},null,8,["modelValue"])]),_:1}),e(m,{cols:"12",sm:"6"},{default:t(()=>[e(g,{modelValue:n.editedItem.selectedRole,"onUpdate:modelValue":l[6]||(l[6]=s=>n.editedItem.selectedRole=s),items:n.roles,"item-title":"name","item-value":"name",label:"Role"},null,8,["modelValue","items"])]),_:1}),e(m,{cols:"12",sm:"6"},{default:t(()=>[e(_,{modelValue:n.editedItem.phone_number,"onUpdate:modelValue":l[7]||(l[7]=s=>n.editedItem.phone_number=s),label:"Agent SIP"},null,8,["modelValue"])]),_:1}),e(m,{cols:"12",sm:"6"},{default:t(()=>[e(g,{modelValue:n.editedItem.branch_id,"onUpdate:modelValue":l[8]||(l[8]=s=>n.editedItem.branch_id=s),items:o.branches,"item-title":"name","item-value":"id",label:"Branch"},null,8,["modelValue","items"])]),_:1}),e(m,{cols:"12",sm:"6"},{default:t(()=>[e(g,{modelValue:n.editedItem.country_id,"onUpdate:modelValue":l[9]||(l[9]=s=>n.editedItem.country_id=s),items:o.countries,"item-title":"name","item-value":"id",label:"Country"},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1})]),_:1}),e(A,null,{default:t(()=>[e(b),e(v,{color:"blue-darken-1",variant:"text",onClick:d.close},{default:t(()=>[a(" Cancel ")]),_:1},8,["onClick"]),e(v,{color:"blue-darken-1",variant:"text",onClick:d.save},{default:t(()=>[a(" Save ")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(P,{modelValue:n.dialogDelete,"onUpdate:modelValue":l[11]||(l[11]=s=>n.dialogDelete=s),"max-width":"500px"},{default:t(()=>[e(y,null,{default:t(()=>[e(C,{class:"text-h5"},{default:t(()=>[a(" Are you sure you want to delete this item? ")]),_:1}),e(A,null,{default:t(()=>[e(b),e(v,{color:"blue-darken-1",variant:"text",onClick:d.closeDelete},{default:t(()=>[a(" Cancel ")]),_:1},8,["onClick"]),e(v,{color:"blue-darken-1",variant:"text",onClick:d.deleteItemConfirm},{default:t(()=>[a(" OK ")]),_:1},8,["onClick"]),e(b)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),"item.actions":t(({item:s})=>[e(p,{bottom:"",text:"Edit"},{activator:t(({on:r,attrs:c})=>[e(h,f(c,I(r),{size:"large",color:"info",class:"me-2",onClick:k=>d.editItem(s)}),{default:t(()=>[a(" mdi-pencil ")]),_:2},1040,["onClick"])]),_:2},1024),e(p,{bottom:"",text:"Delete"},{activator:t(({on:r,attrs:c})=>[e(h,f(c,I(r),{size:"large",color:"error",class:"me-2",onClick:k=>d.deleteItem(s)}),{default:t(()=>[a(" mdi-delete ")]),_:2},1040,["onClick"])]),_:2},1024),e(p,{bottom:"",text:"Activate Account"},{activator:t(({on:r,attrs:c})=>[e(h,f(c,I(r),{size:"large",color:"success",class:"me-2",onClick:k=>d.activateAccount(s)}),{default:t(()=>[a(" mdi-account-check ")]),_:2},1040,["onClick"])]),_:2},1024),e(p,{bottom:"",text:"Reset Password"},{activator:t(({on:r,attrs:c})=>[e(h,f(c,I(r),{size:"large",color:"warning",class:"me-2",onClick:k=>d.resetPassword(s)}),{default:t(()=>[a(" mdi-lock-reset ")]),_:2},1040,["onClick"])]),_:2},1024),e(p,{bottom:"",text:"Manage Permissions"},{activator:t(({on:r,attrs:c})=>[e(h,f(c,I(r),{size:"large",color:"primary",class:"me-2",onClick:k=>d.managePermissions(s)}),{default:t(()=>[a(" mdi-account-key ")]),_:2},1040,["onClick"])]),_:2},1024)]),"no-data":t(()=>[e(v,{color:"primary",onClick:d.initialize},{default:t(()=>[a(" Reset ")]),_:1},8,["onClick"])]),_:1},8,["headers","loading","items"]),e(E,{ref:"PermissionsComponent"},null,512)]),_:1})]),_:1})}const Z=q(H,[["render",j],["__scopeId","data-v-f2d1d7db"]]);export{Z as default};

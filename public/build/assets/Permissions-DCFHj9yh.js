import{s as h,i as r,o as c,c as m,w as i,b as t,f as d,d as f,t as k,e as I,F as x,g as B,p as R,j as z,a as j}from"./app-Ds5uSqDQ.js";import{_ as q}from"./_plugin-vue_export-helper-DlAUqK2U.js";const E={name:"PermissionsDialog",props:{value:{type:Boolean,default:!1},userId:{type:[String,Number],default:""},username:{type:String,default:""}},data(){return{loading:!1,processing:!1,error:null,permissions:[],originalPermissions:[],selectedPermissions:[],selectedUserId:"",searchQuery:""}},computed:{mainDialog:{get(){return this.value},set(e){this.$emit("input",e)}},filteredPermissions(){if(!this.searchQuery)return this.permissions;const e=this.searchQuery.toLowerCase();return this.permissions.filter(s=>s.name.toLowerCase().includes(e)||s.description&&s.description.toLowerCase().includes(e))},noChanges(){return this.originalPermissions.length!==this.selectedPermissions.length?!1:this.originalPermissions.every(e=>this.selectedPermissions.includes(e))}},watch:{userId(e){e&&(this.selectedUserId=e)},value(e){e&&this.userId&&this.initialize()}},methods:{initialize(){this.loading=!0,this.error=null,this.selectedUserId=this.userId,Promise.all([this.fetchPermissions(),this.fetchUserPermissions()]).catch(e=>{this.error="Failed to load permissions data. Please try again.",console.error("Initialization error:",e)}).finally(()=>{this.loading=!1})},async fetchPermissions(){try{const s=await h.get("/api/v1/permissions");return this.permissions=s.data.map(n=>({...n,description:n.description||`Permission for ${n.name}`})),s}catch(e){throw console.error("Fetch permissions error:",e),e}},async fetchUserPermissions(){try{const e=`/api/v1/users/${this.selectedUserId}/permissions`,s=await h.get(e);return this.selectedPermissions=[...s.data],this.originalPermissions=[...s.data],s}catch(e){throw console.error("Fetch user permissions error:",e),e}},selectAll(e){if(e){const s=this.filteredPermissions.map(n=>n.name);this.selectedPermissions=[...new Set([...this.selectedPermissions,...s])]}else{const s=this.filteredPermissions.map(n=>n.name);this.selectedPermissions=this.selectedPermissions.filter(n=>!s.includes(n))}},closeDialog(){this.mainDialog=!1,this.resetForm()},resetForm(){this.searchQuery="",this.selectedPermissions=[],this.originalPermissions=[],this.error=null},async updatePermissions(){this.processing=!0,this.error=null;try{const e=`/api/v1/users/${this.selectedUserId}/permissions`,s={permissions:this.selectedPermissions};await h.put(e,s),this.$emit("permissions-updated",{userId:this.selectedUserId,permissions:this.selectedPermissions}),this.$toastr.success("Permissions updated successfully"),this.closeDialog()}catch(e){console.error("Update permissions error:",e),this.error="Failed to update permissions. Please try again.",this.$toastr.error("Failed to update permissions")}finally{this.processing=!1}}}},G=e=>(R("data-v-a0e9fe8d"),e=e(),z(),e),M=G(()=>j("span",null,"Permission Groups",-1)),T={key:0,class:"text-caption grey--text"};function H(e,s,n,J,o,l){const C=r("v-toolbar-title"),p=r("v-spacer"),U=r("v-icon"),u=r("v-btn"),w=r("v-toolbar"),V=r("v-progress-circular"),_=r("v-row"),D=r("v-text-field"),g=r("v-alert"),S=r("v-card-title"),v=r("v-divider"),A=r("v-checkbox"),y=r("v-col"),P=r("v-card-text"),b=r("v-card"),F=r("v-card-actions"),L=r("v-dialog");return c(),m(L,{modelValue:l.mainDialog,"onUpdate:modelValue":s[4]||(s[4]=a=>l.mainDialog=a),"max-width":"800",persistent:""},{default:i(()=>[t(b,{class:"permissions-card",outlined:""},{default:i(()=>[t(w,{flat:"",color:"primary",dark:""},{default:i(()=>[t(C,null,{default:i(()=>[d("Manage User Permissions")]),_:1}),t(p),t(u,{icon:"",onClick:l.closeDialog},{default:i(()=>[t(U,null,{default:i(()=>[d("mdi-close")]),_:1})]),_:1},8,["onClick"])]),_:1}),t(P,{class:"pt-6"},{default:i(()=>[o.loading?(c(),m(_,{key:0,justify:"center",class:"my-4"},{default:i(()=>[t(V,{indeterminate:"",color:"primary"})]),_:1})):(c(),f(x,{key:1},[t(D,{modelValue:o.searchQuery,"onUpdate:modelValue":s[0]||(s[0]=a=>o.searchQuery=a),"prepend-icon":"mdi-magnify",label:"Search permissions",clearable:"",dense:"",outlined:"",class:"mb-4"},null,8,["modelValue"]),o.error?(c(),m(g,{key:0,type:"error",dense:"",dismissible:"",class:"mb-4"},{default:i(()=>[d(k(o.error),1)]),_:1})):I("",!0),t(_,null,{default:i(()=>[t(y,{cols:"12"},{default:i(()=>[t(b,{flat:"",outlined:""},{default:i(()=>[t(S,{class:"subtitle-1 py-2"},{default:i(()=>[M,t(p),t(u,{text:"",small:"",color:"primary",onClick:s[1]||(s[1]=a=>l.selectAll(!0)),class:"mr-2"},{default:i(()=>[d(" Select All ")]),_:1}),t(u,{text:"",small:"",color:"error",onClick:s[2]||(s[2]=a=>l.selectAll(!1))},{default:i(()=>[d(" Deselect All ")]),_:1})]),_:1}),t(v),t(P,{class:"permissions-container"},{default:i(()=>[l.filteredPermissions.length?(c(),m(_,{key:0},{default:i(()=>[(c(!0),f(x,null,B(l.filteredPermissions,(a,N)=>(c(),m(y,{key:N,cols:"12",md:"4",sm:"6"},{default:i(()=>[t(A,{modelValue:o.selectedPermissions,"onUpdate:modelValue":s[3]||(s[3]=Q=>o.selectedPermissions=Q),label:a.name,value:a.name,disabled:o.processing,hint:a.description,"persistent-hint":"",dense:""},null,8,["modelValue","label","value","disabled","hint"])]),_:2},1024))),128))]),_:1})):(c(),m(g,{key:1,type:"info",text:""},{default:i(()=>[d(" No permissions match your search criteria ")]),_:1}))]),_:1})]),_:1})]),_:1})]),_:1})],64))]),_:1}),t(v),t(F,{class:"pa-4"},{default:i(()=>[o.selectedPermissions.length?(c(),f("span",T,k(o.selectedPermissions.length)+" permission(s) selected ",1)):I("",!0),t(p),t(u,{text:"",color:"grey darken-1",onClick:l.closeDialog,disabled:o.processing},{default:i(()=>[d(" Cancel ")]),_:1},8,["onClick","disabled"]),t(u,{color:"primary",onClick:l.updatePermissions,loading:o.processing,disabled:o.processing||l.noChanges,depressed:""},{default:i(()=>[d(" Save Changes ")]),_:1},8,["onClick","loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}const W=q(E,[["render",H],["__scopeId","data-v-a0e9fe8d"]]);export{W as default};
